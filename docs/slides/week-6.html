<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Week 6 – ESS 523c</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5b6eb65566b1f8a996f1287d789c0740.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-c63d9198b28a859559c0f0cce9729cfa.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../site_libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="../site_libs/tabwid-1.1.3/tabwid.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../csu-rams-logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ESS 523c</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mikejohnson51/csu-ess-523c/"> <i class="bi bi-github" role="img" aria-label="ESS 523c">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction <img src="hexes/tidymodels.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#classification-vs.-prediction" id="toc-classification-vs.-prediction" class="nav-link" data-scroll-target="#classification-vs.-prediction">Classification vs.&nbsp;Prediction</a></li>
  <li><a href="#classification-models" id="toc-classification-models" class="nav-link" data-scroll-target="#classification-models">Classification Models</a></li>
  <li><a href="#prediction-models" id="toc-prediction-models" class="nav-link" data-scroll-target="#prediction-models">Prediction Models</a></li>
  <li><a href="#choosing-the-right-model" id="toc-choosing-the-right-model" class="nav-link" data-scroll-target="#choosing-the-right-model">Choosing the Right Model</a></li>
  <li><a href="#model-selection-considerations" id="toc-model-selection-considerations" class="nav-link" data-scroll-target="#model-selection-considerations">Model Selection Considerations</a></li>
  <li><a href="#load-required-libraries" id="toc-load-required-libraries" class="nav-link" data-scroll-target="#load-required-libraries">Load Required Libraries <img src="hexes/tidyverse.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/tidymodels.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/forested.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/forested.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></a></li>
  <li><a href="#machine-learning-specifications-in-tidymodels" id="toc-machine-learning-specifications-in-tidymodels" class="nav-link" data-scroll-target="#machine-learning-specifications-in-tidymodels">Machine Learning Specifications in <code>tidymodels</code></a>
  <ul class="collapse">
  <li><a href="#unified-interface-for-ml-models" id="toc-unified-interface-for-ml-models" class="nav-link" data-scroll-target="#unified-interface-for-ml-models">Unified Interface for ML Models <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#what-are-hyperparameters" id="toc-what-are-hyperparameters" class="nav-link" data-scroll-target="#what-are-hyperparameters">What are hyperparameters?</a></li>
  </ul></li>
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression">1. Linear Regression</a>
  <ul class="collapse">
  <li><a href="#components-of-linear-regression" id="toc-components-of-linear-regression" class="nav-link" data-scroll-target="#components-of-linear-regression">Components of Linear Regression</a></li>
  <li><a href="#linear-regression-in-tidymodels" id="toc-linear-regression-in-tidymodels" class="nav-link" data-scroll-target="#linear-regression-in-tidymodels">Linear Regression in <code>tidymodels</code></a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></a></li>
  </ul></li>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression">Logistic Regression</a>
  <ul class="collapse">
  <li><a href="#why-use-logistic-regression" id="toc-why-use-logistic-regression" class="nav-link" data-scroll-target="#why-use-logistic-regression">Why Use Logistic Regression?</a></li>
  <li><a href="#components-of-logistic-regression" id="toc-components-of-logistic-regression" class="nav-link" data-scroll-target="#components-of-logistic-regression">Components of Logistic Regression</a></li>
  <li><a href="#variants-of-logistic-regression" id="toc-variants-of-logistic-regression" class="nav-link" data-scroll-target="#variants-of-logistic-regression">Variants of Logistic Regression</a></li>
  <li><a href="#building-a-logistic-regression-model" id="toc-building-a-logistic-regression-model" class="nav-link" data-scroll-target="#building-a-logistic-regression-model">Building a Logistic Regression Model</a></li>
  <li><a href="#advantages-and-disadvantages" id="toc-advantages-and-disadvantages" class="nav-link" data-scroll-target="#advantages-and-disadvantages">Advantages and Disadvantages</a></li>
  <li><a href="#logistic-regression-in-tidymodels" id="toc-logistic-regression-in-tidymodels" class="nav-link" data-scroll-target="#logistic-regression-in-tidymodels">Logistic Regression in <code>tidymodels</code></a></li>
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1">Example <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  <li><a href="#decision-tree" id="toc-decision-tree" class="nav-link" data-scroll-target="#decision-tree">3. Decision Tree</a>
  <ul class="collapse">
  <li><a href="#why-use-decision-trees" id="toc-why-use-decision-trees" class="nav-link" data-scroll-target="#why-use-decision-trees">Why Use Decision Trees?</a></li>
  <li><a href="#components-of-a-decision-tree" id="toc-components-of-a-decision-tree" class="nav-link" data-scroll-target="#components-of-a-decision-tree">Components of a Decision Tree</a></li>
  <li><a href="#building-a-decision-tree" id="toc-building-a-decision-tree" class="nav-link" data-scroll-target="#building-a-decision-tree">Building a Decision Tree</a></li>
  <li><a href="#advantages-and-disadvantages-1" id="toc-advantages-and-disadvantages-1" class="nav-link" data-scroll-target="#advantages-and-disadvantages-1">Advantages and Disadvantages</a></li>
  <li><a href="#decision-tree-using-tidymodels" id="toc-decision-tree-using-tidymodels" class="nav-link" data-scroll-target="#decision-tree-using-tidymodels">Decision Tree using tidymodels</a></li>
  <li><a href="#example-2" id="toc-example-2" class="nav-link" data-scroll-target="#example-2">Example <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></a></li>
  <li><a href="#conclusion-1" id="toc-conclusion-1" class="nav-link" data-scroll-target="#conclusion-1">Conclusion</a></li>
  </ul></li>
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest">4. Random Forest</a>
  <ul class="collapse">
  <li><a href="#why-use-random-forest" id="toc-why-use-random-forest" class="nav-link" data-scroll-target="#why-use-random-forest">Why Use Random Forest?</a></li>
  <li><a href="#components-of-a-random-forest" id="toc-components-of-a-random-forest" class="nav-link" data-scroll-target="#components-of-a-random-forest">Components of a Random Forest</a></li>
  <li><a href="#building-a-random-forest" id="toc-building-a-random-forest" class="nav-link" data-scroll-target="#building-a-random-forest">Building a Random Forest</a>
  <ul class="collapse">
  <li><a href="#constructing-a-random-forest-involves" id="toc-constructing-a-random-forest-involves" class="nav-link" data-scroll-target="#constructing-a-random-forest-involves">Constructing a Random Forest involves:</a></li>
  <li><a href="#hyperparameters-in-random-forest" id="toc-hyperparameters-in-random-forest" class="nav-link" data-scroll-target="#hyperparameters-in-random-forest">Hyperparameters in Random Forest</a></li>
  </ul></li>
  <li><a href="#advantages-and-disadvantages-2" id="toc-advantages-and-disadvantages-2" class="nav-link" data-scroll-target="#advantages-and-disadvantages-2">Advantages and Disadvantages</a></li>
  <li><a href="#random-forest-implementation-using-tidymodels" id="toc-random-forest-implementation-using-tidymodels" class="nav-link" data-scroll-target="#random-forest-implementation-using-tidymodels">Random Forest Implementation using Tidymodels</a></li>
  <li><a href="#example-3" id="toc-example-3" class="nav-link" data-scroll-target="#example-3">Example <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></a></li>
  <li><a href="#conclusion-2" id="toc-conclusion-2" class="nav-link" data-scroll-target="#conclusion-2">Conclusion</a></li>
  </ul></li>
  <li><a href="#boosting-machines" id="toc-boosting-machines" class="nav-link" data-scroll-target="#boosting-machines">Boosting Machines</a>
  <ul class="collapse">
  <li><a href="#why-use-boosting-machines" id="toc-why-use-boosting-machines" class="nav-link" data-scroll-target="#why-use-boosting-machines">Why Use Boosting Machines?</a></li>
  <li><a href="#components-of-gradient-boosting" id="toc-components-of-gradient-boosting" class="nav-link" data-scroll-target="#components-of-gradient-boosting">Components of Gradient Boosting</a></li>
  <li><a href="#popular-boosting-algorithms" id="toc-popular-boosting-algorithms" class="nav-link" data-scroll-target="#popular-boosting-algorithms">Popular Boosting Algorithms</a></li>
  <li><a href="#building-an-xgboost-model" id="toc-building-an-xgboost-model" class="nav-link" data-scroll-target="#building-an-xgboost-model">Building an XGBoost Model</a></li>
  <li><a href="#advantages-and-disadvantages-3" id="toc-advantages-and-disadvantages-3" class="nav-link" data-scroll-target="#advantages-and-disadvantages-3">Advantages and Disadvantages</a></li>
  <li><a href="#boost-implementation-using-tidymodels" id="toc-boost-implementation-using-tidymodels" class="nav-link" data-scroll-target="#boost-implementation-using-tidymodels">Boost Implementation using Tidymodels</a></li>
  <li><a href="#conclusion-3" id="toc-conclusion-3" class="nav-link" data-scroll-target="#conclusion-3">Conclusion</a></li>
  </ul></li>
  <li><a href="#support-vector-machine-svm" id="toc-support-vector-machine-svm" class="nav-link" data-scroll-target="#support-vector-machine-svm">Support Vector Machine (SVM)</a>
  <ul class="collapse">
  <li><a href="#why-use-svm" id="toc-why-use-svm" class="nav-link" data-scroll-target="#why-use-svm">2. Why Use SVM?</a></li>
  <li><a href="#components-of-svm" id="toc-components-of-svm" class="nav-link" data-scroll-target="#components-of-svm">3. Components of SVM</a></li>
  <li><a href="#building-an-svm-model" id="toc-building-an-svm-model" class="nav-link" data-scroll-target="#building-an-svm-model">Building an SVM Model</a></li>
  <li><a href="#advantages-and-disadvantages-4" id="toc-advantages-and-disadvantages-4" class="nav-link" data-scroll-target="#advantages-and-disadvantages-4">Advantages and Disadvantages</a></li>
  <li><a href="#svm-implementation-using-tidymodels" id="toc-svm-implementation-using-tidymodels" class="nav-link" data-scroll-target="#svm-implementation-using-tidymodels">SVM Implementation using Tidymodels</a></li>
  <li><a href="#conclusion-4" id="toc-conclusion-4" class="nav-link" data-scroll-target="#conclusion-4">Conclusion</a></li>
  </ul></li>
  <li><a href="#neural-networks" id="toc-neural-networks" class="nav-link" data-scroll-target="#neural-networks">Neural Networks</a>
  <ul class="collapse">
  <li><a href="#why-use-neural-networks" id="toc-why-use-neural-networks" class="nav-link" data-scroll-target="#why-use-neural-networks">Why Use Neural Networks?</a></li>
  <li><a href="#components-of-a-neural-network" id="toc-components-of-a-neural-network" class="nav-link" data-scroll-target="#components-of-a-neural-network">Components of a Neural Network</a></li>
  <li><a href="#training-a-neural-network" id="toc-training-a-neural-network" class="nav-link" data-scroll-target="#training-a-neural-network">Training a Neural Network</a></li>
  <li><a href="#advantages-and-disadvantages-5" id="toc-advantages-and-disadvantages-5" class="nav-link" data-scroll-target="#advantages-and-disadvantages-5">Advantages and Disadvantages</a></li>
  <li><a href="#varients-of-neural-networks" id="toc-varients-of-neural-networks" class="nav-link" data-scroll-target="#varients-of-neural-networks">Varients of Neural Networks</a></li>
  <li><a href="#neural-network-implementation" id="toc-neural-network-implementation" class="nav-link" data-scroll-target="#neural-network-implementation">Neural Network Implementation</a></li>
  <li><a href="#example-4" id="toc-example-4" class="nav-link" data-scroll-target="#example-4">Example <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></a></li>
  <li><a href="#conclusion-5" id="toc-conclusion-5" class="nav-link" data-scroll-target="#conclusion-5">Conclusion</a></li>
  <li><a href="#wrap-up" id="toc-wrap-up" class="nav-link" data-scroll-target="#wrap-up">Wrap up <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></a></li>
  <li><a href="#model-performance-comparision" id="toc-model-performance-comparision" class="nav-link" data-scroll-target="#model-performance-comparision">Model Performance Comparision <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation">Model Evaluation <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#the-whole-game---status-update" id="toc-the-whole-game---status-update" class="nav-link" data-scroll-target="#the-whole-game---status-update">The whole game - status update</a></li>
  <li><a href="#recaping" id="toc-recaping" class="nav-link" data-scroll-target="#recaping">Recaping</a></li>
  <li><a href="#evaluation" id="toc-evaluation" class="nav-link" data-scroll-target="#evaluation">Evaluation</a></li>
  </ul></li>
  <li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification">Classification:</a>
  <ul class="collapse">
  <li><a href="#confusion-matrix" id="toc-confusion-matrix" class="nav-link" data-scroll-target="#confusion-matrix">Confusion matrix <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  </ul></li>
  <li><a href="#what-to-do-with-a-confusion-matrix" id="toc-what-to-do-with-a-confusion-matrix" class="nav-link" data-scroll-target="#what-to-do-with-a-confusion-matrix">What to do with a confusion matrix</a>
  <ul class="collapse">
  <li><a href="#accuracy" id="toc-accuracy" class="nav-link" data-scroll-target="#accuracy">1. Accuracy <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#sensitivity" id="toc-sensitivity" class="nav-link" data-scroll-target="#sensitivity">2. Sensitivity <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#specificity" id="toc-specificity" class="nav-link" data-scroll-target="#specificity">3. Specificity <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#two-class-data" id="toc-two-class-data" class="nav-link" data-scroll-target="#two-class-data">Two class data</a></li>
  <li><a href="#varying-the-threshold" id="toc-varying-the-threshold" class="nav-link" data-scroll-target="#varying-the-threshold">Varying the threshold</a></li>
  <li><a href="#roc-curves" id="toc-roc-curves" class="nav-link" data-scroll-target="#roc-curves">ROC curves</a></li>
  <li><a href="#roc-curves-1" id="toc-roc-curves-1" class="nav-link" data-scroll-target="#roc-curves-1">ROC curves</a></li>
  <li><a href="#roc-curves-2" id="toc-roc-curves-2" class="nav-link" data-scroll-target="#roc-curves-2">ROC curves <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#brier-score" id="toc-brier-score" class="nav-link" data-scroll-target="#brier-score">Brier score</a></li>
  <li><a href="#brier-score-1" id="toc-brier-score-1" class="nav-link" data-scroll-target="#brier-score-1">Brier score</a></li>
  <li><a href="#separation-vs-calibration" id="toc-separation-vs-calibration" class="nav-link" data-scroll-target="#separation-vs-calibration">Separation vs calibration</a></li>
  </ul></li>
  <li><a href="#regression" id="toc-regression" class="nav-link" data-scroll-target="#regression">Regression</a>
  <ul class="collapse">
  <li><a href="#r-squared-r2" id="toc-r-squared-r2" class="nav-link" data-scroll-target="#r-squared-r2">R-squared (<span class="math inline">\(R^2\)</span>)</a></li>
  <li><a href="#root-mean-squared-error-rmse" id="toc-root-mean-squared-error-rmse" class="nav-link" data-scroll-target="#root-mean-squared-error-rmse">Root Mean Squared Error (RMSE)</a></li>
  <li><a href="#mean-absolute-error-mae" id="toc-mean-absolute-error-mae" class="nav-link" data-scroll-target="#mean-absolute-error-mae">Mean Absolute Error (MAE)</a></li>
  <li><a href="#comparing-metrics" id="toc-comparing-metrics" class="nav-link" data-scroll-target="#comparing-metrics">Comparing Metrics</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#metrics-selection-model-performance" id="toc-metrics-selection-model-performance" class="nav-link" data-scroll-target="#metrics-selection-model-performance">Metrics Selection model performance <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  </ul></li>
  <li><a href="#recap" id="toc-recap" class="nav-link" data-scroll-target="#recap">Recap</a>
  <ul class="collapse">
  <li><a href="#previously---setup" id="toc-previously---setup" class="nav-link" data-scroll-target="#previously---setup">Previously - Setup <img src="hexes/tidymodels.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#previously---data-usage" id="toc-previously---data-usage" class="nav-link" data-scroll-target="#previously---data-usage">Previously - Data Usage <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#previously---feature-engineering" id="toc-previously---feature-engineering" class="nav-link" data-scroll-target="#previously---feature-engineering">Previously - Feature engineering <img src="hexes/recipes.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  </ul></li>
  <li><a href="#optimizing-models-via-tuning-hyperparameter" id="toc-optimizing-models-via-tuning-hyperparameter" class="nav-link" data-scroll-target="#optimizing-models-via-tuning-hyperparameter">Optimizing Models via Tuning Hyperparameter</a>
  <ul class="collapse">
  <li><a href="#tuning-parameters" id="toc-tuning-parameters" class="nav-link" data-scroll-target="#tuning-parameters">Tuning parameters</a></li>
  <li><a href="#tagging-parameters-for-tuning" id="toc-tagging-parameters-for-tuning" class="nav-link" data-scroll-target="#tagging-parameters-for-tuning">Tagging parameters for tuning <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#boosted-trees" id="toc-boosted-trees" class="nav-link" data-scroll-target="#boosted-trees">Boosted Trees</a></li>
  <li><a href="#boosted-tree-tuning-parameters" id="toc-boosted-tree-tuning-parameters" class="nav-link" data-scroll-target="#boosted-tree-tuning-parameters">Boosted Tree Tuning Parameters</a></li>
  <li><a href="#boosted-tree-tuning-parameters-1" id="toc-boosted-tree-tuning-parameters-1" class="nav-link" data-scroll-target="#boosted-tree-tuning-parameters-1">Boosted Tree Tuning Parameters <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></a></li>
  <li><a href="#optimize-tuning-parameters" id="toc-optimize-tuning-parameters" class="nav-link" data-scroll-target="#optimize-tuning-parameters">Optimize tuning parameters</a></li>
  <li><a href="#grid-search" id="toc-grid-search" class="nav-link" data-scroll-target="#grid-search">1. Grid search</a></li>
  <li><a href="#grid-search-1" id="toc-grid-search-1" class="nav-link" data-scroll-target="#grid-search-1">1. Grid search</a></li>
  <li><a href="#iterative-search" id="toc-iterative-search" class="nav-link" data-scroll-target="#iterative-search">2. Iterative Search</a></li>
  </ul></li>
  <li><a href="#grid-search-example" id="toc-grid-search-example" class="nav-link" data-scroll-target="#grid-search-example">Grid Search Example</a>
  <ul class="collapse">
  <li><a href="#parameters" id="toc-parameters" class="nav-link" data-scroll-target="#parameters">Parameters</a></li>
  <li><a href="#different-types-of-grids" id="toc-different-types-of-grids" class="nav-link" data-scroll-target="#different-types-of-grids">Different types of grids <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#create-a-grid" id="toc-create-a-grid" class="nav-link" data-scroll-target="#create-a-grid">Create a grid <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></a></li>
  <li><a href="#create-a-grid-1" id="toc-create-a-grid-1" class="nav-link" data-scroll-target="#create-a-grid-1">Create a grid <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></a></li>
  <li><a href="#create-a-sfd-curve" id="toc-create-a-sfd-curve" class="nav-link" data-scroll-target="#create-a-sfd-curve">Create a SFD curve <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></a></li>
  <li><a href="#create-a-regular-grid" id="toc-create-a-regular-grid" class="nav-link" data-scroll-target="#create-a-regular-grid">Create a regular grid <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></a></li>
  <li><a href="#update-parameter-ranges" id="toc-update-parameter-ranges" class="nav-link" data-scroll-target="#update-parameter-ranges">Update parameter ranges <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></a></li>
  <li><a href="#the-results" id="toc-the-results" class="nav-link" data-scroll-target="#the-results">The results <img src="hexes/ggplot2.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></a></li>
  </ul></li>
  <li><a href="#use-the-tune_-functions-to-tune-models" id="toc-use-the-tune_-functions-to-tune-models" class="nav-link" data-scroll-target="#use-the-tune_-functions-to-tune-models">Use the <code>tune_*()</code> functions to tune models</a>
  <ul class="collapse">
  <li><a href="#choosing-tuning-parameters" id="toc-choosing-tuning-parameters" class="nav-link" data-scroll-target="#choosing-tuning-parameters">Choosing tuning parameters <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/recipes.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="192" width="64" height="74"></a></li>
  <li><a href="#grid-search-2" id="toc-grid-search-2" class="nav-link" data-scroll-target="#grid-search-2">Grid Search <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></a></li>
  <li><a href="#grid-search-3" id="toc-grid-search-3" class="nav-link" data-scroll-target="#grid-search-3">Grid Search <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></a></li>
  <li><a href="#grid-results" id="toc-grid-results" class="nav-link" data-scroll-target="#grid-results">Grid results <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#tuning-results" id="toc-tuning-results" class="nav-link" data-scroll-target="#tuning-results">Tuning results <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#choose-a-parameter-combination" id="toc-choose-a-parameter-combination" class="nav-link" data-scroll-target="#choose-a-parameter-combination">Choose a parameter combination <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#choose-a-parameter-combination-1" id="toc-choose-a-parameter-combination-1" class="nav-link" data-scroll-target="#choose-a-parameter-combination-1">Choose a parameter combination <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#checking-calibration" id="toc-checking-calibration" class="nav-link" data-scroll-target="#checking-calibration">Checking Calibration <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/probably.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></a></li>
  <li><a href="#the-final-fit" id="toc-the-final-fit" class="nav-link" data-scroll-target="#the-final-fit">The final fit!</a></li>
  <li><a href="#the-final-fit-1" id="toc-the-final-fit-1" class="nav-link" data-scroll-target="#the-final-fit-1">The final fit!</a></li>
  <li><a href="#the-whole-game" id="toc-the-whole-game" class="nav-link" data-scroll-target="#the-whole-game">The whole game</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="week-6.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 6</h1>
<p class="subtitle lead">Machine Learning Part 2</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction <img src="hexes/tidymodels.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<p>Machine learning (ML) is widely used in environmental science for tasks such as land cover classification, climate modeling, and forested distribution prediction. This lecture explores five common ML model specifications the <code>tidymodels</code> framework in R, applied to the <code>forested</code> dataset.</p>
<ol type="1">
<li><p>Linear Regression<br>
</p></li>
<li><p>Logistic Regression<br>
</p></li>
<li><p>Trees<br>
</p>
<ul>
<li>Decision Tree<br>
</li>
<li>Random Forest<br>
</li>
<li>Boost<br>
</li>
</ul></li>
<li><p>Support Vector Machines<br>
</p></li>
<li><p>Neural Nets<br>
</p></li>
</ol>
</section>
<section id="classification-vs.-prediction" class="level2">
<h2 class="anchored" data-anchor-id="classification-vs.-prediction">Classification vs.&nbsp;Prediction</h2>
<p>Most machine learning applications in environmental science serve different purposes (modes):</p>
<p><strong>Classification Models</strong> → Categorize features into predefined classes.</p>
<p><strong>Prediction Models</strong> → Forecast numerical environmental variables based on past trends.</p>
<p><br></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/ml_illustration.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="classification-models" class="level2">
<h2 class="anchored" data-anchor-id="classification-models">Classification Models</h2>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Goal: Categorize phenomena into discrete classes.</p>
</div>
</div>
</div>
<section id="examples" class="level4">
<h4 class="anchored" data-anchor-id="examples">Examples:</h4>
<p>✅ Land Cover Classification (Forest, Urban, Water, Agriculture)<br>
✅ Flood Risk Assessment (High, Medium, Low)<br>
✅ Drought Severity Levels (No Drought, Moderate, Severe)<br>
✅ Wildfire Prediction (Fire vs.&nbsp;No Fire)<br>
✅ forested Identification (Bird forested, Plant Types)</p>
</section>
<section id="common-algorithms" class="level4">
<h4 class="anchored" data-anchor-id="common-algorithms">Common Algorithms:</h4>
<ul>
<li>Decision Trees<br>
</li>
<li>Random Forest<br>
</li>
<li>Support Vector Machines (SVM)&nbsp;</li>
<li>Neural Networks (for remote sensing &amp; image analysis)<br>
</li>
<li>K-Nearest Neighbors (KNN)<br>
</li>
</ul>
</section>
</section>
<section id="prediction-models" class="level2">
<h2 class="anchored" data-anchor-id="prediction-models">Prediction Models</h2>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Goal: Estimate continuous environmental variables.</p>
</div>
</div>
</div>
<section id="examples-1" class="level4">
<h4 class="anchored" data-anchor-id="examples-1">Examples:</h4>
<p>📈 Streamflow Forecasting (Predict river discharge over time)<br>
🌡️ Temperature Projections (Future temperature changes under climate scenarios)<br>
☔ Precipitation Forecasting (Rainfall estimates for flood preparedness)<br>
📊 Air Quality Index Prediction (Forecast pollution levels)<br>
</p>
</section>
<section id="common-algorithms-1" class="level4">
<h4 class="anchored" data-anchor-id="common-algorithms-1">Common Algorithms:</h4>
<ul>
<li>Linear &amp; Multiple Regression<br>
</li>
<li>Random Forest Regression<br>
</li>
<li>Long Short-Term Memory (LSTM) Neural Networks (for time series forecasting)<br>
</li>
</ul>
</section>
</section>
<section id="choosing-the-right-model" class="level2">
<h2 class="anchored" data-anchor-id="choosing-the-right-model">Choosing the Right Model</h2>
<ul>
<li><p>Use <u>classification</u> if: You need to categorize environmental states (e.g., classifying land use changes).</p></li>
<li><p>Use <u>prediction</u> if: You need to forecast environmental conditions (e.g., predicting flood levels)</p></li>
<li><p>Use <u>hybrid approaches</u> if: You need to classify and predict (e.g., classifying drought severity and then predicting future water availability).</p></li>
</ul>
</section>
<section id="model-selection-considerations" class="level2">
<h2 class="anchored" data-anchor-id="model-selection-considerations">Model Selection Considerations</h2>
<p>Choosing an ML algorithm (model) depends on:</p>
<ul>
<li><p><strong>Dataset Size</strong>: e.g.&nbsp;Large datasets benefit from ensemble methods like Random Forest and XGBoost.</p></li>
<li><p><strong>Feature Complexity</strong>: e.g.&nbsp;SVM works well for high-dimensional data.</p></li>
<li><p><strong>Interpretability Needs</strong>: e.g.&nbsp;Decision trees and LASSO regression provide intuitive insights.</p></li>
<li><p><strong>Computation Constraints</strong>: e.g.&nbsp;GLM and Decision Trees are efficient compared to XGBoost.</p></li>
<li><p><strong>Data</strong>: Variance, linearity, diminsionality</p></li>
</ul>
</section>
<section id="load-required-libraries" class="level2">
<h2 class="anchored" data-anchor-id="load-required-libraries">Load Required Libraries <img src="hexes/tidyverse.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/tidymodels.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/forested.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forested)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data Preparation <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/forested.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></h2>
<p>We will use the <code>forested</code> dataset for classification tasks. The dataset contains information about penguin forested, body measurements, and other environmental factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>forested_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(forested, <span class="at">strata =</span> tree_no_tree)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>forested_train <span class="ot">&lt;-</span> <span class="fu">training</span>(forested_split)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>forested_test  <span class="ot">&lt;-</span> <span class="fu">testing</span>(forested_split)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>forested_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(forested_train, <span class="at">v =</span> <span class="dv">10</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Feature Engineering: Classification</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>forested_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(forested <span class="sc">~</span> ., <span class="at">data =</span> forested_train)  <span class="sc">|&gt;</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())  <span class="sc">|&gt;</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mean</span>(<span class="fu">all_numeric_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="machine-learning-specifications-in-tidymodels" class="level1">
<h1>Machine Learning Specifications in <code>tidymodels</code></h1>
<section id="unified-interface-for-ml-models" class="level2">
<h2 class="anchored" data-anchor-id="unified-interface-for-ml-models">Unified Interface for ML Models <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<ul>
<li>The <code>parsnip</code> package is a part of the <code>tidymodels</code> framework</li>
<li>It provides a consistent interface for specifying models through specifications</li>
<li>The combination of a specification, mode, and engine is called a model</li>
<li>Lets look at the parsnip <a href="https://www.tidymodels.org/find/parsnip/">documentation</a>!</li>
</ul>
</section>
<section id="what-are-hyperparameters" class="level2">
<h2 class="anchored" data-anchor-id="what-are-hyperparameters">What are hyperparameters?</h2>
<ul>
<li>Hyperparameters are settings that control the learning process of a model.</li>
<li>They are set before training and affect the model’s performance.</li>
<li>Hyperparameters can be tuned to optimize the model’s predictive power.</li>
<li>More on model tuning next week!</li>
</ul>
</section>
</section>
<section id="linear-regression" class="level1">
<h1>1. Linear Regression</h1>
<p>Linear regression is a fundamental statistical method used for modeling the relationship between a dependent variable and one or more independent variables. It is widely used in environmental science for tasks such as predicting forested distribution, estimating climate variables, and modeling ecosystem dynamics.</p>
<section id="components-of-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="components-of-linear-regression">Components of Linear Regression</h2>
<ul>
<li><strong>Dependent Variable (Y)</strong>: The variable to be predicted.</li>
<li><strong>Independent Variables (X)</strong>: Features that influence the dependent variable.</li>
<li><strong>Regression Line</strong>: Represents the relationship between X and Y.</li>
<li><strong>Residuals</strong>: Differences between predicted and actual values.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/lm-gif.gif" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="linear-regression-in-tidymodels" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression-in-tidymodels">Linear Regression in <code>tidymodels</code></h2>
<section id="specification" class="level4">
<h4 class="anchored" data-anchor-id="specification">Specification</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">linear_reg</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linear Regression Model Specification (regression)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Computational engine: lm</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="engines-modes" class="level4">
<h4 class="anchored" data-anchor-id="engines-modes">engines &amp; modes <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_engines</span>(<span class="st">"linear_reg"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">specification =</span> <span class="st">"linear_reg"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flextable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-ea1d3e8a{}.cl-ea1a6eb2{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-ea1bc168{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ea1bcc58{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ea1bcc59{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ea1bcc62{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-ea1d3e8a"><thead><tr style="overflow-wrap:break-word;"><th class="cl-ea1bcc58"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">engine</span></p></th><th class="cl-ea1bcc58"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">mode</span></p></th><th class="cl-ea1bcc58"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">specification</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">lm</span></p></td><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">regression</span></p></td><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">linear_reg</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">glm</span></p></td><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">regression</span></p></td><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">linear_reg</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">glmnet</span></p></td><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">regression</span></p></td><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">linear_reg</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">stan</span></p></td><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">regression</span></p></td><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">linear_reg</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">spark</span></p></td><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">regression</span></p></td><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">linear_reg</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">keras</span></p></td><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">regression</span></p></td><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">linear_reg</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">brulee</span></p></td><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">regression</span></p></td><td class="cl-ea1bcc59"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">linear_reg</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ea1bcc62"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">quantreg</span></p></td><td class="cl-ea1bcc62"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">quantile regression</span></p></td><td class="cl-ea1bcc62"><p class="cl-ea1bc168"><span class="cl-ea1a6eb2">linear_reg</span></p></td></tr></tbody></table></div>
</div>
</div>
</section>
</section>
<section id="example" class="level2">
<h2 class="anchored" data-anchor-id="example">Example <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>lm_mod <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">mode =</span> <span class="st">"regression"</span>, <span class="at">engine =</span> <span class="st">"lm"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">workflow</span>() <span class="sc">|&gt;</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_formula</span>(elevation <span class="sc">~</span> .) <span class="sc">|&gt;</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_mod) <span class="sc">|&gt;</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resample =</span> forested_folds) <span class="sc">|&gt;</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 6</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric .estimator   mean     n  std_err .config             </span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 rmse    standard   82.6      10 1.23     Preprocessor1_Model1</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 rsq     standard    0.971    10 0.000733 Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="logistic-regression" class="level1">
<h1>Logistic Regression</h1>
<p>Logistic Regression is used for <em>binary</em> classification tasks. It models the probability that an feature belongs to a category using the logistic (sigmoid) function. Unlike linear regression, which predicts continuous values, logistic regression predicts probabilities and applies a decision threshold to classify outcomes.</p>
<section id="why-use-logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="why-use-logistic-regression">Why Use Logistic Regression?</h2>
<p>Logistic Regression is widely used in machine learning due to its:</p>
<ul>
<li><strong>Simplicity</strong>: Easy to implement and interpret.</li>
<li><strong>Efficiency</strong>: Computationally inexpensive, even on large datasets.</li>
<li><strong>Probabilistic Predictions</strong>: Outputs probabilities instead of hard classifications.</li>
<li><strong>Regularization Support</strong>: Extensions like L1 (Lasso) and L2 (Ridge) help prevent overfitting.</li>
</ul>
</section>
<section id="components-of-logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="components-of-logistic-regression">Components of Logistic Regression</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><strong>Sigmoid Function</strong>: Converts linear outputs into probabilities between 0 and 1.</li>
<li><strong>Decision Boundary</strong>: A threshold (often 0.5) determines classification.</li>
<li><strong>Log-Loss (Binary Cross-Entropy)</strong>: Measures the error between predicted probabilities and actual labels.</li>
<li><strong>Regularization (L1 and L2)</strong>: Helps in feature selection and prevents overfitting.</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/log-reg.gif" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="variants-of-logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="variants-of-logistic-regression">Variants of Logistic Regression</h2>
<ul>
<li><p><strong>Binary Logistic Regression</strong>: Used when the target variable has two classes (e.g., forested vs.&nbsp;not).</p></li>
<li><p><strong>Multinomial Logistic Regression</strong>: Extends logistic regression to multiple classes without assuming ordering.</p></li>
<li><p><strong>Ordinal Logistic Regression</strong>: Handles multi-class classification where order matters (e.g., rating scales).</p></li>
</ul>
</section>
<section id="building-a-logistic-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="building-a-logistic-regression-model">Building a Logistic Regression Model</h2>
<section id="constructing-a-logistic-regression-model-involves" class="level4">
<h4 class="anchored" data-anchor-id="constructing-a-logistic-regression-model-involves">Constructing a Logistic Regression Model involves:</h4>
<ol type="1">
<li>Defining feature (X) and target variable (y).</li>
<li>Applying the sigmoid function to map predictions to probabilities.</li>
<li>Using a loss function (log-loss) to optimize model weights.</li>
<li>Updating weights iteratively via gradient descent.</li>
</ol>
</section>
<section id="hyperparameters-in-logistic-regression" class="level4">
<h4 class="anchored" data-anchor-id="hyperparameters-in-logistic-regression">Hyperparameters in Logistic Regression</h4>
<ul>
<li><strong>penalty</strong>: Type of regularization (L1, L2, or none).</li>
<li><strong>mixture</strong>: A number between zero and one giving the proportion of L1 regularization (i.e.&nbsp;lasso) in the model</li>
</ul>
</section>
</section>
<section id="advantages-and-disadvantages" class="level2">
<h2 class="anchored" data-anchor-id="advantages-and-disadvantages">Advantages and Disadvantages</h2>
<section id="advantages" class="level4">
<h4 class="anchored" data-anchor-id="advantages">Advantages:</h4>
<ul>
<li>Simple and interpretable.</li>
<li>Efficient on large datasets.</li>
<li>Outputs probabilities for uncertainty estimation.</li>
<li>Works well when data is linearly separable.</li>
</ul>
</section>
<section id="disadvantages" class="level4">
<h4 class="anchored" data-anchor-id="disadvantages">Disadvantages:</h4>
<ul>
<li>Assumes a linear decision boundary.</li>
<li>Sensitive to outliers.</li>
<li>Can underperform on complex, non-linear data.</li>
</ul>
</section>
</section>
<section id="logistic-regression-in-tidymodels" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression-in-tidymodels">Logistic Regression in <code>tidymodels</code></h2>
<section id="specification-1" class="level4">
<h4 class="anchored" data-anchor-id="specification-1">Specification</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logistic_reg</span>()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Logistic Regression Model Specification (classification)</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Computational engine: glm</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="engines-modes-1" class="level4">
<h4 class="anchored" data-anchor-id="engines-modes-1">engines &amp; modes <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_engines</span>(<span class="st">'logistic_reg'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">specification =</span> <span class="st">"logistic_reg"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flextable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-ea3ee5b2{}.cl-ea395052{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-ea3a39e0{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ea3a4354{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ea3a4355{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ea3a4356{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-ea3ee5b2"><thead><tr style="overflow-wrap:break-word;"><th class="cl-ea3a4354"><p class="cl-ea3a39e0"><span class="cl-ea395052">engine</span></p></th><th class="cl-ea3a4354"><p class="cl-ea3a39e0"><span class="cl-ea395052">mode</span></p></th><th class="cl-ea3a4354"><p class="cl-ea3a39e0"><span class="cl-ea395052">specification</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">glm</span></p></td><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">classification</span></p></td><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">logistic_reg</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">glmnet</span></p></td><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">classification</span></p></td><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">logistic_reg</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">LiblineaR</span></p></td><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">classification</span></p></td><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">logistic_reg</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">spark</span></p></td><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">classification</span></p></td><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">logistic_reg</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">keras</span></p></td><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">classification</span></p></td><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">logistic_reg</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">stan</span></p></td><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">classification</span></p></td><td class="cl-ea3a4355"><p class="cl-ea3a39e0"><span class="cl-ea395052">logistic_reg</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ea3a4356"><p class="cl-ea3a39e0"><span class="cl-ea395052">brulee</span></p></td><td class="cl-ea3a4356"><p class="cl-ea3a39e0"><span class="cl-ea395052">classification</span></p></td><td class="cl-ea3a4356"><p class="cl-ea3a39e0"><span class="cl-ea395052">logistic_reg</span></p></td></tr></tbody></table></div>
</div>
</div>
</section>
</section>
<section id="example-1" class="level2">
<h2 class="anchored" data-anchor-id="example-1">Example <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>log_model <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>(<span class="at">penalty =</span> .<span class="dv">01</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">'classification'</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(forested_recipe) <span class="sc">|&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(log_model) <span class="sc">|&gt;</span> </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resample =</span> forested_folds) <span class="sc">|&gt;</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 6</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric     .estimator   mean     n std_err .config             </span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 accuracy    binary     0.893     10 0.00429 Preprocessor1_Model1</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 brier_class binary     0.0786    10 0.00330 Preprocessor1_Model1</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 roc_auc     binary     0.958     10 0.00304 Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Logistic Regression is a fundamental classification algorithm known for its simplicity and efficiency. It serves as a strong baseline model and is widely applied in domains like medical diagnosis, credit scoring, and fraud detection. With proper tuning and regularization, it remains a powerful tool in predictive modeling.</p>
</section>
</section>
<section id="decision-tree" class="level1">
<h1>3. Decision Tree</h1>
<p>A Decision Tree is a flowchart-like structure used for decision-making and predictive modeling. It consists of nodes representing decisions, branches indicating possible outcomes, and leaf nodes that represent final classifications or numerical outputs. Decision Trees are widely used in both classification and regression tasks.</p>
<section id="why-use-decision-trees" class="level2">
<h2 class="anchored" data-anchor-id="why-use-decision-trees">Why Use Decision Trees?</h2>
<p>Decision Trees are popular due to their: - <strong>Simplicity and Interpretability</strong>: Easy to understand and visualize. - <strong>Non-Linearity Handling</strong>: Can capture complex relationships in data. - <strong>Feature Importance</strong>: Helps in identifying the most influential features. - <strong>Minimal Data Preprocessing</strong>: Requires little to no feature scaling.</p>
</section>
<section id="components-of-a-decision-tree" class="level2">
<h2 class="anchored" data-anchor-id="components-of-a-decision-tree">Components of a Decision Tree</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><strong>Root Node</strong>: The starting point representing the entire dataset.</li>
<li><strong>Decision Nodes</strong>: Intermediate nodes where a dataset is <em>split</em> based on a feature.</li>
<li><strong>Splitting</strong>: The process of dividing a node into sub-nodes based on a feature value.</li>
<li><strong>Pruning</strong>: The process of removing unnecessary branches to avoid overfitting.</li>
<li><strong>Leaf Nodes</strong>: The terminal nodes that provide the final output (class label or numerical prediction).</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/dt_image.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="building-a-decision-tree" class="level2">
<h2 class="anchored" data-anchor-id="building-a-decision-tree">Building a Decision Tree</h2>
<section id="constructing-a-decision-tree-involves" class="level4">
<h4 class="anchored" data-anchor-id="constructing-a-decision-tree-involves">Constructing a Decision Tree involves:</h4>
<ol type="1">
<li>Selecting the best feature(s) to split the data.</li>
<li>Splitting the data into subsets.</li>
<li>Repeating this process recursively until stopping criteria (e.g., depth, minimum samples per leaf) are met.</li>
<li>Pruning the tree if necessary to reduce overfitting.</li>
</ol>
</section>
<section id="splitting-criteria" class="level4">
<h4 class="anchored" data-anchor-id="splitting-criteria">Splitting Criteria</h4>
<p>Several criteria can be used to determine the best split:<br>
- <strong>Gini Impurity</strong>: Measures the impurity of a node, used in Classification and Regression Trees (CART).<br>
- <strong>Entropy (Information Gain)</strong>: Measures the randomness in a dataset.<br>
- <strong>Mean Squared Error (MSE)</strong>: Used for regression trees to minimize variance within nodes.<br>
</p>
</section>
<section id="hyperparameters-in-decision-trees" class="level4">
<h4 class="anchored" data-anchor-id="hyperparameters-in-decision-trees">Hyperparameters in Decision Trees</h4>
<p>Key hyperparameters include:<br>
- <code>cost_complexity</code>: complexity parameter for pruning<br>
- <code>tree_depth</code>: maximum depth of the tree<br>
- <code>min_n</code>: minimum number of observations in a node<br>
</p>
</section>
</section>
<section id="advantages-and-disadvantages-1" class="level2">
<h2 class="anchored" data-anchor-id="advantages-and-disadvantages-1">Advantages and Disadvantages</h2>
<section id="advantages-1" class="level4">
<h4 class="anchored" data-anchor-id="advantages-1">Advantages:</h4>
<ul>
<li>Easy to interpret and explain.</li>
<li>Can handle both numerical and categorical data.</li>
<li>Requires minimal data preparation.</li>
<li>Works well with missing values.</li>
</ul>
</section>
<section id="disadvantages-1" class="level4">
<h4 class="anchored" data-anchor-id="disadvantages-1">Disadvantages:</h4>
<ul>
<li>Prone to overfitting, especially on small datasets.</li>
<li>Can be unstable; small changes in data can lead to drastically different splits.</li>
<li>Biased towards features with more levels.</li>
</ul>
</section>
</section>
<section id="decision-tree-using-tidymodels" class="level2">
<h2 class="anchored" data-anchor-id="decision-tree-using-tidymodels">Decision Tree using tidymodels</h2>
<section id="specification-2" class="level4">
<h4 class="anchored" data-anchor-id="specification-2">Specification</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">decision_tree</span>()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Decision Tree Model Specification (unknown mode)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Computational engine: rpart</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="engines-modes-2" class="level4">
<h4 class="anchored" data-anchor-id="engines-modes-2">engines &amp; modes <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_engines</span>(<span class="st">'decision_tree'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">specification =</span> <span class="st">"decision_tree"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flextable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-eb4d9908{}.cl-eb4ad4c0{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-eb4bd41a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-eb4bde42{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-eb4bde4c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-eb4bde4d{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-eb4d9908"><thead><tr style="overflow-wrap:break-word;"><th class="cl-eb4bde42"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">engine</span></p></th><th class="cl-eb4bde42"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">mode</span></p></th><th class="cl-eb4bde42"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">specification</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-eb4bde4c"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">rpart</span></p></td><td class="cl-eb4bde4c"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">classification</span></p></td><td class="cl-eb4bde4c"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">decision_tree</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-eb4bde4c"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">rpart</span></p></td><td class="cl-eb4bde4c"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">regression</span></p></td><td class="cl-eb4bde4c"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">decision_tree</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-eb4bde4c"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">C5.0</span></p></td><td class="cl-eb4bde4c"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">classification</span></p></td><td class="cl-eb4bde4c"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">decision_tree</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-eb4bde4c"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">spark</span></p></td><td class="cl-eb4bde4c"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">classification</span></p></td><td class="cl-eb4bde4c"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">decision_tree</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-eb4bde4d"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">spark</span></p></td><td class="cl-eb4bde4d"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">regression</span></p></td><td class="cl-eb4bde4d"><p class="cl-eb4bd41a"><span class="cl-eb4ad4c0">decision_tree</span></p></td></tr></tbody></table></div>
</div>
</div>
</section>
</section>
<section id="example-2" class="level2">
<h2 class="anchored" data-anchor-id="example-2">Example <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dt_model <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">tree_depth =</span> <span class="dv">10</span>, <span class="at">min_n =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">'classification'</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(forested_recipe) <span class="sc">|&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(dt_model) <span class="sc">|&gt;</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resample =</span> forested_folds) <span class="sc">|&gt;</span> </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 6</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric     .estimator   mean     n std_err .config             </span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 accuracy    binary     0.891     10 0.00361 Preprocessor1_Model1</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 brier_class binary     0.0911    10 0.00329 Preprocessor1_Model1</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 roc_auc     binary     0.911     10 0.00526 Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conclusion-1" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-1">Conclusion</h2>
<p>Decision Trees are a powerful and interpretable tool for both classification and regression problems. While they have limitations, techniques like pruning and ensemble methods (e.g., Random Forests) can help mitigate their weaknesses. Understanding Decision Trees within the <code>tidymodels</code> framework makes them accessible for practical applications in environmental science.</p>
</section>
</section>
<section id="random-forest" class="level1">
<h1>4. Random Forest</h1>
<p>Random Forests provide an ensemble learning method that constructs <em>multiple decision trees</em> and aggregates their predictions to improve accuracy and reduce overfitting. It is used for both classification and regression tasks.</p>
<section id="why-use-random-forest" class="level2">
<h2 class="anchored" data-anchor-id="why-use-random-forest">Why Use Random Forest?</h2>
<p>Random Forest offers several advantages: - <strong>Higher Accuracy</strong>: By combining multiple decision trees, it reduces variance and improves predictive performance. - <strong>Robustness to Overfitting</strong>: By averaging multiple trees, it mitigates the risk of overfitting. - <strong>Feature Importance Analysis</strong>: Helps identify the most influential features. - <strong>Handles Missing Data</strong>: Can work well with incomplete datasets.</p>
</section>
<section id="components-of-a-random-forest" class="level2">
<h2 class="anchored" data-anchor-id="components-of-a-random-forest">Components of a Random Forest</h2>
<ul>
<li><strong>Multiple Decision Trees</strong>: The fundamental building blocks.</li>
<li><strong>Bootstrap Sampling</strong>: Randomly selects subsets of data to train each tree.</li>
<li><strong>Feature Subsetting</strong>: Uses a random subset of features at each split to improve diversity among trees.</li>
<li><strong>Aggregation (Bagging)</strong>: Combines the outputs of individual trees through voting (classification) or averaging (regression).</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/rand-forest.gif" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="building-a-random-forest" class="level2">
<h2 class="anchored" data-anchor-id="building-a-random-forest">Building a Random Forest</h2>
<section id="constructing-a-random-forest-involves" class="level3">
<h3 class="anchored" data-anchor-id="constructing-a-random-forest-involves">Constructing a Random Forest involves:</h3>
<ol type="1">
<li>Creating multiple bootstrap samples from the dataset.</li>
<li>Training a decision tree on each bootstrap sample using a random subset of features.</li>
<li>Aggregating predictions from all trees to produce the final output.</li>
</ol>
</section>
<section id="hyperparameters-in-random-forest" class="level3">
<h3 class="anchored" data-anchor-id="hyperparameters-in-random-forest">Hyperparameters in Random Forest</h3>
<ul>
<li><strong>Number of Trees (<code>ntree</code>)</strong>: Determines how many trees are included in the forest.</li>
<li><strong>Maximum Depth (<code>max_depth</code>)</strong>: Limits the depth of individual trees to prevent overfitting.</li>
<li><strong>Minimum Samples per Leaf (<code>min_n</code>)</strong>: Specifies the minimum number of observations required in a leaf node.</li>
<li><strong>Number of Features (<code>mtry</code>)</strong>: Controls how many features are randomly selected at each split.</li>
</ul>
</section>
</section>
<section id="advantages-and-disadvantages-2" class="level2">
<h2 class="anchored" data-anchor-id="advantages-and-disadvantages-2">Advantages and Disadvantages</h2>
<section id="advantages-2" class="level4">
<h4 class="anchored" data-anchor-id="advantages-2">Advantages:</h4>
<ul>
<li>Handles large datasets with high-dimensional feature spaces.</li>
<li>Reduces overfitting by averaging multiple decision trees.</li>
<li>Works well with both categorical and numerical data.</li>
<li>Provides built-in feature selection.</li>
</ul>
</section>
<section id="disadvantages-2" class="level4">
<h4 class="anchored" data-anchor-id="disadvantages-2">Disadvantages:</h4>
<ul>
<li>Requires more computational resources than a single decision tree.</li>
<li>Less interpretable than a single decision tree.</li>
<li>Can be slower to make predictions due to ensemble averaging.</li>
</ul>
</section>
</section>
<section id="random-forest-implementation-using-tidymodels" class="level2">
<h2 class="anchored" data-anchor-id="random-forest-implementation-using-tidymodels">Random Forest Implementation using Tidymodels</h2>
<section id="specification-3" class="level4">
<h4 class="anchored" data-anchor-id="specification-3">Specification</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rand_forest</span>()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Random Forest Model Specification (unknown mode)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Computational engine: ranger</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="engines-modes-3" class="level4">
<h4 class="anchored" data-anchor-id="engines-modes-3">engines &amp; modes <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_engines</span>(<span class="st">'rand_forest'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">specification =</span> <span class="st">"rand_forest"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flextable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-ebf531f4{}.cl-ebf2eb2e{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-ebf3e2e0{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ebf3ecea{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ebf3eceb{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ebf3ecec{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-ebf531f4"><thead><tr style="overflow-wrap:break-word;"><th class="cl-ebf3ecea"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">engine</span></p></th><th class="cl-ebf3ecea"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">mode</span></p></th><th class="cl-ebf3ecea"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">specification</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-ebf3eceb"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">ranger</span></p></td><td class="cl-ebf3eceb"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">classification</span></p></td><td class="cl-ebf3eceb"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">rand_forest</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ebf3eceb"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">ranger</span></p></td><td class="cl-ebf3eceb"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">regression</span></p></td><td class="cl-ebf3eceb"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">rand_forest</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ebf3eceb"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">randomForest</span></p></td><td class="cl-ebf3eceb"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">classification</span></p></td><td class="cl-ebf3eceb"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">rand_forest</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ebf3eceb"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">randomForest</span></p></td><td class="cl-ebf3eceb"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">regression</span></p></td><td class="cl-ebf3eceb"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">rand_forest</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ebf3eceb"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">spark</span></p></td><td class="cl-ebf3eceb"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">classification</span></p></td><td class="cl-ebf3eceb"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">rand_forest</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ebf3ecec"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">spark</span></p></td><td class="cl-ebf3ecec"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">regression</span></p></td><td class="cl-ebf3ecec"><p class="cl-ebf3e2e0"><span class="cl-ebf2eb2e">rand_forest</span></p></td></tr></tbody></table></div>
</div>
</div>
</section>
</section>
<section id="example-3" class="level2">
<h2 class="anchored" data-anchor-id="example-3">Example <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a Random Forest model</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">trees =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>, <span class="at">importance =</span> <span class="st">"impurity"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(forested_recipe) <span class="sc">|&gt;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(rf_model) <span class="sc">|&gt;</span> </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resample =</span> forested_folds) <span class="sc">|&gt;</span> </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 6</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric     .estimator   mean     n std_err .config             </span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 accuracy    binary     0.909     10 0.00386 Preprocessor1_Model1</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 brier_class binary     0.0677    10 0.00232 Preprocessor1_Model1</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 roc_auc     binary     0.964     10 0.00213 Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conclusion-2" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-2">Conclusion</h2>
<p>Random Forest is a powerful ensemble learning method that improves upon decision trees by reducing overfitting and increasing accuracy. By leveraging the <code>tidymodels</code> framework in R, it can be effectively applied to various environmental science problems.</p>
</section>
</section>
<section id="boosting-machines" class="level1">
<h1>Boosting Machines</h1>
<p>Boosting is an ensemble learning technique that builds multiple weak models (often decision trees) sequentially, with each model correcting the errors of its predecessor. This iterative process improves predictive accuracy and reduces bias, making boosting one of the most powerful machine learning methods. Popular implementations include Gradient Boosting Machines (GBM), XGBoost (Extreme Gradient Boosting), LightGBM, and CatBoost.</p>
<section id="why-use-boosting-machines" class="level2">
<h2 class="anchored" data-anchor-id="why-use-boosting-machines">Why Use Boosting Machines?</h2>
<p>XGBoost is widely used in machine learning due to its: - <strong>High Accuracy</strong>: Often outperforms other algorithms in predictive tasks. - <strong>Efficiency</strong>: Optimized for speed and parallel processing. - <strong>Feature Importance</strong>: Provides insights into which features influence predictions. - <strong>Robustness to Overfitting</strong>: Uses regularization techniques to enhance generalization.</p>
</section>
<section id="components-of-gradient-boosting" class="level2">
<h2 class="anchored" data-anchor-id="components-of-gradient-boosting">Components of Gradient Boosting</h2>
<ul>
<li><strong>Weak Learners</strong>: Typically small decision trees (stumps).</li>
<li><strong>Gradient Descent Optimization</strong>: Each tree corrects the residual errors of the previous trees.</li>
<li><strong>Learning Rate (<code>eta</code>)</strong>: Controls the contribution of each tree to the final prediction.</li>
<li><strong>Regularization (<code>lambda</code> and <code>alpha</code>)</strong>: Penalizes complex trees to prevent overfitting.</li>
</ul>
</section>
<section id="popular-boosting-algorithms" class="level2">
<h2 class="anchored" data-anchor-id="popular-boosting-algorithms">Popular Boosting Algorithms</h2>
<ul>
<li><p>Gradient Boosting Machines (GBM): A general boosting method that minimizes loss using gradient descent.</p></li>
<li><p>XGBoost (Extreme Gradient Boosting): An optimized version of GBM that is computationally efficient and includes regularization.</p></li>
<li><p>LightGBM: Designed for efficiency on large datasets by using histogram-based learning and reducing memory usage.</p></li>
<li><p>CatBoost: Specialized for categorical data, using ordered boosting and permutation techniques to reduce bias.</p></li>
</ul>
</section>
<section id="building-an-xgboost-model" class="level2">
<h2 class="anchored" data-anchor-id="building-an-xgboost-model">Building an XGBoost Model</h2>
<section id="the-process-involves" class="level4">
<h4 class="anchored" data-anchor-id="the-process-involves">The process involves:</h4>
<ol type="1">
<li>Initializing predictions with a simple model (e.g., the mean for regression).</li>
<li>Computing the residual errors.</li>
<li>Training a new tree to predict these residuals.</li>
<li>Updating the predictions by adding a fraction of the new tree’s output.</li>
<li>Repeating until a stopping criterion is met (e.g., a maximum number of trees or performance threshold).</li>
</ol>
</section>
<section id="hyperparameters-in-xgboost" class="level4">
<h4 class="anchored" data-anchor-id="hyperparameters-in-xgboost">Hyperparameters in XGBoost</h4>
<ul>
<li><strong><code>nrounds</code> (Number of Trees)</strong>: The number of boosting iterations.</li>
<li><strong><code>max_depth</code></strong>: The maximum depth of trees.</li>
<li><strong><code>eta</code> (Learning Rate)</strong>: Controls how much each tree contributes to the model.</li>
<li><strong><code>gamma</code></strong>: Minimum loss reduction required to split a node.</li>
<li><strong><code>colsample_bytree</code></strong>: Fraction of features to consider for each tree.</li>
</ul>
</section>
</section>
<section id="advantages-and-disadvantages-3" class="level2">
<h2 class="anchored" data-anchor-id="advantages-and-disadvantages-3">Advantages and Disadvantages</h2>
<section id="advantages-3" class="level4">
<h4 class="anchored" data-anchor-id="advantages-3">Advantages:</h4>
<ul>
<li>Handles large datasets efficiently.</li>
<li>Reduces bias and variance compared to single decision trees.</li>
<li>Provides feature importance analysis.</li>
<li>Can be used for both classification and regression.</li>
</ul>
</section>
<section id="disadvantages-3" class="level4">
<h4 class="anchored" data-anchor-id="disadvantages-3">Disadvantages:</h4>
<ul>
<li>More complex and harder to interpret than a single decision tree.</li>
<li>Requires tuning of hyperparameters for optimal performance.</li>
<li>Can overfit if not properly regularized.</li>
</ul>
</section>
</section>
<section id="boost-implementation-using-tidymodels" class="level2">
<h2 class="anchored" data-anchor-id="boost-implementation-using-tidymodels">Boost Implementation using Tidymodels</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define an XGBoost model</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>b_model <span class="ot">&lt;-</span> <span class="fu">boost_tree</span>() <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"xgboost"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(forested_recipe) <span class="sc">|&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(b_model) <span class="sc">|&gt;</span> </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resample =</span> forested_folds) <span class="sc">|&gt;</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 6</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric     .estimator   mean     n std_err .config             </span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 accuracy    binary     0.909     10 0.00461 Preprocessor1_Model1</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 brier_class binary     0.0657    10 0.00259 Preprocessor1_Model1</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 roc_auc     binary     0.969     10 0.00197 Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conclusion-3" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-3">Conclusion</h2>
<p>XGBoost is a powerful ensemble learning method that significantly improves predictive accuracy while mitigating overfitting. By leveraging <code>tidymodels</code> in R, environmental scientists can apply XGBoost to various challenges such as climate modeling, pollution forecasting, and disaster risk assessment.</p>
</section>
</section>
<section id="support-vector-machine-svm" class="level1">
<h1>Support Vector Machine (SVM)</h1>
<p>Support Vector Machines (SVM) is a supervised learning algorithm used for classification and regression tasks. It works by finding the optimal hyperplane that best separates data points into different classes.</p>
<section id="why-use-svm" class="level2">
<h2 class="anchored" data-anchor-id="why-use-svm">2. Why Use SVM?</h2>
<p>SVM is widely used in machine learning due to its:<br>
- <strong>Effective for High-Dimensional Data</strong>: Works well with datasets with many features.<br>
- <strong>Robustness to Overfitting</strong>: Uses regularization techniques to prevent overfitting.<br>
- <strong>Versatility</strong>: Can be applied to linear and non-linear classification tasks using different kernel functions.<br>
- <strong>Support for Small Datasets</strong>: Works well when the number of samples is limited.<br>
</p>
</section>
<section id="components-of-svm" class="level2">
<h2 class="anchored" data-anchor-id="components-of-svm">3. Components of SVM</h2>
<ul>
<li><strong>Support Vectors</strong>: Data points that define the hyperplane.<br>
</li>
<li><strong>Margin</strong>: The distance between the hyperplane and the nearest support vectors.<br>
</li>
<li><strong>Kernel Functions</strong>: Transform data to a higher dimension to make it separable.<br>
</li>
</ul>
</section>
<section id="building-an-svm-model" class="level2">
<h2 class="anchored" data-anchor-id="building-an-svm-model">Building an SVM Model</h2>
<section id="the-process-involves-1" class="level4">
<h4 class="anchored" data-anchor-id="the-process-involves-1">The process involves:</h4>
<ol type="1">
<li>Selecting an appropriate kernel function (linear, polynomial, radial basis function, etc.).<br>
</li>
<li>Finding the hyperplane that best separates the data.<br>
</li>
<li>Maximizing the margin between the hyperplane and the closest points.<br>
</li>
<li>Using a regularization parameter (<code>C</code>) to control trade-offs between a wider margin and misclassifications.<br>
</li>
</ol>
</section>
<section id="hyperparameters-in-svm" class="level4">
<h4 class="anchored" data-anchor-id="hyperparameters-in-svm">Hyperparameters in SVM</h4>
<p>Key hyperparameters include:<br>
- <strong><code>C</code> (Regularization Parameter)</strong>: Controls the trade-off between maximizing margin and minimizing classification error.<br>
- <strong><code>kernel</code></strong>: Determines the transformation of input space (e.g., linear, radial basis function (RBF), polynomial).<br>
- <strong><code>gamma</code></strong>: Controls the influence of individual training</p>
</section>
</section>
<section id="advantages-and-disadvantages-4" class="level2">
<h2 class="anchored" data-anchor-id="advantages-and-disadvantages-4">Advantages and Disadvantages</h2>
<section id="advantages-4" class="level4">
<h4 class="anchored" data-anchor-id="advantages-4">Advantages:</h4>
<ul>
<li>Works well with small to medium-sized datasets.</li>
<li>Effective for both linear and non-linear classification.</li>
<li>Handles high-dimensional spaces well.</li>
</ul>
</section>
<section id="disadvantages-4" class="level4">
<h4 class="anchored" data-anchor-id="disadvantages-4">Disadvantages:</h4>
<ul>
<li>Computationally expensive for large datasets.</li>
<li>Requires careful tuning of hyperparameters.</li>
<li>Not as interpretable as decision trees.</li>
</ul>
</section>
</section>
<section id="svm-implementation-using-tidymodels" class="level2">
<h2 class="anchored" data-anchor-id="svm-implementation-using-tidymodels">SVM Implementation using Tidymodels</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define an SVM model</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>svm_model <span class="ot">&lt;-</span> <span class="fu">svm_poly</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kernlab"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(forested_recipe) <span class="sc">|&gt;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(svm_model) <span class="sc">|&gt;</span> </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resample =</span> forested_folds) <span class="sc">|&gt;</span> </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 6</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric     .estimator   mean     n std_err .config             </span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 accuracy    binary     0.905     10 0.00421 Preprocessor1_Model1</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 brier_class binary     0.0744    10 0.00320 Preprocessor1_Model1</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 roc_auc     binary     0.956     10 0.00293 Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conclusion-4" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-4">Conclusion</h2>
<p>Support Vector Machines (SVM) is a powerful algorithm for classification and regression tasks, especially when working with high-dimensional datasets. By leveraging <code>tidymodels</code> in R, environmental scientists can apply SVM to various challenges such as land cover classification, pollution prediction, and climate modeling.</p>
</section>
</section>
<section id="neural-networks" class="level1">
<h1>Neural Networks</h1>
<p>A Neural Network is a computational model inspired by the structure of the human brain. It consists of layers of interconnected neurons that transform input data to learn patterns and make predictions. Neural Networks are widely used for tasks such as image recognition, natural language processing, and time series forecasting.</p>
<section id="why-use-neural-networks" class="level2">
<h2 class="anchored" data-anchor-id="why-use-neural-networks">Why Use Neural Networks?</h2>
<p>Neural Networks are popular due to their:<br>
- Ability to Model Complex Patterns: Can capture intricate relationships in data.<br>
- Scalability: Performs well with large datasets.<br>
- Feature Learning: Automatically extracts relevant features from raw data.<br>
- Generalization: Can adapt to different types of data with proper training.</p>
</section>
<section id="components-of-a-neural-network" class="level2">
<h2 class="anchored" data-anchor-id="components-of-a-neural-network">Components of a Neural Network</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>Neurons: The fundamental units that receive, process, and transmit information.</p></li>
<li><p>Input Layer: The initial layer that receives raw data.</p></li>
<li><p>Hidden Layers: Intermediate layers where computations occur to learn features.</p></li>
<li><p>Output Layer: Produces the final prediction or classification.</p></li>
<li><p>Weights &amp; Biases: Parameters that are optimized during training.</p></li>
<li><p>Activation Functions: Functions like ReLU, Sigmoid, and Softmax that introduce non-linearity.</p></li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/nn.gif" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="training-a-neural-network" class="level2">
<h2 class="anchored" data-anchor-id="training-a-neural-network">Training a Neural Network</h2>
<section id="the-training-process-involves" class="level4">
<h4 class="anchored" data-anchor-id="the-training-process-involves">The training process involves:</h4>
<ul>
<li>Forward Propagation: Inputs pass through the network, producing an output.</li>
<li>Loss Calculation: The difference between predicted and actual values is measured.</li>
<li>Backpropagation: Errors are propagated backward to update weights.</li>
<li>Optimization: Gradient descent (or its variants) adjusts weights to minimize loss.</li>
<li>Iteration: The process repeats over multiple epochs until convergence.</li>
</ul>
</section>
<section id="hyperparameters-in-neural-networks" class="level4">
<h4 class="anchored" data-anchor-id="hyperparameters-in-neural-networks">Hyperparameters in Neural Networks</h4>
<ul>
<li>hidden_units: Number of neurons in hidden layers.</li>
<li>penalty: Regularization term to prevent overfitting.</li>
<li>dropout: Fraction of neurons randomly dropped during training.</li>
<li>epochs: Number of training iterations.</li>
<li>activation: Activation function for neurons (e.g., ReLU, Sigmoid).</li>
<li>learn_rate: Step size for weight updates.</li>
</ul>
</section>
</section>
<section id="advantages-and-disadvantages-5" class="level2">
<h2 class="anchored" data-anchor-id="advantages-and-disadvantages-5">Advantages and Disadvantages</h2>
<section id="advantages-5" class="level4">
<h4 class="anchored" data-anchor-id="advantages-5">Advantages:</h4>
<ul>
<li>Can model complex, non-linear relationships.</li>
<li>Works well with high-dimensional data.</li>
<li>Automatically extracts features from data.</li>
</ul>
</section>
<section id="disadvantages-5" class="level4">
<h4 class="anchored" data-anchor-id="disadvantages-5">Disadvantages:</h4>
<ul>
<li>Requires large datasets for effective training.</li>
<li>Computationally expensive.</li>
<li>Difficult to interpret compared to simpler models like Decision Trees.</li>
</ul>
</section>
</section>
<section id="varients-of-neural-networks" class="level2">
<h2 class="anchored" data-anchor-id="varients-of-neural-networks">Varients of Neural Networks</h2>
<p><code>mlp()</code> → Generic MLP model (uses “nnet”, “keras”, or “brulee” as an engine).</p>
<p><code>bag_mlp()</code> → Bagged MLP model using “nnet” (reduces variance).</p>
<p><code>brulee::mlp()</code> → MLP model using torch via brulee (more scalable and flexible).</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Which one you choose depends on your dataset size, computational resources, and need for ensembling. If you need better scalability, <code>brulee::mlp()</code> is likely a better choice. If you want a quick MLP with some regularization, <code>mlp()</code> with “nnet” or “keras” works. If variance reduction is a concern, <code>bag_mlp()</code> is a solid option.</p>
</div>
</div>
</div>
</section>
<section id="neural-network-implementation" class="level2">
<h2 class="anchored" data-anchor-id="neural-network-implementation">Neural Network Implementation</h2>
<p><code>mlp()</code> defines a multilayer perceptron model (a.k.a. a single layer, feed-forward neural network). This function can fit classification and regression models.</p>
<section id="specification-4" class="level4">
<h4 class="anchored" data-anchor-id="specification-4">Specification</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mlp</span>()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Single Layer Neural Network Model Specification (unknown mode)</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Computational engine: nnet</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="engines-modes-4" class="level4">
<h4 class="anchored" data-anchor-id="engines-modes-4">engines &amp; modes <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_engines</span>(<span class="st">"mlp"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">specification =</span> <span class="st">"mlp"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flextable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-7d72fa62{}.cl-7d70e060{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-7d71c426{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-7d71cd54{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7d71cd55{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7d71cd56{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-7d72fa62"><thead><tr style="overflow-wrap:break-word;"><th class="cl-7d71cd54"><p class="cl-7d71c426"><span class="cl-7d70e060">engine</span></p></th><th class="cl-7d71cd54"><p class="cl-7d71c426"><span class="cl-7d70e060">mode</span></p></th><th class="cl-7d71cd54"><p class="cl-7d71c426"><span class="cl-7d70e060">specification</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">keras</span></p></td><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">classification</span></p></td><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">mlp</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">keras</span></p></td><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">regression</span></p></td><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">mlp</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">nnet</span></p></td><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">classification</span></p></td><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">mlp</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">nnet</span></p></td><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">regression</span></p></td><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">mlp</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">brulee</span></p></td><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">classification</span></p></td><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">mlp</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">brulee</span></p></td><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">regression</span></p></td><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">mlp</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">brulee_two_layer</span></p></td><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">classification</span></p></td><td class="cl-7d71cd55"><p class="cl-7d71c426"><span class="cl-7d70e060">mlp</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-7d71cd56"><p class="cl-7d71c426"><span class="cl-7d70e060">brulee_two_layer</span></p></td><td class="cl-7d71cd56"><p class="cl-7d71c426"><span class="cl-7d70e060">regression</span></p></td><td class="cl-7d71cd56"><p class="cl-7d71c426"><span class="cl-7d70e060">mlp</span></p></td></tr></tbody></table></div>
</div>
</div>
</section>
</section>
<section id="example-4" class="level2">
<h2 class="anchored" data-anchor-id="example-4">Example <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>nn_model <span class="ot">&lt;-</span> <span class="fu">mlp</span>(<span class="at">hidden_units =</span> <span class="dv">5</span>, <span class="at">penalty =</span> <span class="fl">0.01</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"nnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(forested_recipe) <span class="sc">|&gt;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(nn_model) <span class="sc">|&gt;</span> </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resample =</span> forested_folds) <span class="sc">|&gt;</span> </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 6</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric     .estimator  mean     n std_err .config             </span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 accuracy    binary     0.908    10 0.00462 Preprocessor1_Model1</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 brier_class binary     0.118    10 0.00139 Preprocessor1_Model1</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 roc_auc     binary     0.965    10 0.00211 Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conclusion-5" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-5">Conclusion</h2>
<p>Neural Networks are a powerful tool for solving complex problems in various domains. While they require significant computational resources, proper training and regularization techniques can make them highly effective for predictive modeling. Understanding Neural Networks within the torch framework allows for practical applications in data science and environmental modeling.</p>
</section>
<section id="wrap-up" class="level2">
<h2 class="anchored" data-anchor-id="wrap-up">Wrap up <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></h2>
<p>Lets combine all the models and evaluate their performance using cross-validation.</p>
<ul>
<li><p>We learned about cross-validation <a href="https://mikejohnson51.github.io/csu-ess-330/slides/15-ml-intro.html">last Monday</a> and its importance in evaluating model performance.</p></li>
<li><p>We will use a workflow set (seen <a href="https://mikejohnson51.github.io/csu-ess-330/slides/16-workflows.html">last Wednesday</a>) to fit multiple models at once and compare their performance.</p></li>
<li><p>Remember, we have <u>not</u> implmented any hyperparameter tuning yet, so these are just base models.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>forested_folds <span class="ot">&lt;-</span>  <span class="fu">vfold_cv</span>(forested_train, <span class="at">v =</span> <span class="dv">10</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>wf <span class="ot">&lt;-</span>  <span class="fu">workflow_set</span>(<span class="fu">list</span>(forested_recipe), </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(log_model, </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                       dt_model, </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                       rf_model, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                       b_model, </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                       svm_model, </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                       nn_model)) <span class="sc">|&gt;</span> </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a> <span class="fu">workflow_map</span>(<span class="st">'fit_resamples'</span>, <span class="at">resamples =</span> forested_folds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-performance-comparision" class="level2">
<h2 class="anchored" data-anchor-id="model-performance-comparision">Model Performance Comparision <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(wf) <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>(<span class="dv">18</span>) <span class="sc">+</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-6_files/figure-revealjs/unnamed-chunk-27-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation">Model Evaluation <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<p>Understanding the boost model provided the best performance out of the box we can (1) select that model (2)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>final_fit <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(forested_recipe) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Selected Model</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(b_model) <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Trained with full training dataset</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> forested_train) <span class="sc">|&gt;</span> </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Validated against hold out data</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> forested_test)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Final Results!</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="fu">metrics</span>(final_fit,  <span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class) </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric  .estimator .estimate</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 accuracy binary         0.917</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 kap      binary         0.833</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="fu">conf_mat</span>(final_fit, <span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           Truth</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Prediction Yes  No</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Yes 910  86</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        No   61 720</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-whole-game---status-update" class="level2">
<h2 class="anchored" data-anchor-id="the-whole-game---status-update">The whole game - status update</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/whole-game-final-performance.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="recaping" class="level2">
<h2 class="anchored" data-anchor-id="recaping">Recaping</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forested)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a seed</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># IntitalizeInitialize Split</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>forested_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(forested, <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>forested_train <span class="ot">&lt;-</span> <span class="fu">training</span>(forested_split)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>forested_test  <span class="ot">&lt;-</span> <span class="fu">testing</span>(forested_split)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Build Resamples</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>forested_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(forested_train, <span class="at">v =</span> <span class="dv">10</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a model specification with mode (default engine)</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>dt_mod         <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">cost_complexity =</span> <span class="fl">0.0001</span>, <span class="at">mode =</span> <span class="st">"classification"</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Bare bones workflow &amp; fit</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>forested_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(forested <span class="sc">~</span> ., dt_mod)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>forested_fit   <span class="ot">&lt;-</span> <span class="fu">fit</span>(forested_wflow, forested_train)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting Predictions:</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5,685 × 22</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    .pred_class .pred_Yes .pred_No forested  year elevation eastness northness</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;fct&gt;           &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 No             0.0114   0.989  No        2016       464       -5       -99</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Yes            0.636    0.364  Yes       2016       166       92        37</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 No             0.0114   0.989  No        2016       644      -85       -52</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Yes            0.977    0.0226 Yes       2014      1285        4        99</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Yes            0.977    0.0226 Yes       2013       822       87        48</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Yes            0.808    0.192  Yes       2017         3        6       -99</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Yes            0.977    0.0226 Yes       2014      2041      -95        28</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Yes            0.977    0.0226 Yes       2015      1009       -8        99</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 No             0.0114   0.989  No        2017       436      -98        19</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 No             0.0114   0.989  No        2018       775       63        76</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 5,675 more rows</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 14 more variables: roughness &lt;dbl&gt;, tree_no_tree &lt;fct&gt;, dew_temp &lt;dbl&gt;,</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   precip_annual &lt;dbl&gt;, temp_annual_mean &lt;dbl&gt;, temp_annual_min &lt;dbl&gt;,</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   temp_annual_max &lt;dbl&gt;, temp_january_min &lt;dbl&gt;, vapor_min &lt;dbl&gt;,</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   vapor_max &lt;dbl&gt;, canopy_cover &lt;dbl&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;, land_type &lt;fct&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluation" class="level2">
<h2 class="anchored" data-anchor-id="evaluation">Evaluation</h2>
<ul>
<li>So far we have used <code>metrics</code> and <code>collect_metrics</code> to evaluate and compare models</li>
<li>The default metrics for classification problems are: <code>accuracy</code>, <code>brier_score</code>, <code>roc_auc</code>
<ul>
<li>All classification metrics stem from the classic confusion matrix</li>
</ul></li>
</ul>
<p>. . .</p>
<ul>
<li>The default metrics for regression problems are: <code>rsq</code>, <code>rmse</code>, <code>mae</code>
<ul>
<li>The majority of these are measures of correlation and residual error</li>
</ul></li>
</ul>
</section>
</section>
<section id="classification" class="level1">
<h1>Classification:</h1>
<section id="confusion-matrix" class="level2">
<h2 class="anchored" data-anchor-id="confusion-matrix">Confusion matrix <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<ul>
<li>A confusion matrix is a table that describes the performance of a classification model on a set of data for which the true values are known.</li>
<li>It counts the number of accurate and false predictions, separated by the truth state</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           Truth</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Prediction  Yes   No</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Yes 2991  176</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        No   144 2374</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="what-to-do-with-a-confusion-matrix" class="level1">
<h1>What to do with a confusion matrix</h1>
<p><img src="images/confusion-matrix.png" class="img-fluid"></p>
<section id="accuracy" class="level2">
<h2 class="anchored" data-anchor-id="accuracy">1. Accuracy <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<ul>
<li>Accuracy is the proportion of true results (both true positives and true negatives) among the total number of cases examined.</li>
<li>It is a measure of the correctness of the model’s predictions.</li>
<li>It is the most common metric used to evaluate classification models.</li>
</ul>
<div class="columns">
<div class="column" style="width:40%;">
<p><img src="images/confusion-matrix-accuracy.png" class="img-fluid"></p>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(<span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric  .estimator .estimate</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 accuracy binary         0.944</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="sensitivity" class="level2">
<h2 class="anchored" data-anchor-id="sensitivity">2. Sensitivity <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<ul>
<li>Sensitivity is the proportion of true positives to the sum of true positives and false negatives.</li>
<li>It is useful for identifying the presence of a condition.</li>
<li>It is also known as the true positive rate, recall, or probability of detection.</li>
</ul>
<div class="columns">
<div class="column" style="width:40%;">
<p><img src="images/confusion-matrix-sensitivity.png" class="img-fluid"></p>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sensitivity</span>(<span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric     .estimator .estimate</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 sensitivity binary         0.954</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="specificity" class="level2">
<h2 class="anchored" data-anchor-id="specificity">3. Specificity <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<ul>
<li>Specificity is the proportion of true negatives to the sum of true negatives and false positives.</li>
<li>It is useful for identifying the absence of a condition.</li>
<li>It is also known as the true negative rate, and is the complement of sensitivity.</li>
</ul>
<div class="columns">
<div class="column" style="width:40%;">
<p><img src="images/confusion-matrix-specificity.png" class="img-fluid"></p>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">sensitivity</span>(<span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="co">#&gt;   .metric     .estimator .estimate</span></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="co">#&gt; 1 sensitivity binary         0.954</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specificity</span>(<span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric     .estimator .estimate</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 specificity binary         0.931</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="two-class-data" class="level2">
<h2 class="anchored" data-anchor-id="two-class-data">Two class data</h2>
<p>These metrics assume that we know the threshold for converting “soft” probability predictions into “hard” class predictions.</p>
<ul>
<li><p>For example, if the predicted probability of a tree is 0.7, we might say that the model predicts “Tree” for that observation.<br>
</p></li>
<li><p>If the predicted probability of a tree is 0.4, we might say that the model predicts “No tree” for that observation.<br>
</p></li>
<li><p>The threshold is the value that separates the two classes.<br>
</p></li>
<li><p>The default threshold is 0.5, but this can be changed.<br>
</p></li>
</ul>
<p>. . .</p>
<p>Is a 50% threshold good?</p>
<p>. . .</p>
<p>What happens if we say that we need to be 80% sure to declare an event?</p>
<ul>
<li>sensitivity ⬇️, specificity ⬆️</li>
</ul>
<p>. . .</p>
<p>What happens for a 20% threshold?</p>
<ul>
<li>sensitivity ⬆️, specificity ⬇️</li>
</ul>
</section>
<section id="varying-the-threshold" class="level2">
<h2 class="anchored" data-anchor-id="varying-the-threshold">Varying the threshold</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>The threshold can be varied to see how it affects the sensitivity and specificity of the model.</li>
<li>This is done by plotting the sensitivity and specificity against the threshold.</li>
<li>The threshold is varied from 0 to 1, and the sensitivity and specificity are calculated at each threshold.</li>
<li>The plot shows the trade-off between sensitivity and specificity at different thresholds.</li>
<li>The threshold can be chosen based on the desired balance between sensitivity and specificity.</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-6_files/figure-revealjs/thresholds-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="roc-curves" class="level2">
<h2 class="anchored" data-anchor-id="roc-curves">ROC curves</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>For an ROC (receiver operator characteristic) curve, we plot</p>
<ul>
<li>the false positive rate (1 - specificity) on the x-axis</li>
<li>the true positive rate (sensitivity) on the y-axis</li>
</ul>
<p>with sensitivity and specificity calculated at all possible thresholds.</p>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-6_files/figure-revealjs/roc-curve-1-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="roc-curves-1" class="level2">
<h2 class="anchored" data-anchor-id="roc-curves-1">ROC curves</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>The ROC AUC is the probability that a randomly chosen positive instance is ranked higher than a randomly chosen negative instance.</p>
<ul>
<li><p>The ROC AUC is a measure of how well the model separates the two classes.</p></li>
<li><p>The ROC AUC is a number between 0 and 1.</p></li>
<li><p>ROC AUC = 1 💯</p>
<ul>
<li>perfect classification</li>
</ul></li>
<li><p>ROC AUC = 0.5 😐</p>
<ul>
<li>random guessing</li>
</ul></li>
<li><p>ROC AUC &lt; 0.5 😱</p>
<ul>
<li>worse than random guessing</li>
</ul></li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-6_files/figure-revealjs/roc-curve-2-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="roc-curves-2" class="level2">
<h2 class="anchored" data-anchor-id="roc-curves-2">ROC curves <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<p>(A ROC AUC of 0.7-0.8 is considered acceptable, 0.8-0.9 is good, and &gt;0.9 is excellent.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assumes _first_ factor level is event; there are options to change that</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span>  </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> forested, .pred_Yes)  <span class="sc">|&gt;</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span>, <span class="dv">20</span>, <span class="dv">50</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .threshold specificity sensitivity</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   -Inf           0           1    </span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      0.235       0.885       0.972</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      0.909       0.969       0.826</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span>  </span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_auc</span>(<span class="at">truth =</span> forested, .pred_Yes)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 roc_auc binary         0.975</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="brier-score" class="level2">
<h2 class="anchored" data-anchor-id="brier-score">Brier score</h2>
<ul>
<li><p>The Brier score is a measure of how well the predicted probabilities of an event match the actual outcomes.</p></li>
<li><p>It is the mean squared difference between predicted probabilities and actual outcomes.</p></li>
<li><p>The Brier score is a number between 0 and 1.</p></li>
<li><p>The Brier score is analogous to the mean squared error in regression models:</p></li>
<li><p>Brier = 1 😱</p>
<ul>
<li>predicted probabilities are completely wrong</li>
</ul></li>
<li><p>Brier = 0.5 😐</p>
<ul>
<li>bad</li>
</ul></li>
<li><p>Brier &lt; 0.25</p>
<ul>
<li>acceptable</li>
</ul></li>
<li><p>Brier = 0 💯</p>
<ul>
<li>predicted probabilities are perfect</li>
</ul></li>
</ul>
<p><span class="math display">\[
Brier_{class} = \frac{1}{N}\sum_{i=1}^N\sum_{k=1}^C (y_{ik} - \hat{p}_{ik})^2
\]</span></p>
</section>
<section id="brier-score-1" class="level2">
<h2 class="anchored" data-anchor-id="brier-score-1">Brier score</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span>  </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brier_class</span>(<span class="at">truth =</span> forested, .pred_Yes) </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric     .estimator .estimate</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 brier_class binary        0.0469</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="separation-vs-calibration" class="level2">
<h2 class="anchored" data-anchor-id="separation-vs-calibration">Separation vs calibration</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>The ROC captures separation. - The ROC curve shows the trade-off between sensitivity and specificity at different thresholds.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-6_files/figure-revealjs/separation-forested-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>The Brier score captures calibration. - The Brier score is a measure of how well the predicted probabilities of an event match the actual outcomes.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-6_files/figure-revealjs/calibration-forested-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<ul>
<li>Good separation: the densities don’t overlap.</li>
<li>Good calibration: the calibration line follows the diagonal.</li>
</ul>
<p>Calibration plot: We bin observations according to predicted probability. In the bin for 20%-30% predicted prob, we should see an event rate of ~25% if the model is well-calibrated.</p>
</section>
</section>
<section id="regression" class="level1">
<h1>Regression</h1>
<section id="r-squared-r2" class="level2">
<h2 class="anchored" data-anchor-id="r-squared-r2">R-squared (<span class="math inline">\(R^2\)</span>)</h2>
<ul>
<li>Measures how well the model explains the variance in the data.</li>
<li>Formula:</li>
</ul>
<p><span class="math display">\[
R^2 = 1 - \frac{SS_{res}}{SS_{tot}}
\]</span> where:<br>
- <span class="math inline">\(SS_{res}\)</span> is the sum of squared residuals.<br>
</p>
<ul>
<li><p><span class="math inline">\(SS_{tot}\)</span> is the total sum of squares.<br>
</p></li>
<li><p>Values range from <span class="math inline">\(-\infty\)</span> to 1.<br>
</p>
<ul>
<li>1: Perfect fit<br>
</li>
<li>0: No improvement over mean prediction<br>
</li>
<li>Negative: Worse than just using the mean<br>
</li>
</ul></li>
</ul>
</section>
<section id="root-mean-squared-error-rmse" class="level2">
<h2 class="anchored" data-anchor-id="root-mean-squared-error-rmse">Root Mean Squared Error (RMSE)</h2>
<ul>
<li>Measures the model’s prediction error in the same unit as the dependent variable.</li>
<li>Formula:</li>
</ul>
<p><span class="math display">\[
RMSE = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2}
\]</span></p>
<p>where: - <span class="math inline">\(y_i\)</span> is the actual value. - <span class="math inline">\(\hat{y}_i\)</span> is the predicted value.</p>
<ul>
<li>Penalizes large errors more than MAE.</li>
<li>Lower RMSE indicates better model performance.</li>
</ul>
</section>
<section id="mean-absolute-error-mae" class="level2">
<h2 class="anchored" data-anchor-id="mean-absolute-error-mae">Mean Absolute Error (MAE)</h2>
<ul>
<li>Measures average absolute errors between predictions and actual values.</li>
<li>Formula:</li>
</ul>
<p><span class="math display">\[
MAE = \frac{1}{n} \sum_{i=1}^{n} |y_i - \hat{y}_i|
\]</span></p>
<ul>
<li>Less sensitive to outliers than RMSE.</li>
<li>Lower MAE indicates better model performance.</li>
</ul>
</section>
<section id="comparing-metrics" class="level2">
<h2 class="anchored" data-anchor-id="comparing-metrics">Comparing Metrics</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Metric</th>
<th>Interpretation</th>
<th>Sensitivity to Outliers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(R^2\)</span></td>
<td>Variance explained</td>
<td>Moderate</td>
</tr>
<tr class="even">
<td>RMSE</td>
<td>Penalizes large errors more</td>
<td>High</td>
</tr>
<tr class="odd">
<td>MAE</td>
<td>Average error size</td>
<td>Low</td>
</tr>
</tbody>
</table>
<p><br></p>
<section id="choosing-the-right-metric" class="level4">
<h4 class="anchored" data-anchor-id="choosing-the-right-metric">Choosing the Right Metric</h4>
<ul>
<li><strong>Use <span class="math inline">\(R^2\)</span></strong> to assess model fit and explainability.</li>
<li><strong>Use RMSE</strong> if large errors are especially undesirable.</li>
<li><strong>Use MAE</strong> for a more interpretable, robust metric.</li>
</ul>
</section>
</section>
<section id="section" class="level2" data-background-iframe="https://yardstick.tidymodels.org/reference/index.html">
<h2 data-background-iframe="https://yardstick.tidymodels.org/reference/index.html" class="anchored" data-anchor-id="section"></h2>
<div class="footer">

</div>
</section>
<section id="metrics-selection-model-performance" class="level2">
<h2 class="anchored" data-anchor-id="metrics-selection-model-performance">Metrics Selection model performance <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<p>We can use <code>metric_set()</code> to combine multiple calculations into one</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>forested_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(accuracy, specificity, sensitivity)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forested_metrics</span>(<span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric     .estimator .estimate</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 accuracy    binary         0.944</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 specificity binary         0.931</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 sensitivity binary         0.954</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>Metrics and metric sets work with grouped data frames!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tree_no_tree) <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(<span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   tree_no_tree .metric  .estimator .estimate</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;        &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Tree         accuracy binary         0.946</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 No tree      accuracy binary         0.941</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tree_no_tree) <span class="sc">|&gt;</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specificity</span>(<span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   tree_no_tree .metric     .estimator .estimate</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;        &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Tree         specificity binary         0.582</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 No tree      specificity binary         0.974</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The specificity for <code>"Tree"</code> is a good bit lower than it is for <code>"No tree"</code>.</p>
<p>So, when this index classifies the plot as having a tree, the model does not do well at correctly identifying the plot as non-forested when it is indeed non-forested.</p>
</div>
</div>
</section>
</section>
<section id="recap" class="level1">
<h1>Recap</h1>
<section id="previously---setup" class="level2">
<h2 class="anchored" data-anchor-id="previously---setup">Previously - Setup <img src="hexes/tidymodels.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Ingest Data</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># URLs for COVID-19 case data and census population data</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>covid_url <span class="ot">&lt;-</span> <span class="st">'https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv'</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>pop_url <span class="ot">&lt;-</span>  <span class="st">'/Users/mikejohnson/github/csu-ess-330/resources/co-est2023-alldata.csv'</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">#pop_url   &lt;- 'https://www2.census.gov/programs-surveys/popest/datasets/2020-2023/counties/totals/co-est2023-alldata.csv'</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean Census Data</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>census <span class="ot">=</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(pop_url)  <span class="sc">|&gt;</span> </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COUNTY <span class="sc">==</span> <span class="st">"000"</span>) <span class="sc">|&gt;</span>  <span class="co"># Filter for state-level data only</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fips =</span> STATE) <span class="sc">|&gt;</span>      <span class="co"># Create a new FIPS column for merging</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fips, <span class="fu">contains</span>(<span class="st">"2021"</span>))  <span class="co"># Select relevant columns for 2021 data</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Process COVID-19 Data</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>state_data <span class="ot">&lt;-</span>  readr<span class="sc">::</span><span class="fu">read_csv</span>(covid_url) <span class="sc">|&gt;</span> </span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fips) <span class="sc">|&gt;</span> </span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_cases  =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, cases  <span class="sc">-</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(cases)),   <span class="co"># Compute new cases, ensuring no negative values</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_deaths =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, deaths <span class="sc">-</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(deaths))  <span class="co"># Compute new deaths, ensuring no negative values</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(census, <span class="at">by =</span> <span class="st">"fips"</span>) <span class="sc">|&gt;</span>  <span class="co"># Merge with census data</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">m =</span> <span class="fu">month</span>(date), <span class="at">y =</span> <span class="fu">year</span>(date),</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">case_when</span>(   <span class="co"># Define seasons based on month</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>      m <span class="sc">%in%</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">~</span> <span class="st">"Spring"</span>,</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>      m <span class="sc">%in%</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">8</span> <span class="sc">~</span> <span class="st">"Summer"</span>,</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>      m <span class="sc">%in%</span> <span class="dv">9</span><span class="sc">:</span><span class="dv">11</span> <span class="sc">~</span> <span class="st">"Fall"</span>,</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>      m <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="st">"Winter"</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, y, season) <span class="sc">|&gt;</span> </span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_cases  =</span> <span class="fu">sum</span>(new_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Aggregate seasonal cases</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_deaths =</span> <span class="fu">sum</span>(new_deaths, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  <span class="co"># Aggregate seasonal deaths</span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">|&gt;</span> </span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(state, y, season, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span>  <span class="co"># Keep only distinct rows by state, year, season</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, <span class="fu">contains</span>(<span class="st">'season'</span>), y, POPESTIMATE2021, BIRTHS2021, DEATHS2021) <span class="sc">|&gt;</span>  <span class="co"># Select relevant columns</span></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span>  <span class="co"># Remove rows with missing values</span></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logC =</span> <span class="fu">log</span>(season_cases <span class="sc">+</span><span class="dv">1</span>))  <span class="co"># Log-transform case numbers for modeling</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="previously---data-usage" class="level2">
<h2 class="anchored" data-anchor-id="previously---data-usage">Previously - Data Usage <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4028</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(state_data, <span class="at">prop =</span> <span class="fl">0.8</span>, <span class="at">strata =</span> season)  <span class="co"># 80/20 train-test split</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">training</span>(split)  <span class="co"># Training set</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">testing</span>(split)  <span class="co"># Test set</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3045</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(train, <span class="at">v =</span> <span class="dv">10</span>)  <span class="co"># 10-fold cross-validation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="previously---feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="previously---feature-engineering">Previously - Feature engineering <img src="hexes/recipes.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">=</span> <span class="fu">recipe</span>(logC <span class="sc">~</span> . , <span class="at">data =</span> train) <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(state, season_cases) <span class="sc">|&gt;</span>  <span class="co"># Remove non-predictive columns</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>()) <span class="sc">|&gt;</span>  <span class="co"># Convert categorical variables to dummy variables</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span>  <span class="co"># Scale numeric predictors</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_center</span>(<span class="fu">all_numeric_predictors</span>())  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="optimizing-models-via-tuning-hyperparameter" class="level1">
<h1>Optimizing Models via Tuning Hyperparameter</h1>
<section id="tuning-parameters" class="level2">
<h2 class="anchored" data-anchor-id="tuning-parameters">Tuning parameters</h2>
<ul>
<li><p>Some model or preprocessing parameters cannot be estimated directly from the data.</p></li>
<li><p>Try different values and measure their performance.</p></li>
</ul>
<p>. . .</p>
<ul>
<li>Find good values for these parameters.</li>
</ul>
<p>. . .</p>
<ul>
<li>Once the value(s) of the parameter(s) are determined, a model can be finalized by fitting the model to the entire training set.</li>
</ul>
</section>
<section id="tagging-parameters-for-tuning" class="level2">
<h2 class="anchored" data-anchor-id="tagging-parameters-for-tuning">Tagging parameters for tuning <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<p>With tidymodels, you can mark the parameters that you want to optimize with a value of <code>tune()</code>.</p>
<p><br></p>
<p>The function itself just returns… itself:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tune</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; tune()</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">tune</span>())</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  language tune()</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># optionally add a label</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tune</span>(<span class="st">"Marker"</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; tune("Marker")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="boosted-trees" class="level2">
<h2 class="anchored" data-anchor-id="boosted-trees">Boosted Trees</h2>
<p>In last weeks live demo, a boosted tree proved most effective.</p>
<p>Boosted Trees are popular ensemble methods that build a <em>sequence</em> of tree models.</p>
<p>Each tree uses the results of the previous tree to better predict samples, especially those that have been poorly predicted.</p>
<p>Each tree in the ensemble is saved and new samples are predicted using a weighted average of the votes of each tree in the ensemble.</p>
</section>
<section id="boosted-tree-tuning-parameters" class="level2">
<h2 class="anchored" data-anchor-id="boosted-tree-tuning-parameters">Boosted Tree Tuning Parameters</h2>
<p>Some <em>possible</em> parameters:</p>
<ul>
<li><code>mtry</code>: The number of predictors randomly sampled at each split (in <span class="math inline">\([1, ncol(x)]\)</span> or <span class="math inline">\((0, 1]\)</span>).</li>
<li><code>trees</code>: The number of trees (<span class="math inline">\([1, \infty]\)</span>, but usually up to thousands)</li>
<li><code>min_n</code>: The number of samples needed to further split (<span class="math inline">\([1, n]\)</span>).</li>
<li><code>learn_rate</code>: The rate that each tree adapts from previous iterations (<span class="math inline">\((0, \infty]\)</span>, usual maximum is 0.1).</li>
<li><code>stop_iter</code>: The number of iterations of boosting where <em>no improvement</em> was shown before stopping (<span class="math inline">\([1, trees]\)</span>)</li>
</ul>
</section>
<section id="boosted-tree-tuning-parameters-1" class="level2">
<h2 class="anchored" data-anchor-id="boosted-tree-tuning-parameters-1">Boosted Tree Tuning Parameters <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>b_mod <span class="ot">&lt;-</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">boost_tree</span>(<span class="at">trees =</span> <span class="fu">tune</span>(), <span class="at">learn_rate =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"xgboost"</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>(b_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(rec, b_mod))</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ══ Workflow ════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Preprocessor: Recipe</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Model: boost_tree()</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── Preprocessor ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Recipe Steps</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • step_rm()</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • step_dummy()</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • step_scale()</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • step_center()</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── Model ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Boosted Tree Model Specification (regression)</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Main Arguments:</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   trees = tune()</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   learn_rate = tune()</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Computational engine: xgboost</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="optimize-tuning-parameters" class="level2">
<h2 class="anchored" data-anchor-id="optimize-tuning-parameters">Optimize tuning parameters</h2>
<p>The main two strategies for optimization are:</p>
<p>. . .</p>
<ul>
<li><p><strong>Grid search</strong> 💠 which tests a pre-defined set of candidate values</p></li>
<li><p><strong>Iterative search</strong> 🌀 which suggests/estimates new values of candidate parameters to evaluate</p></li>
</ul>
</section>
<section id="grid-search" class="level2">
<h2 class="anchored" data-anchor-id="grid-search">1. Grid search</h2>
<ul>
<li><p>Most basic (but very effective) way to tune models</p></li>
<li><p>A small grid of points trying to minimize the error via learning rate:</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/small_init.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="grid-search-1" class="level2">
<h2 class="anchored" data-anchor-id="grid-search-1">1. Grid search</h2>
<p>In reality we would probably sample the space more densely:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/grid_points.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="iterative-search" class="level2">
<h2 class="anchored" data-anchor-id="iterative-search">2. Iterative Search</h2>
<p>We could start with a few points and search the space:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/anime_seq.gif" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="grid-search-example" class="level1">
<h1>Grid Search Example</h1>
<section id="parameters" class="level2">
<h2 class="anchored" data-anchor-id="parameters">Parameters</h2>
<ul>
<li><p>The tidymodels framework provides pre-defined information on tuning parameters (such as their type, range, transformations, etc).</p></li>
<li><p>The <code>extract_parameter_set_dials()</code> function extracts these tuning parameters and the info.</p></li>
</ul>
<section id="grids" class="level4">
<h4 class="anchored" data-anchor-id="grids">Grids</h4>
<ul>
<li><p>Create your grid manually or automatically.</p></li>
<li><p>The <code>grid_*()</code> functions can make a grid.</p></li>
</ul>
</section>
</section>
<section id="different-types-of-grids" class="level2">
<h2 class="anchored" data-anchor-id="different-types-of-grids">Different types of grids <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-6_files/figure-revealjs/grid-types-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Space-filling designs (SFD) attempt to cover the parameter space without redundant candidates. We recommend these the most.</p>
</section>
<section id="create-a-grid" class="level2">
<h2 class="anchored" data-anchor-id="create-a-grid">Create a grid <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extac</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>(b_wflow <span class="sc">|&gt;</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_parameter_set_dials</span>())</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Individual functions: </span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>(<span class="fu">trees</span>())</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>(<span class="fu">learn_rate</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>A parameter set can be updated (e.g.&nbsp;to change the ranges).</p>
</div>
</section>
<section id="create-a-grid-1" class="level2">
<h2 class="anchored" data-anchor-id="create-a-grid-1">Create a grid <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></h2>
<ul>
<li>The <code>grid_*()</code> functions create a grid of parameter values to evaluate.</li>
<li>The <code>grid_space_filling()</code> function creates a space-filling design (SFD) of parameter values to evaluate.</li>
<li>The <code>grid_regular()</code> function creates a regular grid of parameter values to evaluate.</li>
<li>The <code>grid_random()</code> function creates a random grid of parameter values to evaluate.</li>
<li>The <code>grid_latin_hypercube()</code> function creates a Latin hypercube design of parameter values to evaluate.</li>
<li>The <code>grid_max_entropy()</code> function creates a maximum entropy design of parameter values to evaluate.</li>
</ul>
</section>
<section id="create-a-sfd-curve" class="level2">
<h2 class="anchored" data-anchor-id="create-a-sfd-curve">Create a SFD curve <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb39-2"><a href="#cb39-2"></a></span>
<span id="cb39-3"><a href="#cb39-3"></a>(grid <span class="ot">&lt;-</span> </span>
<span id="cb39-4"><a href="#cb39-4"></a>  b_wflow <span class="sc">|&gt;</span> </span>
<span id="cb39-5"><a href="#cb39-5"></a>  <span class="fu">extract_parameter_set_dials</span>() <span class="sc">|&gt;</span> </span>
<span id="cb39-6"><a href="#cb39-6"></a>  <span class="fu">grid_space_filling</span>(<span class="at">size =</span> <span class="dv">25</span>))</span>
<span id="cb39-7"><a href="#cb39-7"></a><span class="co">#&gt; # A tibble: 25 × 2</span></span>
<span id="cb39-8"><a href="#cb39-8"></a><span class="co">#&gt;    trees learn_rate</span></span>
<span id="cb39-9"><a href="#cb39-9"></a><span class="co">#&gt;    &lt;int&gt;      &lt;dbl&gt;</span></span>
<span id="cb39-10"><a href="#cb39-10"></a><span class="co">#&gt;  1     1    0.0287 </span></span>
<span id="cb39-11"><a href="#cb39-11"></a><span class="co">#&gt;  2    84    0.00536</span></span>
<span id="cb39-12"><a href="#cb39-12"></a><span class="co">#&gt;  3   167    0.121  </span></span>
<span id="cb39-13"><a href="#cb39-13"></a><span class="co">#&gt;  4   250    0.00162</span></span>
<span id="cb39-14"><a href="#cb39-14"></a><span class="co">#&gt;  5   334    0.0140 </span></span>
<span id="cb39-15"><a href="#cb39-15"></a><span class="co">#&gt;  6   417    0.0464 </span></span>
<span id="cb39-16"><a href="#cb39-16"></a><span class="co">#&gt;  7   500    0.196  </span></span>
<span id="cb39-17"><a href="#cb39-17"></a><span class="co">#&gt;  8   584    0.00422</span></span>
<span id="cb39-18"><a href="#cb39-18"></a><span class="co">#&gt;  9   667    0.00127</span></span>
<span id="cb39-19"><a href="#cb39-19"></a><span class="co">#&gt; 10   750    0.0178 </span></span>
<span id="cb39-20"><a href="#cb39-20"></a><span class="co">#&gt; # ℹ 15 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-a-regular-grid" class="level2">
<h2 class="anchored" data-anchor-id="create-a-regular-grid">Create a regular grid <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb40-2"><a href="#cb40-2"></a></span>
<span id="cb40-3"><a href="#cb40-3"></a>(grid <span class="ot">&lt;-</span> </span>
<span id="cb40-4"><a href="#cb40-4"></a>  b_wflow <span class="sc">|&gt;</span> </span>
<span id="cb40-5"><a href="#cb40-5"></a>  <span class="fu">extract_parameter_set_dials</span>() <span class="sc">|&gt;</span> </span>
<span id="cb40-6"><a href="#cb40-6"></a>  <span class="fu">grid_regular</span>(<span class="at">levels =</span> <span class="dv">4</span>))</span>
<span id="cb40-7"><a href="#cb40-7"></a><span class="co">#&gt; # A tibble: 16 × 2</span></span>
<span id="cb40-8"><a href="#cb40-8"></a><span class="co">#&gt;    trees learn_rate</span></span>
<span id="cb40-9"><a href="#cb40-9"></a><span class="co">#&gt;    &lt;int&gt;      &lt;dbl&gt;</span></span>
<span id="cb40-10"><a href="#cb40-10"></a><span class="co">#&gt;  1     1    0.001  </span></span>
<span id="cb40-11"><a href="#cb40-11"></a><span class="co">#&gt;  2   667    0.001  </span></span>
<span id="cb40-12"><a href="#cb40-12"></a><span class="co">#&gt;  3  1333    0.001  </span></span>
<span id="cb40-13"><a href="#cb40-13"></a><span class="co">#&gt;  4  2000    0.001  </span></span>
<span id="cb40-14"><a href="#cb40-14"></a><span class="co">#&gt;  5     1    0.00681</span></span>
<span id="cb40-15"><a href="#cb40-15"></a><span class="co">#&gt;  6   667    0.00681</span></span>
<span id="cb40-16"><a href="#cb40-16"></a><span class="co">#&gt;  7  1333    0.00681</span></span>
<span id="cb40-17"><a href="#cb40-17"></a><span class="co">#&gt;  8  2000    0.00681</span></span>
<span id="cb40-18"><a href="#cb40-18"></a><span class="co">#&gt;  9     1    0.0464 </span></span>
<span id="cb40-19"><a href="#cb40-19"></a><span class="co">#&gt; 10   667    0.0464 </span></span>
<span id="cb40-20"><a href="#cb40-20"></a><span class="co">#&gt; 11  1333    0.0464 </span></span>
<span id="cb40-21"><a href="#cb40-21"></a><span class="co">#&gt; 12  2000    0.0464 </span></span>
<span id="cb40-22"><a href="#cb40-22"></a><span class="co">#&gt; 13     1    0.316  </span></span>
<span id="cb40-23"><a href="#cb40-23"></a><span class="co">#&gt; 14   667    0.316  </span></span>
<span id="cb40-24"><a href="#cb40-24"></a><span class="co">#&gt; 15  1333    0.316  </span></span>
<span id="cb40-25"><a href="#cb40-25"></a><span class="co">#&gt; 16  2000    0.316</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="update-parameter-ranges" class="level2">
<h2 class="anchored" data-anchor-id="update-parameter-ranges">Update parameter ranges <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>b_param <span class="ot">&lt;-</span> </span>
<span id="cb41-2"><a href="#cb41-2"></a>  b_wflow <span class="sc">|&gt;</span> </span>
<span id="cb41-3"><a href="#cb41-3"></a>  <span class="fu">extract_parameter_set_dials</span>() <span class="sc">|&gt;</span> </span>
<span id="cb41-4"><a href="#cb41-4"></a>  <span class="fu">update</span>(<span class="at">trees =</span> <span class="fu">trees</span>(<span class="fu">c</span>(<span class="dv">1</span>L, <span class="dv">100</span>L)),</span>
<span id="cb41-5"><a href="#cb41-5"></a>         <span class="at">learn_rate =</span> <span class="fu">learn_rate</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>)))</span>
<span id="cb41-6"><a href="#cb41-6"></a></span>
<span id="cb41-7"><a href="#cb41-7"></a><span class="fu">set.seed</span>(<span class="dv">712</span>)</span>
<span id="cb41-8"><a href="#cb41-8"></a>(grid <span class="ot">&lt;-</span> </span>
<span id="cb41-9"><a href="#cb41-9"></a>  b_param <span class="sc">|&gt;</span> </span>
<span id="cb41-10"><a href="#cb41-10"></a>  <span class="fu">grid_space_filling</span>(<span class="at">size =</span> <span class="dv">25</span>))</span>
<span id="cb41-11"><a href="#cb41-11"></a><span class="co">#&gt; # A tibble: 25 × 2</span></span>
<span id="cb41-12"><a href="#cb41-12"></a><span class="co">#&gt;    trees learn_rate</span></span>
<span id="cb41-13"><a href="#cb41-13"></a><span class="co">#&gt;    &lt;int&gt;      &lt;dbl&gt;</span></span>
<span id="cb41-14"><a href="#cb41-14"></a><span class="co">#&gt;  1     1  0.00215  </span></span>
<span id="cb41-15"><a href="#cb41-15"></a><span class="co">#&gt;  2     5  0.000147 </span></span>
<span id="cb41-16"><a href="#cb41-16"></a><span class="co">#&gt;  3     9  0.0215   </span></span>
<span id="cb41-17"><a href="#cb41-17"></a><span class="co">#&gt;  4    13  0.0000215</span></span>
<span id="cb41-18"><a href="#cb41-18"></a><span class="co">#&gt;  5    17  0.000681 </span></span>
<span id="cb41-19"><a href="#cb41-19"></a><span class="co">#&gt;  6    21  0.00464  </span></span>
<span id="cb41-20"><a href="#cb41-20"></a><span class="co">#&gt;  7    25  0.0464   </span></span>
<span id="cb41-21"><a href="#cb41-21"></a><span class="co">#&gt;  8    29  0.0001   </span></span>
<span id="cb41-22"><a href="#cb41-22"></a><span class="co">#&gt;  9    34  0.0000147</span></span>
<span id="cb41-23"><a href="#cb41-23"></a><span class="co">#&gt; 10    38  0.001    </span></span>
<span id="cb41-24"><a href="#cb41-24"></a><span class="co">#&gt; # ℹ 15 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-results" class="level2">
<h2 class="anchored" data-anchor-id="the-results">The results <img src="hexes/ggplot2.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></h2>
<div class="cell" data-layout-align="center" data-output-location="column">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>grid <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(trees, learn_rate)) <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-6_files/figure-revealjs/sfd-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>Note that the learning rates are uniform on the log-10 scale and this shows 2 of 4 dimensions.</p>
</section>
</section>
<section id="use-the-tune_-functions-to-tune-models" class="level1">
<h1>Use the <code>tune_*()</code> functions to tune models</h1>
<section id="choosing-tuning-parameters" class="level2">
<h2 class="anchored" data-anchor-id="choosing-tuning-parameters">Choosing tuning parameters <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/recipes.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="192" width="64" height="74"></h2>
<p>Let’s take our previous model and tune more parameters:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>b_mod <span class="ot">&lt;-</span> </span>
<span id="cb43-2"><a href="#cb43-2"></a>  <span class="fu">boost_tree</span>(<span class="at">trees =</span> <span class="fu">tune</span>(), <span class="at">learn_rate =</span> <span class="fu">tune</span>(),  <span class="at">min_n =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb43-3"><a href="#cb43-3"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb43-4"><a href="#cb43-4"></a>  <span class="fu">set_engine</span>(<span class="st">"xgboost"</span>)</span>
<span id="cb43-5"><a href="#cb43-5"></a></span>
<span id="cb43-6"><a href="#cb43-6"></a>b_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(rec, b_mod)</span>
<span id="cb43-7"><a href="#cb43-7"></a></span>
<span id="cb43-8"><a href="#cb43-8"></a><span class="co"># Update the feature hash ranges (log-2 units)</span></span>
<span id="cb43-9"><a href="#cb43-9"></a>b_param <span class="ot">&lt;-</span></span>
<span id="cb43-10"><a href="#cb43-10"></a>  b_wflow <span class="sc">|&gt;</span></span>
<span id="cb43-11"><a href="#cb43-11"></a>  <span class="fu">extract_parameter_set_dials</span>() <span class="sc">|&gt;</span></span>
<span id="cb43-12"><a href="#cb43-12"></a>  <span class="fu">update</span>(<span class="at">trees =</span> <span class="fu">trees</span>(<span class="fu">c</span>(<span class="dv">1</span>L, <span class="dv">1000</span>L)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="grid-search-2" class="level2">
<h2 class="anchored" data-anchor-id="grid-search-2">Grid Search <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb44-2"><a href="#cb44-2"></a>ctrl <span class="ot">&lt;-</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-3"><a href="#cb44-3"></a></span>
<span id="cb44-4"><a href="#cb44-4"></a>b_res <span class="ot">&lt;-</span></span>
<span id="cb44-5"><a href="#cb44-5"></a>  b_wflow <span class="sc">|&gt;</span></span>
<span id="cb44-6"><a href="#cb44-6"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb44-7"><a href="#cb44-7"></a>    <span class="at">resamples =</span> folds,</span>
<span id="cb44-8"><a href="#cb44-8"></a>    <span class="at">grid =</span> <span class="dv">25</span>,</span>
<span id="cb44-9"><a href="#cb44-9"></a>    <span class="co"># The options below are not required by default</span></span>
<span id="cb44-10"><a href="#cb44-10"></a>    <span class="at">param_info =</span> b_param, </span>
<span id="cb44-11"><a href="#cb44-11"></a>    <span class="at">control =</span> ctrl,</span>
<span id="cb44-12"><a href="#cb44-12"></a>    <span class="at">metrics =</span> <span class="fu">metric_set</span>(mae)</span>
<span id="cb44-13"><a href="#cb44-13"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="notes">
<ul>
<li><code>tune_grid()</code> is representative of tuning function syntax</li>
<li>similar to <code>fit_resamples()</code></li>
</ul>
</div>
</section>
<section id="grid-search-3" class="level2">
<h2 class="anchored" data-anchor-id="grid-search-3">Grid Search <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"> <img src="hexes/dials.png" class="absolute" data-top="-20" data-right="128" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>b_res </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Tuning results</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # 10-fold cross-validation </span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 5</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    splits           id     .metrics          .notes           .predictions        </span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;            &lt;list&gt;           &lt;list&gt;              </span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 &lt;split [513/57]&gt; Fold01 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 &lt;split [513/57]&gt; Fold02 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 &lt;split [513/57]&gt; Fold03 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 &lt;split [513/57]&gt; Fold04 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 &lt;split [513/57]&gt; Fold05 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 &lt;split [513/57]&gt; Fold06 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 &lt;split [513/57]&gt; Fold07 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 &lt;split [513/57]&gt; Fold08 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 &lt;split [513/57]&gt; Fold09 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 &lt;split [513/57]&gt; Fold10 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="grid-results" class="level2">
<h2 class="anchored" data-anchor-id="grid-results">Grid results <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(b_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-6_files/figure-revealjs/autoplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="tuning-results" class="level2">
<h2 class="anchored" data-anchor-id="tuning-results">Tuning results <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(b_res)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 25 × 9</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    trees min_n learn_rate .metric .estimator  mean     n std_err .config              </span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                </span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1   458     2    0.00422 mae     standard   1.54     10  0.0259 Preprocessor1_Model01</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2   417     3    0.0590  mae     standard   0.347    10  0.0143 Preprocessor1_Model02</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3   833     5    0.0226  mae     standard   0.333    10  0.0133 Preprocessor1_Model03</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4   125     6    0.00536 mae     standard   5.34     10  0.0476 Preprocessor1_Model04</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5   708     8    0.196   mae     standard   0.359    10  0.0120 Preprocessor1_Model05</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6   791     9    0.00205 mae     standard   2.08     10  0.0300 Preprocessor1_Model06</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7    84    11    0.0464  mae     standard   0.405    10  0.0186 Preprocessor1_Model07</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8   250    13    0.316   mae     standard   0.356    10  0.0133 Preprocessor1_Model08</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9   292    14    0.00127 mae     standard   7.20     10  0.0562 Preprocessor1_Model09</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10   583    16    0.0110  mae     standard   0.353    10  0.0153 Preprocessor1_Model10</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 15 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="choose-a-parameter-combination" class="level2">
<h2 class="anchored" data-anchor-id="choose-a-parameter-combination">Choose a parameter combination <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_best</span>(b_res, <span class="at">metric =</span> <span class="st">"mae"</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 9</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   trees min_n learn_rate .metric .estimator  mean     n std_err .config              </span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                </span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   833     5     0.0226 mae     standard   0.333    10  0.0133 Preprocessor1_Model03</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2   542    21     0.121  mae     standard   0.342    10  0.0146 Preprocessor1_Model13</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3   958    17     0.0750 mae     standard   0.344    10  0.0130 Preprocessor1_Model11</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4   750    30     0.249  mae     standard   0.346    10  0.0123 Preprocessor1_Model19</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5   417     3     0.0590 mae     standard   0.347    10  0.0143 Preprocessor1_Model02</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="choose-a-parameter-combination-1" class="level2">
<h2 class="anchored" data-anchor-id="choose-a-parameter-combination-1">Choose a parameter combination <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<p>Create your own tibble for final parameters or use one of the <code>tune::select_*()</code> functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>(b_best <span class="ot">&lt;-</span> <span class="fu">select_best</span>(b_res, <span class="at">metric =</span> <span class="st">"mae"</span>))</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 4</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   trees min_n learn_rate .config              </span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt;                </span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   833     5     0.0226 Preprocessor1_Model03</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="checking-calibration" class="level2">
<h2 class="anchored" data-anchor-id="checking-calibration">Checking Calibration <img src="hexes/tune.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/probably.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></h2>
<div class="cell" data-output-location="column">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(probably)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>b_res <span class="sc">|&gt;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">parameters =</span> b_best</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cal_plot_regression</span>(</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">truth =</span> logC,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> .pred</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-6_files/figure-revealjs/b-cal-plot-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-final-fit" class="level2">
<h2 class="anchored" data-anchor-id="the-final-fit">The final fit!</h2>
<p>Suppose that we are happy with our model.</p>
<p>Let’s fit the model on the training set and verify our performance using the test set.</p>
<p>. . .</p>
<p>We’ve seen <code>fit()</code> and <code>predict()</code> (+ <code>augment()</code>) but there is a shortcut:</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the boosted tree workflow can be `finalized` with the best parameters</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>workflow <span class="ot">&lt;-</span> <span class="fu">finalize_workflow</span>(b_wflow, b_best)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># forested_split has train + test info</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>(final_fit <span class="ot">&lt;-</span> <span class="fu">last_fit</span>(workflow, split))</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Resampling results</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Manual resampling </span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 6</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   splits            id               .metrics         .notes           .predictions       .workflow </span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;list&gt;            &lt;chr&gt;            &lt;list&gt;           &lt;list&gt;           &lt;list&gt;             &lt;list&gt;    </span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 &lt;split [570/144]&gt; train/test split &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [144 × 4]&gt; &lt;workflow&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-final-fit-1" class="level2">
<h2 class="anchored" data-anchor-id="the-final-fit-1">The final fit!</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(final_fit)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric .estimator .estimate .config             </span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 rmse    standard       0.391 Preprocessor1_Model1</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 rsq     standard       0.918 Preprocessor1_Model1</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_predictions</span>(final_fit) <span class="sc">|&gt;</span> </span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(.pred, logC)) <span class="sc">+</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>() <span class="sc">+</span> </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-6_files/figure-revealjs/unnamed-chunk-47-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-whole-game" class="level2">
<h2 class="anchored" data-anchor-id="the-whole-game">The whole game</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/whole-game-final-performance.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->

<script>
  // htmlwidgets need to know to resize themselves when slides are shown/hidden.
  // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
  // slide changes (different for each slide format).
  (function () {
    // dispatch for htmlwidgets
    function fireSlideEnter() {
      const event = window.document.createEvent("Event");
      event.initEvent("slideenter", true, true);
      window.document.dispatchEvent(event);
    }

    function fireSlideChanged(previousSlide, currentSlide) {
      fireSlideEnter();

      // dispatch for shiny
      if (window.jQuery) {
        if (previousSlide) {
          window.jQuery(previousSlide).trigger("hidden");
        }
        if (currentSlide) {
          window.jQuery(currentSlide).trigger("shown");
        }
      }
    }

    // hookup for slidy
    if (window.w3c_slidy) {
      window.w3c_slidy.add_observer(function (slide_num) {
        // slide_num starts at position 1
        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
      });
    }

  })();
</script>

<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>