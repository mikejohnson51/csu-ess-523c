<!DOCTYPE html>
<html lang="en"><head>
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <title>ESS 523c – Week 2</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-be8ed9a3cdcbe7a498a633334f8d1033.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
<script src="https://use.fontawesome.com/5235085b15.js"></script>
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#1E4D2B" class="quarto-title-block center">
  <h1 class="title">Week 2</h1>
  <p class="subtitle">Features, Projections &amp; Measures</p>

<div class="quarto-title-authors">
</div>

</section>
<section id="simple-features" class="slide level2">
<h2>Simple Features</h2>

<img data-src="images/09-sf-model.png" width="350" class="r-stretch"></section>
<section id="todays-data-colorado-counties" class="slide level2">
<h2>Todays Data: Colorado Counties!</h2>
<div class="cell">
<pre><code>#&gt; Simple feature collection with 64 features and 4 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    geoid       name      aland state_nm                       geometry
#&gt; 1  08001      Adams 3021840487 Colorado MULTIPOLYGON (((-105.0532 3...
#&gt; 2  08003    Alamosa 1871643028 Colorado MULTIPOLYGON (((-105.4855 3...
#&gt; 3  08005   Arapahoe 2066438714 Colorado MULTIPOLYGON (((-103.7065 3...
#&gt; 4  08007  Archuleta 3496712164 Colorado MULTIPOLYGON (((-107.1287 3...
#&gt; 5  08009       Baca 6617400567 Colorado MULTIPOLYGON (((-102.0416 3...
#&gt; 6  08011       Bent 3918255148 Colorado MULTIPOLYGON (((-102.7476 3...
#&gt; 7  08013    Boulder 1881325109 Colorado MULTIPOLYGON (((-105.3978 3...
#&gt; 8  08014 Broomfield   85386685 Colorado MULTIPOLYGON (((-105.1092 3...
#&gt; 9  08015    Chaffee 2624715692 Colorado MULTIPOLYGON (((-105.9698 3...
#&gt; 10 08017   Cheyenne 4605713960 Colorado MULTIPOLYGON (((-103.1729 3...</code></pre>
</div>
</section>
<section id="simple-features-1" class="slide level2">
<h2>Simple Features</h2>
<ul>
<li class="fragment"><p>Simple feature geometries describe the geometries of <code>features.</code></p></li>
<li class="fragment"><p>The main application of simple feature geometries is to describe 2D geometries as <code>points</code>, <code>lines</code>, or <code>polygons</code>.</p></li>
<li class="fragment"><p>“simple” refers to the fact that line or polygon geometries are represented by set of points connected with straight lines.</p></li>
<li class="fragment"><p>Simple features access is a standard (Herring 2011, Herring (2010), ISO (2004)) for describing simple feature geometries via:</p>
<ol type="1">
<li class="fragment"><p>a class hierarchy</p></li>
<li class="fragment"><p>a set of operations</p></li>
<li class="fragment"><p>binary and text encodings</p></li>
</ol></li>
</ul>
</section>
<section id="simple-features-access" class="slide level2">
<h2>Simple Features Access</h2>
<ul>
<li class="fragment"><p><a href="https://en.wikipedia.org/wiki/Simple_Features">Simple features</a> or <a href="http://www.opengeospatial.org/standards/sfa"><em>simple feature access</em></a> refers to the formal standard (ISO 19125-1:2004) describing how objects in the real world can be represented in computers, with emphasis on the <em>spatial</em> geometry of these objects.</p></li>
<li class="fragment"><p>It also describes how objects can be stored in and retrieved from databases, and which geometrical operations should/can be defined for them.</p></li>
<li class="fragment"><p>The standard is widely implemented in spatial databases (such as PostGIS), commercial GIS (e.g., <a href="http://www.esri.com/">ESRI ArcGIS</a>) and forms the vector data basis for libraries such as <a href="http://www.gdal.org/">GDAL</a>.</p></li>
<li class="fragment"><p>A subset of simple features (e.g.&nbsp;the <strong>big 7</strong>) forms the <a href="http://geojson.org/">GeoJSON</a> specification.</p></li>
<li class="fragment"><p>R has well-supported classes for storing spatial data (<a href="https://CRAN.R-project.org/package=sp">sp</a>) and interfacing to the above mentioned environments (<a href="https://CRAN.R-project.org/package=rgdal">rgdal</a>, <a href="https://CRAN.R-project.org/package=rgeos">rgeos</a>), but has so far lacked a complete implementation of simple features, making conversions at times convoluted, inefficient or incomplete.</p></li>
<li class="fragment"><p><a href="http://github.com/r-spatial/sf">sf</a> is seeking to fill this gap and has/will succeed <a href="https://CRAN.R-project.org/package=sp">sp</a></p></li>
</ul>
</section>
<section id="so-what-is-a-feature" class="slide level2">
<h2>So what is a feature?</h2>
<ul>
<li class="fragment"><p>A feature is a thing (object) in the real world, such as a building or a river</p></li>
<li class="fragment"><p>They often consist of other objects.</p>
<ul>
<li class="fragment"><p>A river system can be a feature, a river can be a feature, a river outlet can be a feature.</p></li>
<li class="fragment"><p>A image pixel can be a feature, and the image can be a feature…</p></li>
</ul></li>
</ul>
</section>
<section id="spatial-features" class="slide level2">
<h2>Spatial Features</h2>
<ul>
<li class="fragment"><p>The standard says: “<em>A simple feature is defined by the OpenGIS Abstract specification to have both <strong>spatial</strong> and <strong>non-spatial</strong> attributes. Spatial attributes are geometry valued, and simple features are based on 2D geometry with linear interpolation between vertices.</em>” - <a href="http://www.opengeospatial.org/standards/sfa">standard</a>.</p></li>
<li class="fragment"><p>Spatial Features have a <em>geometry</em> describing <em>where</em> the feature is located and <em>how</em> it is represented.</p></li>
<li class="fragment"><p>The geometry of a river can be its watershed, of its mainstem, or the point it drains to (see the OGC <a href="https://docs.opengeospatial.org/is/14-111r6/14-111r6.html">HY_Feature</a> standard)</p></li>
<li class="fragment"><p>Features can have attributes describing other properties of the feature</p></li>
</ul>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a><span class="fu">str</span>(co<span class="sc">$</span>geometry)</span>
<span id="cb2-2"><a></a><span class="co">#&gt; sfc_MULTIPOLYGON of length 64; first list element: List of 1</span></span>
<span id="cb2-3"><a></a><span class="co">#&gt;  $ :List of 1</span></span>
<span id="cb2-4"><a></a><span class="co">#&gt;   ..$ : num [1:132, 1:2] -105 -105 -105 -105 -105 ...</span></span>
<span id="cb2-5"><a></a><span class="co">#&gt;  - attr(*, "class")= chr [1:3] "XY" "MULTIPOLYGON" "sfg"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment">Other properties may include its length, slope, stream order or average flowrate</li>
</ul>
</div>
</section>
<section id="geometry-types" class="slide level2 smaller">
<h2>Geometry types</h2>
<p>The following 7 simple feature types are the most common, and are the only ones used for <a href="https://tools.ietf.org/html/rfc7946">GeoJSON</a>:</p>
<table class="caption-top">
<colgroup>
<col style="width: 7%">
<col style="width: 92%">
</colgroup>
<thead>
<tr class="header">
<th>SINGLE</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>POINT</code></td>
<td>zero-dimensional geometry containing a single point</td>
</tr>
<tr class="even">
<td><code>LINESTRING</code></td>
<td>sequence of points connected by straight, non-self intersecting line pieces; one-dimensional geometry</td>
</tr>
<tr class="odd">
<td><code>POLYGON</code></td>
<td>geometry with a positive area (two-dimensional); sequence of points form a closed, non-self intersecting ring; the first ring denotes the exterior ring, zero or more subsequent rings denote holes in this exterior ring</td>
</tr>
</tbody>
</table>
<table class="caption-top">
<colgroup>
<col style="width: 7%">
<col style="width: 92%">
</colgroup>
<thead>
<tr class="header">
<th>MULTI (same typed)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>MULTIPOINT</code></td>
<td>set of points; a MULTIPOINT is simple if no two Points in the MULTIPOINT are equal</td>
</tr>
<tr class="even">
<td><code>MULTILINESTRING</code></td>
<td>set of linestrings</td>
</tr>
<tr class="odd">
<td><code>MULTIPOLYGON</code></td>
<td>set of polygons</td>
</tr>
</tbody>
</table>
<table class="caption-top">
<colgroup>
<col style="width: 7%">
<col style="width: 92%">
</colgroup>
<thead>
<tr class="header">
<th>Multi-Typed</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>GEOMETRYCOLLECTION</code></td>
<td>set of geometries of any type except GEOMETRYCOLLECTION</td>
</tr>
</tbody>
</table>
<ul>
<li class="fragment">The descriptions above were copied from the <a href="http://postgis.net/docs/using_postgis_dbmanagement.html">PostGIS manual</a>.</li>
</ul>
</section>
<section id="section" class="slide level2 smaller">
<h2></h2>
<p>The remaining geometries 10 are rarer, but increasingly find implementations:</p>
<table class="caption-top">
<colgroup>
<col style="width: 7%">
<col style="width: 92%">
</colgroup>
<thead>
<tr class="header">
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>CIRCULARSTRING</code></td>
<td>The CIRCULARSTRING is the basic curve type, similar to a LINESTRING in the linear world. A single segment requires three points, the start and end points (first and third) and any other point on the arc. The exception to this is for a closed circle, where the start and end points are the same. In this case the second point MUST be the center of the arc, i.e., the opposite side of the circle. To chain arcs together, the last point of the previous arc becomes the first point of the next arc, just like in LINESTRING. This means that a valid circular string must have an odd number of points greater than 1.</td>
</tr>
<tr class="even">
<td><code>COMPOUNDCURVE</code></td>
<td>A compound curve is a single, continuous curve that has both curved (circular) segments and linear segments. That means that in addition to having well-formed components, the end point of every component (except the last) must be coincident with the start point of the following component.</td>
</tr>
<tr class="odd">
<td><code>CURVEPOLYGON</code></td>
<td>Example compound curve in a curve polygon: CURVEPOLYGON(COMPOUNDCURVE(CIRCULARSTRING(0 0,2 0, 2 1, 2 3, 4 3),(4 3, 4 5, 1 4, 0 0)), CIRCULARSTRING(1.7 1, 1.4 0.4, 1.6 0.4, 1.6 0.5, 1.7 1) )</td>
</tr>
<tr class="even">
<td><code>MULTICURVE</code></td>
<td>A MultiCurve is a 1-dimensional GeometryCollection whose elements are Curves, it can include linear strings, circular strings or compound strings.</td>
</tr>
<tr class="odd">
<td><code>MULTISURFACE</code></td>
<td>A MultiSurface is a 2-dimensional GeometryCollection whose elements are Surfaces, all using coordinates from the same coordinate reference system.</td>
</tr>
<tr class="even">
<td><code>CURVE</code></td>
<td>A Curve is a 1-dimensional geometric object usually stored as a sequence of Points, with the subtype of Curve specifying the form of the interpolation between Points</td>
</tr>
<tr class="odd">
<td><code>SURFACE</code></td>
<td>A Surface is a 2-dimensional geometric object</td>
</tr>
<tr class="even">
<td><code>POLYHEDRALSURFACE</code></td>
<td>A PolyhedralSurface is a contiguous collection of polygons, which share common boundary segments</td>
</tr>
<tr class="odd">
<td><code>TIN</code></td>
<td>A TIN (triangulated irregular network) is a PolyhedralSurface consisting only of Triangle patches.</td>
</tr>
<tr class="even">
<td><code>TRIANGLE</code></td>
<td>A Triangle is a polygon with 3 distinct, non-collinear vertices and no interior boundary</td>
</tr>
</tbody>
</table>
</section>
<section id="dimensions" class="slide level2">
<h2>Dimensions</h2>
<p><strong>All</strong> geometries are composed of <code>points</code></p>
<ul>
<li class="fragment"><p>Points are defined by coordinates in a 2-, 3- or 4-D space.</p></li>
<li class="fragment"><p>In addition to XY coordinates, there are two optional dimensions:</p></li>
<li class="fragment"><p>a Z coordinate, denoting altitude</p></li>
<li class="fragment"><p>an M coordinate (rarely used), denoting some <em>measure</em></p></li>
<li class="fragment"><p>The <code>M</code> describes a property of the vertex that is <em>independent</em> of the feature.</p></li>
<li class="fragment"><p>It sounds attractive to encode a time as M, however these quickly become invalid once the path self-intersects.</p></li>
<li class="fragment"><p>Both Z and M are found relatively <strong>rarely</strong>, and software support to do something useful with them is rarer still.</p></li>
</ul>
</section>
<section id="valid-geometries" class="slide level2">
<h2>Valid geometries</h2>
<ul>
<li class="fragment"><p>Valid geometries obey the following properties:</p>
<ul>
<li class="fragment"><p><code>LINESTRINGS</code> shall not self-intersect</p></li>
<li class="fragment"><p><code>POLYGON</code> rings shall be closed (last point = first point)</p></li>
<li class="fragment"><p><code>POLYGON</code> holes (inner rings) shall be inside their exterior ring</p></li>
<li class="fragment"><p><code>POLYGON</code> inner rings shall maximally touch the exterior ring in single points, not over a line</p></li>
<li class="fragment"><p><code>POLYGON</code> rings shall not repeat their own path</p></li>
</ul></li>
<li class="fragment"><p>If any of the above is <strong>not</strong> the case, the geometry is not valid.</p></li>
</ul>
</section>
<section id="non-simple-and-non-valid-geometries" class="slide level2">
<h2>Non-simple and non-valid geometries</h2>
<ul>
<li class="fragment"><p><code>st_is_simple</code> and <code>st_is_valid</code> provide methods to help detect non-simple and non-valid geometries:</p></li>
<li class="fragment"><p>An example of a non-simple geometries is a self-intersecting lines</p></li>
<li class="fragment"><p>An example of a non-valid geometry are would be a polygon with slivers or self-intersections.</p></li>
</ul>
<div class="{columns}">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a>(x1 <span class="ot">&lt;-</span> <span class="fu">st_linestring</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>),<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>))))</span>
<span id="cb3-2"><a></a><span class="co">#&gt; LINESTRING (0 0, 1 1, 0 1, 1 0)</span></span>
<span id="cb3-3"><a></a><span class="fu">st_is_simple</span>(x1)</span>
<span id="cb3-4"><a></a><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.aling="center">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-2_files/figure-revealjs/unnamed-chunk-6-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>(x2 <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.6</span>,<span class="dv">1</span>,<span class="dv">0</span>)))))</span>
<span id="cb4-2"><a></a><span class="co">#&gt; POLYGON ((0 0, 1 0, 1 1, 1 0.6, 0 1, 0 0))</span></span>
<span id="cb4-3"><a></a>(x3 <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>)))))</span>
<span id="cb4-4"><a></a><span class="co">#&gt; POLYGON ((0 0, 1 1, 0 1, 1 0, 0 0))</span></span>
<span id="cb4-5"><a></a></span>
<span id="cb4-6"><a></a><span class="fu">st_is_valid</span>(<span class="fu">c</span>(x2,x3))</span>
<span id="cb4-7"><a></a><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.aling="center">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-2_files/figure-revealjs/unnamed-chunk-8-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="empty-geometries" class="slide level2">
<h2>Empty Geometries</h2>
<ul>
<li class="fragment"><p>An important concept in the feature geometry framework is the <code>empty</code> geometry.</p></li>
<li class="fragment"><p><code>empty</code> geometries serve similar purposes as NA values in vectors (placeholder)</p></li>
<li class="fragment"><p>Empty geometries arise naturally from geometrical operations, for instance:</p></li>
</ul>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a>(<span class="at">e =</span> <span class="fu">st_intersection</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)), <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))))</span>
<span id="cb5-2"><a></a><span class="co">#&gt; GEOMETRYCOLLECTION EMPTY</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment"><p>It is not entirely clear what the benefit is of having <code>typed</code> empty geometries, but according to the simple feature standard they are type so the <code>sf</code> package abides by that.</p></li>
<li class="fragment"><p>Empty geometries can be detected by:</p></li>
</ul>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a><span class="fu">st_is_empty</span>(e)</span>
<span id="cb6-2"><a></a><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="so" class="slide level2">
<h2>So:</h2>
<ul>
<li class="fragment">There are 17 typed geometries supported by the simple feature standard</li>
<li class="fragment">All geometries are made up of points</li>
<li class="fragment">points can exist in 2,3,4 Dinimsonal space</li>
<li class="fragment"><code>LINESTRING</code> and <code>POLYGON</code> geometries have rules that define validity</li>
<li class="fragment">Geometries can be empty (but are still typed)</li>
</ul>
</section>
<section>
<section id="well-known-text-well-known-binary" class="title-slide slide level1 center">
<h1>Well-known Text, Well-known Binary</h1>

</section>
<section id="wkt-and-wkb" class="slide level2">
<h2>WKT and WKB</h2>
<ul>
<li class="fragment"><p>The simple feature standard includes two encodings: Well-known text (WKT) &amp; well-known binary (WKB)</p></li>
<li class="fragment"><p><code>Well Known Text</code> is human-readable:</p></li>
</ul>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a>x <span class="ot">&lt;-</span> <span class="fu">st_linestring</span>(<span class="fu">matrix</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">1</span>,<span class="dv">5</span>))</span>
<span id="cb7-2"><a></a><span class="fu">st_as_text</span>(x)</span>
<span id="cb7-3"><a></a><span class="co">#&gt; [1] "LINESTRING (10 5, 9 4, 8 3, 7 2, 6 1)"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment"><p>In this example, the word <code>LINESTRING</code> provides the geometry <em>type</em> which is followed by a parentheses, inside the parentheses are the <code>points</code> that make up the geometry.</p></li>
<li class="fragment"><p>Separate points are separated by a “comma”, while the point coordinates are separated by a “space.”</p></li>
<li class="fragment"><p>Coordinates are usually floating point numbers, and moving large amounts of information as text is slow and imprecise.</p></li>
</ul>
</div>
</section>
<section class="slide level2">

<ul>
<li class="fragment">For that reason, we use well-known binary (WKB) encoding</li>
</ul>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a>x</span>
<span id="cb8-2"><a></a><span class="co">#&gt; LINESTRING (10 5, 9 4, 8 3, 7 2, 6 1)</span></span>
<span id="cb8-3"><a></a><span class="fu">st_as_binary</span>(x)</span>
<span id="cb8-4"><a></a><span class="co">#&gt;  [1] 01 02 00 00 00 05 00 00 00 00 00 00 00 00 00 24 40 00 00 00 00 00 00 14 40</span></span>
<span id="cb8-5"><a></a><span class="co">#&gt; [26] 00 00 00 00 00 00 22 40 00 00 00 00 00 00 10 40 00 00 00 00 00 00 20 40 00</span></span>
<span id="cb8-6"><a></a><span class="co">#&gt; [51] 00 00 00 00 00 08 40 00 00 00 00 00 00 1c 40 00 00 00 00 00 00 00 40 00 00</span></span>
<span id="cb8-7"><a></a><span class="co">#&gt; [76] 00 00 00 00 18 40 00 00 00 00 00 00 f0 3f</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment"><p>Binary conversion is used to communicate geometries to external libraries (GDAL, GEOS, liblwgeom) and spatial databases because it is fast and lossless.</p></li>
<li class="fragment"><p>WKT and WKB can both be transformed back into R native objects by</p></li>
</ul>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a><span class="fu">st_as_sfc</span>(<span class="st">"LINESTRING(10 5, 9 4, 8 3, 7 2, 6 1)"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb9-2"><a></a><span class="co">#&gt; LINESTRING (10 5, 9 4, 8 3, 7 2, 6 1)</span></span>
<span id="cb9-3"><a></a><span class="fu">st_as_sfc</span>(<span class="fu">structure</span>(<span class="fu">list</span>(<span class="fu">st_as_binary</span>(x)), <span class="at">class =</span> <span class="st">"WKB"</span>))[[<span class="dv">1</span>]]</span>
<span id="cb9-4"><a></a><span class="co">#&gt; LINESTRING (10 5, 9 4, 8 3, 7 2, 6 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment">Conversion between R native objects and WKB is done by package <code>sf</code> in compiled (C++/Rcpp) code, making this a reusable and fast route for I/O of simple feature geometries in R.</li>
</ul>
</div>
</section>
<section id="how-simple-features-are-organized-in-r" class="slide level2">
<h2>How simple features are organized in R?</h2>
<ul>
<li class="fragment"><p>Simple Features is a standard that is implemented in R (not limited to R)</p></li>
<li class="fragment"><p>So far we have discusses simple features the <em>standard</em>, rather then simple features the <em>implementation</em></p></li>
<li class="fragment"><p>In R, simple features are implemented using standard data <em>structures</em> (S3 classes, lists, matrix, vector).</p></li>
<li class="fragment"><p>Attributes are stored in <code>data.frames</code> (or <code>tbl_df</code>)</p></li>
<li class="fragment"><p>Feature geometries are stored in a <code>data.frame</code> column.</p></li>
<li class="fragment"><p>Since geometries are not single-valued, they are put in a <code>list-column</code></p></li>
<li class="fragment"><p>This means each observation (element) is a list itself!</p></li>
</ul>
<div class="fragment">
<p>Remember our nested lists?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a><span class="fu">list</span>(<span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)))</span>
<span id="cb10-2"><a></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb10-3"><a></a><span class="co">#&gt; [[1]][[1]]</span></span>
<span id="cb10-4"><a></a><span class="co">#&gt; [1] 1 2 3 4 5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section></section>
<section>
<section id="sfg-sfc-sf" class="title-slide slide level1 center">
<h1>sfg –&gt; sfc –&gt; sf</h1>

</section>
<section id="sf-sfc-sfg" class="slide level2">
<h2>sf, sfc, sfg</h2>
<p>The three classes are used to represent simple feature obejcts are:</p>
<p><code>sf</code>: <code>data.frame</code> with feature attributes and geometries</p>
<div class="fragment">
<p>which is contains an:<br>
</p>
<p><code>sfc</code>: the <code>list-column</code> with the geometries for each feature</p>
</div>
<div class="fragment">
<p>which is composed of:<br>
</p>
<p><code>sfg</code>, individual simple feature geometries</p>
</div>
</section>
<section id="sf-sfc-sfg-1" class="slide level2">
<h2>sf, sfc, sfg</h2>

<img data-src="images/10-sf-diagram.png" width="562" class="r-stretch"><p>In the output we see:</p>
<ul>
<li class="fragment"><p>in green a simple feature: a single <strong>record</strong> (row, consisting of attributes and geometry</p></li>
<li class="fragment"><p>in blue a single simple feature <strong>geometry</strong> (an object of class <code>sfg</code>)</p></li>
<li class="fragment"><p>in red a simple feature list-column (an object of class <code>sfc</code>, which is a column in the <code>data.frame</code>)</p></li>
<li class="fragment"><p>Even though geometries are native R objects, they are printed as <strong>well-known text</strong></p></li>
</ul>
</section>
<section id="sfg-simple-feature-geometry-blue" class="slide level2">
<h2><code>sfg</code>: simple feature geometry (blue)</h2>

<img data-src="images/10-sf-diagram.png" width="562" class="r-stretch"><ul>
<li class="fragment"><p>Simple feature geometry (<code>sfg</code>) objects carry the geometry for a single feature</p></li>
<li class="fragment"><p>Simple feature geometries are implemented as R native data, using the following rules</p>
<ol type="1">
<li class="fragment"><p>a single POINT is a numeric vector</p></li>
<li class="fragment"><p>a set of points (e.g.&nbsp;in a LINESTRING or ring of a POLYGON) is a <code>matrix</code>, each row containing a point</p></li>
<li class="fragment"><p>any other set is a <code>list</code></p></li>
</ol>
<ul>
<li class="fragment">list of numeric matrices for <code>MULTILINESTRING</code> and <code>POLYGON</code></li>
<li class="fragment">list of lists of numeric matrices for <code>MULTIPOLYGON</code></li>
<li class="fragment">list of (typed) geometries for <code>GEOMETRYCOLLECTION</code></li>
</ul></li>
</ul>
</section>
<section id="sfg-simple-feature-geometry" class="slide level2">
<h2><code>sfg</code>: simple feature geometry</h2>
<p>Creator functions are <strong>rarely</strong> used in practice, since we typically read existing spatial data. But, they are useful for illustration:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>(x <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)))</span>
<span id="cb11-2"><a></a><span class="co">#&gt; POINT (1 2)</span></span>
<span id="cb11-3"><a></a><span class="fu">str</span>(x)</span>
<span id="cb11-4"><a></a><span class="co">#&gt;  'XY' num [1:2] 1 2</span></span>
<span id="cb11-5"><a></a>(x <span class="ot">&lt;-</span> <span class="fu">st_linestring</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="at">ncol=</span><span class="dv">2</span>)))</span>
<span id="cb11-6"><a></a><span class="co">#&gt; LINESTRING (1 3, 2 4)</span></span>
<span id="cb11-7"><a></a><span class="fu">str</span>(x)</span>
<span id="cb11-8"><a></a><span class="co">#&gt;  'XY' num [1:2, 1:2] 1 2 3 4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sfg-simple-feature-geometry-1" class="slide level2">
<h2><code>sfg</code>: simple feature geometry</h2>
<p>All geometry objects have a S3 class indicating their (1) dimension, (2) type, and (3) superclass</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a>(<span class="at">pt =</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb12-2"><a></a><span class="co">#&gt; POINT (0 1)</span></span>
<span id="cb12-3"><a></a><span class="fu">attributes</span>(pt)</span>
<span id="cb12-4"><a></a><span class="co">#&gt; $class</span></span>
<span id="cb12-5"><a></a><span class="co">#&gt; [1] "XY"    "POINT" "sfg"</span></span>
<span id="cb12-6"><a></a></span>
<span id="cb12-7"><a></a>(<span class="at">pt2 =</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">4</span>)))</span>
<span id="cb12-8"><a></a><span class="co">#&gt; POINT Z (0 1 4)</span></span>
<span id="cb12-9"><a></a><span class="fu">attributes</span>(pt2)</span>
<span id="cb12-10"><a></a><span class="co">#&gt; $class</span></span>
<span id="cb12-11"><a></a><span class="co">#&gt; [1] "XYZ"   "POINT" "sfg"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sfg-simple-feature-geometry-2" class="slide level2">
<h2><code>sfg</code>: simple feature geometry</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a>(<span class="at">m1 =</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>)))</span>
<span id="cb13-2"><a></a><span class="co">#&gt;      [,1] [,2]</span></span>
<span id="cb13-3"><a></a><span class="co">#&gt; [1,]    8    1</span></span>
<span id="cb13-4"><a></a><span class="co">#&gt; [2,]    2    5</span></span>
<span id="cb13-5"><a></a><span class="co">#&gt; [3,]    3    2</span></span>
<span id="cb13-6"><a></a></span>
<span id="cb13-7"><a></a>(<span class="at">mp =</span> <span class="fu">st_multipoint</span>(m1))</span>
<span id="cb13-8"><a></a><span class="co">#&gt; MULTIPOINT ((8 1), (2 5), (3 2))</span></span>
<span id="cb13-9"><a></a><span class="fu">attributes</span>(mp)</span>
<span id="cb13-10"><a></a><span class="co">#&gt; $dim</span></span>
<span id="cb13-11"><a></a><span class="co">#&gt; [1] 3 2</span></span>
<span id="cb13-12"><a></a><span class="co">#&gt; </span></span>
<span id="cb13-13"><a></a><span class="co">#&gt; $class</span></span>
<span id="cb13-14"><a></a><span class="co">#&gt; [1] "XY"         "MULTIPOINT" "sfg"</span></span>
<span id="cb13-15"><a></a></span>
<span id="cb13-16"><a></a>(<span class="at">ls =</span> <span class="fu">st_linestring</span>(m1))</span>
<span id="cb13-17"><a></a><span class="co">#&gt; LINESTRING (8 1, 2 5, 3 2)</span></span>
<span id="cb13-18"><a></a><span class="fu">attributes</span>(ls)</span>
<span id="cb13-19"><a></a><span class="co">#&gt; $dim</span></span>
<span id="cb13-20"><a></a><span class="co">#&gt; [1] 3 2</span></span>
<span id="cb13-21"><a></a><span class="co">#&gt; </span></span>
<span id="cb13-22"><a></a><span class="co">#&gt; $class</span></span>
<span id="cb13-23"><a></a><span class="co">#&gt; [1] "XY"         "LINESTRING" "sfg"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sfg-simple-feature-geometry-3" class="slide level2">
<h2><code>sfg</code>: simple feature geometry</h2>
<p>Although these geometries contain the same <code>points</code> (m1), they have entirely different meaning: the point set is a zero-dimensional, the line a one-dimensional geometry:</p>
<p>Here, dimensions is <em>not</em> the XY vs XYZ, but rather whether the geometry has length (1D) or area (2D) or greater…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a><span class="fu">st_dimension</span>(mp)</span>
<span id="cb14-2"><a></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb14-3"><a></a></span>
<span id="cb14-4"><a></a><span class="fu">st_length</span>(mp)</span>
<span id="cb14-5"><a></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb14-6"><a></a></span>
<span id="cb14-7"><a></a><span class="fu">st_dimension</span>(ls)</span>
<span id="cb14-8"><a></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb14-9"><a></a></span>
<span id="cb14-10"><a></a><span class="fu">st_length</span>(ls)</span>
<span id="cb14-11"><a></a><span class="co">#&gt; [1] 10.37338</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mixed-geometries" class="slide level2">
<h2>Mixed geometries</h2>
<p>Sets of simple features also consist of features with heterogeneous geometries. In this case, the geometry type of the set is <code>GEOMETRY</code>:</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a>(<span class="at">g =</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)), </span>
<span id="cb15-2"><a></a>            <span class="fu">st_linestring</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)))))</span>
<span id="cb15-3"><a></a><span class="co">#&gt; Geometry set for 2 features </span></span>
<span id="cb15-4"><a></a><span class="co">#&gt; Geometry type: GEOMETRY</span></span>
<span id="cb15-5"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb15-6"><a></a><span class="co">#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 1</span></span>
<span id="cb15-7"><a></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb15-8"><a></a><span class="co">#&gt; POINT (0 0)</span></span>
<span id="cb15-9"><a></a><span class="co">#&gt; LINESTRING (0 0, 1 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p>These set can be filtered by using <code>st_is</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a>g <span class="sc">|&gt;</span> <span class="fu">st_is</span>(<span class="st">"LINESTRING"</span>)</span>
<span id="cb16-2"><a></a><span class="co">#&gt; [1] FALSE  TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or, when working with sf objects,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a><span class="co"># Note need of %&gt;%</span></span>
<span id="cb17-2"><a></a><span class="fu">st_sf</span>(g) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a></a>  <span class="fu">filter</span>(<span class="fu">st_is</span>(., <span class="st">"LINESTRING"</span>))</span>
<span id="cb17-4"><a></a><span class="co">#&gt; Simple feature collection with 1 feature and 0 fields</span></span>
<span id="cb17-5"><a></a><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span id="cb17-6"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb17-7"><a></a><span class="co">#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 1</span></span>
<span id="cb17-8"><a></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb17-9"><a></a><span class="co">#&gt;                       g</span></span>
<span id="cb17-10"><a></a><span class="co">#&gt; 1 LINESTRING (0 0, 1 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section id="geometrycollection" class="slide level2">
<h2>GEOMETRYCOLLECTION</h2>
<ul>
<li class="fragment"><p>Single features (1 geometry per row) can have a single geometry, that consists of several geometries of different types.</p></li>
<li class="fragment"><p>Such cases arise rather naturally when looking for intersections. For instance, the intersection of two LINESTRING geometries may be the combination of a <code>LINESTRING</code> and a <code>POINT.</code></p></li>
<li class="fragment"><p>Putting this intersection into a single feature geometry needs a <code>GEOMETRYCOLLECTION</code></p></li>
</ul>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a>pt <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb18-2"><a></a>ls <span class="ot">&lt;-</span> <span class="fu">st_linestring</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">ncol =</span> <span class="dv">2</span>))</span>
<span id="cb18-3"><a></a>poly1 <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">5.5</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="fl">5.5</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="dv">0</span>), <span class="at">ncol =</span> <span class="dv">2</span>)))</span>
<span id="cb18-4"><a></a>poly2 <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">6.6</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="fl">6.6</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">2</span>)))</span>
<span id="cb18-5"><a></a>multipoly <span class="ot">&lt;-</span> <span class="fu">st_multipolygon</span>(<span class="fu">list</span>(poly1, poly2))</span>
<span id="cb18-6"><a></a></span>
<span id="cb18-7"><a></a><span class="fu">st_sfc</span>(pt, ls, poly1, poly2, multipoly)</span>
<span id="cb18-8"><a></a><span class="co">#&gt; Geometry set for 5 features </span></span>
<span id="cb18-9"><a></a><span class="co">#&gt; Geometry type: GEOMETRY</span></span>
<span id="cb18-10"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb18-11"><a></a><span class="co">#&gt; Bounding box:  xmin: 1 ymin: -0.5 xmax: 8 ymax: 1.5</span></span>
<span id="cb18-12"><a></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb18-13"><a></a><span class="co">#&gt; POINT (1 0)</span></span>
<span id="cb18-14"><a></a><span class="co">#&gt; LINESTRING (4 0, 3 0)</span></span>
<span id="cb18-15"><a></a><span class="co">#&gt; POLYGON ((5.5 0, 7 0, 7 -0.5, 6 -0.5, 5.5 0))</span></span>
<span id="cb18-16"><a></a><span class="co">#&gt; POLYGON ((6.6 1, 8 1, 8 1.5, 7 1.5, 6.6 1))</span></span>
<span id="cb18-17"><a></a><span class="co">#&gt; MULTIPOLYGON (((5.5 0, 7 0, 7 -0.5, 6 -0.5, 5.5...</span></span>
<span id="cb18-18"><a></a></span>
<span id="cb18-19"><a></a>(j <span class="ot">&lt;-</span> <span class="fu">st_geometrycollection</span>(<span class="fu">list</span>(pt, ls, poly1, poly2, multipoly)))</span>
<span id="cb18-20"><a></a><span class="co">#&gt; GEOMETRYCOLLECTION (POINT (1 0), LINESTRING (4 0, 3 0), POLYGON ((5.5 0, 7 0, 7 -0.5, 6 -0.5, 5.5 0)), POLYGON ((6.6 1, 8 1, 8 1.5, 7 1.5, 6.6 1)), MULTIPOLYGON (((5.5 0, 7 0, 7 -0.5, 6 -0.5, 5.5 0)), ((6.6 1, 8 1, 8 1.5, 7 1.5, 6.6 1))))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="geometrycollection-1" class="slide level2">
<h2>GEOMETRYCOLLECTION</h2>
<ul>
<li class="fragment">In case we end up with <code>GEOMETRYCOLLECTION</code> objects, the next question is often what to do with them. One thing we can do is extract elements from them:</li>
</ul>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a><span class="fu">st_collection_extract</span>(j, <span class="st">"POLYGON"</span>)</span>
<span id="cb19-2"><a></a><span class="co">#&gt; Geometry set for 3 features </span></span>
<span id="cb19-3"><a></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb19-4"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb19-5"><a></a><span class="co">#&gt; Bounding box:  xmin: 5.5 ymin: -0.5 xmax: 8 ymax: 1.5</span></span>
<span id="cb19-6"><a></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb19-7"><a></a><span class="co">#&gt; MULTIPOLYGON (((5.5 0, 7 0, 7 -0.5, 6 -0.5, 5.5...</span></span>
<span id="cb19-8"><a></a><span class="co">#&gt; MULTIPOLYGON (((6.6 1, 8 1, 8 1.5, 7 1.5, 6.6 1)))</span></span>
<span id="cb19-9"><a></a><span class="co">#&gt; MULTIPOLYGON (((5.5 0, 7 0, 7 -0.5, 6 -0.5, 5.5...</span></span>
<span id="cb19-10"><a></a></span>
<span id="cb19-11"><a></a><span class="fu">st_collection_extract</span>(j, <span class="st">"POINT"</span>)</span>
<span id="cb19-12"><a></a><span class="co">#&gt; POINT (1 0)</span></span>
<span id="cb19-13"><a></a></span>
<span id="cb19-14"><a></a><span class="fu">st_collection_extract</span>(j, <span class="st">"LINESTRING"</span>)</span>
<span id="cb19-15"><a></a><span class="co">#&gt; LINESTRING (4 0, 3 0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="conversion-between-types" class="slide level2">
<h2>Conversion between types</h2>
<p>We can convert simple feature geometries using the <code>st_cast</code> generic (up to the extent that a conversion is feasible):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a><span class="fu">methods</span>(st_cast)</span>
<span id="cb20-2"><a></a><span class="co">#&gt;  [1] st_cast.CIRCULARSTRING*     st_cast.COMPOUNDCURVE*     </span></span>
<span id="cb20-3"><a></a><span class="co">#&gt;  [3] st_cast.CURVE*              st_cast.GEOMETRYCOLLECTION*</span></span>
<span id="cb20-4"><a></a><span class="co">#&gt;  [5] st_cast.LINESTRING*         st_cast.MULTICURVE*        </span></span>
<span id="cb20-5"><a></a><span class="co">#&gt;  [7] st_cast.MULTILINESTRING*    st_cast.MULTIPOINT*        </span></span>
<span id="cb20-6"><a></a><span class="co">#&gt;  [9] st_cast.MULTIPOLYGON*       st_cast.MULTISURFACE*      </span></span>
<span id="cb20-7"><a></a><span class="co">#&gt; [11] st_cast.POINT*              st_cast.POLYGON*           </span></span>
<span id="cb20-8"><a></a><span class="co">#&gt; [13] st_cast.sf*                 st_cast.sfc*               </span></span>
<span id="cb20-9"><a></a><span class="co">#&gt; [15] st_cast.sfc_CIRCULARSTRING*</span></span>
<span id="cb20-10"><a></a><span class="co">#&gt; see '?methods' for accessing help and source code</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conversion-between-types-1" class="slide level2">
<h2>Conversion between types</h2>
<p>Lets take the Larimer County in our Colorado sf object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a>(<span class="at">co1 =</span> <span class="fu">filter</span>(co, name <span class="sc">==</span> <span class="st">"Larimer"</span>)<span class="sc">$</span>geometry)</span>
<span id="cb21-2"><a></a><span class="co">#&gt; Geometry set for 1 feature </span></span>
<span id="cb21-3"><a></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb21-4"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb21-5"><a></a><span class="co">#&gt; Bounding box:  xmin: -106.1954 ymin: 40.25778 xmax: -104.9431 ymax: 40.99844</span></span>
<span id="cb21-6"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb21-7"><a></a><span class="co">#&gt; MULTIPOLYGON (((-105.6533 40.26046, -105.6094 4...</span></span>
<span id="cb21-8"><a></a>(<span class="at">co_ls =</span> <span class="fu">st_cast</span>(co1, <span class="st">"MULTILINESTRING"</span>))</span>
<span id="cb21-9"><a></a><span class="co">#&gt; Geometry set for 1 feature </span></span>
<span id="cb21-10"><a></a><span class="co">#&gt; Geometry type: MULTILINESTRING</span></span>
<span id="cb21-11"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb21-12"><a></a><span class="co">#&gt; Bounding box:  xmin: -106.1954 ymin: 40.25778 xmax: -104.9431 ymax: 40.99844</span></span>
<span id="cb21-13"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb21-14"><a></a><span class="co">#&gt; MULTILINESTRING ((-105.6533 40.26046, -105.6094...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="week-2_files/figure-revealjs/unnamed-chunk-28-1.png" width="960" class="r-stretch"></section>
<section id="conversion-between-types-2" class="slide level2">
<h2>Conversion between types</h2>
<p>It is often convenient to analyze the the points that make up a <code>LINESTRING</code> However …</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a></a>  <span class="fu">st_linestring</span>() <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a></a>  <span class="fu">st_cast</span>(<span class="st">"POINT"</span>)</span>
<span id="cb22-4"><a></a><span class="co">#&gt; Warning in st_cast.LINESTRING(st_linestring(rbind(c(0, 0), c(1, 1), c(1, :</span></span>
<span id="cb22-5"><a></a><span class="co">#&gt; point from first coordinate only</span></span>
<span id="cb22-6"><a></a><span class="co">#&gt; POINT (0 0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>does not do what we expect, because it will convert a <strong>single</strong> geometry into a new <strong>single</strong> geometry (one line to one point)</p>
</div>
<div class="fragment">
<p>Instead, we must recognize that a collection of points is what defines a <code>LINSETRING</code> and a collection of <code>POINT</code>s, operating as a single unit, is a <code>MULTIPOINT</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a></a>  <span class="fu">st_linestring</span>() <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a></a>  <span class="fu">st_cast</span>(<span class="st">"MULTIPOINT"</span>)</span>
<span id="cb23-4"><a></a><span class="co">#&gt; MULTIPOINT ((0 0), (1 1), (1 0), (0 1))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<p>If we really wanted the individual <code>POINT</code> geometries, we need to work with sets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a>(p <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a></a>   <span class="fu">st_linestring</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-3"><a></a>   <span class="fu">st_sfc</span>() <span class="sc">|&gt;</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb24-4"><a></a>   <span class="fu">st_cast</span>(<span class="st">"POINT"</span>))</span>
<span id="cb24-5"><a></a><span class="co">#&gt; Geometry set for 4 features </span></span>
<span id="cb24-6"><a></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb24-7"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb24-8"><a></a><span class="co">#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 1</span></span>
<span id="cb24-9"><a></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb24-10"><a></a><span class="co">#&gt; POINT (0 0)</span></span>
<span id="cb24-11"><a></a><span class="co">#&gt; POINT (1 1)</span></span>
<span id="cb24-12"><a></a><span class="co">#&gt; POINT (1 0)</span></span>
<span id="cb24-13"><a></a><span class="co">#&gt; POINT (0 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="sfc-sets-of-geometries" class="slide level2">
<h2><code>sfc</code>: sets of geometries</h2>
<ul>
<li class="fragment"><p><code>sf</code> provides a dedicated class for handeling geometry sets, called <code>sfc</code> (simple feature geometry list column).</p></li>
<li class="fragment"><p>We can create such a list column with constructor function <code>st_sfc</code>:</p></li>
</ul>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a>(<span class="at">sfc =</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)), <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">2</span>))))</span>
<span id="cb25-2"><a></a><span class="co">#&gt; Geometry set for 2 features </span></span>
<span id="cb25-3"><a></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb25-4"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb25-5"><a></a><span class="co">#&gt; Bounding box:  xmin: -3 ymin: 1 xmax: 0 ymax: 2</span></span>
<span id="cb25-6"><a></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb25-7"><a></a><span class="co">#&gt; POINT (0 1)</span></span>
<span id="cb25-8"><a></a><span class="co">#&gt; POINT (-3 2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section class="slide level2">

<p>The default report from the print method for sfc gives</p>
<ul>
<li class="fragment">the number of features geometries</li>
<li class="fragment">the feature geometry type (here: POINT)</li>
<li class="fragment">the feature geometry dimension (here: XY)</li>
<li class="fragment">the bounding box for the set</li>
<li class="fragment">the coordinate reference system for the set (epsg and proj4string)</li>
<li class="fragment">the first few geometries, as (abbreviated) WKT</li>
</ul>
<div class="fragment">
<p>The class of the geometry <code>list-column</code> is a combination of a specific class, and a superclass.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a><span class="fu">class</span>(sfc)</span>
<span id="cb26-2"><a></a><span class="co">#&gt; [1] "sfc_POINT" "sfc"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section class="slide level2">

<p>In addition to a class, the <code>sfc</code> object has further attributes (remember S3 class!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a><span class="fu">attributes</span>(sfc) <span class="sc">|&gt;</span> <span class="fu">names</span>()</span>
<span id="cb27-2"><a></a><span class="co">#&gt; [1] "class"     "precision" "bbox"      "crs"       "n_empty"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>which are used to record for the whole set:</p>
<ul>
<li class="fragment">a precision value</li>
<li class="fragment">the bounding box enclosing all geometries (for x and y)</li>
<li class="fragment">a coordinate reference system</li>
<li class="fragment">the number of empty geometries contained in the set</li>
</ul>
</section>
<section class="slide level2">

<p>This means that all these properties are defined for the set (sfc), and not for geometries (sfg) individually.</p>
<p><code>sfc</code> objects are lists with each entry being an sfg object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a>p[[<span class="dv">2</span>]]</span>
<span id="cb28-2"><a></a><span class="co">#&gt; POINT (1 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and we will use these lists as <em>list columns</em> in <code>data.frame</code> or <code>tibble</code> objects to represent simple features with geometries in a list column.</p>
</section>
<section id="sets-of-geometries-arise-when-we-separate-compound-geometries" class="slide level2">
<h2>Sets of geometries arise when we separate compound geometries:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;      [,1] [,2]
#&gt; [1,]    0    0
#&gt; [2,]    1    1
#&gt; [3,]    1    0
#&gt; [4,]    0    1</code></pre>
</div>
</div></div>
</section>
<section id="sets-of-geometries-arise-when-we-separate-compound-geometries-1" class="slide level2">
<h2>Sets of geometries arise when we separate compound geometries:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a></a>   <span class="fu">st_linestring</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; LINESTRING (0 0, 1 1, 1 0, 0 1)</code></pre>
</div>
</div></div>
</section>
<section id="sets-of-geometries-arise-when-we-separate-compound-geometries-2" class="slide level2">
<h2>Sets of geometries arise when we separate compound geometries:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a></a>   <span class="fu">st_linestring</span>() <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a></a>   <span class="fu">st_sfc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Geometry set for 1 feature 
#&gt; Geometry type: LINESTRING
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 1
#&gt; CRS:           NA
#&gt; LINESTRING (0 0, 1 1, 1 0, 0 1)</code></pre>
</div>
</div></div>
</section>
<section id="sets-of-geometries-arise-when-we-separate-compound-geometries-3" class="slide level2">
<h2>Sets of geometries arise when we separate compound geometries:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a></a>   <span class="fu">st_linestring</span>() <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a></a>   <span class="fu">st_sfc</span>() <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a></a>   <span class="fu">st_cast</span>(<span class="st">"POINT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Geometry set for 4 features 
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 1
#&gt; CRS:           NA
#&gt; POINT (0 0)
#&gt; POINT (1 1)
#&gt; POINT (1 0)
#&gt; POINT (0 1)</code></pre>
</div>
</div></div>
</section>
<section id="sets-of-geometries-arise-when-we-separate-compound-geometries-4" class="slide level2">
<h2>Sets of geometries arise when we separate compound geometries:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a></a><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a></a>   <span class="fu">st_linestring</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a></a>   <span class="fu">st_sfc</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-4"><a></a>   <span class="fu">st_cast</span>(<span class="st">"POINT"</span>) <span class="ot">-&gt;</span></span>
<span id="cb37-5"><a></a>  p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">

</div></div>
<ul>
<li class="fragment"><p>On the last slide, <code>st_sfc</code> creates a set of <em>one</em> <code>LINESTRING</code> (p), with a size of 4.</p></li>
<li class="fragment"><p>Going the other way around (from set to feature), we need to <em>combine</em> geometries:</p></li>
</ul>
<div class="fragment">
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a></a>p</span>
<span id="cb38-2"><a></a><span class="co">#&gt; Geometry set for 4 features </span></span>
<span id="cb38-3"><a></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb38-4"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb38-5"><a></a><span class="co">#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 1</span></span>
<span id="cb38-6"><a></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb38-7"><a></a><span class="co">#&gt; POINT (0 0)</span></span>
<span id="cb38-8"><a></a><span class="co">#&gt; POINT (1 1)</span></span>
<span id="cb38-9"><a></a><span class="co">#&gt; POINT (1 0)</span></span>
<span id="cb38-10"><a></a><span class="co">#&gt; POINT (0 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a></a><span class="fu">st_combine</span>(p)</span>
<span id="cb39-2"><a></a><span class="co">#&gt; Geometry set for 1 feature </span></span>
<span id="cb39-3"><a></a><span class="co">#&gt; Geometry type: MULTIPOINT</span></span>
<span id="cb39-4"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb39-5"><a></a><span class="co">#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 1</span></span>
<span id="cb39-6"><a></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb39-7"><a></a><span class="co">#&gt; MULTIPOINT ((0 0), (1 1), (1 0), (0 1))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</div>
</section>
<section id="casting-must-be-done-the-level-of-the-feature" class="slide level2">
<h2>Casting must be done the level of the feature</h2>
<p>If we want to go from the 4 feature (p) object to a 1 feature LINESTRING, we must combine before casting …</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a></a><span class="fu">st_combine</span>(p) <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a></a>  <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>)</span>
<span id="cb40-3"><a></a><span class="co">#&gt; Geometry set for 1 feature </span></span>
<span id="cb40-4"><a></a><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span id="cb40-5"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb40-6"><a></a><span class="co">#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 1</span></span>
<span id="cb40-7"><a></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb40-8"><a></a><span class="co">#&gt; LINESTRING (0 0, 1 1, 1 0, 0 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="disolving-geometries" class="title-slide slide level1 center">
<h1>Disolving Geometries</h1>
<p>Combining geometries <strong>preserves</strong> their interior boundaries, unioning <strong>resolves/dissolves</strong> the internal boundaries:</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a></a>(<span class="at">co_geom =</span> co<span class="sc">$</span>geometry)</span>
<span id="cb41-2"><a></a><span class="co">#&gt; Geometry set for 64 features </span></span>
<span id="cb41-3"><a></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb41-4"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb41-5"><a></a><span class="co">#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342</span></span>
<span id="cb41-6"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb41-7"><a></a><span class="co">#&gt; First 5 geometries:</span></span>
<span id="cb41-8"><a></a><span class="co">#&gt; MULTIPOLYGON (((-105.0532 39.79106, -104.976 39...</span></span>
<span id="cb41-9"><a></a><span class="co">#&gt; MULTIPOLYGON (((-105.4855 37.5779, -105.4859 37...</span></span>
<span id="cb41-10"><a></a><span class="co">#&gt; MULTIPOLYGON (((-103.7065 39.73989, -103.7239 3...</span></span>
<span id="cb41-11"><a></a><span class="co">#&gt; MULTIPOLYGON (((-107.1287 37.42294, -107.2803 3...</span></span>
<span id="cb41-12"><a></a><span class="co">#&gt; MULTIPOLYGON (((-102.0416 37.64428, -102.0558 3...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a></a><span class="fu">plot</span>(co_geom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-2_files/figure-revealjs/unnamed-chunk-40-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="section-1" class="slide level2 smaller">
<h2></h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a></a>(<span class="at">co_c =</span> <span class="fu">st_combine</span>(co_geom))</span>
<span id="cb43-2"><a></a><span class="co">#&gt; Geometry set for 1 feature </span></span>
<span id="cb43-3"><a></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb43-4"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb43-5"><a></a><span class="co">#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342</span></span>
<span id="cb43-6"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb43-7"><a></a><span class="co">#&gt; MULTIPOLYGON (((-105.0532 39.79106, -104.976 39...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week-2_files/figure-revealjs/unnamed-chunk-42-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a></a>(<span class="at">co_u =</span> <span class="fu">st_union</span>(co_geom))</span>
<span id="cb44-2"><a></a><span class="co">#&gt; Geometry set for 1 feature </span></span>
<span id="cb44-3"><a></a><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span id="cb44-4"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb44-5"><a></a><span class="co">#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342</span></span>
<span id="cb44-6"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb44-7"><a></a><span class="co">#&gt; POLYGON ((-105.155 36.99526, -105.1208 36.99543...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week-2_files/figure-revealjs/unnamed-chunk-44-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a></a>(<span class="at">co_c_ml =</span> <span class="fu">st_combine</span>(co_geom) <span class="sc">|&gt;</span> </span>
<span id="cb45-2"><a></a>   <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>))</span>
<span id="cb45-3"><a></a><span class="co">#&gt; Geometry set for 1 feature </span></span>
<span id="cb45-4"><a></a><span class="co">#&gt; Geometry type: MULTILINESTRING</span></span>
<span id="cb45-5"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb45-6"><a></a><span class="co">#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342</span></span>
<span id="cb45-7"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb45-8"><a></a><span class="co">#&gt; MULTILINESTRING ((-105.0532 39.79106, -104.976 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week-2_files/figure-revealjs/unnamed-chunk-46-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a></a>(<span class="at">co_u_ml =</span> <span class="fu">st_union</span>(co_geom)  <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a></a>    <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>))</span>
<span id="cb46-3"><a></a><span class="co">#&gt; Geometry set for 1 feature </span></span>
<span id="cb46-4"><a></a><span class="co">#&gt; Geometry type: MULTILINESTRING</span></span>
<span id="cb46-5"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb46-6"><a></a><span class="co">#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342</span></span>
<span id="cb46-7"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb46-8"><a></a><span class="co">#&gt; MULTILINESTRING ((-105.155 36.99526, -105.1208 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week-2_files/figure-revealjs/unnamed-chunk-48-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="sf-objects-with-simple-features" class="slide level2">
<h2><code>sf</code>: objects with simple features</h2>
<p>Simple features <code>geometries</code> and feature <code>attributes</code> are put together in <code>sf</code> (simple feature) objects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a></a>co</span>
<span id="cb47-2"><a></a><span class="co">#&gt; Simple feature collection with 64 features and 4 fields</span></span>
<span id="cb47-3"><a></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb47-4"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb47-5"><a></a><span class="co">#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342</span></span>
<span id="cb47-6"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb47-7"><a></a><span class="co">#&gt; First 10 features:</span></span>
<span id="cb47-8"><a></a><span class="co">#&gt;    geoid       name      aland state_nm                       geometry</span></span>
<span id="cb47-9"><a></a><span class="co">#&gt; 1  08001      Adams 3021840487 Colorado MULTIPOLYGON (((-105.0532 3...</span></span>
<span id="cb47-10"><a></a><span class="co">#&gt; 2  08003    Alamosa 1871643028 Colorado MULTIPOLYGON (((-105.4855 3...</span></span>
<span id="cb47-11"><a></a><span class="co">#&gt; 3  08005   Arapahoe 2066438714 Colorado MULTIPOLYGON (((-103.7065 3...</span></span>
<span id="cb47-12"><a></a><span class="co">#&gt; 4  08007  Archuleta 3496712164 Colorado MULTIPOLYGON (((-107.1287 3...</span></span>
<span id="cb47-13"><a></a><span class="co">#&gt; 5  08009       Baca 6617400567 Colorado MULTIPOLYGON (((-102.0416 3...</span></span>
<span id="cb47-14"><a></a><span class="co">#&gt; 6  08011       Bent 3918255148 Colorado MULTIPOLYGON (((-102.7476 3...</span></span>
<span id="cb47-15"><a></a><span class="co">#&gt; 7  08013    Boulder 1881325109 Colorado MULTIPOLYGON (((-105.3978 3...</span></span>
<span id="cb47-16"><a></a><span class="co">#&gt; 8  08014 Broomfield   85386685 Colorado MULTIPOLYGON (((-105.1092 3...</span></span>
<span id="cb47-17"><a></a><span class="co">#&gt; 9  08015    Chaffee 2624715692 Colorado MULTIPOLYGON (((-105.9698 3...</span></span>
<span id="cb47-18"><a></a><span class="co">#&gt; 10 08017   Cheyenne 4605713960 Colorado MULTIPOLYGON (((-103.1729 3...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This <code>sf</code> object is of class</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a></a><span class="fu">class</span>(co)</span>
<span id="cb48-2"><a></a><span class="co">#&gt; [1] "sf"         "data.frame"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>meaning it extends <code>data.frame</code>, but with a single list-column with geometries, which is held in the column named:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a></a><span class="fu">attr</span>(co, <span class="st">"sf_column"</span>)</span>
<span id="cb49-2"><a></a><span class="co">#&gt; [1] "geometry"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sfc-simple-feature-geometry-list-column" class="slide level2">
<h2>sfc: simple feature geometry list-column</h2>
<p>The column in the <code>sf</code> <code>data.frame</code> that contains the geometries is a list, of class <code>sfc</code>.</p>
<p>We can retrieve the geometry list-column as we would any data.frame column (e.g.&nbsp;<code>co$geometry</code>), or more generally with <code>st_geometry</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a></a>(co_geom <span class="ot">&lt;-</span> <span class="fu">st_geometry</span>(co))</span>
<span id="cb50-2"><a></a><span class="co">#&gt; Geometry set for 64 features </span></span>
<span id="cb50-3"><a></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb50-4"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb50-5"><a></a><span class="co">#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342</span></span>
<span id="cb50-6"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb50-7"><a></a><span class="co">#&gt; First 5 geometries:</span></span>
<span id="cb50-8"><a></a><span class="co">#&gt; MULTIPOLYGON (((-105.0532 39.79106, -104.976 39...</span></span>
<span id="cb50-9"><a></a><span class="co">#&gt; MULTIPOLYGON (((-105.4855 37.5779, -105.4859 37...</span></span>
<span id="cb50-10"><a></a><span class="co">#&gt; MULTIPOLYGON (((-103.7065 39.73989, -103.7239 3...</span></span>
<span id="cb50-11"><a></a><span class="co">#&gt; MULTIPOLYGON (((-107.1287 37.42294, -107.2803 3...</span></span>
<span id="cb50-12"><a></a><span class="co">#&gt; MULTIPOLYGON (((-102.0416 37.64428, -102.0558 3...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Geometries are printed in abbreviated form, but we can view a complete geometry by selecting it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a></a>co_geom[[<span class="dv">1</span>]]</span>
<span id="cb51-2"><a></a><span class="co">#&gt; MULTIPOLYGON (((-105.0532 39.79106, -104.976 39.79104, -104.9731 39.79242, -104.9716 39.79829, -104.9687 39.7984, -104.9689 39.79104, -104.9602 39.79102, -104.9554 39.79463, -104.9405 39.7946, -104.9405 39.791, -104.927 39.79105, -104.927 39.78378, -104.9034 39.78381, -104.9036 39.79839, -104.8845 39.79832, -104.8844 39.81282, -104.8661 39.81285, -104.866 39.79839, -104.8291 39.79806, -104.7909 39.79825, -104.7909 39.8418, -104.7623 39.84179, -104.7623 39.84539, -104.731 39.84519, -104.7304 39.89613, -104.7033 39.89595, -104.7032 39.90693, -104.6921 39.90685, -104.6921 39.91418, -104.6796 39.91402, -104.6797 39.90701, -104.6309 39.90664, -104.6309 39.89929, -104.5996 39.89904, -104.5998 39.88131, -104.6052 39.88135, -104.6053 39.87311, -104.6192 39.87322, -104.6198 39.82242, -104.6554 39.82261, -104.6554 39.813, -104.6662 39.81307, -104.6661 39.82279, -104.7625 39.82344, -104.7626 39.79843, -104.7344 39.79844, -104.7346 39.76918, -104.7646 39.76919, -104.7646 39.77157, -104.7722 39.7715, -104.7722 39.77641, -104.7816 39.77648, -104.7816 39.7728, -104.8282 39.77278, -104.8282 39.76916, -104.833 39.76918, -104.8376 39.76717, -104.8564 39.76858, -104.8563 39.75813, -104.8482 39.75642, -104.8469 39.75469, -104.8799 39.75473, -104.88 39.74744, -104.8847 39.74747, -104.8846 39.74016, -104.8217 39.74029, -104.7256 39.74027, -104.6783 39.74, -104.6603 39.74048, -104.6528 39.73978, -104.6304 39.7395, -104.6246 39.74008, -104.5589 39.73933, -104.5074 39.73825, -104.3919 39.73804, -104.3401 39.73825, -104.265 39.73888, -104.2095 39.73902, -104.1151 39.73977, -104.0407 39.73998, -103.9776 39.74027, -103.9655 39.74052, -103.9075 39.74065, -103.8661 39.74024, -103.8002 39.7402, -103.794 39.74005, -103.7239 39.73978, -103.7065 39.73989, -103.7066 39.76555, -103.7063 39.82855, -103.7063 39.889, -103.7061 39.90854, -103.7062 39.95888, -103.7057 39.98511, -103.7057 40.00137, -103.8677 40.0012, -103.9546 40.00113, -104.0371 40.00113, -104.1503 40.00086, -104.1693 40.00078, -104.2674 40.00092, -104.3015 40.00077, -104.4523 40.00062, -104.6019 40.00053, -104.6406 40.00057, -104.7885 40.00041, -104.9048 40.00032, -104.9614 40.00034, -104.9809 40.00032, -104.9877 39.98648, -104.9878 39.97575, -104.9944 39.9758, -104.9971 39.97215, -104.9881 39.97218, -104.9881 39.96847, -104.9972 39.96853, -104.9974 39.98121, -105.0158 39.98119, -105.0156 39.95519, -105.0171 39.95281, -105.0122 39.95045, -105.0063 39.95044, -105.0063 39.9468, -104.9972 39.94677, -104.9971 39.94324, -105.0157 39.94313, -105.0155 39.9214, -105.0344 39.9213, -105.0343 39.91418, -105.0529 39.91422, -105.0532 39.86362, -105.0532 39.79106)))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-stickness-of-sfc-column" class="slide level2">
<h2>The stickness of <code>sfc</code> column</h2>
<ul>
<li class="fragment">Geometry columns are “sticky” meaning they persist through data manipulation:</li>
</ul>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a></a>co <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a></a>  <span class="fu">select</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb52-3"><a></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb52-4"><a></a><span class="co">#&gt; Simple feature collection with 2 features and 1 field</span></span>
<span id="cb52-5"><a></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb52-6"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb52-7"><a></a><span class="co">#&gt; Bounding box:  xmin: -106.0393 ymin: 37.3562 xmax: -103.7057 ymax: 40.00137</span></span>
<span id="cb52-8"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb52-9"><a></a><span class="co">#&gt;      name                       geometry</span></span>
<span id="cb52-10"><a></a><span class="co">#&gt; 1   Adams MULTIPOLYGON (((-105.0532 3...</span></span>
<span id="cb52-11"><a></a><span class="co">#&gt; 2 Alamosa MULTIPOLYGON (((-105.4855 3...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment">Dropping the geometry column requires dropping the geometry via <code>sf</code>:</li>
</ul>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a></a>co <span class="sc">|&gt;</span> </span>
<span id="cb53-2"><a></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb53-3"><a></a>  <span class="fu">select</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb53-4"><a></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb53-5"><a></a><span class="co">#&gt;      name</span></span>
<span id="cb53-6"><a></a><span class="co">#&gt; 1   Adams</span></span>
<span id="cb53-7"><a></a><span class="co">#&gt; 2 Alamosa</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment">Or cohersing the <code>sf</code> object to a <code>data.frame</code>:</li>
</ul>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a></a>co <span class="sc">|&gt;</span> </span>
<span id="cb54-2"><a></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb54-3"><a></a>  <span class="fu">select</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb54-4"><a></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb54-5"><a></a><span class="co">#&gt;      name</span></span>
<span id="cb54-6"><a></a><span class="co">#&gt; 1   Adams</span></span>
<span id="cb54-7"><a></a><span class="co">#&gt; 2 Alamosa</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="the-stickness-of-sfc-column-1" class="slide level2">
<h2>The stickness of <code>sfc</code> column</h2>
<ul>
<li class="fragment">A simple features object (sf) is the connection of a <code>sfc</code> list-column and <code>data.frame</code> of attributes</li>
</ul>

<img data-src="images/11-sticky-geom.png" class="quarto-figure quarto-figure-center r-stretch" width="529"><ul>
<li class="fragment">This binding is unique compared to other column bindings built with things like
<ul>
<li class="fragment"><code>dplyr::bind_cols()</code></li>
<li class="fragment"><code>cbind()</code></li>
<li class="fragment"><code>do.call(cbind, list())</code></li>
</ul></li>
</ul>
</section></section>
<section>
<section id="coordinate-systems" class="title-slide slide level1 center">
<h1>Coordinate Systems</h1>

</section>
<section id="what-makes-spatial-data-spatial" class="slide level2">
<h2>What makes spatial data <em>spatial</em>?</h2>
<ul>
<li class="fragment">What makes a feature geometry <em>spatial</em> is the reference system…</li>
</ul>

<img data-src="images/09-sf-model.png" class="quarto-figure quarto-figure-center r-stretch" width="350"></section>
<section id="reading-and-writing" class="slide level2">
<h2>Reading and writing</h2>
<p>As we’ve seen above, reading spatial data from an external file can be done via <code>sf</code> - reading data requires the “parser function” and the file path</p>
<div class="cell">
<pre><code>#&gt; Reading layer `co' from data source 
#&gt;   `/Users/mikejohnson/github/csu-ess-523c/slides/data/co.shp' 
#&gt;   using driver `ESRI Shapefile'
#&gt; Simple feature collection with 64 features and 4 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342
#&gt; Geodetic CRS:  WGS 84</code></pre>
</div>
<p>we can suppress the output by adding argument <code>quiet=TRUE</code> or by using the otherwise nearly identical but more quiet</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a></a>co <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/co.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Writing takes place in the same fashion, using <code>st_write</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a></a><span class="fu">st_write</span>(co, <span class="st">"data/co.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or its quiet alternative that silently overwrites existing files by default,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a></a><span class="fu">write_sf</span>(co, <span class="st">"co.shp"</span>) <span class="co"># silently overwrites</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="from-tables-e.g.-csv" class="slide level2">
<h2>From Tables (e.g.&nbsp;CSV)</h2>
<p>Spatial data can also be created from CSV and other flat files once it is in R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a></a>(<span class="at">cities =</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"../labs/data/uscities.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb59-2"><a></a>  <span class="fu">select</span>(city, state_name, county_name, population, lat, lng) )</span>
<span id="cb59-3"><a></a><span class="co">#&gt; # A tibble: 31,254 × 6</span></span>
<span id="cb59-4"><a></a><span class="co">#&gt;    city         state_name           county_name         population   lat    lng</span></span>
<span id="cb59-5"><a></a><span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;                &lt;chr&gt;                    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb59-6"><a></a><span class="co">#&gt;  1 New York     New York             Queens                18832416  40.7  -73.9</span></span>
<span id="cb59-7"><a></a><span class="co">#&gt;  2 Los Angeles  California           Los Angeles           11885717  34.1 -118. </span></span>
<span id="cb59-8"><a></a><span class="co">#&gt;  3 Chicago      Illinois             Cook                   8489066  41.8  -87.7</span></span>
<span id="cb59-9"><a></a><span class="co">#&gt;  4 Miami        Florida              Miami-Dade             6113982  25.8  -80.2</span></span>
<span id="cb59-10"><a></a><span class="co">#&gt;  5 Houston      Texas                Harris                 6046392  29.8  -95.4</span></span>
<span id="cb59-11"><a></a><span class="co">#&gt;  6 Dallas       Texas                Dallas                 5843632  32.8  -96.8</span></span>
<span id="cb59-12"><a></a><span class="co">#&gt;  7 Philadelphia Pennsylvania         Philadelphia           5696588  40.0  -75.1</span></span>
<span id="cb59-13"><a></a><span class="co">#&gt;  8 Atlanta      Georgia              Fulton                 5211164  33.8  -84.4</span></span>
<span id="cb59-14"><a></a><span class="co">#&gt;  9 Washington   District of Columbia District of Columb…    5146120  38.9  -77.0</span></span>
<span id="cb59-15"><a></a><span class="co">#&gt; 10 Boston       Massachusetts        Suffolk                4355184  42.3  -71.1</span></span>
<span id="cb59-16"><a></a><span class="co">#&gt; # ℹ 31,244 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>To do this, you must specify the <code>X</code> and the <code>Y</code> coordinate columns as well as a CRS:</p>
<ul>
<li class="fragment">A typical lat/long CRS is EPSG:4326</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a></a>(<span class="at">cities_sf =</span> <span class="fu">st_as_sf</span>(cities, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lng"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb60-2"><a></a><span class="co">#&gt; Simple feature collection with 31254 features and 4 fields</span></span>
<span id="cb60-3"><a></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb60-4"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb60-5"><a></a><span class="co">#&gt; Bounding box:  xmin: -176.6295 ymin: 17.9559 xmax: 174.111 ymax: 71.2727</span></span>
<span id="cb60-6"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb60-7"><a></a><span class="co">#&gt; # A tibble: 31,254 × 5</span></span>
<span id="cb60-8"><a></a><span class="co">#&gt;    city         state_name      county_name population            geometry</span></span>
<span id="cb60-9"><a></a><span class="co">#&gt;  * &lt;chr&gt;        &lt;chr&gt;           &lt;chr&gt;            &lt;dbl&gt;         &lt;POINT [°]&gt;</span></span>
<span id="cb60-10"><a></a><span class="co">#&gt;  1 New York     New York        Queens        18832416  (-73.9249 40.6943)</span></span>
<span id="cb60-11"><a></a><span class="co">#&gt;  2 Los Angeles  California      Los Angeles   11885717 (-118.4068 34.1141)</span></span>
<span id="cb60-12"><a></a><span class="co">#&gt;  3 Chicago      Illinois        Cook           8489066  (-87.6866 41.8375)</span></span>
<span id="cb60-13"><a></a><span class="co">#&gt;  4 Miami        Florida         Miami-Dade     6113982   (-80.2101 25.784)</span></span>
<span id="cb60-14"><a></a><span class="co">#&gt;  5 Houston      Texas           Harris         6046392   (-95.3885 29.786)</span></span>
<span id="cb60-15"><a></a><span class="co">#&gt;  6 Dallas       Texas           Dallas         5843632  (-96.7667 32.7935)</span></span>
<span id="cb60-16"><a></a><span class="co">#&gt;  7 Philadelphia Pennsylvania    Philadelph…    5696588  (-75.1339 40.0077)</span></span>
<span id="cb60-17"><a></a><span class="co">#&gt;  8 Atlanta      Georgia         Fulton         5211164   (-84.422 33.7628)</span></span>
<span id="cb60-18"><a></a><span class="co">#&gt;  9 Washington   District of Co… District o…    5146120  (-77.0163 38.9047)</span></span>
<span id="cb60-19"><a></a><span class="co">#&gt; 10 Boston       Massachusetts   Suffolk        4355184  (-71.0852 42.3188)</span></span>
<span id="cb60-20"><a></a><span class="co">#&gt; # ℹ 31,244 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-manipulation" class="slide level2">
<h2>Data Manipulation</h2>
<ul>
<li class="fragment"><p>Since <code>sf</code> objects are <code>data.frames</code>, our <code>dplyr</code> verbs work!</p></li>
<li class="fragment"><p>Lets find the most populous city in each Colorado county…</p></li>
</ul>
</section>
<section id="sf-and-dplyr" class="slide level2">
<h2>sf and dplyr</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a></a>cities_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 31254 features and 4 fields
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -176.6295 ymin: 17.9559 xmax: 174.111 ymax: 71.2727
#&gt; Geodetic CRS:  WGS 84
#&gt; # A tibble: 31,254 × 5
#&gt;    city         state_name      county_name population            geometry
#&gt;  * &lt;chr&gt;        &lt;chr&gt;           &lt;chr&gt;            &lt;dbl&gt;         &lt;POINT [°]&gt;
#&gt;  1 New York     New York        Queens        18832416  (-73.9249 40.6943)
#&gt;  2 Los Angeles  California      Los Angeles   11885717 (-118.4068 34.1141)
#&gt;  3 Chicago      Illinois        Cook           8489066  (-87.6866 41.8375)
#&gt;  4 Miami        Florida         Miami-Dade     6113982   (-80.2101 25.784)
#&gt;  5 Houston      Texas           Harris         6046392   (-95.3885 29.786)
#&gt;  6 Dallas       Texas           Dallas         5843632  (-96.7667 32.7935)
#&gt;  7 Philadelphia Pennsylvania    Philadelph…    5696588  (-75.1339 40.0077)
#&gt;  8 Atlanta      Georgia         Fulton         5211164   (-84.422 33.7628)
#&gt;  9 Washington   District of Co… District o…    5146120  (-77.0163 38.9047)
#&gt; 10 Boston       Massachusetts   Suffolk        4355184  (-71.0852 42.3188)
#&gt; # ℹ 31,244 more rows</code></pre>
</div>
</div></div>
</section>
<section id="sf-and-dplyr-1" class="slide level2">
<h2>sf and dplyr</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a></a>cities_sf <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a></a>  <span class="fu">filter</span>(state_name <span class="sc">==</span> <span class="st">"Colorado"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 477 features and 4 fields
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -109.0066 ymin: 37.0155 xmax: -102.0804 ymax: 40.9849
#&gt; Geodetic CRS:  WGS 84
#&gt; # A tibble: 477 × 5
#&gt;    city             state_name county_name population            geometry
#&gt;  * &lt;chr&gt;            &lt;chr&gt;      &lt;chr&gt;            &lt;dbl&gt;         &lt;POINT [°]&gt;
#&gt;  1 Denver           Colorado   Denver         2691349  (-104.8758 39.762)
#&gt;  2 Colorado Springs Colorado   El Paso         638421 (-104.7605 38.8674)
#&gt;  3 Aurora           Colorado   Arapahoe        390201 (-104.7237 39.7083)
#&gt;  4 Fort Collins     Colorado   Larimer         339256 (-105.0656 40.5477)
#&gt;  5 Lakewood         Colorado   Jefferson       156309 (-105.1172 39.6977)
#&gt;  6 Greeley          Colorado   Weld            143554 (-104.7706 40.4152)
#&gt;  7 Thornton         Colorado   Adams           142878 (-104.9438 39.9197)
#&gt;  8 Grand Junction   Colorado   Mesa            141008 (-108.5673 39.0877)
#&gt;  9 Arvada           Colorado   Jefferson       122835   (-105.151 39.832)
#&gt; 10 Boulder          Colorado   Boulder         120121 (-105.2524 40.0248)
#&gt; # ℹ 467 more rows</code></pre>
</div>
</div></div>
</section>
<section id="sf-and-dplyr-2" class="slide level2">
<h2>sf and dplyr</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a></a>cities_sf <span class="sc">|&gt;</span></span>
<span id="cb65-2"><a></a>  <span class="fu">filter</span>(state_name <span class="sc">==</span> <span class="st">"Colorado"</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-3"><a></a>  <span class="fu">group_by</span>(county_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 477 features and 4 fields
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -109.0066 ymin: 37.0155 xmax: -102.0804 ymax: 40.9849
#&gt; Geodetic CRS:  WGS 84
#&gt; # A tibble: 477 × 5
#&gt; # Groups:   county_name [64]
#&gt;    city             state_name county_name population            geometry
#&gt;    &lt;chr&gt;            &lt;chr&gt;      &lt;chr&gt;            &lt;dbl&gt;         &lt;POINT [°]&gt;
#&gt;  1 Denver           Colorado   Denver         2691349  (-104.8758 39.762)
#&gt;  2 Colorado Springs Colorado   El Paso         638421 (-104.7605 38.8674)
#&gt;  3 Aurora           Colorado   Arapahoe        390201 (-104.7237 39.7083)
#&gt;  4 Fort Collins     Colorado   Larimer         339256 (-105.0656 40.5477)
#&gt;  5 Lakewood         Colorado   Jefferson       156309 (-105.1172 39.6977)
#&gt;  6 Greeley          Colorado   Weld            143554 (-104.7706 40.4152)
#&gt;  7 Thornton         Colorado   Adams           142878 (-104.9438 39.9197)
#&gt;  8 Grand Junction   Colorado   Mesa            141008 (-108.5673 39.0877)
#&gt;  9 Arvada           Colorado   Jefferson       122835   (-105.151 39.832)
#&gt; 10 Boulder          Colorado   Boulder         120121 (-105.2524 40.0248)
#&gt; # ℹ 467 more rows</code></pre>
</div>
</div></div>
</section>
<section id="sf-and-dplyr-3" class="slide level2">
<h2>sf and dplyr</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a></a>cities_sf <span class="sc">|&gt;</span></span>
<span id="cb67-2"><a></a>  <span class="fu">filter</span>(state_name <span class="sc">==</span> <span class="st">"Colorado"</span>) <span class="sc">|&gt;</span></span>
<span id="cb67-3"><a></a>  <span class="fu">group_by</span>(county_name) <span class="sc">|&gt;</span></span>
<span id="cb67-4"><a></a>  <span class="fu">slice_max</span>(population, <span class="at">n =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 64 features and 4 fields
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -108.9071 ymin: 37.1751 xmax: -102.2627 ymax: 40.9849
#&gt; Geodetic CRS:  WGS 84
#&gt; # A tibble: 64 × 5
#&gt; # Groups:   county_name [64]
#&gt;    city           state_name county_name population            geometry
#&gt;    &lt;chr&gt;          &lt;chr&gt;      &lt;chr&gt;            &lt;dbl&gt;         &lt;POINT [°]&gt;
#&gt;  1 Thornton       Colorado   Adams           142878 (-104.9438 39.9197)
#&gt;  2 Alamosa        Colorado   Alamosa           9847  (-105.877 37.4752)
#&gt;  3 Aurora         Colorado   Arapahoe        390201 (-104.7237 39.7083)
#&gt;  4 Pagosa Springs Colorado   Archuleta         1718 (-107.0307 37.2675)
#&gt;  5 Springfield    Colorado   Baca              1482  (-102.6189 37.405)
#&gt;  6 Las Animas     Colorado   Bent              2480 (-103.2236 38.0695)
#&gt;  7 Boulder        Colorado   Boulder         120121 (-105.2524 40.0248)
#&gt;  8 Broomfield     Colorado   Broomfield       75110 (-105.0526 39.9542)
#&gt;  9 Salida         Colorado   Chaffee           5786 (-105.9979 38.5298)
#&gt; 10 Cheyenne Wells Colorado   Cheyenne           949 (-102.3521 38.8192)
#&gt; # ℹ 54 more rows</code></pre>
</div>
</div></div>
</section>
<section id="sf-and-dplyr-4" class="slide level2">
<h2>sf and dplyr</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a></a>cities_sf <span class="sc">|&gt;</span></span>
<span id="cb69-2"><a></a>  <span class="fu">filter</span>(state_name <span class="sc">==</span> <span class="st">"Colorado"</span>) <span class="sc">|&gt;</span></span>
<span id="cb69-3"><a></a>  <span class="fu">group_by</span>(county_name) <span class="sc">|&gt;</span></span>
<span id="cb69-4"><a></a>  <span class="fu">slice_max</span>(population, <span class="at">n =</span> <span class="dv">1</span>) <span class="ot">-&gt;</span></span>
<span id="cb69-5"><a></a>  co_cities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">

</div></div>
</section>
<section id="plotting" class="slide level2">
<h2>Plotting</h2>
<ul>
<li class="fragment"><p>We’ve already seen that <code>ggplot()</code> is a powerful visualization tool:</p></li>
<li class="fragment"><p>The 5 steps we described for building a ggplot are:</p>
<ol type="1">
<li class="fragment">canvas</li>
<li class="fragment">layers (geoms)</li>
<li class="fragment">labels</li>
<li class="fragment">facets</li>
<li class="fragment">themes</li>
</ol></li>
<li class="fragment"><p>spatial work in R is becoming so common that <code>ggplot()</code> comes with a sf geom (<code>geom_sf</code>)</p></li>
</ul>
</section>
<section id="sf-an-ggplot" class="slide level2">
<h2>sf an ggplot</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a></a><span class="fu">ggplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-2_files/figure-revealjs/ggplot_auto_01_output-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="sf-an-ggplot-1" class="slide level2">
<h2>sf an ggplot</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb71-2"><a></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> co, <span class="fu">aes</span>(<span class="at">fill =</span> aland<span class="sc">/</span><span class="fl">1e10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-2_files/figure-revealjs/ggplot_auto_02_output-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="sf-an-ggplot-2" class="slide level2">
<h2>sf an ggplot</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb72-2"><a></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> co, <span class="fu">aes</span>(<span class="at">fill =</span> aland<span class="sc">/</span><span class="fl">1e10</span>)) <span class="sc">+</span></span>
<span id="cb72-3"><a></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> co_cities, <span class="fu">aes</span>(<span class="at">size =</span> population<span class="sc">/</span><span class="fl">1e5</span>), <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-2_files/figure-revealjs/ggplot_auto_03_output-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="sf-an-ggplot-3" class="slide level2">
<h2>sf an ggplot</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb73-2"><a></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> co, <span class="fu">aes</span>(<span class="at">fill =</span> aland<span class="sc">/</span><span class="fl">1e10</span>)) <span class="sc">+</span></span>
<span id="cb73-3"><a></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> co_cities, <span class="fu">aes</span>(<span class="at">size =</span> population<span class="sc">/</span><span class="fl">1e5</span>), <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb73-4"><a></a>  <span class="fu">theme_linedraw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-2_files/figure-revealjs/ggplot_auto_04_output-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="sf-an-ggplot-4" class="slide level2">
<h2>sf an ggplot</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb74-2"><a></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> co, <span class="fu">aes</span>(<span class="at">fill =</span> aland<span class="sc">/</span><span class="fl">1e10</span>)) <span class="sc">+</span></span>
<span id="cb74-3"><a></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> co_cities, <span class="fu">aes</span>(<span class="at">size =</span> population<span class="sc">/</span><span class="fl">1e5</span>), <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb74-4"><a></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb74-5"><a></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Colorado Counties: Land Area"</span>,</span>
<span id="cb74-6"><a></a>       <span class="at">size =</span> <span class="st">"Population </span><span class="sc">\n</span><span class="st">(100,000)"</span>,</span>
<span id="cb74-7"><a></a>       <span class="at">fill =</span> <span class="st">"Acres </span><span class="sc">\n</span><span class="st">(billions)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-2_files/figure-revealjs/ggplot_auto_05_output-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="conus" class="slide level2">
<h2>CONUS</h2>
<div class="{columns}">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a></a>conus <span class="ot">&lt;-</span>  USAboundaries<span class="sc">::</span><span class="fu">us_states</span>() <span class="sc">|&gt;</span></span>
<span id="cb75-2"><a></a>  <span class="fu">filter</span>(<span class="sc">!</span>state_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puerto Rico"</span>, </span>
<span id="cb75-3"><a></a>                            <span class="st">"Alaska"</span>, </span>
<span id="cb75-4"><a></a>                            <span class="st">"Hawaii"</span>))</span>
<span id="cb75-5"><a></a></span>
<span id="cb75-6"><a></a><span class="fu">length</span>(<span class="fu">st_geometry</span>(conus))</span>
<span id="cb75-7"><a></a><span class="co">#&gt; [1] 49</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb76-2"><a></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> conus, <span class="fu">aes</span>(<span class="at">fill =</span> state_name)) <span class="sc">+</span> </span>
<span id="cb76-3"><a></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span> </span>
<span id="cb76-4"><a></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb76-5"><a></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"CONUS:"</span>, <span class="fu">length</span>(<span class="fu">st_geometry</span>(conus)), <span class="st">"feature(s)"</span>) ) <span class="sc">+</span> </span>
<span id="cb76-6"><a></a>  <span class="fu">scale_fill_viridis_d</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-2_files/figure-revealjs/unnamed-chunk-66-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="feature-resoloved-and-combined" class="slide level2">
<h2>1 feature: resoloved and combined:</h2>
<ul>
<li class="fragment"><code>st_cast</code> / <code>st_union</code> work on <code>sfg</code>, <code>sfc</code>, and <code>sf</code> objects:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a></a>us_c_ml <span class="ot">=</span> <span class="fu">st_combine</span>(conus) <span class="sc">|&gt;</span></span>
<span id="cb77-2"><a></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>)</span>
<span id="cb77-3"><a></a>   </span>
<span id="cb77-4"><a></a>us_u_ml <span class="ot">=</span> <span class="fu">st_union</span>(conus) <span class="sc">|&gt;</span></span>
<span id="cb77-5"><a></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="week-2_files/figure-revealjs/unnamed-chunk-68-1.png" width="960" class="r-stretch"></section>
<section id="so-what" class="slide level2">
<h2>So what?</h2>
<p>Lets imagine we want to know the distance from Denver to the nearest state border:</p>
<p>To do this, we need to:<br>
</p>
<p>1: define Denver as a geometry in a CRS<br>
2: determine the correct geometry types / representation<br>
3: calculate the distance between (1) and (2)<br>
</p>
</section>
<section id="make-denver-in-the-crs-of-our-states" class="slide level2">
<h2>1. Make “Denver” in the CRS of our states</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a></a>denver_sf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fl">39.7392</span>, </span>
<span id="cb78-2"><a></a>                       <span class="at">x =</span> <span class="sc">-</span><span class="fl">104.9903</span>, </span>
<span id="cb78-3"><a></a>                       <span class="at">name =</span> <span class="st">"Denver"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb78-4"><a></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), </span>
<span id="cb78-5"><a></a>           <span class="at">crs =</span> <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="determine-the-3-closest-states" class="slide level2">
<h2>2. Determine the 3 closest states:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a></a>conus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 12 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    statefp  statens    affgeoid geoid stusps       name lsad        aland
#&gt; 1       06 01779778 0400000US06    06     CA California   00 403671196038
#&gt; 2       55 01779806 0400000US55    55     WI  Wisconsin   00 140292246684
#&gt; 3       16 01779783 0400000US16    16     ID      Idaho   00 214049923496
#&gt; 4       27 00662849 0400000US27    27     MN  Minnesota   00 206232157570
#&gt; 5       19 01779785 0400000US19    19     IA       Iowa   00 144659688848
#&gt; 6       29 01779791 0400000US29    29     MO   Missouri   00 178052563675
#&gt; 7       24 01714934 0400000US24    24     MD   Maryland   00  25151895765
#&gt; 8       41 01155107 0400000US41    41     OR     Oregon   00 248628426864
#&gt; 9       26 01779789 0400000US26    26     MI   Michigan   00 146614604273
#&gt; 10      30 00767982 0400000US30    30     MT    Montana   00 376973673895
#&gt;          awater state_name state_abbr jurisdiction_type
#&gt; 1   20294133830 California         CA             state
#&gt; 2   29343721650  Wisconsin         WI             state
#&gt; 3    2391577745      Idaho         ID             state
#&gt; 4   18949864226  Minnesota         MN             state
#&gt; 5    1085996889       Iowa         IA             state
#&gt; 6    2487215790   Missouri         MO             state
#&gt; 7    6979171386   Maryland         MD             state
#&gt; 8    6170953359     Oregon         OR             state
#&gt; 9  103872203398   Michigan         MI             state
#&gt; 10   3866689601    Montana         MT             state
#&gt;                          geometry
#&gt; 1  MULTIPOLYGON (((-118.594 33...
#&gt; 2  MULTIPOLYGON (((-86.93428 4...
#&gt; 3  MULTIPOLYGON (((-117.243 44...
#&gt; 4  MULTIPOLYGON (((-97.22904 4...
#&gt; 5  MULTIPOLYGON (((-96.62187 4...
#&gt; 6  MULTIPOLYGON (((-95.76564 4...
#&gt; 7  MULTIPOLYGON (((-76.04621 3...
#&gt; 8  MULTIPOLYGON (((-124.5524 4...
#&gt; 9  MULTIPOLYGON (((-84.61622 4...
#&gt; 10 MULTIPOLYGON (((-116.0492 4...</code></pre>
</div>
</div></div>
</section>
<section id="determine-the-3-closest-states-1" class="slide level2">
<h2>2. Determine the 3 closest states:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a></a>conus <span class="sc">|&gt;</span></span>
<span id="cb81-2"><a></a>  <span class="fu">select</span>(state_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 1 field
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    state_name                       geometry
#&gt; 1  California MULTIPOLYGON (((-118.594 33...
#&gt; 2   Wisconsin MULTIPOLYGON (((-86.93428 4...
#&gt; 3       Idaho MULTIPOLYGON (((-117.243 44...
#&gt; 4   Minnesota MULTIPOLYGON (((-97.22904 4...
#&gt; 5        Iowa MULTIPOLYGON (((-96.62187 4...
#&gt; 6    Missouri MULTIPOLYGON (((-95.76564 4...
#&gt; 7    Maryland MULTIPOLYGON (((-76.04621 3...
#&gt; 8      Oregon MULTIPOLYGON (((-124.5524 4...
#&gt; 9    Michigan MULTIPOLYGON (((-84.61622 4...
#&gt; 10    Montana MULTIPOLYGON (((-116.0492 4...</code></pre>
</div>
</div></div>
</section>
<section id="determine-the-3-closest-states-2" class="slide level2">
<h2>2. Determine the 3 closest states:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a></a>conus <span class="sc">|&gt;</span></span>
<span id="cb83-2"><a></a>  <span class="fu">select</span>(state_name) <span class="sc">%&gt;%</span></span>
<span id="cb83-3"><a></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">st_distance</span>(., denver_sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 2 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    state_name                       geometry          dist
#&gt; 1  California MULTIPOLYGON (((-118.594 33... 1000950.5 [m]
#&gt; 2   Wisconsin MULTIPOLYGON (((-86.93428 4... 1146522.6 [m]
#&gt; 3       Idaho MULTIPOLYGON (((-117.243 44...  567809.5 [m]
#&gt; 4   Minnesota MULTIPOLYGON (((-97.22904 4...  823100.9 [m]
#&gt; 5        Iowa MULTIPOLYGON (((-96.62187 4...  773889.8 [m]
#&gt; 6    Missouri MULTIPOLYGON (((-95.76564 4...  789142.1 [m]
#&gt; 7    Maryland MULTIPOLYGON (((-76.04621 3... 2174383.4 [m]
#&gt; 8      Oregon MULTIPOLYGON (((-124.5524 4... 1041819.1 [m]
#&gt; 9    Michigan MULTIPOLYGON (((-84.61622 4... 1401455.7 [m]
#&gt; 10    Montana MULTIPOLYGON (((-116.0492 4...  585011.2 [m]</code></pre>
</div>
</div></div>
</section>
<section id="determine-the-3-closest-states-3" class="slide level2">
<h2>2. Determine the 3 closest states:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a></a>conus <span class="sc">|&gt;</span></span>
<span id="cb85-2"><a></a>  <span class="fu">select</span>(state_name) <span class="sc">%&gt;%</span></span>
<span id="cb85-3"><a></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">st_distance</span>(., denver_sf)) <span class="sc">|&gt;</span></span>
<span id="cb85-4"><a></a>  <span class="fu">slice_min</span>(dist, <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 3 features and 2 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -111.0569 ymin: 36.99243 xmax: -95.30829 ymax: 45.0059
#&gt; Geodetic CRS:  WGS 84
#&gt;   state_name         dist                       geometry
#&gt; 1   Colorado      0.0 [m] MULTIPOLYGON (((-109.06 38....
#&gt; 2    Wyoming 139988.4 [m] MULTIPOLYGON (((-111.0569 4...
#&gt; 3   Nebraska 161243.2 [m] MULTIPOLYGON (((-104.0531 4...</code></pre>
</div>
</div></div>
<ul>
<li class="fragment">That’s close, but the distance to Colorado is 0, that’s not a state border.</li>
</ul>
</section>
<section id="geometry-selection" class="slide level2">
<h2>Geometry Selection</h2>
<ul>
<li class="fragment"><code>Polygon</code> (therefore MULTIPOLGYGONS) describe areas!</li>
<li class="fragment">The distance to a <code>point</code> <strong>in</strong> a <code>polygon</code> to that polygon is 0.</li>
</ul>
</section>
<section id="to-determine-distance-to-border-we-need-a-linear-representation" class="slide level2">
<h2>To determine distance to border we need a linear representation:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a></a>conus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 12 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    statefp  statens    affgeoid geoid stusps       name lsad        aland
#&gt; 1       06 01779778 0400000US06    06     CA California   00 403671196038
#&gt; 2       55 01779806 0400000US55    55     WI  Wisconsin   00 140292246684
#&gt; 3       16 01779783 0400000US16    16     ID      Idaho   00 214049923496
#&gt; 4       27 00662849 0400000US27    27     MN  Minnesota   00 206232157570
#&gt; 5       19 01779785 0400000US19    19     IA       Iowa   00 144659688848
#&gt; 6       29 01779791 0400000US29    29     MO   Missouri   00 178052563675
#&gt; 7       24 01714934 0400000US24    24     MD   Maryland   00  25151895765
#&gt; 8       41 01155107 0400000US41    41     OR     Oregon   00 248628426864
#&gt; 9       26 01779789 0400000US26    26     MI   Michigan   00 146614604273
#&gt; 10      30 00767982 0400000US30    30     MT    Montana   00 376973673895
#&gt;          awater state_name state_abbr jurisdiction_type
#&gt; 1   20294133830 California         CA             state
#&gt; 2   29343721650  Wisconsin         WI             state
#&gt; 3    2391577745      Idaho         ID             state
#&gt; 4   18949864226  Minnesota         MN             state
#&gt; 5    1085996889       Iowa         IA             state
#&gt; 6    2487215790   Missouri         MO             state
#&gt; 7    6979171386   Maryland         MD             state
#&gt; 8    6170953359     Oregon         OR             state
#&gt; 9  103872203398   Michigan         MI             state
#&gt; 10   3866689601    Montana         MT             state
#&gt;                          geometry
#&gt; 1  MULTIPOLYGON (((-118.594 33...
#&gt; 2  MULTIPOLYGON (((-86.93428 4...
#&gt; 3  MULTIPOLYGON (((-117.243 44...
#&gt; 4  MULTIPOLYGON (((-97.22904 4...
#&gt; 5  MULTIPOLYGON (((-96.62187 4...
#&gt; 6  MULTIPOLYGON (((-95.76564 4...
#&gt; 7  MULTIPOLYGON (((-76.04621 3...
#&gt; 8  MULTIPOLYGON (((-124.5524 4...
#&gt; 9  MULTIPOLYGON (((-84.61622 4...
#&gt; 10 MULTIPOLYGON (((-116.0492 4...</code></pre>
</div>
</div></div>
</section>
<section id="to-determine-distance-to-border-we-need-a-linear-representation-1" class="slide level2">
<h2>To determine distance to border we need a linear representation:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a></a>conus <span class="sc">|&gt;</span></span>
<span id="cb89-2"><a></a>  <span class="fu">select</span>(state_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 1 field
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    state_name                       geometry
#&gt; 1  California MULTIPOLYGON (((-118.594 33...
#&gt; 2   Wisconsin MULTIPOLYGON (((-86.93428 4...
#&gt; 3       Idaho MULTIPOLYGON (((-117.243 44...
#&gt; 4   Minnesota MULTIPOLYGON (((-97.22904 4...
#&gt; 5        Iowa MULTIPOLYGON (((-96.62187 4...
#&gt; 6    Missouri MULTIPOLYGON (((-95.76564 4...
#&gt; 7    Maryland MULTIPOLYGON (((-76.04621 3...
#&gt; 8      Oregon MULTIPOLYGON (((-124.5524 4...
#&gt; 9    Michigan MULTIPOLYGON (((-84.61622 4...
#&gt; 10    Montana MULTIPOLYGON (((-116.0492 4...</code></pre>
</div>
</div></div>
</section>
<section id="to-determine-distance-to-border-we-need-a-linear-representation-2" class="slide level2">
<h2>To determine distance to border we need a linear representation:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a></a>conus <span class="sc">|&gt;</span></span>
<span id="cb91-2"><a></a>  <span class="fu">select</span>(state_name) <span class="sc">|&gt;</span></span>
<span id="cb91-3"><a></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 1 field
#&gt; Geometry type: MULTILINESTRING
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    state_name                       geometry
#&gt; 1  California MULTILINESTRING ((-118.594 ...
#&gt; 2   Wisconsin MULTILINESTRING ((-86.93428...
#&gt; 3       Idaho MULTILINESTRING ((-117.243 ...
#&gt; 4   Minnesota MULTILINESTRING ((-97.22904...
#&gt; 5        Iowa MULTILINESTRING ((-96.62187...
#&gt; 6    Missouri MULTILINESTRING ((-95.76564...
#&gt; 7    Maryland MULTILINESTRING ((-76.04621...
#&gt; 8      Oregon MULTILINESTRING ((-124.5524...
#&gt; 9    Michigan MULTILINESTRING ((-84.61622...
#&gt; 10    Montana MULTILINESTRING ((-116.0492...</code></pre>
</div>
</div></div>
</section>
<section id="to-determine-distance-to-border-we-need-a-linear-representation-3" class="slide level2">
<h2>To determine distance to border we need a linear representation:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a></a>conus <span class="sc">|&gt;</span></span>
<span id="cb93-2"><a></a>  <span class="fu">select</span>(state_name) <span class="sc">|&gt;</span></span>
<span id="cb93-3"><a></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-4"><a></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">st_distance</span>(., denver_sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 2 fields
#&gt; Geometry type: MULTILINESTRING
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    state_name                       geometry          dist
#&gt; 1  California MULTILINESTRING ((-118.594 ... 1000950.5 [m]
#&gt; 2   Wisconsin MULTILINESTRING ((-86.93428... 1146522.6 [m]
#&gt; 3       Idaho MULTILINESTRING ((-117.243 ...  567809.5 [m]
#&gt; 4   Minnesota MULTILINESTRING ((-97.22904...  823100.9 [m]
#&gt; 5        Iowa MULTILINESTRING ((-96.62187...  773889.8 [m]
#&gt; 6    Missouri MULTILINESTRING ((-95.76564...  789142.1 [m]
#&gt; 7    Maryland MULTILINESTRING ((-76.04621... 2174383.4 [m]
#&gt; 8      Oregon MULTILINESTRING ((-124.5524... 1041819.1 [m]
#&gt; 9    Michigan MULTILINESTRING ((-84.61622... 1401455.7 [m]
#&gt; 10    Montana MULTILINESTRING ((-116.0492...  585011.2 [m]</code></pre>
</div>
</div></div>
</section>
<section id="to-determine-distance-to-border-we-need-a-linear-representation-4" class="slide level2">
<h2>To determine distance to border we need a linear representation:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a></a>conus <span class="sc">|&gt;</span></span>
<span id="cb95-2"><a></a>  <span class="fu">select</span>(state_name) <span class="sc">|&gt;</span></span>
<span id="cb95-3"><a></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-4"><a></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">st_distance</span>(., denver_sf)) <span class="sc">|&gt;</span></span>
<span id="cb95-5"><a></a>  <span class="fu">slice_min</span>(dist, <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 3 features and 2 fields
#&gt; Geometry type: MULTILINESTRING
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -111.0569 ymin: 36.99243 xmax: -95.30829 ymax: 45.0059
#&gt; Geodetic CRS:  WGS 84
#&gt;   state_name         dist                       geometry
#&gt; 1   Colorado 139988.4 [m] MULTILINESTRING ((-109.06 3...
#&gt; 2    Wyoming 139988.4 [m] MULTILINESTRING ((-111.0569...
#&gt; 3   Nebraska 161243.2 [m] MULTILINESTRING ((-104.0531...</code></pre>
</div>
</div></div>
<ul>
<li class="fragment"><p>Good. However, we were only interested in the distance to the closest border not to ALL boarders. Therefore we calculated 48 (49 - 1) more distances then needed!</p></li>
<li class="fragment"><p>While this is not to complex for 1 &lt;-&gt; 49 features imagine we had 28,000+ (like your lab)!</p></li>
<li class="fragment"><p>That would result in 1,344,000 more calculations then needed …</p></li>
</ul>
</section>
<section id="revisting-the-idea-of-the-feature-level" class="slide level2">
<h2>Revisting the idea of the feature level:</h2>
<ul>
<li class="fragment"><p>A “feature” can “be part of the whole” or the whole</p>
<ul>
<li class="fragment"><p>A island (POLYGON), or a set of islands acting as 1 unit (MULTIPOLYGON)</p></li>
<li class="fragment"><p>A city (POINT), or a set of cities meeting a condition (MULTIPOINT)</p></li>
<li class="fragment"><p>A road (LINESTRING), or a route (MULTILINESTRING)</p></li>
</ul></li>
<li class="fragment"><p>Since we want the distance to the nearest border, <em>regardless</em> of the state. Our <strong>feature</strong> is the <em>set of borders with preserved boundaries</em>.</p></li>
<li class="fragment"><p>In other words, a 1 feature <code>MULTILINESTRING</code></p></li>
</ul>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a></a><span class="fu">st_distance</span>(denver_sf, <span class="fu">st_cast</span>(<span class="fu">st_combine</span>(conus), <span class="st">"MULTILINESTRING"</span>))</span>
<span id="cb97-2"><a></a><span class="co">#&gt; Units: [m]</span></span>
<span id="cb97-3"><a></a><span class="co">#&gt;          [,1]</span></span>
<span id="cb97-4"><a></a><span class="co">#&gt; [1,] 139988.4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment">The same principle would apply if the question was “<em>distance to national border</em>”</li>
</ul>
</div>
</section>
<section id="coordinate-systems-1" class="slide level2">
<h2>Coordinate Systems</h2>
<ul>
<li class="fragment"><p>Coordinate Reference Systems (CRS) defines how spatial features relate to the surface of the Earth.</p></li>
<li class="fragment"><p>CRSs are either geographic or projected…</p></li>
<li class="fragment"><p>CRSs are measurement units for coordinates:</p></li>
</ul>
</section>
<section id="sf-tools" class="slide level2">
<h2><code>sf</code> tools</h2>
<p>In <code>sf</code> we have <em>three</em> tools for exploring, define, and changing CRS systems:</p>
<ul>
<li class="fragment"><p><em>st_crs</em> : Retrieve coordinate reference system from sf or sfc object</p></li>
<li class="fragment"><p><em>st_set_crs</em> : Set or replace coordinate reference system from object</p></li>
<li class="fragment"><p><em>st_transform</em> : Transform or convert coordinates of simple feature</p></li>
<li class="fragment"><p>Again, “st” (like PostGIS) denotes it is an operation that can work on a ” <em>s</em> patial <em>t</em> ype”</p></li>
</ul>
</section>
<section id="geographic-coordinate-systms-gcs" class="slide level2">
<h2>Geographic Coordinate Systms (GCS)</h2>
<ul>
<li class="fragment"><p>A GCS identifies locations on the <em>curved</em> surface of the earth.</p></li>
<li class="fragment"><p>Locations are measured in <strong>angular</strong> units from the center of the earth relative to the plane defined by the equator and the plane defined by the prime meridian.</p></li>
<li class="fragment"><p>The vertical angle describes the <em>latitude</em> and the horizontal angle the <em>longitude</em></p></li>
<li class="fragment"><p>In most coordinate systems, the North-South and East-West directions are encoded as +/-.</p></li>
<li class="fragment"><p>North and East are positive (<code>+</code>) and South and West are negative (<code>-</code>) sign.</p></li>
<li class="fragment"><p>A GCS is defined by 3 components:</p>
<ul>
<li class="fragment"><p>an <strong>ellipsoid</strong></p></li>
<li class="fragment"><p>a <strong>geoid</strong></p></li>
<li class="fragment"><p>a <strong>datum</strong></p></li>
</ul></li>
</ul>
</section>
<section id="sphere-and-ellipsoid" class="slide level2">
<h2>Sphere and Ellipsoid</h2>
<ul>
<li class="fragment"><p>Assuming that the earth is a perfect sphere simplifies calculations and works for small-scale maps (maps that show a <em>large</em> area of the earth).</p></li>
<li class="fragment"><p>But … the earth is not a sphere do to its rotation inducing a centripetal force along the equator.</p></li>
<li class="fragment"><p>This results in an equatorial axis that is roughly 21 km longer than the polar axis.</p></li>
<li class="fragment"><p>To account for this, the earth is modeled as an ellipsoid (slighty squished sphere) defined by two radii:</p>
<ul>
<li class="fragment">the <strong>semi-major</strong> axis (along the equatorial radius)</li>
<li class="fragment">the <strong>semi-minor</strong> axis (along the polar radius)</li>
</ul></li>
</ul>

<img data-src="images/11-semi-axis.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="section-2" class="slide level2">
<h2></h2>
<ul>
<li class="fragment"><p>Thanks to satellite and computational capabilities our estimates of these radii are be quite precise</p>
<ul>
<li class="fragment"><p>The semi-major axis is 6,378,137 m</p></li>
<li class="fragment"><p>The semi-minor axis is 6,356,752 m</p></li>
</ul></li>
<li class="fragment"><p>Differences in distance along the surfaces of an ellipsoid vs.&nbsp;a perfect sphere are small but measurable (the difference can be as high as 20 km)</p></li>
</ul>
<div class="{columns}">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/11-sphere.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/11-ellipsoid.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="geoid" class="slide level2">
<h2>Geoid</h2>
<ul>
<li class="fragment"><p>The <em>ellipsoid</em> gives us the earths form as a perfectly smooth object</p></li>
<li class="fragment"><p>But … the earth is not perfectly smooth</p></li>
<li class="fragment"><p>Deviations from the perfect sphere are measurable and can influence measurements.</p></li>
<li class="fragment"><p>A <em>geoid</em> is a mathematical model fore representing these deviations</p>
<ul>
<li class="fragment"><p>We are <em>not</em> talking about mountains and ocean trenches but the earth’s gravitational potential which is tied to the flow of the earth’s hot and fluid core.</p></li>
<li class="fragment"><p>Therefore the geoid is constantly changing, albeit a large temporal scale.</p></li>
</ul></li>
<li class="fragment"><p>The measurement and representation of the earth’s shape is at the heart of <code>geodesy</code></p></li>
</ul>

<img data-src="images/11-nasa-geoids.jpg" width="175" class="r-stretch quarto-figure-center"><p class="caption">NASA’s geoid models</p></section>
<section id="datum" class="slide level2">
<h2>Datum</h2>
<ul>
<li class="fragment"><p>So how are we to reconcile our need to work with a (simple) mathematical model of the earth’s shape with the undulating nature of the geoid?</p></li>
<li class="fragment"><p>We align the geoid with the ellipsoid to map the the earths departures from the smooth assumption</p></li>
<li class="fragment"><p>The alignment can be <strong>local</strong> where the ellipsoid surface is closely fit to the geoid at a particular location on the earth’s surface</p></li>
</ul>
<p>or</p>
<ul>
<li class="fragment"><p><strong>geocentric</strong> where the ellipsoid is aligned with the center of the earth.</p></li>
<li class="fragment"><p>The alignment of the smooth ellipsoid to the geoid model defines a <strong>datum</strong>.</p></li>
</ul>
</section>
<section id="local-datums" class="slide level2">
<h2>Local Datums</h2>
<ul>
<li class="fragment"><p>There are many local datums to choose from</p></li>
<li class="fragment"><p>The choice of datum is largely driven by the location</p></li>
<li class="fragment"><p>When working in the USA, a the North American Datum of 1927 (or NAD27 for short) is standard</p>
<ul>
<li class="fragment">NAD27 is not well suited for other parts of the world.</li>
</ul></li>
</ul>
</section>
<section id="section-3" class="slide level2 smaller">
<h2></h2>
<p>Examples of common local datums are shown in the following table:</p>
<table class="caption-top">
<colgroup>
<col style="width: 40%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Local datum</th>
<th>Acronym</th>
<th>Best for</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>North American Datum of 1927</td>
<td>NAD27</td>
<td>Continental US</td>
<td>This is an old datum but still prevalent</td>
</tr>
<tr class="even">
<td>European Datum of 1950</td>
<td>ED50</td>
<td>Western Europe</td>
<td>Developed after World War II and still quite popular</td>
</tr>
<tr class="odd">
<td>World Geodetic System 1972</td>
<td>WGS72</td>
<td>Global</td>
<td>Developed by the Department of Defense.</td>
</tr>
</tbody>
</table>
</section>
<section id="geocentric-datum" class="slide level2 smaller">
<h2>Geocentric Datum</h2>
<ul>
<li class="fragment"><p>Many modern datums use a geocentric alignment</p>
<ul>
<li class="fragment"><p>World Geodetic Survey for 1984 (WGS84)</p></li>
<li class="fragment"><p>North American Datums of 1983 (NAD83)</p></li>
</ul></li>
<li class="fragment"><p>Most popular geocentric datums use the WGS84 <em>ellipsoid</em> or the GRS80 <em>ellipsoid</em> which share nearly identical semi-major and semi-minor axes</p></li>
</ul>
<table class="caption-top">
<colgroup>
<col style="width: 37%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Geocentric datum</th>
<th>Acronym</th>
<th>Best for</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>North American Datum of 1983</td>
<td>NAD83</td>
<td>Continental US</td>
<td>This is one of the most popular modern datums for the contiguous US.</td>
</tr>
<tr class="even">
<td>European Terrestrial Reference System 1989</td>
<td>ETRS89</td>
<td>Western Europe</td>
<td>This is the most popular modern datum for much of Europe.</td>
</tr>
<tr class="odd">
<td>World Geodetic System 1984</td>
<td>WGS84</td>
<td>Global</td>
<td>Developed by the Department of Defense.</td>
</tr>
</tbody>
</table>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>NAD 27 is based on Clarke Ellipsoid of 1866 which is calculated by manual surveying. NAD83 is based on the Geodetic Reference System (GRS) of 1980.</p>
</div>
</div>
</div>
</section>
<section id="building-a-gcs" class="slide level2">
<h2>Building a GCS</h2>
<ul>
<li class="fragment"><p>So, a GCS is defined by the ellipsoid model and its alignment to the geoid defining the datum.</p></li>
<li class="fragment"><p>Smooth Sphere - Mathmatical Geoid (in angular units)</p></li>
</ul>
</section>
<section id="projected-coordinate-systems" class="slide level2">
<h2>Projected Coordinate Systems</h2>
<ul>
<li class="fragment"><p>The surface of the earth is curved but maps (and to data GIS) is flat.</p></li>
<li class="fragment"><p>A projected coordinate system (PCS) is a reference system for identifying locations and measuring features on a flat (2D) surfaces. I</p></li>
<li class="fragment"><p>Projected coordinate systems have an origin, an <em>x</em> axis, a <em>y</em> axis, and a linear unit of measure.</p></li>
<li class="fragment"><p>Going from a GCS to a PCS requires mathematical transformations.</p></li>
<li class="fragment"><p>There are three main groups of projection types:</p>
<ul>
<li class="fragment">conic</li>
<li class="fragment">cylindrical</li>
<li class="fragment">planar</li>
</ul></li>
</ul>
</section>
<section id="projection-types" class="slide level2">
<h2>Projection Types:</h2>

<img data-src="images/11-projected-crs.png" class="quarto-figure quarto-figure-center r-stretch" width="236"><ul>
<li class="fragment"><p>In all cases, distortion is <em>minimized</em> at the line/point of <strong>tangency</strong> (denoted by black line/point)</p></li>
<li class="fragment"><p>Distortions are <em>minimized</em> along the tangency lines and increase with the distance from those lines.</p></li>
</ul>
</section>
<section id="plannar" class="slide level2">
<h2>Plannar</h2>
<ul>
<li class="fragment"><p>A planar projection projects data onto a flat surface touching the globe at a <em>point</em> or along 1 line of <em>tangency.</em></p></li>
<li class="fragment"><p>Typically used to map polar regions.</p></li>
</ul>

<img data-src="images/11-projected-crs.png" class="quarto-figure quarto-figure-center r-stretch" width="236"></section>
<section id="cylindrical" class="slide level2">
<h2>Cylindrical</h2>
<ul>
<li class="fragment"><p>A cylindrical projection maps the surface onto a cylinder.</p></li>
<li class="fragment"><p>This projection could also be created by touching the Earth’s surface along 1 or 2 lines of <em>tangency</em></p></li>
<li class="fragment"><p>Most often when mapping the entire world.</p></li>
</ul>

<img data-src="images/11-projected-crs.png" class="quarto-figure quarto-figure-center r-stretch" width="236"></section>
<section id="conic" class="slide level2">
<h2>Conic</h2>
<ul>
<li class="fragment"><p>In a conic projection, the Earth’s surface is projected onto a cone along 1 or 2 lines of <em>tangency</em></p></li>
<li class="fragment"><p>Therefore, it is the best suited for maps of mid-latitude areas.</p></li>
</ul>

<img data-src="images/11-projected-crs.png" class="quarto-figure quarto-figure-center r-stretch" width="236"></section>
<section id="spatial-properties" class="slide level2">
<h2>Spatial Properties</h2>
<ul>
<li class="fragment"><p>All projections <em>distort</em> real-world geographic features.</p></li>
<li class="fragment"><p>Think about trying to unpeel an orange while preserving the skin</p></li>
<li class="fragment"><p>The four spatial properties that are subject to distortion are: <strong>shape</strong>, <strong>area</strong>, <strong>distance</strong> and <strong>direction</strong></p>
<ul>
<li class="fragment"><p>A map that preserves shape is called <code>conformal</code>;</p></li>
<li class="fragment"><p>one that preserves area is called <code>equal-area</code>;</p></li>
<li class="fragment"><p>one that preserves distance is called <code>equidistant</code></p></li>
<li class="fragment"><p>one that preserves direction is called <code>azimuthal</code></p></li>
<li class="fragment"><p>Each map projection can preserve only one or two of the four spatial properties.</p></li>
<li class="fragment"><p>Often, projections are named after the spatial properties they preserve.</p></li>
</ul></li>
<li class="fragment"><p>When working with small-scale (large area) maps and when multiple spatial properties are needed, it is best to break the analyses across projections to minimize errors associated with spatial distortion.</p></li>
</ul>
</section>
<section id="setting-crsspcss" class="slide level2 smaller">
<h2>Setting CRSs/PCSs</h2>
<ul>
<li class="fragment">We saw that <code>sfc</code> objects have two attributes to store a CRS: <code>epsg</code> and <code>proj4string</code></li>
</ul>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a></a><span class="fu">st_geometry</span>(conus)</span>
<span id="cb98-2"><a></a><span class="co">#&gt; Geometry set for 49 features </span></span>
<span id="cb98-3"><a></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb98-4"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb98-5"><a></a><span class="co">#&gt; Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436</span></span>
<span id="cb98-6"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb98-7"><a></a><span class="co">#&gt; First 5 geometries:</span></span>
<span id="cb98-8"><a></a><span class="co">#&gt; MULTIPOLYGON (((-118.594 33.4672, -118.4848 33....</span></span>
<span id="cb98-9"><a></a><span class="co">#&gt; MULTIPOLYGON (((-86.93428 45.42115, -86.83575 4...</span></span>
<span id="cb98-10"><a></a><span class="co">#&gt; MULTIPOLYGON (((-117.243 44.39097, -117.2151 44...</span></span>
<span id="cb98-11"><a></a><span class="co">#&gt; MULTIPOLYGON (((-97.22904 49.00069, -96.93096 4...</span></span>
<span id="cb98-12"><a></a><span class="co">#&gt; MULTIPOLYGON (((-96.62187 42.77925, -96.57794 4...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment"><p>This implies that all geometries in a geometry list-column (sfc) must have the same CRS.</p></li>
<li class="fragment"><p><code>proj4string</code> is a generic, string-based description of a CRS, understood by <a href="https://proj4.org/">PROJ</a></p></li>
<li class="fragment"><p>It defines projection types and parameter values for particular projections,</p></li>
<li class="fragment"><p>As a result it can cover an infinite amount of different projections.</p></li>
<li class="fragment"><p><code>epsg</code> is the <em>integer ID</em> for a known CRS that can be resolved into a <code>proj4string</code>.</p>
<ul>
<li class="fragment">This is somewhat equivalent to the idea that a 6-digit FIP code can be resolved to a state/county pair</li>
</ul></li>
<li class="fragment"><p>Some <code>proj4string</code> values can resolved back into their corresponding <code>epsg</code> ID, but this does not always work.</p></li>
<li class="fragment"><p>The importance of having <code>epsg</code> values stored with data besides <code>proj4string</code> values is that the <code>epsg</code> refers to particular, well-known CRS, whose parameters may change (improve) over time</p></li>
<li class="fragment"><p>fixing only the <code>proj4string</code> may remove the possibility to benefit from such improvements, and limit some of the provenance of datasets (but may help reproducibility)</p></li>
</ul>
</div>
</section>
<section id="proj4-coordinate-syntax" class="slide level2 smaller">
<h2><code>PROJ4</code> coordinate syntax</h2>
<p>The <code>PROJ4</code> syntax contains a list of parameters, each prefixed with the <code>+</code> character.</p>
<p>A list of some <code>PROJ4</code> parameters follows and the full list can be found <a href="https://proj.org/usage/projections.html">here</a>:</p>
<table class="caption-top">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>+a</td>
<td>Semi-major radius of the ellipsoid axis</td>
</tr>
<tr class="even">
<td>+b</td>
<td>Semi-minor radius of the ellipsoid axis</td>
</tr>
<tr class="odd">
<td>+datum</td>
<td>Datum name</td>
</tr>
<tr class="even">
<td>+ellps</td>
<td>Ellipsoid name</td>
</tr>
<tr class="odd">
<td>+lat_0</td>
<td>Latitude of origin</td>
</tr>
<tr class="even">
<td>+lat_1</td>
<td>Latitude of first standard parallel</td>
</tr>
<tr class="odd">
<td>+lat_2</td>
<td>Latitude of second standard parallel</td>
</tr>
<tr class="even">
<td>+lat_ts</td>
<td>Latitude of true scale</td>
</tr>
<tr class="odd">
<td>+lon_0</td>
<td>Central meridian</td>
</tr>
<tr class="even">
<td>+over</td>
<td>Allow longitude output outside -180 to 180 range, disables wrapping</td>
</tr>
<tr class="odd">
<td>+proj</td>
<td>Projection name</td>
</tr>
<tr class="even">
<td>+south</td>
<td>Denotes southern hemisphere UTM zone</td>
</tr>
<tr class="odd">
<td>+units</td>
<td>meters, US survey feet, etc.</td>
</tr>
<tr class="even">
<td>+x_0</td>
<td>False easting</td>
</tr>
<tr class="odd">
<td>+y_0</td>
<td>False northing</td>
</tr>
<tr class="even">
<td>+zone</td>
<td>UTM zone</td>
</tr>
</tbody>
</table>
</section>
<section id="transform-and-retrive" class="slide level2">
<h2>Transform and retrive</h2>
<div class="{columns}">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a></a><span class="fu">st_crs</span>(conus)<span class="sc">$</span>epsg</span>
<span id="cb99-2"><a></a><span class="co">#&gt; [1] 4326</span></span>
<span id="cb99-3"><a></a><span class="fu">st_crs</span>(conus)<span class="sc">$</span>proj4string</span>
<span id="cb99-4"><a></a><span class="co">#&gt; [1] "+proj=longlat +datum=WGS84 +no_defs"</span></span>
<span id="cb99-5"><a></a><span class="fu">st_crs</span>(conus)<span class="sc">$</span>datum</span>
<span id="cb99-6"><a></a><span class="co">#&gt; [1] "WGS84"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a></a>conus5070 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(conus, <span class="dv">5070</span>)</span>
<span id="cb100-2"><a></a></span>
<span id="cb100-3"><a></a><span class="fu">st_crs</span>(conus5070)<span class="sc">$</span>epsg</span>
<span id="cb100-4"><a></a><span class="co">#&gt; [1] 5070</span></span>
<span id="cb100-5"><a></a><span class="fu">st_crs</span>(conus5070)<span class="sc">$</span>proj4string</span>
<span id="cb100-6"><a></a><span class="co">#&gt; [1] "+proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs"</span></span>
<span id="cb100-7"><a></a><span class="fu">st_crs</span>(conus5070)<span class="sc">$</span>datum</span>
<span id="cb100-8"><a></a><span class="co">#&gt; [1] "NAD83"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>

<img data-src="week-2_files/figure-revealjs/unnamed-chunk-82-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="revisit-denver" class="slide level2">
<h2>Revisit Denver</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb101-1"><a></a><span class="bu">echo</span> <span class="at">-104.9903</span> 39.7392 <span class="kw">|</span> <span class="ex">proj</span> +proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs</span>
<span id="cb101-2"><a></a><span class="co">#&gt; -723281.88   6827.29</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment">red = false origin : blue = Denver</li>
</ul>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img data-src="week-2_files/figure-revealjs/unnamed-chunk-84-1.png"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img data-src="week-2_files/figure-revealjs/unnamed-chunk-84-2.png"></p>
</div>
</div>
</div>
</section>
<section id="geodesic-geometries" class="slide level2">
<h2>Geodesic geometries</h2>
<ul>
<li class="fragment"><p>PCSs introduce errors in their geometric measurements because the distance between two points on an ellipsoid is difficult to replicate on a projected coordinate system unless these points are close to one another.</p></li>
<li class="fragment"><p>In most cases, such errors other sources of error in the feature representation outweigh measurement errors made in a PCS making them tolorable.</p></li>
<li class="fragment"><p>However, if the domain of analysis is large (i.e.&nbsp;the North American continent), then the measurement errors associated with a projected coordinate system may no longer be acceptable.</p></li>
<li class="fragment"><p>A way to circumvent projected coordinate system limitations is to adopt a <em>geodesic</em> solution.</p></li>
</ul>
</section>
<section id="geodesic-measurments" class="slide level2">
<h2>Geodesic Measurments</h2>
<ul>
<li class="fragment"><p>A <strong>geodesic distance</strong> is the shortest distance between two points on an ellipsoid</p></li>
<li class="fragment"><p>A <strong>geodesic area</strong> measurement is one that is measured on an ellipsoid.</p></li>
<li class="fragment"><p>Such measurements are <em>independent</em> of the underlying projected coordinate system.</p></li>
<li class="fragment"><p>Why does this matter?</p></li>
<li class="fragment"><p>Compare the distances measured between Santa Barbara and Amsterdam. The blue line represents the shortest distance between the two points on a <em>planar</em> coordinate system. The red line as measured on a <em>ellipsoid</em>.</p></li>
</ul>

<img data-src="week-2_files/figure-revealjs/unnamed-chunk-85-1.png" width="2304" class="r-stretch"></section>
<section id="section-4" class="slide level2">
<h2></h2>
<ul>
<li class="fragment"><p>the geodesic distance looks weird given its curved appearance on the projected map.</p></li>
<li class="fragment"><p>this curvature is a byproduct of the current reference system’s increasing distance distortion as one moves towards the pole!</p></li>
<li class="fragment"><p>We can display the geodesic and planar distance on a 3D globe (or a projection that mimics the view of the 3D earth).</p></li>
</ul>

<img data-src="week-2_files/figure-revealjs/unnamed-chunk-86-1.png" width="960" class="r-stretch"></section>
<section id="section-5" class="slide level2">
<h2></h2>
<ul>
<li class="fragment"><p>So if a geodesic measurement is more precise than a planar measurement, why not perform all spatial operations using geodesic geometry?</p></li>
<li class="fragment"><p>The downside is in its computational requirements.</p></li>
<li class="fragment"><p>It’s far more efficient to compute area/distance on a plane than it is on a spheroid.</p></li>
<li class="fragment"><p>This is because geodesic calculations have no simple algebraic solutions and involve approximations that may require iteration! (think optimization or nonlinear solutions)</p></li>
<li class="fragment"><p>So this may be a computationally taxing approach if processing 1,000(s) or 1,000,000(s) of line segments.</p></li>
</ul>
</section>
<section id="gedesic-area-and-length-measurements" class="slide level2">
<h2>Gedesic Area and Length Measurements</h2>
<ul>
<li class="fragment"><p>Not all algorthimns are equal (in terms of speed or accuracy)</p></li>
<li class="fragment"><p>Some more efficient algorithms that minimize computation time may reduce precision in the process.</p></li>
<li class="fragment"><p>Some of ArcMap’s functions offer the option to compute geodesic distances and areas however ArcMap does not clearly indicate <em>how</em> its geodesic calculations are implemented (<a href="https://mgimond.github.io/Spatial/coordinate-systems.html#geodesic-geometries">cite</a>)</p></li>
<li class="fragment"><p>R is well documented, and is efficient!</p></li>
</ul>
</section>
<section id="distances" class="slide level2">
<h2>Distances</h2>
<p><code>?st_distance</code></p>

<img data-src="images/11-sf-geos-measures.png" class="quarto-figure quarto-figure-center r-stretch" width="488"></section>
<section id="native-sf-binds-to-libwgeom" class="slide level2">
<h2>native <code>sf</code> binds to <code>libwgeom</code></h2>
<div class="{columns}">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/11-lwgeom.png" class="quarto-figure quarto-figure-center" width="488"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/09-sf-depends.png" class="quarto-figure quarto-figure-center" width="559"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="distance-example" class="slide level2">
<h2>Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb102-2"><a></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb102-3"><a></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB</code></pre>
</div>
</div></div>
</section>
<section id="distance-example-1" class="slide level2">
<h2>Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb104-2"><a></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb104-3"><a></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb104-4"><a></a></span>
<span id="cb104-5"><a></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb104-6"><a></a>                <span class="at">crs =</span> <span class="dv">4326</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)</code></pre>
</div>
</div></div>
</section>
<section id="distance-example-2" class="slide level2">
<h2>Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb106-2"><a></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb106-3"><a></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb106-4"><a></a></span>
<span id="cb106-5"><a></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb106-6"><a></a>                <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb106-7"><a></a></span>
<span id="cb106-8"><a></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)</code></pre>
</div>
</div></div>
</section>
<section id="distance-example-3" class="slide level2">
<h2>Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb108-2"><a></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb108-3"><a></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb108-4"><a></a></span>
<span id="cb108-5"><a></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb108-6"><a></a>                <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb108-7"><a></a></span>
<span id="cb108-8"><a></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span>
<span id="cb108-9"><a></a></span>
<span id="cb108-10"><a></a><span class="co"># Greeat Circle Distance</span></span>
<span id="cb108-11"><a></a><span class="fu">st_distance</span>(pts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)
#&gt; Units: [m]
#&gt;         [,1]    [,2]
#&gt; [1,]       0 4050406
#&gt; [2,] 4050406       0</code></pre>
</div>
</div></div>
</section>
<section id="distance-example-4" class="slide level2">
<h2>Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb110-2"><a></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb110-3"><a></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb110-4"><a></a></span>
<span id="cb110-5"><a></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb110-6"><a></a>                <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb110-7"><a></a></span>
<span id="cb110-8"><a></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span>
<span id="cb110-9"><a></a></span>
<span id="cb110-10"><a></a><span class="co"># Greeat Circle Distance</span></span>
<span id="cb110-11"><a></a><span class="fu">st_distance</span>(pts)</span>
<span id="cb110-12"><a></a></span>
<span id="cb110-13"><a></a><span class="co"># Euclidean Distance</span></span>
<span id="cb110-14"><a></a><span class="fu">st_distance</span>(pts, <span class="at">which =</span> <span class="st">"Euclidean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)
#&gt; Units: [m]
#&gt;         [,1]    [,2]
#&gt; [1,]       0 4050406
#&gt; [2,] 4050406       0
#&gt; Units: [°]
#&gt;          1        2
#&gt; 1  0.00000 46.12338
#&gt; 2 46.12338  0.00000</code></pre>
</div>
</div></div>
</section>
<section id="distance-example-5" class="slide level2">
<h2>Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb112-2"><a></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb112-3"><a></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb112-4"><a></a></span>
<span id="cb112-5"><a></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb112-6"><a></a>                <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb112-7"><a></a></span>
<span id="cb112-8"><a></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span>
<span id="cb112-9"><a></a></span>
<span id="cb112-10"><a></a><span class="co"># Greeat Circle Distance</span></span>
<span id="cb112-11"><a></a><span class="fu">st_distance</span>(pts)</span>
<span id="cb112-12"><a></a></span>
<span id="cb112-13"><a></a><span class="co"># Euclidean Distance</span></span>
<span id="cb112-14"><a></a><span class="fu">st_distance</span>(pts, <span class="at">which =</span> <span class="st">"Euclidean"</span>)</span>
<span id="cb112-15"><a></a></span>
<span id="cb112-16"><a></a><span class="co"># Equal Area PCS</span></span>
<span id="cb112-17"><a></a><span class="fu">st_distance</span>(<span class="fu">st_transform</span>(pts, <span class="dv">5070</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)
#&gt; Units: [m]
#&gt;         [,1]    [,2]
#&gt; [1,]       0 4050406
#&gt; [2,] 4050406       0
#&gt; Units: [°]
#&gt;          1        2
#&gt; 1  0.00000 46.12338
#&gt; 2 46.12338  0.00000
#&gt; Units: [m]
#&gt;         1       2
#&gt; 1       0 4017987
#&gt; 2 4017987       0</code></pre>
</div>
</div></div>
</section>
<section id="distance-example-6" class="slide level2">
<h2>Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb114-2"><a></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb114-3"><a></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb114-4"><a></a></span>
<span id="cb114-5"><a></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb114-6"><a></a>                <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb114-7"><a></a></span>
<span id="cb114-8"><a></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span>
<span id="cb114-9"><a></a></span>
<span id="cb114-10"><a></a><span class="co"># Greeat Circle Distance</span></span>
<span id="cb114-11"><a></a><span class="fu">st_distance</span>(pts)</span>
<span id="cb114-12"><a></a></span>
<span id="cb114-13"><a></a><span class="co"># Euclidean Distance</span></span>
<span id="cb114-14"><a></a><span class="fu">st_distance</span>(pts, <span class="at">which =</span> <span class="st">"Euclidean"</span>)</span>
<span id="cb114-15"><a></a></span>
<span id="cb114-16"><a></a><span class="co"># Equal Area PCS</span></span>
<span id="cb114-17"><a></a><span class="fu">st_distance</span>(<span class="fu">st_transform</span>(pts, <span class="dv">5070</span>))</span>
<span id="cb114-18"><a></a></span>
<span id="cb114-19"><a></a><span class="co"># Equal Distance</span></span>
<span id="cb114-20"><a></a><span class="fu">st_distance</span>(<span class="fu">st_transform</span>(pts, eqds))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)
#&gt; Units: [m]
#&gt;         [,1]    [,2]
#&gt; [1,]       0 4050406
#&gt; [2,] 4050406       0
#&gt; Units: [°]
#&gt;          1        2
#&gt; 1  0.00000 46.12338
#&gt; 2 46.12338  0.00000
#&gt; Units: [m]
#&gt;         1       2
#&gt; 1       0 4017987
#&gt; 2 4017987       0
#&gt; Units: [m]
#&gt;         1       2
#&gt; 1       0 3823549
#&gt; 2 3823549       0</code></pre>
</div>
</div></div>
</section>
<section id="distance-example-7" class="slide level2">
<h2>Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb116-2"><a></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb116-3"><a></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb116-4"><a></a></span>
<span id="cb116-5"><a></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb116-6"><a></a>                <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb116-7"><a></a></span>
<span id="cb116-8"><a></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span>
<span id="cb116-9"><a></a></span>
<span id="cb116-10"><a></a><span class="co"># Greeat Circle Distance</span></span>
<span id="cb116-11"><a></a><span class="fu">st_distance</span>(pts)</span>
<span id="cb116-12"><a></a></span>
<span id="cb116-13"><a></a><span class="co"># Euclidean Distance</span></span>
<span id="cb116-14"><a></a><span class="fu">st_distance</span>(pts, <span class="at">which =</span> <span class="st">"Euclidean"</span>)</span>
<span id="cb116-15"><a></a></span>
<span id="cb116-16"><a></a><span class="co"># Equal Area PCS</span></span>
<span id="cb116-17"><a></a><span class="fu">st_distance</span>(<span class="fu">st_transform</span>(pts, <span class="dv">5070</span>))</span>
<span id="cb116-18"><a></a></span>
<span id="cb116-19"><a></a><span class="co"># Equal Distance</span></span>
<span id="cb116-20"><a></a><span class="fu">st_distance</span>(<span class="fu">st_transform</span>(pts, eqds))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)
#&gt; Units: [m]
#&gt;         [,1]    [,2]
#&gt; [1,]       0 4050406
#&gt; [2,] 4050406       0
#&gt; Units: [°]
#&gt;          1        2
#&gt; 1  0.00000 46.12338
#&gt; 2 46.12338  0.00000
#&gt; Units: [m]
#&gt;         1       2
#&gt; 1       0 4017987
#&gt; 2 4017987       0
#&gt; Units: [m]
#&gt;         1       2
#&gt; 1       0 3823549
#&gt; 2 3823549       0</code></pre>
</div>
</div></div>
</section>
<section id="area-example-conus" class="slide level2">
<h2>Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">

</div></div>
</section>
<section id="area-example-conus-1" class="slide level2">
<h2>Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb119-2"><a></a></span>
<span id="cb119-3"><a></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"WGS84"</span>, <span class="st">"AEA"</span>, <span class="st">"EPDS"</span>),</span>
<span id="cb119-4"><a></a>           <span class="at">area =</span> <span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">st_area</span>(conus)),</span>
<span id="cb119-5"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, <span class="dv">5070</span>))),</span>
<span id="cb119-6"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, eqds)))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">

</div></div>
</section>
<section id="area-example-conus-2" class="slide level2">
<h2>Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb120-2"><a></a></span>
<span id="cb120-3"><a></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"WGS84"</span>, <span class="st">"AEA"</span>, <span class="st">"EPDS"</span>),</span>
<span id="cb120-4"><a></a>           <span class="at">area =</span> <span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">st_area</span>(conus)),</span>
<span id="cb120-5"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, <span class="dv">5070</span>))),</span>
<span id="cb120-6"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, eqds)))))</span>
<span id="cb120-7"><a></a></span>
<span id="cb120-8"><a></a><span class="fu">ggplot</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-2_files/figure-revealjs/conus_auto_03_output-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="area-example-conus-3" class="slide level2">
<h2>Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb121-2"><a></a></span>
<span id="cb121-3"><a></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"WGS84"</span>, <span class="st">"AEA"</span>, <span class="st">"EPDS"</span>),</span>
<span id="cb121-4"><a></a>           <span class="at">area =</span> <span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">st_area</span>(conus)),</span>
<span id="cb121-5"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, <span class="dv">5070</span>))),</span>
<span id="cb121-6"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, eqds)))))</span>
<span id="cb121-7"><a></a></span>
<span id="cb121-8"><a></a><span class="fu">ggplot</span>(df) <span class="sc">+</span></span>
<span id="cb121-9"><a></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> <span class="fu">as.numeric</span>(area) ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-2_files/figure-revealjs/conus_auto_04_output-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="area-example-conus-4" class="slide level2">
<h2>Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb122-2"><a></a></span>
<span id="cb122-3"><a></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"WGS84"</span>, <span class="st">"AEA"</span>, <span class="st">"EPDS"</span>),</span>
<span id="cb122-4"><a></a>           <span class="at">area =</span> <span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">st_area</span>(conus)),</span>
<span id="cb122-5"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, <span class="dv">5070</span>))),</span>
<span id="cb122-6"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, eqds)))))</span>
<span id="cb122-7"><a></a></span>
<span id="cb122-8"><a></a><span class="fu">ggplot</span>(df) <span class="sc">+</span></span>
<span id="cb122-9"><a></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> <span class="fu">as.numeric</span>(area) )) <span class="sc">+</span></span>
<span id="cb122-10"><a></a>  <span class="fu">theme_linedraw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-2_files/figure-revealjs/conus_auto_05_output-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="area-example-conus-5" class="slide level2">
<h2>Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb123-2"><a></a></span>
<span id="cb123-3"><a></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"WGS84"</span>, <span class="st">"AEA"</span>, <span class="st">"EPDS"</span>),</span>
<span id="cb123-4"><a></a>           <span class="at">area =</span> <span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">st_area</span>(conus)),</span>
<span id="cb123-5"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, <span class="dv">5070</span>))),</span>
<span id="cb123-6"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, eqds)))))</span>
<span id="cb123-7"><a></a></span>
<span id="cb123-8"><a></a><span class="fu">ggplot</span>(df) <span class="sc">+</span></span>
<span id="cb123-9"><a></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> <span class="fu">as.numeric</span>(area) )) <span class="sc">+</span></span>
<span id="cb123-10"><a></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb123-11"><a></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"SRS"</span>, <span class="at">y =</span> <span class="st">"m2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-2_files/figure-revealjs/conus_auto_06_output-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="units-in-sf" class="slide level2">
<h2>Units in <code>sf</code></h2>
<ul>
<li class="fragment"><p>The CRS in <code>sf</code> encodes the units of measurement relating to spatial features</p></li>
<li class="fragment"><p>Where possible geometric operations such as <code>st_distance()</code>, <code>st_length()</code> and <code>st_area()</code> report results with a units attribute appropriate for the CRS:</p></li>
<li class="fragment"><p>This can be both handy and very confusing for those new to it. Consider the following:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a></a>(<span class="at">l =</span> <span class="fu">sum</span>(<span class="fu">st_length</span>(conus)))</span>
<span id="cb124-2"><a></a><span class="co">#&gt; 94980149 [m]</span></span>
<span id="cb124-3"><a></a>(<span class="at">a =</span> <span class="fu">sum</span>(<span class="fu">st_area</span>(conus)))</span>
<span id="cb124-4"><a></a><span class="co">#&gt; 7.83761e+12 [m^2]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-6" class="slide level2">
<h2></h2>
<p>We can set units if we do manipulations as well using the units package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a></a>units<span class="sc">::</span><span class="fu">set_units</span>(l, <span class="st">"km"</span>)</span>
<span id="cb125-2"><a></a><span class="co">#&gt; 94980.15 [km]</span></span>
<span id="cb125-3"><a></a>units<span class="sc">::</span><span class="fu">set_units</span>(l, <span class="st">"mile"</span>)</span>
<span id="cb125-4"><a></a><span class="co">#&gt; 59017.93 [mile]</span></span>
<span id="cb125-5"><a></a></span>
<span id="cb125-6"><a></a>units<span class="sc">::</span><span class="fu">set_units</span>(a, <span class="st">"ha"</span>)</span>
<span id="cb125-7"><a></a><span class="co">#&gt; 783760974 [ha]</span></span>
<span id="cb125-8"><a></a>units<span class="sc">::</span><span class="fu">set_units</span>(a, <span class="st">"km2"</span>)</span>
<span id="cb125-9"><a></a><span class="co">#&gt; 7837610 [km^2]</span></span>
<span id="cb125-10"><a></a>units<span class="sc">::</span><span class="fu">set_units</span>(a, <span class="st">"in2"</span>)</span>
<span id="cb125-11"><a></a><span class="co">#&gt; 1.214832e+16 [in^2]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="units-are-a-class" class="slide level2">
<h2>Units are a class</h2>
<ul>
<li class="fragment">units are an S3 data object with attribute information and “rules of engagement”</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a></a><span class="fu">class</span>(<span class="fu">st_length</span>(conus)) </span>
<span id="cb126-2"><a></a><span class="co">#&gt; [1] "units"</span></span>
<span id="cb126-3"><a></a><span class="fu">attributes</span>(<span class="fu">st_length</span>(conus)) <span class="sc">|&gt;</span> <span class="fu">unlist</span>()</span>
<span id="cb126-4"><a></a><span class="co">#&gt; units.numerator           class </span></span>
<span id="cb126-5"><a></a><span class="co">#&gt;             "m"         "units"</span></span>
<span id="cb126-6"><a></a></span>
<span id="cb126-7"><a></a><span class="fu">st_length</span>(conus) <span class="sc">+</span> <span class="dv">100</span></span>
<span id="cb126-8"><a></a><span class="co">#&gt; Error in Ops.units(st_length(conus), 100): both operands of the expression should be "units" objects</span></span>
<span id="cb126-9"><a></a></span>
<span id="cb126-10"><a></a>conus <span class="sc">|&gt;</span> </span>
<span id="cb126-11"><a></a>  <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fu">st_area</span>(.)) <span class="sc">|&gt;</span> </span>
<span id="cb126-12"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> area)) <span class="sc">+</span> </span>
<span id="cb126-13"><a></a>  <span class="fu">geom_col</span>()</span>
<span id="cb126-14"><a></a><span class="co">#&gt; Error in `stopifnot()`:</span></span>
<span id="cb126-15"><a></a><span class="co">#&gt; ℹ In argument: `area = st_area(.)`.</span></span>
<span id="cb126-16"><a></a><span class="co">#&gt; Caused by error:</span></span>
<span id="cb126-17"><a></a><span class="co">#&gt; ! object '.' not found</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="unit-values-can-be-stripped-of-their-attributes-if-need-be" class="slide level2">
<h2>Unit values can be stripped of their attributes if need be:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a></a><span class="co"># Via drop_units</span></span>
<span id="cb127-2"><a></a>(units<span class="sc">::</span><span class="fu">drop_units</span>(<span class="fu">sum</span>(<span class="fu">st_length</span>(conus))))</span>
<span id="cb127-3"><a></a><span class="co">#&gt; [1] 94980149</span></span>
<span id="cb127-4"><a></a></span>
<span id="cb127-5"><a></a><span class="co"># Via casting</span></span>
<span id="cb127-6"><a></a>(<span class="fu">as.numeric</span>(<span class="fu">sum</span>(<span class="fu">st_length</span>(conus))))</span>
<span id="cb127-7"><a></a><span class="co">#&gt; [1] 94980149</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../csu-rams-logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://github.com/mikejohnson51/csu-ess-523c/">ESS 523c: Environmental Data Science Applications: Water Resources</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 1000,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script>
      Reveal.addEventListener( 'slidechanged', function( event ) {
        console.log("hello")
        
        slide_id = event.currentSlide.id
        link = "annotations" + ".html#" + slide_id
        
        var annotation_div = document.createElement('div')
        annotation_div.setAttribute("class", "annotation-link")
        
        var notes_link = document.createElement('a')
        notes_link.setAttribute("href", link)
        notes_link.setAttribute("target", "_blank")
        
        var iii = document.createElement('i')
        iii.setAttribute("class", "fa fa-info")
        notes_link.appendChild(iii)
        
        annotation_div.appendChild(notes_link)
        
        var tmp = event.currentTarget.getElementsByClassName("annotation-link")
        if (tmp.length === 1) {
          tmp[0].remove()
        }
        
        if (event.currentSlide.classList.contains("annotation")) {
          event.currentTarget.append(annotation_div)
        }
      } );

    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>