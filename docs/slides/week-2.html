<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Week 2 – ESS 523c</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5b6eb65566b1f8a996f1287d789c0740.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-c63d9198b28a859559c0f0cce9729cfa.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../csu-rams-logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ESS 523c</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mikejohnson51/csu-ess-523c/"> <i class="bi bi-github" role="img" aria-label="ESS 523c">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#simple-features" id="toc-simple-features" class="nav-link active" data-scroll-target="#simple-features">Simple Features</a></li>
  <li><a href="#todays-data-colorado-counties" id="toc-todays-data-colorado-counties" class="nav-link" data-scroll-target="#todays-data-colorado-counties">Todays Data: Colorado Counties!</a></li>
  <li><a href="#simple-features-1" id="toc-simple-features-1" class="nav-link" data-scroll-target="#simple-features-1">Simple Features</a></li>
  <li><a href="#simple-features-access" id="toc-simple-features-access" class="nav-link" data-scroll-target="#simple-features-access">Simple Features Access</a></li>
  <li><a href="#so-what-is-a-feature" id="toc-so-what-is-a-feature" class="nav-link" data-scroll-target="#so-what-is-a-feature">So what is a feature?</a></li>
  <li><a href="#spatial-features" id="toc-spatial-features" class="nav-link" data-scroll-target="#spatial-features">Spatial Features</a></li>
  <li><a href="#geometry-types" id="toc-geometry-types" class="nav-link" data-scroll-target="#geometry-types">Geometry types</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#dimensions" id="toc-dimensions" class="nav-link" data-scroll-target="#dimensions">Dimensions</a></li>
  <li><a href="#valid-geometries" id="toc-valid-geometries" class="nav-link" data-scroll-target="#valid-geometries">Valid geometries</a></li>
  <li><a href="#non-simple-and-non-valid-geometries" id="toc-non-simple-and-non-valid-geometries" class="nav-link" data-scroll-target="#non-simple-and-non-valid-geometries">Non-simple and non-valid geometries</a></li>
  <li><a href="#empty-geometries" id="toc-empty-geometries" class="nav-link" data-scroll-target="#empty-geometries">Empty Geometries</a></li>
  <li><a href="#so" id="toc-so" class="nav-link" data-scroll-target="#so">So:</a></li>
  <li><a href="#well-known-text-well-known-binary" id="toc-well-known-text-well-known-binary" class="nav-link" data-scroll-target="#well-known-text-well-known-binary">Well-known Text, Well-known Binary</a>
  <ul class="collapse">
  <li><a href="#wkt-and-wkb" id="toc-wkt-and-wkb" class="nav-link" data-scroll-target="#wkt-and-wkb">WKT and WKB</a></li>
  <li><a href="#how-simple-features-are-organized-in-r" id="toc-how-simple-features-are-organized-in-r" class="nav-link" data-scroll-target="#how-simple-features-are-organized-in-r">How simple features are organized in R?</a></li>
  </ul></li>
  <li><a href="#sfg-sfc-sf" id="toc-sfg-sfc-sf" class="nav-link" data-scroll-target="#sfg-sfc-sf">sfg –&gt; sfc –&gt; sf</a>
  <ul class="collapse">
  <li><a href="#sf-sfc-sfg" id="toc-sf-sfc-sfg" class="nav-link" data-scroll-target="#sf-sfc-sfg">sf, sfc, sfg</a></li>
  <li><a href="#sf-sfc-sfg-1" id="toc-sf-sfc-sfg-1" class="nav-link" data-scroll-target="#sf-sfc-sfg-1">sf, sfc, sfg</a></li>
  <li><a href="#sfg-simple-feature-geometry-blue" id="toc-sfg-simple-feature-geometry-blue" class="nav-link" data-scroll-target="#sfg-simple-feature-geometry-blue"><code>sfg</code>: simple feature geometry (blue)</a></li>
  <li><a href="#sfg-simple-feature-geometry" id="toc-sfg-simple-feature-geometry" class="nav-link" data-scroll-target="#sfg-simple-feature-geometry"><code>sfg</code>: simple feature geometry</a></li>
  <li><a href="#sfg-simple-feature-geometry-1" id="toc-sfg-simple-feature-geometry-1" class="nav-link" data-scroll-target="#sfg-simple-feature-geometry-1"><code>sfg</code>: simple feature geometry</a></li>
  <li><a href="#sfg-simple-feature-geometry-2" id="toc-sfg-simple-feature-geometry-2" class="nav-link" data-scroll-target="#sfg-simple-feature-geometry-2"><code>sfg</code>: simple feature geometry</a></li>
  <li><a href="#sfg-simple-feature-geometry-3" id="toc-sfg-simple-feature-geometry-3" class="nav-link" data-scroll-target="#sfg-simple-feature-geometry-3"><code>sfg</code>: simple feature geometry</a></li>
  <li><a href="#mixed-geometries" id="toc-mixed-geometries" class="nav-link" data-scroll-target="#mixed-geometries">Mixed geometries</a></li>
  <li><a href="#geometrycollection" id="toc-geometrycollection" class="nav-link" data-scroll-target="#geometrycollection">GEOMETRYCOLLECTION</a></li>
  <li><a href="#geometrycollection-1" id="toc-geometrycollection-1" class="nav-link" data-scroll-target="#geometrycollection-1">GEOMETRYCOLLECTION</a></li>
  <li><a href="#conversion-between-types" id="toc-conversion-between-types" class="nav-link" data-scroll-target="#conversion-between-types">Conversion between types</a></li>
  <li><a href="#conversion-between-types-1" id="toc-conversion-between-types-1" class="nav-link" data-scroll-target="#conversion-between-types-1">Conversion between types</a></li>
  <li><a href="#conversion-between-types-2" id="toc-conversion-between-types-2" class="nav-link" data-scroll-target="#conversion-between-types-2">Conversion between types</a></li>
  <li><a href="#sfc-sets-of-geometries" id="toc-sfc-sets-of-geometries" class="nav-link" data-scroll-target="#sfc-sets-of-geometries"><code>sfc</code>: sets of geometries</a></li>
  <li><a href="#sets-of-geometries-arise-when-we-separate-compound-geometries" id="toc-sets-of-geometries-arise-when-we-separate-compound-geometries" class="nav-link" data-scroll-target="#sets-of-geometries-arise-when-we-separate-compound-geometries">Sets of geometries arise when we separate compound geometries:</a></li>
  <li><a href="#sets-of-geometries-arise-when-we-separate-compound-geometries-1" id="toc-sets-of-geometries-arise-when-we-separate-compound-geometries-1" class="nav-link" data-scroll-target="#sets-of-geometries-arise-when-we-separate-compound-geometries-1">Sets of geometries arise when we separate compound geometries:</a></li>
  <li><a href="#sets-of-geometries-arise-when-we-separate-compound-geometries-2" id="toc-sets-of-geometries-arise-when-we-separate-compound-geometries-2" class="nav-link" data-scroll-target="#sets-of-geometries-arise-when-we-separate-compound-geometries-2">Sets of geometries arise when we separate compound geometries:</a></li>
  <li><a href="#sets-of-geometries-arise-when-we-separate-compound-geometries-3" id="toc-sets-of-geometries-arise-when-we-separate-compound-geometries-3" class="nav-link" data-scroll-target="#sets-of-geometries-arise-when-we-separate-compound-geometries-3">Sets of geometries arise when we separate compound geometries:</a></li>
  <li><a href="#sets-of-geometries-arise-when-we-separate-compound-geometries-4" id="toc-sets-of-geometries-arise-when-we-separate-compound-geometries-4" class="nav-link" data-scroll-target="#sets-of-geometries-arise-when-we-separate-compound-geometries-4">Sets of geometries arise when we separate compound geometries:</a></li>
  <li><a href="#casting-must-be-done-the-level-of-the-feature" id="toc-casting-must-be-done-the-level-of-the-feature" class="nav-link" data-scroll-target="#casting-must-be-done-the-level-of-the-feature">Casting must be done the level of the feature</a></li>
  </ul></li>
  <li><a href="#disolving-geometries" id="toc-disolving-geometries" class="nav-link" data-scroll-target="#disolving-geometries">Disolving Geometries</a>
  <ul class="collapse">
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a></li>
  <li><a href="#feature-resoloved-and-combined" id="toc-feature-resoloved-and-combined" class="nav-link" data-scroll-target="#feature-resoloved-and-combined">1 feature: resoloved and combined:</a></li>
  <li><a href="#so-what" id="toc-so-what" class="nav-link" data-scroll-target="#so-what">So what?</a></li>
  <li><a href="#make-denver-in-the-crs-of-our-states" id="toc-make-denver-in-the-crs-of-our-states" class="nav-link" data-scroll-target="#make-denver-in-the-crs-of-our-states">1. Make “Denver” in the CRS of our states</a></li>
  <li><a href="#determine-the-3-closest-states" id="toc-determine-the-3-closest-states" class="nav-link" data-scroll-target="#determine-the-3-closest-states">2. Determine the 3 closest states:</a></li>
  <li><a href="#determine-the-3-closest-states-1" id="toc-determine-the-3-closest-states-1" class="nav-link" data-scroll-target="#determine-the-3-closest-states-1">2. Determine the 3 closest states:</a></li>
  <li><a href="#determine-the-3-closest-states-2" id="toc-determine-the-3-closest-states-2" class="nav-link" data-scroll-target="#determine-the-3-closest-states-2">2. Determine the 3 closest states:</a></li>
  <li><a href="#determine-the-3-closest-states-3" id="toc-determine-the-3-closest-states-3" class="nav-link" data-scroll-target="#determine-the-3-closest-states-3">2. Determine the 3 closest states:</a></li>
  <li><a href="#geometry-selection" id="toc-geometry-selection" class="nav-link" data-scroll-target="#geometry-selection">Geometry Selection</a></li>
  <li><a href="#to-determine-distance-to-border-we-need-a-linear-representation" id="toc-to-determine-distance-to-border-we-need-a-linear-representation" class="nav-link" data-scroll-target="#to-determine-distance-to-border-we-need-a-linear-representation">To determine distance to border we need a linear representation:</a></li>
  <li><a href="#to-determine-distance-to-border-we-need-a-linear-representation-1" id="toc-to-determine-distance-to-border-we-need-a-linear-representation-1" class="nav-link" data-scroll-target="#to-determine-distance-to-border-we-need-a-linear-representation-1">To determine distance to border we need a linear representation:</a></li>
  <li><a href="#to-determine-distance-to-border-we-need-a-linear-representation-2" id="toc-to-determine-distance-to-border-we-need-a-linear-representation-2" class="nav-link" data-scroll-target="#to-determine-distance-to-border-we-need-a-linear-representation-2">To determine distance to border we need a linear representation:</a></li>
  <li><a href="#to-determine-distance-to-border-we-need-a-linear-representation-3" id="toc-to-determine-distance-to-border-we-need-a-linear-representation-3" class="nav-link" data-scroll-target="#to-determine-distance-to-border-we-need-a-linear-representation-3">To determine distance to border we need a linear representation:</a></li>
  <li><a href="#to-determine-distance-to-border-we-need-a-linear-representation-4" id="toc-to-determine-distance-to-border-we-need-a-linear-representation-4" class="nav-link" data-scroll-target="#to-determine-distance-to-border-we-need-a-linear-representation-4">To determine distance to border we need a linear representation:</a></li>
  <li><a href="#revisting-the-idea-of-the-feature-level" id="toc-revisting-the-idea-of-the-feature-level" class="nav-link" data-scroll-target="#revisting-the-idea-of-the-feature-level">Revisting the idea of the feature level:</a></li>
  <li><a href="#sf-objects-with-simple-features" id="toc-sf-objects-with-simple-features" class="nav-link" data-scroll-target="#sf-objects-with-simple-features"><code>sf</code>: objects with simple features</a></li>
  <li><a href="#the-stickness-of-sfc-column" id="toc-the-stickness-of-sfc-column" class="nav-link" data-scroll-target="#the-stickness-of-sfc-column">The stickness of <code>sfc</code> column</a></li>
  <li><a href="#the-stickness-of-sfc-column-1" id="toc-the-stickness-of-sfc-column-1" class="nav-link" data-scroll-target="#the-stickness-of-sfc-column-1">The stickness of <code>sfc</code> column</a></li>
  </ul></li>
  <li><a href="#coordinate-systems" id="toc-coordinate-systems" class="nav-link" data-scroll-target="#coordinate-systems">Coordinate Systems</a>
  <ul class="collapse">
  <li><a href="#what-makes-spatial-data-spatial" id="toc-what-makes-spatial-data-spatial" class="nav-link" data-scroll-target="#what-makes-spatial-data-spatial">What makes spatial data <em>spatial</em>?</a></li>
  <li><a href="#coordinate-systems-1" id="toc-coordinate-systems-1" class="nav-link" data-scroll-target="#coordinate-systems-1">Coordinate Systems</a></li>
  <li><a href="#sf-tools" id="toc-sf-tools" class="nav-link" data-scroll-target="#sf-tools"><code>sf</code> tools</a></li>
  <li><a href="#geographic-coordinate-systms-gcs" id="toc-geographic-coordinate-systms-gcs" class="nav-link" data-scroll-target="#geographic-coordinate-systms-gcs">Geographic Coordinate Systms (GCS)</a></li>
  <li><a href="#sphere-and-ellipsoid" id="toc-sphere-and-ellipsoid" class="nav-link" data-scroll-target="#sphere-and-ellipsoid">Sphere and Ellipsoid</a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"></a></li>
  <li><a href="#geoid" id="toc-geoid" class="nav-link" data-scroll-target="#geoid">Geoid</a></li>
  <li><a href="#datum" id="toc-datum" class="nav-link" data-scroll-target="#datum">Datum</a></li>
  <li><a href="#local-datums" id="toc-local-datums" class="nav-link" data-scroll-target="#local-datums">Local Datums</a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3"></a></li>
  <li><a href="#geocentric-datum" id="toc-geocentric-datum" class="nav-link" data-scroll-target="#geocentric-datum">Geocentric Datum</a></li>
  <li><a href="#building-a-gcs" id="toc-building-a-gcs" class="nav-link" data-scroll-target="#building-a-gcs">Building a GCS</a></li>
  <li><a href="#projected-coordinate-systems" id="toc-projected-coordinate-systems" class="nav-link" data-scroll-target="#projected-coordinate-systems">Projected Coordinate Systems</a></li>
  <li><a href="#projection-types" id="toc-projection-types" class="nav-link" data-scroll-target="#projection-types">Projection Types:</a></li>
  <li><a href="#plannar" id="toc-plannar" class="nav-link" data-scroll-target="#plannar">Plannar</a></li>
  <li><a href="#cylindrical" id="toc-cylindrical" class="nav-link" data-scroll-target="#cylindrical">Cylindrical</a></li>
  <li><a href="#conic" id="toc-conic" class="nav-link" data-scroll-target="#conic">Conic</a></li>
  <li><a href="#spatial-properties" id="toc-spatial-properties" class="nav-link" data-scroll-target="#spatial-properties">Spatial Properties</a></li>
  <li><a href="#setting-crsspcss" id="toc-setting-crsspcss" class="nav-link" data-scroll-target="#setting-crsspcss">Setting CRSs/PCSs</a></li>
  <li><a href="#proj4-coordinate-syntax" id="toc-proj4-coordinate-syntax" class="nav-link" data-scroll-target="#proj4-coordinate-syntax"><code>PROJ4</code> coordinate syntax</a></li>
  <li><a href="#transform-and-retrive" id="toc-transform-and-retrive" class="nav-link" data-scroll-target="#transform-and-retrive">Transform and retrive</a></li>
  <li><a href="#revisit-denver" id="toc-revisit-denver" class="nav-link" data-scroll-target="#revisit-denver">Revisit Denver</a></li>
  <li><a href="#geodesic-geometries" id="toc-geodesic-geometries" class="nav-link" data-scroll-target="#geodesic-geometries">Geodesic geometries</a></li>
  <li><a href="#geodesic-measurments" id="toc-geodesic-measurments" class="nav-link" data-scroll-target="#geodesic-measurments">Geodesic Measurments</a></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4"></a></li>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5"></a></li>
  <li><a href="#gedesic-area-and-length-measurements" id="toc-gedesic-area-and-length-measurements" class="nav-link" data-scroll-target="#gedesic-area-and-length-measurements">Gedesic Area and Length Measurements</a></li>
  <li><a href="#distances" id="toc-distances" class="nav-link" data-scroll-target="#distances">Distances</a></li>
  <li><a href="#native-sf-binds-to-libwgeom" id="toc-native-sf-binds-to-libwgeom" class="nav-link" data-scroll-target="#native-sf-binds-to-libwgeom">native <code>sf</code> binds to <code>libwgeom</code></a></li>
  <li><a href="#distance-example" id="toc-distance-example" class="nav-link" data-scroll-target="#distance-example">Distance Example</a></li>
  <li><a href="#distance-example-1" id="toc-distance-example-1" class="nav-link" data-scroll-target="#distance-example-1">Distance Example</a></li>
  <li><a href="#distance-example-2" id="toc-distance-example-2" class="nav-link" data-scroll-target="#distance-example-2">Distance Example</a></li>
  <li><a href="#distance-example-3" id="toc-distance-example-3" class="nav-link" data-scroll-target="#distance-example-3">Distance Example</a></li>
  <li><a href="#distance-example-4" id="toc-distance-example-4" class="nav-link" data-scroll-target="#distance-example-4">Distance Example</a></li>
  <li><a href="#distance-example-5" id="toc-distance-example-5" class="nav-link" data-scroll-target="#distance-example-5">Distance Example</a></li>
  <li><a href="#distance-example-6" id="toc-distance-example-6" class="nav-link" data-scroll-target="#distance-example-6">Distance Example</a></li>
  <li><a href="#distance-example-7" id="toc-distance-example-7" class="nav-link" data-scroll-target="#distance-example-7">Distance Example</a></li>
  <li><a href="#area-example-conus" id="toc-area-example-conus" class="nav-link" data-scroll-target="#area-example-conus">Area Example: CONUS</a></li>
  <li><a href="#area-example-conus-1" id="toc-area-example-conus-1" class="nav-link" data-scroll-target="#area-example-conus-1">Area Example: CONUS</a></li>
  <li><a href="#area-example-conus-2" id="toc-area-example-conus-2" class="nav-link" data-scroll-target="#area-example-conus-2">Area Example: CONUS</a></li>
  <li><a href="#area-example-conus-3" id="toc-area-example-conus-3" class="nav-link" data-scroll-target="#area-example-conus-3">Area Example: CONUS</a></li>
  <li><a href="#area-example-conus-4" id="toc-area-example-conus-4" class="nav-link" data-scroll-target="#area-example-conus-4">Area Example: CONUS</a></li>
  <li><a href="#area-example-conus-5" id="toc-area-example-conus-5" class="nav-link" data-scroll-target="#area-example-conus-5">Area Example: CONUS</a></li>
  <li><a href="#units-in-sf" id="toc-units-in-sf" class="nav-link" data-scroll-target="#units-in-sf">Units in <code>sf</code></a></li>
  <li><a href="#section-6" id="toc-section-6" class="nav-link" data-scroll-target="#section-6"></a></li>
  <li><a href="#units-are-a-class" id="toc-units-are-a-class" class="nav-link" data-scroll-target="#units-are-a-class">Units are a class</a></li>
  <li><a href="#unit-values-can-be-stripped-of-their-attributes-if-need-be" id="toc-unit-values-can-be-stripped-of-their-attributes-if-need-be" class="nav-link" data-scroll-target="#unit-values-can-be-stripped-of-their-attributes-if-need-be">Unit values can be stripped of their attributes if need be:</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="week-2.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 2</h1>
<p class="subtitle lead">Features, Projections &amp; Measures</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="simple-features" class="level2">
<h2 class="anchored" data-anchor-id="simple-features">Simple Features</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/09-sf-model.png" class="img-fluid figure-img" width="350"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="todays-data-colorado-counties" class="level2">
<h2 class="anchored" data-anchor-id="todays-data-colorado-counties">Todays Data: Colorado Counties!</h2>
<div class="cell">
<pre><code>#&gt; Simple feature collection with 64 features and 4 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    geoid       name      aland state_nm                       geometry
#&gt; 1  08001      Adams 3021840487 Colorado MULTIPOLYGON (((-105.0532 3...
#&gt; 2  08003    Alamosa 1871643028 Colorado MULTIPOLYGON (((-105.4855 3...
#&gt; 3  08005   Arapahoe 2066438714 Colorado MULTIPOLYGON (((-103.7065 3...
#&gt; 4  08007  Archuleta 3496712164 Colorado MULTIPOLYGON (((-107.1287 3...
#&gt; 5  08009       Baca 6617400567 Colorado MULTIPOLYGON (((-102.0416 3...
#&gt; 6  08011       Bent 3918255148 Colorado MULTIPOLYGON (((-102.7476 3...
#&gt; 7  08013    Boulder 1881325109 Colorado MULTIPOLYGON (((-105.3978 3...
#&gt; 8  08014 Broomfield   85386685 Colorado MULTIPOLYGON (((-105.1092 3...
#&gt; 9  08015    Chaffee 2624715692 Colorado MULTIPOLYGON (((-105.9698 3...
#&gt; 10 08017   Cheyenne 4605713960 Colorado MULTIPOLYGON (((-103.1729 3...</code></pre>
</div>
</section>
<section id="simple-features-1" class="level2">
<h2 class="anchored" data-anchor-id="simple-features-1">Simple Features</h2>
<ul>
<li><p>Simple feature geometries describe the geometries of <code>features.</code></p></li>
<li><p>The main application of simple feature geometries is to describe 2D geometries as <code>points</code>, <code>lines</code>, or <code>polygons</code>.</p></li>
<li><p>“simple” refers to the fact that line or polygon geometries are represented by set of points connected with straight lines.</p></li>
<li><p>Simple features access is a standard (Herring 2011, Herring (2010), ISO (2004)) for describing simple feature geometries via:</p>
<ol type="1">
<li><p>a class hierarchy</p></li>
<li><p>a set of operations</p></li>
<li><p>binary and text encodings</p></li>
</ol></li>
</ul>
</section>
<section id="simple-features-access" class="level2">
<h2 class="anchored" data-anchor-id="simple-features-access">Simple Features Access</h2>
<ul>
<li><p><a href="https://en.wikipedia.org/wiki/Simple_Features">Simple features</a> or <a href="http://www.opengeospatial.org/standards/sfa"><em>simple feature access</em></a> refers to the formal standard (ISO 19125-1:2004) describing how objects in the real world can be represented in computers, with emphasis on the <em>spatial</em> geometry of these objects.</p></li>
<li><p>It also describes how objects can be stored in and retrieved from databases, and which geometrical operations should/can be defined for them.</p></li>
<li><p>The standard is widely implemented in spatial databases (such as PostGIS), commercial GIS (e.g., <a href="http://www.esri.com/">ESRI ArcGIS</a>) and forms the vector data basis for libraries such as <a href="http://www.gdal.org/">GDAL</a>.</p></li>
<li><p>A subset of simple features (e.g.&nbsp;the <strong>big 7</strong>) forms the <a href="http://geojson.org/">GeoJSON</a> specification.</p></li>
<li><p>R has well-supported classes for storing spatial data (<a href="https://CRAN.R-project.org/package=sp">sp</a>) and interfacing to the above mentioned environments (<a href="https://CRAN.R-project.org/package=rgdal">rgdal</a>, <a href="https://CRAN.R-project.org/package=rgeos">rgeos</a>), but has so far lacked a complete implementation of simple features, making conversions at times convoluted, inefficient or incomplete.</p></li>
<li><p><a href="http://github.com/r-spatial/sf">sf</a> is seeking to fill this gap and has/will succeed <a href="https://CRAN.R-project.org/package=sp">sp</a></p></li>
</ul>
</section>
<section id="so-what-is-a-feature" class="level2">
<h2 class="anchored" data-anchor-id="so-what-is-a-feature">So what is a feature?</h2>
<ul>
<li><p>A feature is a thing (object) in the real world, such as a building or a river</p></li>
<li><p>They often consist of other objects.</p>
<ul>
<li><p>A river system can be a feature, a river can be a feature, a river outlet can be a feature.</p></li>
<li><p>A image pixel can be a feature, and the image can be a feature…</p></li>
</ul></li>
</ul>
</section>
<section id="spatial-features" class="level2">
<h2 class="anchored" data-anchor-id="spatial-features">Spatial Features</h2>
<ul>
<li><p>The standard says: “<em>A simple feature is defined by the OpenGIS Abstract specification to have both <strong>spatial</strong> and <strong>non-spatial</strong> attributes. Spatial attributes are geometry valued, and simple features are based on 2D geometry with linear interpolation between vertices.</em>” - <a href="http://www.opengeospatial.org/standards/sfa">standard</a>.</p></li>
<li><p>Spatial Features have a <em>geometry</em> describing <em>where</em> the feature is located and <em>how</em> it is represented.</p></li>
<li><p>The geometry of a river can be its watershed, of its mainstem, or the point it drains to (see the OGC <a href="https://docs.opengeospatial.org/is/14-111r6/14-111r6.html">HY_Feature</a> standard)</p></li>
<li><p>Features can have attributes describing other properties of the feature</p></li>
</ul>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(co<span class="sc">$</span>geometry)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sfc_MULTIPOLYGON of length 64; first list element: List of 1</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ :List of 1</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ : num [1:132, 1:2] -105 -105 -105 -105 -105 ...</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  - attr(*, "class")= chr [1:3] "XY" "MULTIPOLYGON" "sfg"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Other properties may include its length, slope, stream order or average flowrate</li>
</ul>
</section>
<section id="geometry-types" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="geometry-types">Geometry types</h2>
<p>The following 7 simple feature types are the most common, and are the only ones used for <a href="https://tools.ietf.org/html/rfc7946">GeoJSON</a>:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 7%">
<col style="width: 92%">
</colgroup>
<thead>
<tr class="header">
<th>SINGLE</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>POINT</code></td>
<td>zero-dimensional geometry containing a single point</td>
</tr>
<tr class="even">
<td><code>LINESTRING</code></td>
<td>sequence of points connected by straight, non-self intersecting line pieces; one-dimensional geometry</td>
</tr>
<tr class="odd">
<td><code>POLYGON</code></td>
<td>geometry with a positive area (two-dimensional); sequence of points form a closed, non-self intersecting ring; the first ring denotes the exterior ring, zero or more subsequent rings denote holes in this exterior ring</td>
</tr>
</tbody>
</table>
<table class="caption-top table">
<colgroup>
<col style="width: 7%">
<col style="width: 92%">
</colgroup>
<thead>
<tr class="header">
<th>MULTI (same typed)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>MULTIPOINT</code></td>
<td>set of points; a MULTIPOINT is simple if no two Points in the MULTIPOINT are equal</td>
</tr>
<tr class="even">
<td><code>MULTILINESTRING</code></td>
<td>set of linestrings</td>
</tr>
<tr class="odd">
<td><code>MULTIPOLYGON</code></td>
<td>set of polygons</td>
</tr>
</tbody>
</table>
<table class="caption-top table">
<colgroup>
<col style="width: 7%">
<col style="width: 92%">
</colgroup>
<thead>
<tr class="header">
<th>Multi-Typed</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>GEOMETRYCOLLECTION</code></td>
<td>set of geometries of any type except GEOMETRYCOLLECTION</td>
</tr>
</tbody>
</table>
<ul>
<li>The descriptions above were copied from the <a href="http://postgis.net/docs/using_postgis_dbmanagement.html">PostGIS manual</a>.</li>
</ul>
</section>
<section id="section" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="section"></h2>
<p>The remaining geometries 10 are rarer, but increasingly find implementations:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 7%">
<col style="width: 92%">
</colgroup>
<thead>
<tr class="header">
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>CIRCULARSTRING</code></td>
<td>The CIRCULARSTRING is the basic curve type, similar to a LINESTRING in the linear world. A single segment requires three points, the start and end points (first and third) and any other point on the arc. The exception to this is for a closed circle, where the start and end points are the same. In this case the second point MUST be the center of the arc, i.e., the opposite side of the circle. To chain arcs together, the last point of the previous arc becomes the first point of the next arc, just like in LINESTRING. This means that a valid circular string must have an odd number of points greater than 1.</td>
</tr>
<tr class="even">
<td><code>COMPOUNDCURVE</code></td>
<td>A compound curve is a single, continuous curve that has both curved (circular) segments and linear segments. That means that in addition to having well-formed components, the end point of every component (except the last) must be coincident with the start point of the following component.</td>
</tr>
<tr class="odd">
<td><code>CURVEPOLYGON</code></td>
<td>Example compound curve in a curve polygon: CURVEPOLYGON(COMPOUNDCURVE(CIRCULARSTRING(0 0,2 0, 2 1, 2 3, 4 3),(4 3, 4 5, 1 4, 0 0)), CIRCULARSTRING(1.7 1, 1.4 0.4, 1.6 0.4, 1.6 0.5, 1.7 1) )</td>
</tr>
<tr class="even">
<td><code>MULTICURVE</code></td>
<td>A MultiCurve is a 1-dimensional GeometryCollection whose elements are Curves, it can include linear strings, circular strings or compound strings.</td>
</tr>
<tr class="odd">
<td><code>MULTISURFACE</code></td>
<td>A MultiSurface is a 2-dimensional GeometryCollection whose elements are Surfaces, all using coordinates from the same coordinate reference system.</td>
</tr>
<tr class="even">
<td><code>CURVE</code></td>
<td>A Curve is a 1-dimensional geometric object usually stored as a sequence of Points, with the subtype of Curve specifying the form of the interpolation between Points</td>
</tr>
<tr class="odd">
<td><code>SURFACE</code></td>
<td>A Surface is a 2-dimensional geometric object</td>
</tr>
<tr class="even">
<td><code>POLYHEDRALSURFACE</code></td>
<td>A PolyhedralSurface is a contiguous collection of polygons, which share common boundary segments</td>
</tr>
<tr class="odd">
<td><code>TIN</code></td>
<td>A TIN (triangulated irregular network) is a PolyhedralSurface consisting only of Triangle patches.</td>
</tr>
<tr class="even">
<td><code>TRIANGLE</code></td>
<td>A Triangle is a polygon with 3 distinct, non-collinear vertices and no interior boundary</td>
</tr>
</tbody>
</table>
</section>
<section id="dimensions" class="level2">
<h2 class="anchored" data-anchor-id="dimensions">Dimensions</h2>
<p><strong>All</strong> geometries are composed of <code>points</code></p>
<ul>
<li><p>Points are defined by coordinates in a 2-, 3- or 4-D space.</p></li>
<li><p>In addition to XY coordinates, there are two optional dimensions:</p></li>
<li><p>a Z coordinate, denoting altitude</p></li>
<li><p>an M coordinate (rarely used), denoting some <em>measure</em></p></li>
<li><p>The <code>M</code> describes a property of the vertex that is <em>independent</em> of the feature.</p></li>
<li><p>It sounds attractive to encode a time as M, however these quickly become invalid once the path self-intersects.</p></li>
<li><p>Both Z and M are found relatively <strong>rarely</strong>, and software support to do something useful with them is rarer still.</p></li>
</ul>
</section>
<section id="valid-geometries" class="level2">
<h2 class="anchored" data-anchor-id="valid-geometries">Valid geometries</h2>
<ul>
<li><p>Valid geometries obey the following properties:</p>
<ul>
<li><p><code>LINESTRINGS</code> shall not self-intersect</p></li>
<li><p><code>POLYGON</code> rings shall be closed (last point = first point)</p></li>
<li><p><code>POLYGON</code> holes (inner rings) shall be inside their exterior ring</p></li>
<li><p><code>POLYGON</code> inner rings shall maximally touch the exterior ring in single points, not over a line</p></li>
<li><p><code>POLYGON</code> rings shall not repeat their own path</p></li>
</ul></li>
<li><p>If any of the above is <strong>not</strong> the case, the geometry is not valid.</p></li>
</ul>
</section>
<section id="non-simple-and-non-valid-geometries" class="level2">
<h2 class="anchored" data-anchor-id="non-simple-and-non-valid-geometries">Non-simple and non-valid geometries</h2>
<ul>
<li><p><code>st_is_simple</code> and <code>st_is_valid</code> provide methods to help detect non-simple and non-valid geometries:</p></li>
<li><p>An example of a non-simple geometries is a self-intersecting lines</p></li>
<li><p>An example of a non-valid geometry are would be a polygon with slivers or self-intersections.</p></li>
</ul>
<div class="{columns}">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>(x1 <span class="ot">&lt;-</span> <span class="fu">st_linestring</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>),<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>))))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; LINESTRING (0 0, 1 1, 0 1, 1 0)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_is_simple</span>(x1)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.aling="center">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-2_files/figure-revealjs/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(x2 <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.6</span>,<span class="dv">1</span>,<span class="dv">0</span>)))))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POLYGON ((0 0, 1 0, 1 1, 1 0.6, 0 1, 0 0))</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>(x3 <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>)))))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POLYGON ((0 0, 1 1, 0 1, 1 0, 0 0))</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">st_is_valid</span>(<span class="fu">c</span>(x2,x3))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.aling="center">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-2_files/figure-revealjs/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="empty-geometries" class="level2">
<h2 class="anchored" data-anchor-id="empty-geometries">Empty Geometries</h2>
<ul>
<li><p>An important concept in the feature geometry framework is the <code>empty</code> geometry.</p></li>
<li><p><code>empty</code> geometries serve similar purposes as NA values in vectors (placeholder)</p></li>
<li><p>Empty geometries arise naturally from geometrical operations, for instance:</p></li>
</ul>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">e =</span> <span class="fu">st_intersection</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)), <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; GEOMETRYCOLLECTION EMPTY</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>It is not entirely clear what the benefit is of having <code>typed</code> empty geometries, but according to the simple feature standard they are type so the <code>sf</code> package abides by that.</p></li>
<li><p>Empty geometries can be detected by:</p></li>
</ul>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_is_empty</span>(e)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="so" class="level2">
<h2 class="anchored" data-anchor-id="so">So:</h2>
<ul>
<li>There are 17 typed geometries supported by the simple feature standard</li>
<li>All geometries are made up of points</li>
<li>points can exist in 2,3,4 Dinimsonal space</li>
<li><code>LINESTRING</code> and <code>POLYGON</code> geometries have rules that define validity</li>
<li>Geometries can be empty (but are still typed)</li>
</ul>
</section>
<section id="well-known-text-well-known-binary" class="level1">
<h1>Well-known Text, Well-known Binary</h1>
<section id="wkt-and-wkb" class="level2">
<h2 class="anchored" data-anchor-id="wkt-and-wkb">WKT and WKB</h2>
<ul>
<li><p>The simple feature standard includes two encodings: Well-known text (WKT) &amp; well-known binary (WKB)</p></li>
<li><p><code>Well Known Text</code> is human-readable:</p></li>
</ul>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">st_linestring</span>(<span class="fu">matrix</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">1</span>,<span class="dv">5</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_as_text</span>(x)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "LINESTRING (10 5, 9 4, 8 3, 7 2, 6 1)"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>In this example, the word <code>LINESTRING</code> provides the geometry <em>type</em> which is followed by a parentheses, inside the parentheses are the <code>points</code> that make up the geometry.</p></li>
<li><p>Separate points are separated by a “comma”, while the point coordinates are separated by a “space.”</p></li>
<li><p>Coordinates are usually floating point numbers, and moving large amounts of information as text is slow and imprecise.</p></li>
</ul>
<hr>
<ul>
<li>For that reason, we use well-known binary (WKB) encoding</li>
</ul>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; LINESTRING (10 5, 9 4, 8 3, 7 2, 6 1)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_as_binary</span>(x)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] 01 02 00 00 00 05 00 00 00 00 00 00 00 00 00 24 40 00 00 00 00 00 00 14 40</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [26] 00 00 00 00 00 00 22 40 00 00 00 00 00 00 10 40 00 00 00 00 00 00 20 40 00</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [51] 00 00 00 00 00 08 40 00 00 00 00 00 00 1c 40 00 00 00 00 00 00 00 40 00 00</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [76] 00 00 00 00 18 40 00 00 00 00 00 00 f0 3f</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>Binary conversion is used to communicate geometries to external libraries (GDAL, GEOS, liblwgeom) and spatial databases because it is fast and lossless.</p></li>
<li><p>WKT and WKB can both be transformed back into R native objects by</p></li>
</ul>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_as_sfc</span>(<span class="st">"LINESTRING(10 5, 9 4, 8 3, 7 2, 6 1)"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; LINESTRING (10 5, 9 4, 8 3, 7 2, 6 1)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_as_sfc</span>(<span class="fu">structure</span>(<span class="fu">list</span>(<span class="fu">st_as_binary</span>(x)), <span class="at">class =</span> <span class="st">"WKB"</span>))[[<span class="dv">1</span>]]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; LINESTRING (10 5, 9 4, 8 3, 7 2, 6 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Conversion between R native objects and WKB is done by package <code>sf</code> in compiled (C++/Rcpp) code, making this a reusable and fast route for I/O of simple feature geometries in R.</li>
</ul>
</section>
<section id="how-simple-features-are-organized-in-r" class="level2">
<h2 class="anchored" data-anchor-id="how-simple-features-are-organized-in-r">How simple features are organized in R?</h2>
<ul>
<li><p>Simple Features is a standard that is implemented in R (not limited to R)</p></li>
<li><p>So far we have discusses simple features the <em>standard</em>, rather then simple features the <em>implementation</em></p></li>
<li><p>In R, simple features are implemented using standard data <em>structures</em> (S3 classes, lists, matrix, vector).</p></li>
<li><p>Attributes are stored in <code>data.frames</code> (or <code>tbl_df</code>)</p></li>
<li><p>Feature geometries are stored in a <code>data.frame</code> column.</p></li>
<li><p>Since geometries are not single-valued, they are put in a <code>list-column</code></p></li>
<li><p>This means each observation (element) is a list itself!</p></li>
</ul>
<p>. . .</p>
<p>Remember our nested lists?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]][[1]]</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1 2 3 4 5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="sfg-sfc-sf" class="level1">
<h1>sfg –&gt; sfc –&gt; sf</h1>
<section id="sf-sfc-sfg" class="level2">
<h2 class="anchored" data-anchor-id="sf-sfc-sfg">sf, sfc, sfg</h2>
<p>The three classes are used to represent simple feature obejcts are:</p>
<p><code>sf</code>: <code>data.frame</code> with feature attributes and geometries</p>
<p>. . .</p>
<p>which is contains an:<br>
</p>
<p><code>sfc</code>: the <code>list-column</code> with the geometries for each feature</p>
<p>. . .</p>
<p>which is composed of:<br>
</p>
<p><code>sfg</code>, individual simple feature geometries</p>
</section>
<section id="sf-sfc-sfg-1" class="level2">
<h2 class="anchored" data-anchor-id="sf-sfc-sfg-1">sf, sfc, sfg</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/10-sf-diagram.png" class="img-fluid figure-img" width="562"></p>
</figure>
</div>
</div>
</div>
<p>In the output we see:</p>
<ul>
<li><p>in green a simple feature: a single <strong>record</strong> (row, consisting of attributes and geometry</p></li>
<li><p>in blue a single simple feature <strong>geometry</strong> (an object of class <code>sfg</code>)</p></li>
<li><p>in red a simple feature list-column (an object of class <code>sfc</code>, which is a column in the <code>data.frame</code>)</p></li>
<li><p>Even though geometries are native R objects, they are printed as <strong>well-known text</strong></p></li>
</ul>
</section>
<section id="sfg-simple-feature-geometry-blue" class="level2">
<h2 class="anchored" data-anchor-id="sfg-simple-feature-geometry-blue"><code>sfg</code>: simple feature geometry (blue)</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/10-sf-diagram.png" class="img-fluid figure-img" width="562"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Simple feature geometry (<code>sfg</code>) objects carry the geometry for a single feature</p></li>
<li><p>Simple feature geometries are implemented as R native data, using the following rules</p>
<ol type="1">
<li><p>a single POINT is a numeric vector</p></li>
<li><p>a set of points (e.g.&nbsp;in a LINESTRING or ring of a POLYGON) is a <code>matrix</code>, each row containing a point</p></li>
<li><p>any other set is a <code>list</code></p></li>
</ol>
<ul>
<li>list of numeric matrices for <code>MULTILINESTRING</code> and <code>POLYGON</code></li>
<li>list of lists of numeric matrices for <code>MULTIPOLYGON</code></li>
<li>list of (typed) geometries for <code>GEOMETRYCOLLECTION</code></li>
</ul></li>
</ul>
</section>
<section id="sfg-simple-feature-geometry" class="level2">
<h2 class="anchored" data-anchor-id="sfg-simple-feature-geometry"><code>sfg</code>: simple feature geometry</h2>
<p>Creator functions are <strong>rarely</strong> used in practice, since we typically read existing spatial data. But, they are useful for illustration:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>(x <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (1 2)</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(x)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  'XY' num [1:2] 1 2</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>(x <span class="ot">&lt;-</span> <span class="fu">st_linestring</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="at">ncol=</span><span class="dv">2</span>)))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; LINESTRING (1 3, 2 4)</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(x)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  'XY' num [1:2, 1:2] 1 2 3 4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sfg-simple-feature-geometry-1" class="level2">
<h2 class="anchored" data-anchor-id="sfg-simple-feature-geometry-1"><code>sfg</code>: simple feature geometry</h2>
<p>All geometry objects have a S3 class indicating their (1) dimension, (2) type, and (3) superclass</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">pt =</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (0 1)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(pt)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $class</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "XY"    "POINT" "sfg"</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>(<span class="at">pt2 =</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">4</span>)))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT Z (0 1 4)</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(pt2)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $class</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "XYZ"   "POINT" "sfg"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sfg-simple-feature-geometry-2" class="level2">
<h2 class="anchored" data-anchor-id="sfg-simple-feature-geometry-2"><code>sfg</code>: simple feature geometry</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">m1 =</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>)))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2]</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]    8    1</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]    2    5</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]    3    2</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>(<span class="at">mp =</span> <span class="fu">st_multipoint</span>(m1))</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOINT ((8 1), (2 5), (3 2))</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(mp)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $dim</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3 2</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $class</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "XY"         "MULTIPOINT" "sfg"</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>(<span class="at">ls =</span> <span class="fu">st_linestring</span>(m1))</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; LINESTRING (8 1, 2 5, 3 2)</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(ls)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $dim</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3 2</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $class</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "XY"         "LINESTRING" "sfg"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sfg-simple-feature-geometry-3" class="level2">
<h2 class="anchored" data-anchor-id="sfg-simple-feature-geometry-3"><code>sfg</code>: simple feature geometry</h2>
<p>Although these geometries contain the same <code>points</code> (m1), they have entirely different meaning: the point set is a zero-dimensional, the line a one-dimensional geometry:</p>
<p>Here, dimensions is <em>not</em> the XY vs XYZ, but rather whether the geometry has length (1D) or area (2D) or greater…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_dimension</span>(mp)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">st_length</span>(mp)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">st_dimension</span>(ls)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">st_length</span>(ls)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 10.37338</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mixed-geometries" class="level2">
<h2 class="anchored" data-anchor-id="mixed-geometries">Mixed geometries</h2>
<p>Sets of simple features also consist of features with heterogeneous geometries. In this case, the geometry type of the set is <code>GEOMETRY</code>:</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">g =</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)), </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">st_linestring</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)))))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 2 features </span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: GEOMETRY</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 1</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (0 0)</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; LINESTRING (0 0, 1 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p>These set can be filtered by using <code>st_is</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">|&gt;</span> <span class="fu">st_is</span>(<span class="st">"LINESTRING"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE  TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or, when working with sf objects,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note need of %&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_sf</span>(g) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">st_is</span>(., <span class="st">"LINESTRING"</span>))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 1 feature and 0 fields</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 1</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                       g</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 LINESTRING (0 0, 1 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="geometrycollection" class="level2">
<h2 class="anchored" data-anchor-id="geometrycollection">GEOMETRYCOLLECTION</h2>
<ul>
<li><p>Single features (1 geometry per row) can have a single geometry, that consists of several geometries of different types.</p></li>
<li><p>Such cases arise rather naturally when looking for intersections. For instance, the intersection of two LINESTRING geometries may be the combination of a <code>LINESTRING</code> and a <code>POINT.</code></p></li>
<li><p>Putting this intersection into a single feature geometry needs a <code>GEOMETRYCOLLECTION</code></p></li>
</ul>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>ls <span class="ot">&lt;-</span> <span class="fu">st_linestring</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">ncol =</span> <span class="dv">2</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>poly1 <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">5.5</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="fl">5.5</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="dv">0</span>), <span class="at">ncol =</span> <span class="dv">2</span>)))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>poly2 <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">6.6</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="fl">6.6</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">2</span>)))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>multipoly <span class="ot">&lt;-</span> <span class="fu">st_multipolygon</span>(<span class="fu">list</span>(poly1, poly2))</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">st_sfc</span>(pt, ls, poly1, poly2, multipoly)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 5 features </span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: GEOMETRY</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: 1 ymin: -0.5 xmax: 8 ymax: 1.5</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (1 0)</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; LINESTRING (4 0, 3 0)</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POLYGON ((5.5 0, 7 0, 7 -0.5, 6 -0.5, 5.5 0))</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POLYGON ((6.6 1, 8 1, 8 1.5, 7 1.5, 6.6 1))</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOLYGON (((5.5 0, 7 0, 7 -0.5, 6 -0.5, 5.5...</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>(j <span class="ot">&lt;-</span> <span class="fu">st_geometrycollection</span>(<span class="fu">list</span>(pt, ls, poly1, poly2, multipoly)))</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; GEOMETRYCOLLECTION (POINT (1 0), LINESTRING (4 0, 3 0), POLYGON ((5.5 0, 7 0, 7 -0.5, 6 -0.5, 5.5 0)), POLYGON ((6.6 1, 8 1, 8 1.5, 7 1.5, 6.6 1)), MULTIPOLYGON (((5.5 0, 7 0, 7 -0.5, 6 -0.5, 5.5 0)), ((6.6 1, 8 1, 8 1.5, 7 1.5, 6.6 1))))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="geometrycollection-1" class="level2">
<h2 class="anchored" data-anchor-id="geometrycollection-1">GEOMETRYCOLLECTION</h2>
<ul>
<li>In case we end up with <code>GEOMETRYCOLLECTION</code> objects, the next question is often what to do with them. One thing we can do is extract elements from them:</li>
</ul>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_collection_extract</span>(j, <span class="st">"POLYGON"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 3 features </span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: 5.5 ymin: -0.5 xmax: 8 ymax: 1.5</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOLYGON (((5.5 0, 7 0, 7 -0.5, 6 -0.5, 5.5...</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOLYGON (((6.6 1, 8 1, 8 1.5, 7 1.5, 6.6 1)))</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOLYGON (((5.5 0, 7 0, 7 -0.5, 6 -0.5, 5.5...</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="fu">st_collection_extract</span>(j, <span class="st">"POINT"</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (1 0)</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="fu">st_collection_extract</span>(j, <span class="st">"LINESTRING"</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; LINESTRING (4 0, 3 0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conversion-between-types" class="level2">
<h2 class="anchored" data-anchor-id="conversion-between-types">Conversion between types</h2>
<p>We can convert simple feature geometries using the <code>st_cast</code> generic (up to the extent that a conversion is feasible):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">methods</span>(st_cast)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] st_cast.CIRCULARSTRING*     st_cast.COMPOUNDCURVE*     </span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [3] st_cast.CURVE*              st_cast.GEOMETRYCOLLECTION*</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5] st_cast.LINESTRING*         st_cast.MULTICURVE*        </span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [7] st_cast.MULTILINESTRING*    st_cast.MULTIPOINT*        </span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9] st_cast.MULTIPOLYGON*       st_cast.MULTISURFACE*      </span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [11] st_cast.POINT*              st_cast.POLYGON*           </span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13] st_cast.sf*                 st_cast.sfc*               </span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [15] st_cast.sfc_CIRCULARSTRING*</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; see '?methods' for accessing help and source code</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conversion-between-types-1" class="level2">
<h2 class="anchored" data-anchor-id="conversion-between-types-1">Conversion between types</h2>
<p>Lets take the Larimer County in our Colorado sf object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">co1 =</span> <span class="fu">filter</span>(co, name <span class="sc">==</span> <span class="st">"Larimer"</span>)<span class="sc">$</span>geometry)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 1 feature </span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -106.1954 ymin: 40.25778 xmax: -104.9431 ymax: 40.99844</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOLYGON (((-105.6533 40.26046, -105.6094 4...</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>(<span class="at">co_ls =</span> <span class="fu">st_cast</span>(co1, <span class="st">"MULTILINESTRING"</span>))</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 1 feature </span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTILINESTRING</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -106.1954 ymin: 40.25778 xmax: -104.9431 ymax: 40.99844</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTILINESTRING ((-105.6533 40.26046, -105.6094...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-2_files/figure-revealjs/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="conversion-between-types-2" class="level2">
<h2 class="anchored" data-anchor-id="conversion-between-types-2">Conversion between types</h2>
<p>It is often convenient to analyze the the points that make up a <code>LINESTRING</code> However …</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_linestring</span>() <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POINT"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in st_cast.LINESTRING(st_linestring(rbind(c(0, 0), c(1, 1), c(1, :</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; point from first coordinate only</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (0 0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>does not do what we expect, because it will convert a <strong>single</strong> geometry into a new <strong>single</strong> geometry (one line to one point)</p>
<p>. . .</p>
<p>Instead, we must recognize that a collection of points is what defines a <code>LINSETRING</code> and a collection of <code>POINT</code>s, operating as a single unit, is a <code>MULTIPOINT</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_linestring</span>() <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTIPOINT"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOINT ((0 0), (1 1), (1 0), (0 1))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>If we really wanted the individual <code>POINT</code> geometries, we need to work with sets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">st_linestring</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">st_sfc</span>() <span class="sc">|&gt;</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">st_cast</span>(<span class="st">"POINT"</span>))</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 4 features </span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 1</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (0 0)</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (1 1)</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (1 0)</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (0 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sfc-sets-of-geometries" class="level2">
<h2 class="anchored" data-anchor-id="sfc-sets-of-geometries"><code>sfc</code>: sets of geometries</h2>
<ul>
<li><p><code>sf</code> provides a dedicated class for handeling geometry sets, called <code>sfc</code> (simple feature geometry list column).</p></li>
<li><p>We can create such a list column with constructor function <code>st_sfc</code>:</p></li>
</ul>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">sfc =</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)), <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">2</span>))))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 2 features </span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -3 ymin: 1 xmax: 0 ymax: 2</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (0 1)</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (-3 2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>The default report from the print method for sfc gives</p>
<ul>
<li>the number of features geometries</li>
<li>the feature geometry type (here: POINT)</li>
<li>the feature geometry dimension (here: XY)</li>
<li>the bounding box for the set</li>
<li>the coordinate reference system for the set (epsg and proj4string)</li>
<li>the first few geometries, as (abbreviated) WKT</li>
</ul>
<p>. . .</p>
<p>The class of the geometry <code>list-column</code> is a combination of a specific class, and a superclass.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sfc)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "sfc_POINT" "sfc"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>In addition to a class, the <code>sfc</code> object has further attributes (remember S3 class!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(sfc) <span class="sc">|&gt;</span> <span class="fu">names</span>()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "class"     "precision" "bbox"      "crs"       "n_empty"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>which are used to record for the whole set:</p>
<ul>
<li>a precision value</li>
<li>the bounding box enclosing all geometries (for x and y)</li>
<li>a coordinate reference system</li>
<li>the number of empty geometries contained in the set</li>
</ul>
<hr>
<p>This means that all these properties are defined for the set (sfc), and not for geometries (sfg) individually.</p>
<p><code>sfc</code> objects are lists with each entry being an sfg object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>p[[<span class="dv">2</span>]]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (1 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and we will use these lists as <em>list columns</em> in <code>data.frame</code> or <code>tibble</code> objects to represent simple features with geometries in a list column.</p>
</section>
<section id="sets-of-geometries-arise-when-we-separate-compound-geometries" class="level2">
<h2 class="anchored" data-anchor-id="sets-of-geometries-arise-when-we-separate-compound-geometries">Sets of geometries arise when we separate compound geometries:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;      [,1] [,2]
#&gt; [1,]    0    0
#&gt; [2,]    1    1
#&gt; [3,]    1    0
#&gt; [4,]    0    1</code></pre>
</div>
</div>
</div>
</section>
<section id="sets-of-geometries-arise-when-we-separate-compound-geometries-1" class="level2">
<h2 class="anchored" data-anchor-id="sets-of-geometries-arise-when-we-separate-compound-geometries-1">Sets of geometries arise when we separate compound geometries:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">st_linestring</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; LINESTRING (0 0, 1 1, 1 0, 0 1)</code></pre>
</div>
</div>
</div>
</section>
<section id="sets-of-geometries-arise-when-we-separate-compound-geometries-2" class="level2">
<h2 class="anchored" data-anchor-id="sets-of-geometries-arise-when-we-separate-compound-geometries-2">Sets of geometries arise when we separate compound geometries:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">st_linestring</span>() <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">st_sfc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Geometry set for 1 feature 
#&gt; Geometry type: LINESTRING
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 1
#&gt; CRS:           NA
#&gt; LINESTRING (0 0, 1 1, 1 0, 0 1)</code></pre>
</div>
</div>
</div>
</section>
<section id="sets-of-geometries-arise-when-we-separate-compound-geometries-3" class="level2">
<h2 class="anchored" data-anchor-id="sets-of-geometries-arise-when-we-separate-compound-geometries-3">Sets of geometries arise when we separate compound geometries:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">st_linestring</span>() <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">st_sfc</span>() <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">st_cast</span>(<span class="st">"POINT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Geometry set for 4 features 
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 1
#&gt; CRS:           NA
#&gt; POINT (0 0)
#&gt; POINT (1 1)
#&gt; POINT (1 0)
#&gt; POINT (0 1)</code></pre>
</div>
</div>
</div>
</section>
<section id="sets-of-geometries-arise-when-we-separate-compound-geometries-4" class="level2">
<h2 class="anchored" data-anchor-id="sets-of-geometries-arise-when-we-separate-compound-geometries-4">Sets of geometries arise when we separate compound geometries:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">st_linestring</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">st_sfc</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">st_cast</span>(<span class="st">"POINT"</span>) <span class="ot">-&gt;</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">

</div>
</div>
<ul>
<li><p>On the last slide, <code>st_sfc</code> creates a set of <em>one</em> <code>LINESTRING</code> (p), with a size of 4.</p></li>
<li><p>Going the other way around (from set to feature), we need to <em>combine</em> geometries:</p></li>
</ul>
<p>. . .</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 4 features </span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 1</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (0 0)</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (1 1)</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (1 0)</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POINT (0 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_combine</span>(p)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 1 feature </span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOINT</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 1</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOINT ((0 0), (1 1), (1 0), (0 1))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="casting-must-be-done-the-level-of-the-feature" class="level2">
<h2 class="anchored" data-anchor-id="casting-must-be-done-the-level-of-the-feature">Casting must be done the level of the feature</h2>
<p>If we want to go from the 4 feature (p) object to a 1 feature LINESTRING, we must combine before casting …</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_combine</span>(p) <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 1 feature </span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 1</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; LINESTRING (0 0, 1 1, 1 0, 0 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="disolving-geometries" class="level1">
<h1>Disolving Geometries</h1>
<p>Combining geometries <strong>preserves</strong> their interior boundaries, unioning <strong>resolves/dissolves</strong> the internal boundaries:</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">co_geom =</span> co<span class="sc">$</span>geometry)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 64 features </span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; First 5 geometries:</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOLYGON (((-105.0532 39.79106, -104.976 39...</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOLYGON (((-105.4855 37.5779, -105.4859 37...</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOLYGON (((-103.7065 39.73989, -103.7239 3...</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOLYGON (((-107.1287 37.42294, -107.2803 3...</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOLYGON (((-102.0416 37.64428, -102.0558 3...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(co_geom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-2_files/figure-revealjs/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<section id="section-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="section-1"></h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">co_c =</span> <span class="fu">st_combine</span>(co_geom))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 1 feature </span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOLYGON (((-105.0532 39.79106, -104.976 39...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-2_files/figure-revealjs/unnamed-chunk-42-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">co_u =</span> <span class="fu">st_union</span>(co_geom))</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 1 feature </span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; POLYGON ((-105.155 36.99526, -105.1208 36.99543...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-2_files/figure-revealjs/unnamed-chunk-44-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">co_c_ml =</span> <span class="fu">st_combine</span>(co_geom) <span class="sc">|&gt;</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>))</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 1 feature </span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTILINESTRING</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTILINESTRING ((-105.0532 39.79106, -104.976 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-2_files/figure-revealjs/unnamed-chunk-46-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">co_u_ml =</span> <span class="fu">st_union</span>(co_geom)  <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 1 feature </span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTILINESTRING</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTILINESTRING ((-105.155 36.99526, -105.1208 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-2_files/figure-revealjs/unnamed-chunk-48-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="feature-resoloved-and-combined" class="level2">
<h2 class="anchored" data-anchor-id="feature-resoloved-and-combined">1 feature: resoloved and combined:</h2>
<ul>
<li><code>st_cast</code> / <code>st_union</code> work on <code>sfg</code>, <code>sfc</code>, and <code>sf</code> objects:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>conus <span class="ot">&lt;-</span> AOI<span class="sc">::</span><span class="fu">aoi_get</span>(<span class="at">state =</span> <span class="st">"conus"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>us_c_ml <span class="ot">=</span> <span class="fu">st_combine</span>(conus) <span class="sc">|&gt;</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>us_u_ml <span class="ot">=</span> <span class="fu">st_union</span>(conus) <span class="sc">|&gt;</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-2_files/figure-revealjs/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="so-what" class="level2">
<h2 class="anchored" data-anchor-id="so-what">So what?</h2>
<p>Lets imagine we want to know the distance from Denver to the nearest state border:</p>
<p>To do this, we need to:<br>
</p>
<p>1: define Denver as a geometry in a CRS<br>
2: determine the correct geometry types / representation<br>
3: calculate the distance between (1) and (2)<br>
</p>
</section>
<section id="make-denver-in-the-crs-of-our-states" class="level2">
<h2 class="anchored" data-anchor-id="make-denver-in-the-crs-of-our-states">1. Make “Denver” in the CRS of our states</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>denver_sf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fl">39.7392</span>, </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">x =</span> <span class="sc">-</span><span class="fl">104.9903</span>, </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">"Denver"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="determine-the-3-closest-states" class="level2">
<h2 class="anchored" data-anchor-id="determine-the-3-closest-states">2. Determine the 3 closest states:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>conus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 14 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.8485 ymin: 24.39631 xmax: -66.88544 ymax: 49.38448
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    state_region state_division feature_code           state_name state_abbr
#&gt; 1             3              6      1779775              Alabama         AL
#&gt; 2             4              8      1779777              Arizona         AZ
#&gt; 3             3              7      0068085             Arkansas         AR
#&gt; 4             4              9      1779778           California         CA
#&gt; 5             4              8      1779779             Colorado         CO
#&gt; 6             1              1      1779780          Connecticut         CT
#&gt; 7             3              5      1779781             Delaware         DE
#&gt; 8             3              5      1702382 District of Columbia         DC
#&gt; 9             3              5      0294478              Florida         FL
#&gt; 10            3              5      1705317              Georgia         GA
#&gt;                    name fip_class tiger_class combined_area_code
#&gt; 1               Alabama      &lt;NA&gt;       G4000                 NA
#&gt; 2               Arizona      &lt;NA&gt;       G4000                 NA
#&gt; 3              Arkansas      &lt;NA&gt;       G4000                 NA
#&gt; 4            California      &lt;NA&gt;       G4000                 NA
#&gt; 5              Colorado      &lt;NA&gt;       G4000                 NA
#&gt; 6           Connecticut      &lt;NA&gt;       G4000                 NA
#&gt; 7              Delaware      &lt;NA&gt;       G4000                 NA
#&gt; 8  District of Columbia      &lt;NA&gt;       G4000                 NA
#&gt; 9               Florida      &lt;NA&gt;       G4000                 NA
#&gt; 10              Georgia      &lt;NA&gt;       G4000                 NA
#&gt;    metropolitan_area_code functional_status    land_area  water_area fip_code
#&gt; 1                    &lt;NA&gt;                 A 131175477769  4591897964       01
#&gt; 2                    &lt;NA&gt;                 A 294363973043   855871553       04
#&gt; 3                    &lt;NA&gt;                 A 134660767709  3121950081       05
#&gt; 4                    &lt;NA&gt;                 A 403671756816 20293573058       06
#&gt; 5                    &lt;NA&gt;                 A 268418796417  1185716938       08
#&gt; 6                    &lt;NA&gt;                 A  12541690473  1816424193       09
#&gt; 7                    &lt;NA&gt;                 A   5046731559  1399179670       10
#&gt; 8                    &lt;NA&gt;                 A    158316124    18709762       11
#&gt; 9                    &lt;NA&gt;                 A 138961722096 45972570361       12
#&gt; 10                   &lt;NA&gt;                 A 149486624386  4418360134       13
#&gt;                          geometry
#&gt; 1  MULTIPOLYGON (((-85.4883 30...
#&gt; 2  MULTIPOLYGON (((-110.7507 3...
#&gt; 3  MULTIPOLYGON (((-90.95577 3...
#&gt; 4  MULTIPOLYGON (((-116.1062 3...
#&gt; 5  MULTIPOLYGON (((-105.155 36...
#&gt; 6  MULTIPOLYGON (((-72.5279 41...
#&gt; 7  MULTIPOLYGON (((-75.13846 3...
#&gt; 8  MULTIPOLYGON (((-77.00244 3...
#&gt; 9  MULTIPOLYGON (((-83.10874 2...
#&gt; 10 MULTIPOLYGON (((-81.09538 3...</code></pre>
</div>
</div>
</div>
</section>
<section id="determine-the-3-closest-states-1" class="level2">
<h2 class="anchored" data-anchor-id="determine-the-3-closest-states-1">2. Determine the 3 closest states:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>conus <span class="sc">|&gt;</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 1 field
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.8485 ymin: 24.39631 xmax: -66.88544 ymax: 49.38448
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;              state_name                       geometry
#&gt; 1               Alabama MULTIPOLYGON (((-85.4883 30...
#&gt; 2               Arizona MULTIPOLYGON (((-110.7507 3...
#&gt; 3              Arkansas MULTIPOLYGON (((-90.95577 3...
#&gt; 4            California MULTIPOLYGON (((-116.1062 3...
#&gt; 5              Colorado MULTIPOLYGON (((-105.155 36...
#&gt; 6           Connecticut MULTIPOLYGON (((-72.5279 41...
#&gt; 7              Delaware MULTIPOLYGON (((-75.13846 3...
#&gt; 8  District of Columbia MULTIPOLYGON (((-77.00244 3...
#&gt; 9               Florida MULTIPOLYGON (((-83.10874 2...
#&gt; 10              Georgia MULTIPOLYGON (((-81.09538 3...</code></pre>
</div>
</div>
</div>
</section>
<section id="determine-the-3-closest-states-2" class="level2">
<h2 class="anchored" data-anchor-id="determine-the-3-closest-states-2">2. Determine the 3 closest states:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>conus <span class="sc">|&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state_name) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">st_distance</span>(., denver_sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 2 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.8485 ymin: 24.39631 xmax: -66.88544 ymax: 49.38448
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;              state_name                       geometry          dist
#&gt; 1               Alabama MULTIPOLYGON (((-85.4883 30... 1571007.9 [m]
#&gt; 2               Arizona MULTIPOLYGON (((-110.7507 3...  466602.9 [m]
#&gt; 3              Arkansas MULTIPOLYGON (((-90.95577 3...  975519.6 [m]
#&gt; 4            California MULTIPOLYGON (((-116.1062 3... 1000950.5 [m]
#&gt; 5              Colorado MULTIPOLYGON (((-105.155 36...       0.0 [m]
#&gt; 6           Connecticut MULTIPOLYGON (((-72.5279 41... 2636635.7 [m]
#&gt; 7              Delaware MULTIPOLYGON (((-75.13846 3... 2485997.1 [m]
#&gt; 8  District of Columbia MULTIPOLYGON (((-77.00244 3... 2388920.9 [m]
#&gt; 9               Florida MULTIPOLYGON (((-83.10874 2... 1847447.4 [m]
#&gt; 10              Georgia MULTIPOLYGON (((-81.09538 3... 1788781.6 [m]</code></pre>
</div>
</div>
</div>
</section>
<section id="determine-the-3-closest-states-3" class="level2">
<h2 class="anchored" data-anchor-id="determine-the-3-closest-states-3">2. Determine the 3 closest states:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>conus <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state_name) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">st_distance</span>(., denver_sf)) <span class="sc">|&gt;</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(dist, <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 3 features and 2 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -111.0546 ymin: 36.99246 xmax: -95.30829 ymax: 45.00582
#&gt; Geodetic CRS:  WGS 84
#&gt;   state_name         dist                       geometry
#&gt; 1   Colorado      0.0 [m] MULTIPOLYGON (((-105.155 36...
#&gt; 2    Wyoming 140002.6 [m] MULTIPOLYGON (((-106.3212 4...
#&gt; 3   Nebraska 161243.2 [m] MULTIPOLYGON (((-95.93779 4...</code></pre>
</div>
</div>
</div>
<ul>
<li>That’s close, but the distance to Colorado is 0, that’s not a state border.</li>
</ul>
</section>
<section id="geometry-selection" class="level2">
<h2 class="anchored" data-anchor-id="geometry-selection">Geometry Selection</h2>
<ul>
<li><code>Polygon</code> (therefore MULTIPOLGYGONS) describe areas!</li>
<li>The distance to a <code>point</code> <strong>in</strong> a <code>polygon</code> to that polygon is 0.</li>
</ul>
</section>
<section id="to-determine-distance-to-border-we-need-a-linear-representation" class="level2">
<h2 class="anchored" data-anchor-id="to-determine-distance-to-border-we-need-a-linear-representation">To determine distance to border we need a linear representation:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>conus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 14 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.8485 ymin: 24.39631 xmax: -66.88544 ymax: 49.38448
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    state_region state_division feature_code           state_name state_abbr
#&gt; 1             3              6      1779775              Alabama         AL
#&gt; 2             4              8      1779777              Arizona         AZ
#&gt; 3             3              7      0068085             Arkansas         AR
#&gt; 4             4              9      1779778           California         CA
#&gt; 5             4              8      1779779             Colorado         CO
#&gt; 6             1              1      1779780          Connecticut         CT
#&gt; 7             3              5      1779781             Delaware         DE
#&gt; 8             3              5      1702382 District of Columbia         DC
#&gt; 9             3              5      0294478              Florida         FL
#&gt; 10            3              5      1705317              Georgia         GA
#&gt;                    name fip_class tiger_class combined_area_code
#&gt; 1               Alabama      &lt;NA&gt;       G4000                 NA
#&gt; 2               Arizona      &lt;NA&gt;       G4000                 NA
#&gt; 3              Arkansas      &lt;NA&gt;       G4000                 NA
#&gt; 4            California      &lt;NA&gt;       G4000                 NA
#&gt; 5              Colorado      &lt;NA&gt;       G4000                 NA
#&gt; 6           Connecticut      &lt;NA&gt;       G4000                 NA
#&gt; 7              Delaware      &lt;NA&gt;       G4000                 NA
#&gt; 8  District of Columbia      &lt;NA&gt;       G4000                 NA
#&gt; 9               Florida      &lt;NA&gt;       G4000                 NA
#&gt; 10              Georgia      &lt;NA&gt;       G4000                 NA
#&gt;    metropolitan_area_code functional_status    land_area  water_area fip_code
#&gt; 1                    &lt;NA&gt;                 A 131175477769  4591897964       01
#&gt; 2                    &lt;NA&gt;                 A 294363973043   855871553       04
#&gt; 3                    &lt;NA&gt;                 A 134660767709  3121950081       05
#&gt; 4                    &lt;NA&gt;                 A 403671756816 20293573058       06
#&gt; 5                    &lt;NA&gt;                 A 268418796417  1185716938       08
#&gt; 6                    &lt;NA&gt;                 A  12541690473  1816424193       09
#&gt; 7                    &lt;NA&gt;                 A   5046731559  1399179670       10
#&gt; 8                    &lt;NA&gt;                 A    158316124    18709762       11
#&gt; 9                    &lt;NA&gt;                 A 138961722096 45972570361       12
#&gt; 10                   &lt;NA&gt;                 A 149486624386  4418360134       13
#&gt;                          geometry
#&gt; 1  MULTIPOLYGON (((-85.4883 30...
#&gt; 2  MULTIPOLYGON (((-110.7507 3...
#&gt; 3  MULTIPOLYGON (((-90.95577 3...
#&gt; 4  MULTIPOLYGON (((-116.1062 3...
#&gt; 5  MULTIPOLYGON (((-105.155 36...
#&gt; 6  MULTIPOLYGON (((-72.5279 41...
#&gt; 7  MULTIPOLYGON (((-75.13846 3...
#&gt; 8  MULTIPOLYGON (((-77.00244 3...
#&gt; 9  MULTIPOLYGON (((-83.10874 2...
#&gt; 10 MULTIPOLYGON (((-81.09538 3...</code></pre>
</div>
</div>
</div>
</section>
<section id="to-determine-distance-to-border-we-need-a-linear-representation-1" class="level2">
<h2 class="anchored" data-anchor-id="to-determine-distance-to-border-we-need-a-linear-representation-1">To determine distance to border we need a linear representation:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>conus <span class="sc">|&gt;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 1 field
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.8485 ymin: 24.39631 xmax: -66.88544 ymax: 49.38448
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;              state_name                       geometry
#&gt; 1               Alabama MULTIPOLYGON (((-85.4883 30...
#&gt; 2               Arizona MULTIPOLYGON (((-110.7507 3...
#&gt; 3              Arkansas MULTIPOLYGON (((-90.95577 3...
#&gt; 4            California MULTIPOLYGON (((-116.1062 3...
#&gt; 5              Colorado MULTIPOLYGON (((-105.155 36...
#&gt; 6           Connecticut MULTIPOLYGON (((-72.5279 41...
#&gt; 7              Delaware MULTIPOLYGON (((-75.13846 3...
#&gt; 8  District of Columbia MULTIPOLYGON (((-77.00244 3...
#&gt; 9               Florida MULTIPOLYGON (((-83.10874 2...
#&gt; 10              Georgia MULTIPOLYGON (((-81.09538 3...</code></pre>
</div>
</div>
</div>
</section>
<section id="to-determine-distance-to-border-we-need-a-linear-representation-2" class="level2">
<h2 class="anchored" data-anchor-id="to-determine-distance-to-border-we-need-a-linear-representation-2">To determine distance to border we need a linear representation:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>conus <span class="sc">|&gt;</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state_name) <span class="sc">|&gt;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 1 field
#&gt; Geometry type: MULTILINESTRING
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.8485 ymin: 24.39631 xmax: -66.88544 ymax: 49.38448
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;              state_name                       geometry
#&gt; 1               Alabama MULTILINESTRING ((-85.4883 ...
#&gt; 2               Arizona MULTILINESTRING ((-110.7507...
#&gt; 3              Arkansas MULTILINESTRING ((-90.95577...
#&gt; 4            California MULTILINESTRING ((-116.1062...
#&gt; 5              Colorado MULTILINESTRING ((-105.155 ...
#&gt; 6           Connecticut MULTILINESTRING ((-72.5279 ...
#&gt; 7              Delaware MULTILINESTRING ((-75.13846...
#&gt; 8  District of Columbia MULTILINESTRING ((-77.00244...
#&gt; 9               Florida MULTILINESTRING ((-83.10874...
#&gt; 10              Georgia MULTILINESTRING ((-81.09538...</code></pre>
</div>
</div>
</div>
</section>
<section id="to-determine-distance-to-border-we-need-a-linear-representation-3" class="level2">
<h2 class="anchored" data-anchor-id="to-determine-distance-to-border-we-need-a-linear-representation-3">To determine distance to border we need a linear representation:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>conus <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state_name) <span class="sc">|&gt;</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">st_distance</span>(., denver_sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 2 fields
#&gt; Geometry type: MULTILINESTRING
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.8485 ymin: 24.39631 xmax: -66.88544 ymax: 49.38448
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;              state_name                       geometry          dist
#&gt; 1               Alabama MULTILINESTRING ((-85.4883 ... 1571007.9 [m]
#&gt; 2               Arizona MULTILINESTRING ((-110.7507...  466602.9 [m]
#&gt; 3              Arkansas MULTILINESTRING ((-90.95577...  975519.6 [m]
#&gt; 4            California MULTILINESTRING ((-116.1062... 1000950.5 [m]
#&gt; 5              Colorado MULTILINESTRING ((-105.155 ...  140002.6 [m]
#&gt; 6           Connecticut MULTILINESTRING ((-72.5279 ... 2636635.7 [m]
#&gt; 7              Delaware MULTILINESTRING ((-75.13846... 2485997.1 [m]
#&gt; 8  District of Columbia MULTILINESTRING ((-77.00244... 2388920.9 [m]
#&gt; 9               Florida MULTILINESTRING ((-83.10874... 1847447.4 [m]
#&gt; 10              Georgia MULTILINESTRING ((-81.09538... 1788781.6 [m]</code></pre>
</div>
</div>
</div>
</section>
<section id="to-determine-distance-to-border-we-need-a-linear-representation-4" class="level2">
<h2 class="anchored" data-anchor-id="to-determine-distance-to-border-we-need-a-linear-representation-4">To determine distance to border we need a linear representation:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>conus <span class="sc">|&gt;</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state_name) <span class="sc">|&gt;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">st_distance</span>(., denver_sf)) <span class="sc">|&gt;</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(dist, <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 3 features and 2 fields
#&gt; Geometry type: MULTILINESTRING
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -111.0546 ymin: 36.99246 xmax: -95.30829 ymax: 45.00582
#&gt; Geodetic CRS:  WGS 84
#&gt;   state_name         dist                       geometry
#&gt; 1   Colorado 140002.6 [m] MULTILINESTRING ((-105.155 ...
#&gt; 2    Wyoming 140002.6 [m] MULTILINESTRING ((-106.3212...
#&gt; 3   Nebraska 161243.2 [m] MULTILINESTRING ((-95.93779...</code></pre>
</div>
</div>
</div>
<ul>
<li><p>Good. However, we were only interested in the distance to the closest border not to ALL boarders. Therefore we calculated 48 (49 - 1) more distances then needed!</p></li>
<li><p>While this is not to complex for 1 &lt;-&gt; 49 features imagine we had 28,000+ (like your lab)!</p></li>
<li><p>That would result in 1,344,000 more calculations then needed …</p></li>
</ul>
</section>
<section id="revisting-the-idea-of-the-feature-level" class="level2">
<h2 class="anchored" data-anchor-id="revisting-the-idea-of-the-feature-level">Revisting the idea of the feature level:</h2>
<ul>
<li><p>A “feature” can “be part of the whole” or the whole</p>
<ul>
<li><p>A island (POLYGON), or a set of islands acting as 1 unit (MULTIPOLYGON)</p></li>
<li><p>A city (POINT), or a set of cities meeting a condition (MULTIPOINT)</p></li>
<li><p>A road (LINESTRING), or a route (MULTILINESTRING)</p></li>
</ul></li>
<li><p>Since we want the distance to the nearest border, <em>regardless</em> of the state. Our <strong>feature</strong> is the <em>set of borders with preserved boundaries</em>.</p></li>
<li><p>In other words, a 1 feature <code>MULTILINESTRING</code></p></li>
</ul>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(denver_sf, <span class="fu">st_cast</span>(<span class="fu">st_combine</span>(conus), <span class="st">"MULTILINESTRING"</span>))</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Units: [m]</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          [,1]</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,] 140002.6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The same principle would apply if the question was “<em>distance to national border</em>”</li>
</ul>
</section>
<section id="sf-objects-with-simple-features" class="level2">
<h2 class="anchored" data-anchor-id="sf-objects-with-simple-features"><code>sf</code>: objects with simple features</h2>
<p>Simple features <code>geometries</code> and feature <code>attributes</code> are put together in <code>sf</code> (simple feature) objects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>co</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 64 features and 4 fields</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; First 10 features:</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    geoid       name      aland state_nm                       geometry</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  08001      Adams 3021840487 Colorado MULTIPOLYGON (((-105.0532 3...</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  08003    Alamosa 1871643028 Colorado MULTIPOLYGON (((-105.4855 3...</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  08005   Arapahoe 2066438714 Colorado MULTIPOLYGON (((-103.7065 3...</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  08007  Archuleta 3496712164 Colorado MULTIPOLYGON (((-107.1287 3...</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  08009       Baca 6617400567 Colorado MULTIPOLYGON (((-102.0416 3...</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  08011       Bent 3918255148 Colorado MULTIPOLYGON (((-102.7476 3...</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7  08013    Boulder 1881325109 Colorado MULTIPOLYGON (((-105.3978 3...</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8  08014 Broomfield   85386685 Colorado MULTIPOLYGON (((-105.1092 3...</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9  08015    Chaffee 2624715692 Colorado MULTIPOLYGON (((-105.9698 3...</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 08017   Cheyenne 4605713960 Colorado MULTIPOLYGON (((-103.1729 3...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This <code>sf</code> object is of class</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(co)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "sf"         "data.frame"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>meaning it extends <code>data.frame</code>, but with a single list-column with geometries, which is held in the column named:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(co, <span class="st">"sf_column"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "geometry"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-stickness-of-sfc-column" class="level2">
<h2 class="anchored" data-anchor-id="the-stickness-of-sfc-column">The stickness of <code>sfc</code> column</h2>
<ul>
<li>Geometry columns are “sticky” meaning they persist through data manipulation:</li>
</ul>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>co <span class="sc">|&gt;</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 2 features and 1 field</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -106.0393 ymin: 37.3562 xmax: -103.7057 ymax: 40.00137</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      name                       geometry</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   Adams MULTIPOLYGON (((-105.0532 3...</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Alamosa MULTIPOLYGON (((-105.4855 3...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Dropping the geometry column requires dropping the geometry via <code>sf</code>:</li>
</ul>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>co <span class="sc">|&gt;</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      name</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   Adams</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Alamosa</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Or cohersing the <code>sf</code> object to a <code>data.frame</code>:</li>
</ul>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>co <span class="sc">|&gt;</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      name</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   Adams</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Alamosa</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-stickness-of-sfc-column-1" class="level2">
<h2 class="anchored" data-anchor-id="the-stickness-of-sfc-column-1">The stickness of <code>sfc</code> column</h2>
<ul>
<li>A simple features object (sf) is the connection of a <code>sfc</code> list-column and <code>data.frame</code> of attributes</li>
</ul>
<div class="cell" data-layout-align="center" data-out.wisth="75%">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/11-sticky-geom.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="529"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>This binding is unique compared to other column bindings built with things like
<ul>
<li><code>dplyr::bind_cols()</code></li>
<li><code>cbind()</code></li>
<li><code>do.call(cbind, list())</code></li>
</ul></li>
</ul>
</section>
</section>
<section id="coordinate-systems" class="level1">
<h1>Coordinate Systems</h1>
<section id="what-makes-spatial-data-spatial" class="level2">
<h2 class="anchored" data-anchor-id="what-makes-spatial-data-spatial">What makes spatial data <em>spatial</em>?</h2>
<ul>
<li>What makes a feature geometry <em>spatial</em> is the reference system…</li>
</ul>
<div class="cell" data-layout-align="center" data-out.wisth="75%">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/09-sf-model.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="350"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="coordinate-systems-1" class="level2">
<h2 class="anchored" data-anchor-id="coordinate-systems-1">Coordinate Systems</h2>
<ul>
<li><p>Coordinate Reference Systems (CRS) defines how spatial features relate to the surface of the Earth.</p></li>
<li><p>CRSs are either geographic or projected…</p></li>
<li><p>CRSs are measurement units for coordinates:</p></li>
</ul>
</section>
<section id="sf-tools" class="level2">
<h2 class="anchored" data-anchor-id="sf-tools"><code>sf</code> tools</h2>
<p>In <code>sf</code> we have <em>three</em> tools for exploring, define, and changing CRS systems:</p>
<ul>
<li><p><em>st_crs</em> : Retrieve coordinate reference system from sf or sfc object</p></li>
<li><p><em>st_set_crs</em> : Set or replace coordinate reference system from object</p></li>
<li><p><em>st_transform</em> : Transform or convert coordinates of simple feature</p></li>
<li><p>Again, “st” (like PostGIS) denotes it is an operation that can work on a ” <em>s</em> patial <em>t</em> ype”</p></li>
</ul>
</section>
<section id="geographic-coordinate-systms-gcs" class="level2">
<h2 class="anchored" data-anchor-id="geographic-coordinate-systms-gcs">Geographic Coordinate Systms (GCS)</h2>
<ul>
<li><p>A GCS identifies locations on the <em>curved</em> surface of the earth.</p></li>
<li><p>Locations are measured in <strong>angular</strong> units from the center of the earth relative to the plane defined by the equator and the plane defined by the prime meridian.</p></li>
<li><p>The vertical angle describes the <em>latitude</em> and the horizontal angle the <em>longitude</em></p></li>
<li><p>In most coordinate systems, the North-South and East-West directions are encoded as +/-.</p></li>
<li><p>North and East are positive (<code>+</code>) and South and West are negative (<code>-</code>) sign.</p></li>
<li><p>A GCS is defined by 3 components:</p>
<ul>
<li><p>an <strong>ellipsoid</strong></p></li>
<li><p>a <strong>geoid</strong></p></li>
<li><p>a <strong>datum</strong></p></li>
</ul></li>
</ul>
</section>
<section id="sphere-and-ellipsoid" class="level2">
<h2 class="anchored" data-anchor-id="sphere-and-ellipsoid">Sphere and Ellipsoid</h2>
<ul>
<li><p>Assuming that the earth is a perfect sphere simplifies calculations and works for small-scale maps (maps that show a <em>large</em> area of the earth).</p></li>
<li><p>But … the earth is not a sphere do to its rotation inducing a centripetal force along the equator.</p></li>
<li><p>This results in an equatorial axis that is roughly 21 km longer than the polar axis.</p></li>
<li><p>To account for this, the earth is modeled as an ellipsoid (slighty squished sphere) defined by two radii:</p>
<ul>
<li>the <strong>semi-major</strong> axis (along the equatorial radius)</li>
<li>the <strong>semi-minor</strong> axis (along the polar radius)</li>
</ul></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/11-semi-axis.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="section-2" class="level2">
<h2 class="anchored" data-anchor-id="section-2"></h2>
<ul>
<li><p>Thanks to satellite and computational capabilities our estimates of these radii are be quite precise</p>
<ul>
<li><p>The semi-major axis is 6,378,137 m</p></li>
<li><p>The semi-minor axis is 6,356,752 m</p></li>
</ul></li>
<li><p>Differences in distance along the surfaces of an ellipsoid vs.&nbsp;a perfect sphere are small but measurable (the difference can be as high as 20 km)</p></li>
</ul>
<div class="{columns}">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/11-sphere.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/11-ellipsoid.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="geoid" class="level2">
<h2 class="anchored" data-anchor-id="geoid">Geoid</h2>
<ul>
<li><p>The <em>ellipsoid</em> gives us the earths form as a perfectly smooth object</p></li>
<li><p>But … the earth is not perfectly smooth</p></li>
<li><p>Deviations from the perfect sphere are measurable and can influence measurements.</p></li>
<li><p>A <em>geoid</em> is a mathematical model fore representing these deviations</p>
<ul>
<li><p>We are <em>not</em> talking about mountains and ocean trenches but the earth’s gravitational potential which is tied to the flow of the earth’s hot and fluid core.</p></li>
<li><p>Therefore the geoid is constantly changing, albeit a large temporal scale.</p></li>
</ul></li>
<li><p>The measurement and representation of the earth’s shape is at the heart of <code>geodesy</code></p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/11-nasa-geoids.jpg" class="img-fluid figure-img" width="175"></p>
<figcaption>NASA’s geoid models</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="datum" class="level2">
<h2 class="anchored" data-anchor-id="datum">Datum</h2>
<ul>
<li><p>So how are we to reconcile our need to work with a (simple) mathematical model of the earth’s shape with the undulating nature of the geoid?</p></li>
<li><p>We align the geoid with the ellipsoid to map the the earths departures from the smooth assumption</p></li>
<li><p>The alignment can be <strong>local</strong> where the ellipsoid surface is closely fit to the geoid at a particular location on the earth’s surface</p></li>
</ul>
<p>or</p>
<ul>
<li><p><strong>geocentric</strong> where the ellipsoid is aligned with the center of the earth.</p></li>
<li><p>The alignment of the smooth ellipsoid to the geoid model defines a <strong>datum</strong>.</p></li>
</ul>
</section>
<section id="local-datums" class="level2">
<h2 class="anchored" data-anchor-id="local-datums">Local Datums</h2>
<ul>
<li><p>There are many local datums to choose from</p></li>
<li><p>The choice of datum is largely driven by the location</p></li>
<li><p>When working in the USA, a the North American Datum of 1927 (or NAD27 for short) is standard</p>
<ul>
<li>NAD27 is not well suited for other parts of the world.</li>
</ul></li>
</ul>
</section>
<section id="section-3" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="section-3"></h2>
<p>Examples of common local datums are shown in the following table:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 40%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Local datum</th>
<th>Acronym</th>
<th>Best for</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>North American Datum of 1927</td>
<td>NAD27</td>
<td>Continental US</td>
<td>This is an old datum but still prevalent</td>
</tr>
<tr class="even">
<td>European Datum of 1950</td>
<td>ED50</td>
<td>Western Europe</td>
<td>Developed after World War II and still quite popular</td>
</tr>
<tr class="odd">
<td>World Geodetic System 1972</td>
<td>WGS72</td>
<td>Global</td>
<td>Developed by the Department of Defense.</td>
</tr>
</tbody>
</table>
</section>
<section id="geocentric-datum" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="geocentric-datum">Geocentric Datum</h2>
<ul>
<li><p>Many modern datums use a geocentric alignment</p>
<ul>
<li><p>World Geodetic Survey for 1984 (WGS84)</p></li>
<li><p>North American Datums of 1983 (NAD83)</p></li>
</ul></li>
<li><p>Most popular geocentric datums use the WGS84 <em>ellipsoid</em> or the GRS80 <em>ellipsoid</em> which share nearly identical semi-major and semi-minor axes</p></li>
</ul>
<table class="caption-top table">
<colgroup>
<col style="width: 37%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Geocentric datum</th>
<th>Acronym</th>
<th>Best for</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>North American Datum of 1983</td>
<td>NAD83</td>
<td>Continental US</td>
<td>This is one of the most popular modern datums for the contiguous US.</td>
</tr>
<tr class="even">
<td>European Terrestrial Reference System 1989</td>
<td>ETRS89</td>
<td>Western Europe</td>
<td>This is the most popular modern datum for much of Europe.</td>
</tr>
<tr class="odd">
<td>World Geodetic System 1984</td>
<td>WGS84</td>
<td>Global</td>
<td>Developed by the Department of Defense.</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>NAD 27 is based on Clarke Ellipsoid of 1866 which is calculated by manual surveying. NAD83 is based on the Geodetic Reference System (GRS) of 1980.</p>
</div>
</div>
</section>
<section id="building-a-gcs" class="level2">
<h2 class="anchored" data-anchor-id="building-a-gcs">Building a GCS</h2>
<ul>
<li><p>So, a GCS is defined by the ellipsoid model and its alignment to the geoid defining the datum.</p></li>
<li><p>Smooth Sphere - Mathmatical Geoid (in angular units)</p></li>
</ul>
</section>
<section id="projected-coordinate-systems" class="level2">
<h2 class="anchored" data-anchor-id="projected-coordinate-systems">Projected Coordinate Systems</h2>
<ul>
<li><p>The surface of the earth is curved but maps (and to data GIS) is flat.</p></li>
<li><p>A projected coordinate system (PCS) is a reference system for identifying locations and measuring features on a flat (2D) surfaces. I</p></li>
<li><p>Projected coordinate systems have an origin, an <em>x</em> axis, a <em>y</em> axis, and a linear unit of measure.</p></li>
<li><p>Going from a GCS to a PCS requires mathematical transformations.</p></li>
<li><p>There are three main groups of projection types:</p>
<ul>
<li>conic</li>
<li>cylindrical</li>
<li>planar</li>
</ul></li>
</ul>
</section>
<section id="projection-types" class="level2">
<h2 class="anchored" data-anchor-id="projection-types">Projection Types:</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/11-projected-crs.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="236"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>In all cases, distortion is <em>minimized</em> at the line/point of <strong>tangency</strong> (denoted by black line/point)</p></li>
<li><p>Distortions are <em>minimized</em> along the tangency lines and increase with the distance from those lines.</p></li>
</ul>
</section>
<section id="plannar" class="level2">
<h2 class="anchored" data-anchor-id="plannar">Plannar</h2>
<ul>
<li><p>A planar projection projects data onto a flat surface touching the globe at a <em>point</em> or along 1 line of <em>tangency.</em></p></li>
<li><p>Typically used to map polar regions.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/11-projected-crs.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="236"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cylindrical" class="level2">
<h2 class="anchored" data-anchor-id="cylindrical">Cylindrical</h2>
<ul>
<li><p>A cylindrical projection maps the surface onto a cylinder.</p></li>
<li><p>This projection could also be created by touching the Earth’s surface along 1 or 2 lines of <em>tangency</em></p></li>
<li><p>Most often when mapping the entire world.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/11-projected-crs.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="236"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="conic" class="level2">
<h2 class="anchored" data-anchor-id="conic">Conic</h2>
<ul>
<li><p>In a conic projection, the Earth’s surface is projected onto a cone along 1 or 2 lines of <em>tangency</em></p></li>
<li><p>Therefore, it is the best suited for maps of mid-latitude areas.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/11-projected-crs.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="236"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="spatial-properties" class="level2">
<h2 class="anchored" data-anchor-id="spatial-properties">Spatial Properties</h2>
<ul>
<li><p>All projections <em>distort</em> real-world geographic features.</p></li>
<li><p>Think about trying to unpeel an orange while preserving the skin</p></li>
<li><p>The four spatial properties that are subject to distortion are: <strong>shape</strong>, <strong>area</strong>, <strong>distance</strong> and <strong>direction</strong></p>
<ul>
<li><p>A map that preserves shape is called <code>conformal</code>;</p></li>
<li><p>one that preserves area is called <code>equal-area</code>;</p></li>
<li><p>one that preserves distance is called <code>equidistant</code></p></li>
<li><p>one that preserves direction is called <code>azimuthal</code></p></li>
<li><p>Each map projection can preserve only one or two of the four spatial properties.</p></li>
<li><p>Often, projections are named after the spatial properties they preserve.</p></li>
</ul></li>
<li><p>When working with small-scale (large area) maps and when multiple spatial properties are needed, it is best to break the analyses across projections to minimize errors associated with spatial distortion.</p></li>
</ul>
</section>
<section id="setting-crsspcss" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="setting-crsspcss">Setting CRSs/PCSs</h2>
<ul>
<li>We saw that <code>sfc</code> objects have two attributes to store a CRS: <code>epsg</code> and <code>proj4string</code></li>
</ul>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(conus)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 49 features </span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -124.8485 ymin: 24.39631 xmax: -66.88544 ymax: 49.38448</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; First 5 geometries:</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOLYGON (((-85.4883 30.99706, -85.36962 30...</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOLYGON (((-110.7507 37.00301, -110.8054 3...</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOLYGON (((-90.95577 34.11871, -90.9569 34...</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOLYGON (((-116.1062 32.61848, -116.0123 3...</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MULTIPOLYGON (((-105.155 36.99526, -105.1208 36...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>This implies that all geometries in a geometry list-column (sfc) must have the same CRS.</p></li>
<li><p><code>proj4string</code> is a generic, string-based description of a CRS, understood by <a href="https://proj4.org/">PROJ</a></p></li>
<li><p>It defines projection types and parameter values for particular projections,</p></li>
<li><p>As a result it can cover an infinite amount of different projections.</p></li>
<li><p><code>epsg</code> is the <em>integer ID</em> for a known CRS that can be resolved into a <code>proj4string</code>.</p>
<ul>
<li>This is somewhat equivalent to the idea that a 6-digit FIP code can be resolved to a state/county pair</li>
</ul></li>
<li><p>Some <code>proj4string</code> values can resolved back into their corresponding <code>epsg</code> ID, but this does not always work.</p></li>
<li><p>The importance of having <code>epsg</code> values stored with data besides <code>proj4string</code> values is that the <code>epsg</code> refers to particular, well-known CRS, whose parameters may change (improve) over time</p></li>
<li><p>fixing only the <code>proj4string</code> may remove the possibility to benefit from such improvements, and limit some of the provenance of datasets (but may help reproducibility)</p></li>
</ul>
</section>
<section id="proj4-coordinate-syntax" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="proj4-coordinate-syntax"><code>PROJ4</code> coordinate syntax</h2>
<p>The <code>PROJ4</code> syntax contains a list of parameters, each prefixed with the <code>+</code> character.</p>
<p>A list of some <code>PROJ4</code> parameters follows and the full list can be found <a href="https://proj.org/usage/projections.html">here</a>:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>+a</td>
<td>Semi-major radius of the ellipsoid axis</td>
</tr>
<tr class="even">
<td>+b</td>
<td>Semi-minor radius of the ellipsoid axis</td>
</tr>
<tr class="odd">
<td>+datum</td>
<td>Datum name</td>
</tr>
<tr class="even">
<td>+ellps</td>
<td>Ellipsoid name</td>
</tr>
<tr class="odd">
<td>+lat_0</td>
<td>Latitude of origin</td>
</tr>
<tr class="even">
<td>+lat_1</td>
<td>Latitude of first standard parallel</td>
</tr>
<tr class="odd">
<td>+lat_2</td>
<td>Latitude of second standard parallel</td>
</tr>
<tr class="even">
<td>+lat_ts</td>
<td>Latitude of true scale</td>
</tr>
<tr class="odd">
<td>+lon_0</td>
<td>Central meridian</td>
</tr>
<tr class="even">
<td>+over</td>
<td>Allow longitude output outside -180 to 180 range, disables wrapping</td>
</tr>
<tr class="odd">
<td>+proj</td>
<td>Projection name</td>
</tr>
<tr class="even">
<td>+south</td>
<td>Denotes southern hemisphere UTM zone</td>
</tr>
<tr class="odd">
<td>+units</td>
<td>meters, US survey feet, etc.</td>
</tr>
<tr class="even">
<td>+x_0</td>
<td>False easting</td>
</tr>
<tr class="odd">
<td>+y_0</td>
<td>False northing</td>
</tr>
<tr class="even">
<td>+zone</td>
<td>UTM zone</td>
</tr>
</tbody>
</table>
</section>
<section id="transform-and-retrive" class="level2">
<h2 class="anchored" data-anchor-id="transform-and-retrive">Transform and retrive</h2>
<div class="{columns}">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(conus)<span class="sc">$</span>epsg</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 4326</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(conus)<span class="sc">$</span>proj4string</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "+proj=longlat +datum=WGS84 +no_defs"</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(conus)<span class="sc">$</span>datum</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "WGS84"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>conus5070 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(conus, <span class="dv">5070</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(conus5070)<span class="sc">$</span>epsg</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5070</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(conus5070)<span class="sc">$</span>proj4string</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "+proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs"</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(conus5070)<span class="sc">$</span>datum</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "NAD83"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-2_files/figure-revealjs/unnamed-chunk-72-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="revisit-denver" class="level2">
<h2 class="anchored" data-anchor-id="revisit-denver">Revisit Denver</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-104.9903</span> 39.7392 <span class="kw">|</span> <span class="ex">proj</span> +proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -723281.88   6827.29</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>red = false origin : blue = Denver</li>
</ul>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="week-2_files/figure-revealjs/unnamed-chunk-74-1.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="week-2_files/figure-revealjs/unnamed-chunk-74-2.png" class="img-fluid"></p>
</div>
</div>
</div>
</section>
<section id="geodesic-geometries" class="level2">
<h2 class="anchored" data-anchor-id="geodesic-geometries">Geodesic geometries</h2>
<ul>
<li><p>PCSs introduce errors in their geometric measurements because the distance between two points on an ellipsoid is difficult to replicate on a projected coordinate system unless these points are close to one another.</p></li>
<li><p>In most cases, such errors other sources of error in the feature representation outweigh measurement errors made in a PCS making them tolorable.</p></li>
<li><p>However, if the domain of analysis is large (i.e.&nbsp;the North American continent), then the measurement errors associated with a projected coordinate system may no longer be acceptable.</p></li>
<li><p>A way to circumvent projected coordinate system limitations is to adopt a <em>geodesic</em> solution.</p></li>
</ul>
</section>
<section id="geodesic-measurments" class="level2">
<h2 class="anchored" data-anchor-id="geodesic-measurments">Geodesic Measurments</h2>
<ul>
<li><p>A <strong>geodesic distance</strong> is the shortest distance between two points on an ellipsoid</p></li>
<li><p>A <strong>geodesic area</strong> measurement is one that is measured on an ellipsoid.</p></li>
<li><p>Such measurements are <em>independent</em> of the underlying projected coordinate system.</p></li>
<li><p>Why does this matter?</p></li>
<li><p>Compare the distances measured between Santa Barbara and Amsterdam. The blue line represents the shortest distance between the two points on a <em>planar</em> coordinate system. The red line as measured on a <em>ellipsoid</em>.</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-2_files/figure-revealjs/unnamed-chunk-75-1.png" class="img-fluid figure-img" width="2304"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="section-4" class="level2">
<h2 class="anchored" data-anchor-id="section-4"></h2>
<ul>
<li><p>the geodesic distance looks weird given its curved appearance on the projected map.</p></li>
<li><p>this curvature is a byproduct of the current reference system’s increasing distance distortion as one moves towards the pole!</p></li>
<li><p>We can display the geodesic and planar distance on a 3D globe (or a projection that mimics the view of the 3D earth).</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-2_files/figure-revealjs/unnamed-chunk-76-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="section-5" class="level2">
<h2 class="anchored" data-anchor-id="section-5"></h2>
<ul>
<li><p>So if a geodesic measurement is more precise than a planar measurement, why not perform all spatial operations using geodesic geometry?</p></li>
<li><p>The downside is in its computational requirements.</p></li>
<li><p>It’s far more efficient to compute area/distance on a plane than it is on a spheroid.</p></li>
<li><p>This is because geodesic calculations have no simple algebraic solutions and involve approximations that may require iteration! (think optimization or nonlinear solutions)</p></li>
<li><p>So this may be a computationally taxing approach if processing 1,000(s) or 1,000,000(s) of line segments.</p></li>
</ul>
</section>
<section id="gedesic-area-and-length-measurements" class="level2">
<h2 class="anchored" data-anchor-id="gedesic-area-and-length-measurements">Gedesic Area and Length Measurements</h2>
<ul>
<li><p>Not all algorthimns are equal (in terms of speed or accuracy)</p></li>
<li><p>Some more efficient algorithms that minimize computation time may reduce precision in the process.</p></li>
<li><p>Some of ArcMap’s functions offer the option to compute geodesic distances and areas however ArcMap does not clearly indicate <em>how</em> its geodesic calculations are implemented (<a href="https://mgimond.github.io/Spatial/coordinate-systems.html#geodesic-geometries">cite</a>)</p></li>
<li><p>R is well documented, and is efficient!</p></li>
</ul>
</section>
<section id="distances" class="level2">
<h2 class="anchored" data-anchor-id="distances">Distances</h2>
<p><code>?st_distance</code></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/11-sf-geos-measures.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="488"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="native-sf-binds-to-libwgeom" class="level2">
<h2 class="anchored" data-anchor-id="native-sf-binds-to-libwgeom">native <code>sf</code> binds to <code>libwgeom</code></h2>
<div class="{columns}">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/11-lwgeom.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="488"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/09-sf-depends.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="559"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="distance-example" class="level2">
<h2 class="anchored" data-anchor-id="distance-example">Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB</code></pre>
</div>
</div>
</div>
</section>
<section id="distance-example-1" class="level2">
<h2 class="anchored" data-anchor-id="distance-example-1">Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">crs =</span> <span class="dv">4326</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)</code></pre>
</div>
</div>
</div>
</section>
<section id="distance-example-2" class="level2">
<h2 class="anchored" data-anchor-id="distance-example-2">Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)</code></pre>
</div>
</div>
</div>
</section>
<section id="distance-example-3" class="level2">
<h2 class="anchored" data-anchor-id="distance-example-3">Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Greeat Circle Distance</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(pts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)
#&gt; Units: [m]
#&gt;         [,1]    [,2]
#&gt; [1,]       0 4050406
#&gt; [2,] 4050406       0</code></pre>
</div>
</div>
</div>
</section>
<section id="distance-example-4" class="level2">
<h2 class="anchored" data-anchor-id="distance-example-4">Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Greeat Circle Distance</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(pts)</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Euclidean Distance</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(pts, <span class="at">which =</span> <span class="st">"Euclidean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)
#&gt; Units: [m]
#&gt;         [,1]    [,2]
#&gt; [1,]       0 4050406
#&gt; [2,] 4050406       0
#&gt; Units: [°]
#&gt;          1        2
#&gt; 1  0.00000 46.12338
#&gt; 2 46.12338  0.00000</code></pre>
</div>
</div>
</div>
</section>
<section id="distance-example-5" class="level2">
<h2 class="anchored" data-anchor-id="distance-example-5">Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Greeat Circle Distance</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(pts)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Euclidean Distance</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(pts, <span class="at">which =</span> <span class="st">"Euclidean"</span>)</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Equal Area PCS</span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(<span class="fu">st_transform</span>(pts, <span class="dv">5070</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)
#&gt; Units: [m]
#&gt;         [,1]    [,2]
#&gt; [1,]       0 4050406
#&gt; [2,] 4050406       0
#&gt; Units: [°]
#&gt;          1        2
#&gt; 1  0.00000 46.12338
#&gt; 2 46.12338  0.00000
#&gt; Units: [m]
#&gt;         1       2
#&gt; 1       0 4017987
#&gt; 2 4017987       0</code></pre>
</div>
</div>
</div>
</section>
<section id="distance-example-6" class="level2">
<h2 class="anchored" data-anchor-id="distance-example-6">Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Greeat Circle Distance</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(pts)</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Euclidean Distance</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(pts, <span class="at">which =</span> <span class="st">"Euclidean"</span>)</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Equal Area PCS</span></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(<span class="fu">st_transform</span>(pts, <span class="dv">5070</span>))</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Equal Distance</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(<span class="fu">st_transform</span>(pts, eqds))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)
#&gt; Units: [m]
#&gt;         [,1]    [,2]
#&gt; [1,]       0 4050406
#&gt; [2,] 4050406       0
#&gt; Units: [°]
#&gt;          1        2
#&gt; 1  0.00000 46.12338
#&gt; 2 46.12338  0.00000
#&gt; Units: [m]
#&gt;         1       2
#&gt; 1       0 4017987
#&gt; 2 4017987       0
#&gt; Units: [m]
#&gt;         1       2
#&gt; 1       0 3823549
#&gt; 2 3823549       0</code></pre>
</div>
</div>
</div>
</section>
<section id="distance-example-7" class="level2">
<h2 class="anchored" data-anchor-id="distance-example-7">Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Greeat Circle Distance</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(pts)</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Euclidean Distance</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(pts, <span class="at">which =</span> <span class="st">"Euclidean"</span>)</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Equal Area PCS</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(<span class="fu">st_transform</span>(pts, <span class="dv">5070</span>))</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Equal Distance</span></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(<span class="fu">st_transform</span>(pts, eqds))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)
#&gt; Units: [m]
#&gt;         [,1]    [,2]
#&gt; [1,]       0 4050406
#&gt; [2,] 4050406       0
#&gt; Units: [°]
#&gt;          1        2
#&gt; 1  0.00000 46.12338
#&gt; 2 46.12338  0.00000
#&gt; Units: [m]
#&gt;         1       2
#&gt; 1       0 4017987
#&gt; 2 4017987       0
#&gt; Units: [m]
#&gt;         1       2
#&gt; 1       0 3823549
#&gt; 2 3823549       0</code></pre>
</div>
</div>
</div>
</section>
<section id="area-example-conus" class="level2">
<h2 class="anchored" data-anchor-id="area-example-conus">Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">

</div>
</div>
</section>
<section id="area-example-conus-1" class="level2">
<h2 class="anchored" data-anchor-id="area-example-conus-1">Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"WGS84"</span>, <span class="st">"AEA"</span>, <span class="st">"EPDS"</span>),</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">area =</span> <span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">st_area</span>(conus)),</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, <span class="dv">5070</span>))),</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, eqds)))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">

</div>
</div>
</section>
<section id="area-example-conus-2" class="level2">
<h2 class="anchored" data-anchor-id="area-example-conus-2">Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"WGS84"</span>, <span class="st">"AEA"</span>, <span class="st">"EPDS"</span>),</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">area =</span> <span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">st_area</span>(conus)),</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, <span class="dv">5070</span>))),</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, eqds)))))</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-2_files/figure-revealjs/conus_auto_03_output-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="area-example-conus-3" class="level2">
<h2 class="anchored" data-anchor-id="area-example-conus-3">Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"WGS84"</span>, <span class="st">"AEA"</span>, <span class="st">"EPDS"</span>),</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">area =</span> <span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">st_area</span>(conus)),</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, <span class="dv">5070</span>))),</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, eqds)))))</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df) <span class="sc">+</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> <span class="fu">as.numeric</span>(area) ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-2_files/figure-revealjs/conus_auto_04_output-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="area-example-conus-4" class="level2">
<h2 class="anchored" data-anchor-id="area-example-conus-4">Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"WGS84"</span>, <span class="st">"AEA"</span>, <span class="st">"EPDS"</span>),</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">area =</span> <span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">st_area</span>(conus)),</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, <span class="dv">5070</span>))),</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, eqds)))))</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df) <span class="sc">+</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> <span class="fu">as.numeric</span>(area) )) <span class="sc">+</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-2_files/figure-revealjs/conus_auto_05_output-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="area-example-conus-5" class="level2">
<h2 class="anchored" data-anchor-id="area-example-conus-5">Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"WGS84"</span>, <span class="st">"AEA"</span>, <span class="st">"EPDS"</span>),</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">area =</span> <span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">st_area</span>(conus)),</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, <span class="dv">5070</span>))),</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, eqds)))))</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df) <span class="sc">+</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> <span class="fu">as.numeric</span>(area) )) <span class="sc">+</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"SRS"</span>, <span class="at">y =</span> <span class="st">"m2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-2_files/figure-revealjs/conus_auto_06_output-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="units-in-sf" class="level2">
<h2 class="anchored" data-anchor-id="units-in-sf">Units in <code>sf</code></h2>
<ul>
<li><p>The CRS in <code>sf</code> encodes the units of measurement relating to spatial features</p></li>
<li><p>Where possible geometric operations such as <code>st_distance()</code>, <code>st_length()</code> and <code>st_area()</code> report results with a units attribute appropriate for the CRS:</p></li>
<li><p>This can be both handy and very confusing for those new to it. Consider the following:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">l =</span> <span class="fu">sum</span>(<span class="fu">st_length</span>(conus)))</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 100093081 [m]</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>(<span class="at">a =</span> <span class="fu">sum</span>(<span class="fu">st_area</span>(conus)))</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8.096497e+12 [m^2]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-6" class="level2">
<h2 class="anchored" data-anchor-id="section-6"></h2>
<p>We can set units if we do manipulations as well using the units package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(l, <span class="st">"km"</span>)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 100093.1 [km]</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(l, <span class="st">"mile"</span>)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 62194.96 [mile]</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(a, <span class="st">"ha"</span>)</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 809649680 [ha]</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(a, <span class="st">"km2"</span>)</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8096497 [km^2]</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(a, <span class="st">"in2"</span>)</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1.25496e+16 [in^2]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="units-are-a-class" class="level2">
<h2 class="anchored" data-anchor-id="units-are-a-class">Units are a class</h2>
<ul>
<li>units are an S3 data object with attribute information and “rules of engagement”</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="fu">st_length</span>(conus)) </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "units"</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(<span class="fu">st_length</span>(conus)) <span class="sc">|&gt;</span> <span class="fu">unlist</span>()</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; units.numerator           class </span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             "m"         "units"</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="fu">st_length</span>(conus) <span class="sc">+</span> <span class="dv">100</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in Ops.units(st_length(conus), 100): both operands of the expression should be "units" objects</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>conus <span class="sc">|&gt;</span> </span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fu">st_area</span>(.)) <span class="sc">|&gt;</span> </span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> area)) <span class="sc">+</span> </span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in `stopifnot()`:</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ In argument: `area = st_area(.)`.</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Caused by error:</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ! object '.' not found</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="unit-values-can-be-stripped-of-their-attributes-if-need-be" class="level2">
<h2 class="anchored" data-anchor-id="unit-values-can-be-stripped-of-their-attributes-if-need-be">Unit values can be stripped of their attributes if need be:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Via drop_units</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>(units<span class="sc">::</span><span class="fu">drop_units</span>(<span class="fu">sum</span>(<span class="fu">st_length</span>(conus))))</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 100093081</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Via casting</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>(<span class="fu">as.numeric</span>(<span class="fu">sum</span>(<span class="fu">st_length</span>(conus))))</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 100093081</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->

<script>
  // htmlwidgets need to know to resize themselves when slides are shown/hidden.
  // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
  // slide changes (different for each slide format).
  (function () {
    // dispatch for htmlwidgets
    function fireSlideEnter() {
      const event = window.document.createEvent("Event");
      event.initEvent("slideenter", true, true);
      window.document.dispatchEvent(event);
    }

    function fireSlideChanged(previousSlide, currentSlide) {
      fireSlideEnter();

      // dispatch for shiny
      if (window.jQuery) {
        if (previousSlide) {
          window.jQuery(previousSlide).trigger("hidden");
        }
        if (currentSlide) {
          window.jQuery(currentSlide).trigger("shown");
        }
      }
    }

    // hookup for slidy
    if (window.w3c_slidy) {
      window.w3c_slidy.add_observer(function (slide_num) {
        // slide_num starts at position 1
        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
      });
    }

  })();
</script>

<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>