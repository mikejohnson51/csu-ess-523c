<!DOCTYPE html>
<html lang="en"><head>
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <title>ESS 523c – Week 5</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-be8ed9a3cdcbe7a498a633334f8d1033.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
<script src="https://use.fontawesome.com/5235085b15.js"></script>
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#1E4D2B" class="quarto-title-block center">
  <h1 class="title">Week 5</h1>
  <p class="subtitle">Machine Learning Part 1</p>

<div class="quarto-title-authors">
</div>

</section>
<section id="unit-3-modeling-machine-learning" class="slide level2">
<h2>Unit 3: Modeling (Machine Learning)</h2>

<img data-src="https://imgs.xkcd.com/comics/machine_learning.png" class="quarto-figure quarto-figure-center r-stretch"><div class="footer">
<p><a href="https://xkcd.com/1838/" class="uri">https://xkcd.com/1838/</a></p>
</div>
</section>
<section id="what-is-machine-learning" class="slide level2">
<h2>What is machine learning?</h2>
<p><img data-src="images/what_is_ml.png" class="absolute" style="z-index: -1;top: 0px; left: 150px; "></p>
<div class="footer">
<p>Illustration credit: <a href="https://vas3k.com/blog/machine_learning/" class="uri">https://vas3k.com/blog/machine_learning/</a></p>
</div>
</section>
<section id="what-is-machine-learning-2025-edition" class="slide level2">
<h2>What is machine learning? (2025 edition)</h2>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>In the early 2010s, “Artificial intelligence” (AI) was largely synonymous with what we’ll refer to as “machine learning” in this workshop. In the late 2010s and early 2020s, AI usually referred to deep learning methods. Since the release of ChatGPT in late 2022, “AI” has come to also encompass large language models (LLMs) / generative models.</p>
</div>
</div>
</div>
<p><img data-src="images/what_is_ml_expanding.gif" class="absolute" style="z-index: -1;top: 150px; left: 150px; "></p>
<div class="footer">
<p>Illustration credit: <a href="https://vas3k.com/blog/machine_learning/" class="uri">https://vas3k.com/blog/machine_learning/</a></p>
</div>
</section>
<section id="classic-conceptual-model" class="slide level2">
<h2>Classic Conceptual Model</h2>

<img data-src="images/ml_illustration.jpg" class="quarto-figure quarto-figure-center r-stretch"><div class="footer">
<p>Illustration credit: <a href="https://vas3k.com/blog/machine_learning/" class="uri">https://vas3k.com/blog/machine_learning/</a></p>
</div>
</section>
<section id="section" class="slide level2" data-background-image="images/tm-org.png" data-background-size="contain">
<h2></h2>
</section>
<section id="the-big-picture-road-map" class="slide level2">
<h2>The big picture: Road map</h2>

<img data-src="images/whole-game-final-performance.jpg" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="what-is-tidymodels" class="slide level2">
<h2>What is <code>tidymodels</code>?</h2>
<ul>
<li>An R package ecosystem for modeling and machine learning</li>
<li>Built on the <code>tidyverse</code> principles (consistent syntax, modular design)</li>
<li>Provides a structured workflow for preprocessing, model fitting, and evaluation</li>
<li>Includes packages for model specification, preprocessing, resampling, tuning, and evaluation</li>
<li>Promotes best practices for reproducibility and efficiency</li>
<li>Offers a unified interface for different models and tasks</li>
</ul>
</section>
<section id="key-tidymodels-packages" class="slide level2">
<h2>Key tidymodels Packages</h2>
<p>📦 <code>recipes</code>: Feature engineering and preprocessing</p>
<p>📦 <code>parsnip</code>: Unified interface for model specification</p>
<p>📦 <code>workflows</code>: Streamlined modeling pipelines</p>
<p>📦 <code>tune</code>: Hyperparameter tuning</p>
<p>📦 <code>rsample</code>: Resampling and validation</p>
<p>📦 <code>yardstick</code>: Model evaluation metrics</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">'images/tidymodels-packages.png'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a>tidymodels<span class="sc">::</span><span class="fu">tidymodels_packages</span>()</span>
<span id="cb2-2"><a></a><span class="co">#&gt;  [1] "broom"        "cli"          "conflicted"   "dials"        "dplyr"       </span></span>
<span id="cb2-3"><a></a><span class="co">#&gt;  [6] "ggplot2"      "hardhat"      "infer"        "modeldata"    "parsnip"     </span></span>
<span id="cb2-4"><a></a><span class="co">#&gt; [11] "purrr"        "recipes"      "rlang"        "rsample"      "rstudioapi"  </span></span>
<span id="cb2-5"><a></a><span class="co">#&gt; [16] "tibble"       "tidyr"        "tune"         "workflows"    "workflowsets"</span></span>
<span id="cb2-6"><a></a><span class="co">#&gt; [21] "yardstick"    "tidymodels"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<img data-src="images/tidymodels-packages.png" style="width:100.0%" class="r-stretch"></section>
<section id="typcical-workflow-in-tidymodels" class="slide level2">
<h2>Typcical Workflow in <code>tidymodels</code></h2>
<p>1️⃣ Load Package &amp; Data</p>
<p>2️⃣ Preprocess Data (<code>recipes</code>)</p>
<p>3️⃣ Define Model (<code>parsnip</code>)</p>
<p>4️⃣ Create a Workflow (<code>workflows</code>)</p>
<p>5️⃣ Train &amp; Tune (<code>tune</code>)</p>
<p>6️⃣ Evaluate Performance (<code>yardstick</code>)</p>
</section>
<section id="data-normalization-tidymodels" class="slide level2">
<h2>Data Normalization: <code>tidymodels</code></h2>
<ul>
<li><p>Data normalization is a crucial step in data preprocessing for machine learning.</p></li>
<li><p>It ensures that features contribute equally to model performance by transforming them into a common scale.</p></li>
<li><p>This is particularly important for algorithms that rely on distance metrics (e.g., k-nearest neighbors, support vector machines) or gradient-based optimization (e.g., neural networks, logistic regression).</p></li>
<li><p>In the <code>tidymodels</code> framework, data normalization is handled within preprocessing workflows using the <code>recipes</code> package, which provides a structured way to apply transformations consistently.</p></li>
</ul>
</section>
<section id="why-normalize-data-for-ml" class="slide level2">
<h2>Why Normalize Data for ML?</h2>
<p>✅ Improves Model Convergence: Many machine learning models rely on gradient descent, which can be inefficient if features are on different scales.</p>
<p>✅ Prevents Feature Domination: Features with large magnitudes can overshadow smaller ones, leading to biased models.</p>
<p>✅ Enhances Interpretability: Standardized data improves comparisons across variables and aids in better model understanding.</p>
<p>✅ Facilitates Distance-Based Methods: Algorithms like k-nearest neighbors and principal component analysis (PCA) perform best when data is normalized.</p>
</section>
<section id="common-normalization-techniques" class="slide level2">
<h2>Common Normalization Techniques</h2>
<h4 id="min-max-scaling">1. <code>Min-Max Scaling</code></h4>
<ul>
<li><p>Transforms data into a fixed range (typically [0,1]).</p></li>
<li><p>Preserves relationships but sensitive to outliers.</p></li>
<li><p>Formula: <span class="math display">\[ x' = \frac{x - x_{min}}{x_{max} - x_{min}} \]</span></p></li>
<li><p>Implemented using <code>step_range()</code> in <code>recipes.</code></p></li>
</ul>
<h4 id="z-score-standardization-standard-scaling">2. <code>Z-Score Standardization (Standard Scaling)</code></h4>
<ul>
<li><p>Centers data to have zero mean and unit variance.</p></li>
<li><p>More robust to outliers compared to min-max scaling.</p></li>
<li><p>Formula: <span class="math display">\[ x' = \frac{x - \mu}{\sigma} \]</span></p></li>
<li><p>Implemented using <code>step_normalize()</code> in <code>recipes</code>.</p></li>
</ul>
</section>
<section id="common-normalization-techniques-1" class="slide level2">
<h2>Common Normalization Techniques</h2>
<h4 id="robust-scaling">3. <code>Robust Scaling</code></h4>
<ul>
<li><p>Uses median and interquartile range (IQR) for scaling.</p></li>
<li><p>Less sensitive to outliers.</p></li>
<li><p>Formula: <span class="math display">\[ x' = \frac{x - median(x)}{IQR(x)} \]</span></p></li>
<li><p>Implemented using <code>step_YeoJohnson()</code> or <code>step_BoxCox()</code> in <code>recipes.</code></p></li>
</ul>
<h4 id="log-transformation">4. <code>Log Transformation</code></h4>
<ul>
<li><p>Useful for skewed distributions to reduce the impact of extreme values.</p></li>
<li><p>Implemented using <code>step_log()</code> in <code>recipes.</code></p></li>
</ul>
</section>
<section id="common-normalization-techniques-2" class="slide level2">
<h2>Common Normalization Techniques</h2>
<h4 id="principal-component-analysis-pca">5. <code>Principal Component Analysis (PCA)</code></h4>
<ul>
<li><p>Projects data into a lower-dimensional space while maintaining variance.</p></li>
<li><p>Used in high-dimensional datasets.</p></li>
<li><p>Implemented using <code>step_pca()</code> in recipes.</p></li>
</ul>
</section>
<section id="other-feature-engineering-tasks" class="slide level2">
<h2>Other Feature Engineering Tasks</h2>
<h4 id="handling-missing-data">Handling Missing Data</h4>
<ul>
<li><code>step_impute_mean()</code></li>
<li><code>step_impute_median()</code></li>
<li><code>step_impute_knn()</code></li>
</ul>
<p>can be used to fill missing values.</p>
<h4 id="encoding-categorical-variables">Encoding Categorical Variables</h4>
<ul>
<li><p><code>step_dummy()</code> creates dummy variables for categorical features.</p></li>
<li><p><code>step_other()</code> groups infrequent categories into an “other” category.</p></li>
</ul>
<h4 id="creating-interaction-terms">Creating Interaction Terms</h4>
<ul>
<li><code>step_interact()</code> generates interaction terms between predictors.</li>
</ul>
<h4 id="feature-extraction">Feature Extraction</h4>
<ul>
<li><code>step_pca()</code> or <code>step_ica()</code> can be used to extract important components.</li>
</ul>
<h4 id="text-feature-engineering">Text Feature Engineering</h4>
<p><code>step_tokenize()</code>, <code>step_stopwords()</code>, and <code>step_tf()</code> for text processing.</p>
<h4 id="binning-numerical-data">Binning Numerical Data</h4>
<p><code>step_bin2factor()</code> converts continuous variables into categorical bins.</p>
<h4 id="polynomial-and-spline-features">Polynomial and Spline Features</h4>
<p><code>step_poly()</code> and <code>step_bs()</code> for generating polynomial and spline transformations.</p>
</section>
<section id="implementing-normalization-in-tidymodels" class="slide level2">
<h2>Implementing Normalization in Tidymodels</h2>
</section>
<section id="what-will-we-do" class="slide level2">
<h2>What will we do?</h2>
<ol type="1">
<li><p>We will create a recipe to normalize the numerical predictors in the <code>penguins</code> dataset using the <code>recipes</code> package.</p></li>
<li><p>We will then prepare (<code>prep</code>) the recipe and apply it to the dataset to obtain normalized data.</p></li>
<li><p>We will then <code>bake</code> the recipe to apply the transformations to the dataset.</p></li>
<li><p>Once processed, we can implement a linear regression model using the normalized data.</p></li>
</ol>
<div class="fragment">
<h3 id="example-workflow">Example Workflow</h3>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb3-2"><a></a></span>
<span id="cb3-3"><a></a>(recipe_obj <span class="ot">&lt;-</span> <span class="fu">recipe</span>(flipper_length_mm <span class="sc">~</span> </span>
<span id="cb3-4"><a></a>                       bill_length_mm <span class="sc">+</span> body_mass_g <span class="sc">+</span> </span>
<span id="cb3-5"><a></a>                       sex <span class="sc">+</span> island <span class="sc">+</span> species, </span>
<span id="cb3-6"><a></a>                      <span class="at">data =</span> penguins) <span class="sc">|&gt;</span> </span>
<span id="cb3-7"><a></a>  <span class="fu">step_impute_mean</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb3-8"><a></a>  <span class="fu">step_dummy</span>(<span class="fu">all_factor_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb3-9"><a></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()))</span>
<span id="cb3-10"><a></a></span>
<span id="cb3-11"><a></a><span class="co"># Prepare and apply transformations</span></span>
<span id="cb3-12"><a></a>prep_recipe     <span class="ot">&lt;-</span> <span class="fu">prep</span>(recipe_obj, <span class="at">training =</span> penguins) </span>
<span id="cb3-13"><a></a></span>
<span id="cb3-14"><a></a>normalized_data <span class="ot">&lt;-</span> <span class="fu">bake</span>(prep_recipe, <span class="at">new_data =</span> <span class="cn">NULL</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-15"><a></a>  <span class="fu">mutate</span>(<span class="at">species =</span> penguins<span class="sc">$</span>species) <span class="sc">|&gt;</span> </span>
<span id="cb3-16"><a></a>  <span class="fu">drop_na</span>()</span>
<span id="cb3-17"><a></a></span>
<span id="cb3-18"><a></a><span class="fu">head</span>(normalized_data)</span>
<span id="cb3-19"><a></a><span class="co">#&gt; # A tibble: 6 × 9</span></span>
<span id="cb3-20"><a></a><span class="co">#&gt;   bill_length_mm body_mass_g flipper_length_mm sex_male island_Dream</span></span>
<span id="cb3-21"><a></a><span class="co">#&gt;            &lt;dbl&gt;       &lt;dbl&gt;             &lt;int&gt;    &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span id="cb3-22"><a></a><span class="co">#&gt; 1         -0.886      -0.565               181    0.990       -0.750</span></span>
<span id="cb3-23"><a></a><span class="co">#&gt; 2         -0.812      -0.502               186   -1.01        -0.750</span></span>
<span id="cb3-24"><a></a><span class="co">#&gt; 3         -0.665      -1.19                195   -1.01        -0.750</span></span>
<span id="cb3-25"><a></a><span class="co">#&gt; 4         -1.33       -0.940               193   -1.01        -0.750</span></span>
<span id="cb3-26"><a></a><span class="co">#&gt; 5         -0.849      -0.690               190    0.990       -0.750</span></span>
<span id="cb3-27"><a></a><span class="co">#&gt; 6         -0.923      -0.721               181   -1.01        -0.750</span></span>
<span id="cb3-28"><a></a><span class="co">#&gt; # ℹ 4 more variables: island_Torgersen &lt;dbl&gt;, species_Chinstrap &lt;dbl&gt;,</span></span>
<span id="cb3-29"><a></a><span class="co">#&gt; #   species_Gentoo &lt;dbl&gt;, species &lt;fct&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<h4 id="explanation">Explanation:</h4>
<ul>
<li><p><code>recipe()</code> defines preprocessing steps for modeling.</p></li>
<li><p><code>step_impute_mean(all_numeric_predictors())</code> standardizes all numerical predictors.</p></li>
<li><p><code>step_dummy(all_factor_predictors())</code> creates dummy variables for categorical predictors.</p></li>
<li><p><code>step_normalize(all_numeric_predictors()))</code> standardizes all numerical predictors.</p></li>
<li><p><code>prep()</code> estimates parameters for transformations.</p></li>
<li><p><code>bake()</code> applies the transformations to the dataset.</p></li>
</ul>
</div></div>
</div>
</section>
<section id="build-a-model-with-normalized-data" class="slide level2">
<h2>Build a model with Normalized Data</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>(<span class="at">model =</span> <span class="fu">lm</span>(flipper_length_mm <span class="sc">~</span> . , <span class="at">data =</span> normalized_data) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = flipper_length_mm ~ ., data = normalized_data)
#&gt; 
#&gt; Coefficients:
#&gt;       (Intercept)     bill_length_mm        body_mass_g           sex_male  
#&gt;          200.9649             2.2754             4.6414             0.7208  
#&gt;      island_Dream   island_Torgersen  species_Chinstrap     species_Gentoo  
#&gt;            0.6525             0.9800             0.5640             8.0796  
#&gt;  speciesChinstrap      speciesGentoo  
#&gt;                NA                 NA</code></pre>
</div>
</div></div>
</section>
<section id="build-a-model-with-normalized-data-1" class="slide level2">
<h2>Build a model with Normalized Data</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a>(<span class="at">model =</span> <span class="fu">lm</span>(flipper_length_mm <span class="sc">~</span> . , <span class="at">data =</span> normalized_data) )</span>
<span id="cb6-2"><a></a></span>
<span id="cb6-3"><a></a><span class="fu">glance</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = flipper_length_mm ~ ., data = normalized_data)
#&gt; 
#&gt; Coefficients:
#&gt;       (Intercept)     bill_length_mm        body_mass_g           sex_male  
#&gt;          200.9649             2.2754             4.6414             0.7208  
#&gt;      island_Dream   island_Torgersen  species_Chinstrap     species_Gentoo  
#&gt;            0.6525             0.9800             0.5640             8.0796  
#&gt;  speciesChinstrap      speciesGentoo  
#&gt;                NA                 NA
#&gt; # A tibble: 1 × 12
#&gt;   r.squared adj.r.squared sigma statistic   p.value    df logLik   AIC   BIC
#&gt;       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     0.863         0.861  5.23      294. 2.15e-136     7 -1020. 2057. 2092.
#&gt; # ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</code></pre>
</div>
</div></div>
</section>
<section id="build-a-model-with-normalized-data-2" class="slide level2">
<h2>Build a model with Normalized Data</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a>(<span class="at">model =</span> <span class="fu">lm</span>(flipper_length_mm <span class="sc">~</span> . , <span class="at">data =</span> normalized_data) )</span>
<span id="cb8-2"><a></a></span>
<span id="cb8-3"><a></a><span class="fu">glance</span>(model)</span>
<span id="cb8-4"><a></a></span>
<span id="cb8-5"><a></a>(pred <span class="ot">&lt;-</span> <span class="fu">augment</span>(model, normalized_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = flipper_length_mm ~ ., data = normalized_data)
#&gt; 
#&gt; Coefficients:
#&gt;       (Intercept)     bill_length_mm        body_mass_g           sex_male  
#&gt;          200.9649             2.2754             4.6414             0.7208  
#&gt;      island_Dream   island_Torgersen  species_Chinstrap     species_Gentoo  
#&gt;            0.6525             0.9800             0.5640             8.0796  
#&gt;  speciesChinstrap      speciesGentoo  
#&gt;                NA                 NA
#&gt; # A tibble: 1 × 12
#&gt;   r.squared adj.r.squared sigma statistic   p.value    df logLik   AIC   BIC
#&gt;       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     0.863         0.861  5.23      294. 2.15e-136     7 -1020. 2057. 2092.
#&gt; # ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;
#&gt; # A tibble: 333 × 15
#&gt;    bill_length_mm body_mass_g flipper_length_mm sex_male island_Dream
#&gt;             &lt;dbl&gt;       &lt;dbl&gt;             &lt;int&gt;    &lt;dbl&gt;        &lt;dbl&gt;
#&gt;  1         -0.886      -0.565               181    0.990       -0.750
#&gt;  2         -0.812      -0.502               186   -1.01        -0.750
#&gt;  3         -0.665      -1.19                195   -1.01        -0.750
#&gt;  4         -1.33       -0.940               193   -1.01        -0.750
#&gt;  5         -0.849      -0.690               190    0.990       -0.750
#&gt;  6         -0.923      -0.721               181   -1.01        -0.750
#&gt;  7         -0.867       0.592               195    0.990       -0.750
#&gt;  8         -0.518      -1.25                182   -1.01        -0.750
#&gt;  9         -0.978      -0.502               191    0.990       -0.750
#&gt; 10         -1.71        0.248               198    0.990       -0.750
#&gt; # ℹ 323 more rows
#&gt; # ℹ 10 more variables: island_Torgersen &lt;dbl&gt;, species_Chinstrap &lt;dbl&gt;,
#&gt; #   species_Gentoo &lt;dbl&gt;, species &lt;fct&gt;, .fitted &lt;dbl&gt;, .resid &lt;dbl&gt;,
#&gt; #   .hat &lt;dbl&gt;, .sigma &lt;dbl&gt;, .cooksd &lt;dbl&gt;, .std.resid &lt;dbl&gt;</code></pre>
</div>
</div></div>
</section>
<section id="build-a-model-with-normalized-data-3" class="slide level2">
<h2>Build a model with Normalized Data</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a>(<span class="at">model =</span> <span class="fu">lm</span>(flipper_length_mm <span class="sc">~</span> . , <span class="at">data =</span> normalized_data) )</span>
<span id="cb10-2"><a></a></span>
<span id="cb10-3"><a></a><span class="fu">glance</span>(model)</span>
<span id="cb10-4"><a></a></span>
<span id="cb10-5"><a></a>(pred <span class="ot">&lt;-</span> <span class="fu">augment</span>(model, normalized_data))</span>
<span id="cb10-6"><a></a></span>
<span id="cb10-7"><a></a><span class="fu">ggscatter</span>(pred,</span>
<span id="cb10-8"><a></a>          <span class="at">x =</span> <span class="st">'flipper_length_mm'</span>, <span class="at">y =</span> <span class="st">'.fitted'</span>,</span>
<span id="cb10-9"><a></a>          <span class="at">add =</span> <span class="st">"reg.line"</span>, <span class="at">conf.int =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-10"><a></a>          <span class="at">cor.coef =</span> <span class="cn">TRUE</span>, <span class="at">cor.method =</span> <span class="st">"pearson"</span>,</span>
<span id="cb10-11"><a></a>          <span class="at">color =</span> <span class="st">"species"</span>, <span class="at">palette =</span> <span class="st">"jco"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = flipper_length_mm ~ ., data = normalized_data)
#&gt; 
#&gt; Coefficients:
#&gt;       (Intercept)     bill_length_mm        body_mass_g           sex_male  
#&gt;          200.9649             2.2754             4.6414             0.7208  
#&gt;      island_Dream   island_Torgersen  species_Chinstrap     species_Gentoo  
#&gt;            0.6525             0.9800             0.5640             8.0796  
#&gt;  speciesChinstrap      speciesGentoo  
#&gt;                NA                 NA
#&gt; # A tibble: 1 × 12
#&gt;   r.squared adj.r.squared sigma statistic   p.value    df logLik   AIC   BIC
#&gt;       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     0.863         0.861  5.23      294. 2.15e-136     7 -1020. 2057. 2092.
#&gt; # ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;
#&gt; # A tibble: 333 × 15
#&gt;    bill_length_mm body_mass_g flipper_length_mm sex_male island_Dream
#&gt;             &lt;dbl&gt;       &lt;dbl&gt;             &lt;int&gt;    &lt;dbl&gt;        &lt;dbl&gt;
#&gt;  1         -0.886      -0.565               181    0.990       -0.750
#&gt;  2         -0.812      -0.502               186   -1.01        -0.750
#&gt;  3         -0.665      -1.19                195   -1.01        -0.750
#&gt;  4         -1.33       -0.940               193   -1.01        -0.750
#&gt;  5         -0.849      -0.690               190    0.990       -0.750
#&gt;  6         -0.923      -0.721               181   -1.01        -0.750
#&gt;  7         -0.867       0.592               195    0.990       -0.750
#&gt;  8         -0.518      -1.25                182   -1.01        -0.750
#&gt;  9         -0.978      -0.502               191    0.990       -0.750
#&gt; 10         -1.71        0.248               198    0.990       -0.750
#&gt; # ℹ 323 more rows
#&gt; # ℹ 10 more variables: island_Torgersen &lt;dbl&gt;, species_Chinstrap &lt;dbl&gt;,
#&gt; #   species_Gentoo &lt;dbl&gt;, species &lt;fct&gt;, .fitted &lt;dbl&gt;, .resid &lt;dbl&gt;,
#&gt; #   .hat &lt;dbl&gt;, .sigma &lt;dbl&gt;, .cooksd &lt;dbl&gt;, .std.resid &lt;dbl&gt;</code></pre>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-5_files/figure-revealjs/example_auto_04_output-1.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="data-budget" class="slide level2">
<h2>Data Budget</h2>
<ul>
<li><p>In any modeling effort, it’s crucial to evaluate the performance of a model using different validation techniques to ensure a model can generalize to unseen data.</p></li>
<li><p>But data is limited even in the age of “big data”.</p></li>
</ul>

<img data-src="images/whole-game-split.jpg" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="our-typical-process-will-like-this" class="slide level2">
<h2>Our typical process will like this:</h2>
<ol type="1">
<li>Read in raw data (<code>readr</code>, <code>dplyr::*_join</code>) (single or multi table)</li>
</ol>
<div class="fragment">
<ol start="2" type="1">
<li>Prepare the data (EDA/mutate/summarize/clean, etc)</li>
</ol>
<ul>
<li>This is “Feature Engineering”</li>
</ul>
</div>
<div class="fragment">
<ol start="3" type="1">
<li>Once we’ve established our features (rows), we decide how to “spend” them …</li>
</ol>
</div>
<div class="fragment">
<p>For machine learning, we typically split data into <strong>training</strong> and <strong>test</strong> sets:</p>
</div>
<div class="fragment">
<ul>
<li><p>The <strong>training set</strong> is used to estimate model parameters.</p></li>
<li><p>Spending too much data in <strong>training</strong> prevents us from computing a good assessment of model <strong>performance</strong>.</p></li>
</ul>
</div>
<div class="fragment">
<ul>
<li><p>The <strong>test set</strong> is used as an independent assessment of performance.</p></li>
<li><p>Spending too much data in <strong>testing</strong> prevents us from computing good model parameter estimates.</p></li>
</ul>
</div>
</section>
<section id="how-we-split-data" class="slide level2">
<h2>How we split data</h2>

<img data-src="week-5_files/figure-revealjs/test-train-split-1.png" style="width:100.0%" class="r-stretch"><div class="fragment">
<ul>
<li><p>Splitting can be handled in many of ways. Typically, we base it off of a “hold out” percentage (e.g.&nbsp;20%)</p></li>
<li><p>These hold out cases are extracted randomly from the data set. (remember seeds?)</p></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>The <strong>training</strong> set is usually the majority of the data and provides a sandbox for testing different modeling appraoches.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li><p>The <strong>test</strong> set is held in reserve until one or two models are chosen.</p></li>
<li><p>The <strong>test</strong> set is then used as the final arbiter to determine the efficacy of the model.</p></li>
</ul>
</div>
</section>
<section id="startification" class="slide level2">
<h2>Startification</h2>
<ul>
<li><p>In many cases, there is a structure to the data that would inhibit inpartial spliiting (e.g.&nbsp;a class, a region, a species, a sex, etc)</p></li>
<li><p>Imagine you have a jar of M&amp;Ms in different colors — red, blue, and green. You want to take some candies out to taste, but you want to make sure you get a fair mix of each color, not just grabbing a bunch of red ones by accident.</p></li>
<li><p>Stratified resampling is like making sure that if your jar is 50% red, 30% blue, and 20% green, then the handful of candies you take keeps the same balance.</p></li>
<li><p>In data science, we do the same thing when we pick samples from a dataset: we make sure that different groups (like categories of people, animals, or weather types) are still fairly represented!</p></li>
</ul>
</section>
<section id="initial-splits" class="slide level2">
<h2>Initial splits <img data-src="hexes/rsample.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<ul>
<li>In <code>tidymodels</code>, the <code>rsample</code> package provides functions for creating initial splits of data.</li>
<li>The <code>initial_split()</code> function is used to create a single split of the data.</li>
<li>The <code>prop</code> argument defines the proportion of the data to be used for training.</li>
<li>The default is 0.75, which means 75% of the data will be used for training and 25% for testing.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="fu">set.seed</span>(<span class="dv">101991</span>)</span>
<span id="cb12-2"><a></a>(resample_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(penguins, <span class="at">prop =</span> <span class="fl">0.8</span>))</span>
<span id="cb12-3"><a></a><span class="co">#&gt; &lt;Training/Testing/Total&gt;</span></span>
<span id="cb12-4"><a></a><span class="co">#&gt; &lt;275/69/344&gt;</span></span>
<span id="cb12-5"><a></a></span>
<span id="cb12-6"><a></a><span class="co">#Sanity check</span></span>
<span id="cb12-7"><a></a><span class="dv">69</span><span class="sc">/</span><span class="dv">344</span></span>
<span id="cb12-8"><a></a><span class="co">#&gt; [1] 0.2005814</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="accessing-the-data" class="slide level2">
<h2>Accessing the data: <img data-src="hexes/rsample.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<ul>
<li>Once the data is split, we can access the training and testing data using the <code>training()</code> and <code>testing()</code> functions to extract the partitioned data from the full set:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a>penguins_train <span class="ot">&lt;-</span> <span class="fu">training</span>(resample_split)</span>
<span id="cb13-2"><a></a><span class="fu">glimpse</span>(penguins_train)</span>
<span id="cb13-3"><a></a><span class="co">#&gt; Rows: 275</span></span>
<span id="cb13-4"><a></a><span class="co">#&gt; Columns: 7</span></span>
<span id="cb13-5"><a></a><span class="co">#&gt; $ species           &lt;fct&gt; Gentoo, Adelie, Gentoo, Chinstrap, Gentoo, Chinstrap…</span></span>
<span id="cb13-6"><a></a><span class="co">#&gt; $ island            &lt;fct&gt; Biscoe, Torgersen, Biscoe, Dream, Biscoe, Dream, Dre…</span></span>
<span id="cb13-7"><a></a><span class="co">#&gt; $ bill_length_mm    &lt;dbl&gt; 46.2, 43.1, 46.2, 45.9, 46.5, 48.1, 45.2, 55.9, 38.1…</span></span>
<span id="cb13-8"><a></a><span class="co">#&gt; $ bill_depth_mm     &lt;dbl&gt; 14.9, 19.2, 14.4, 17.1, 13.5, 16.4, 17.8, 17.0, 17.0…</span></span>
<span id="cb13-9"><a></a><span class="co">#&gt; $ flipper_length_mm &lt;int&gt; 221, 197, 214, 190, 210, 199, 198, 228, 181, 195, 20…</span></span>
<span id="cb13-10"><a></a><span class="co">#&gt; $ body_mass_g       &lt;int&gt; 5300, 3500, 4650, 3575, 4550, 3325, 3950, 5600, 3175…</span></span>
<span id="cb13-11"><a></a><span class="co">#&gt; $ sex               &lt;fct&gt; male, male, NA, female, female, female, female, male…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a>penguins_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(resample_split)</span>
<span id="cb14-2"><a></a><span class="fu">glimpse</span>(penguins_test)</span>
<span id="cb14-3"><a></a><span class="co">#&gt; Rows: 69</span></span>
<span id="cb14-4"><a></a><span class="co">#&gt; Columns: 7</span></span>
<span id="cb14-5"><a></a><span class="co">#&gt; $ species           &lt;fct&gt; Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel…</span></span>
<span id="cb14-6"><a></a><span class="co">#&gt; $ island            &lt;fct&gt; Torgersen, Torgersen, Torgersen, Biscoe, Biscoe, Bis…</span></span>
<span id="cb14-7"><a></a><span class="co">#&gt; $ bill_length_mm    &lt;dbl&gt; NA, 39.3, 36.6, 35.9, 38.8, 37.9, 39.2, 39.6, 36.7, …</span></span>
<span id="cb14-8"><a></a><span class="co">#&gt; $ bill_depth_mm     &lt;dbl&gt; NA, 20.6, 17.8, 19.2, 17.2, 18.6, 21.1, 17.2, 18.8, …</span></span>
<span id="cb14-9"><a></a><span class="co">#&gt; $ flipper_length_mm &lt;int&gt; NA, 190, 185, 189, 180, 172, 196, 196, 187, 205, 187…</span></span>
<span id="cb14-10"><a></a><span class="co">#&gt; $ body_mass_g       &lt;int&gt; NA, 3650, 3700, 3800, 3800, 3150, 4150, 3550, 3800, …</span></span>
<span id="cb14-11"><a></a><span class="co">#&gt; $ sex               &lt;fct&gt; NA, male, female, female, male, female, male, female…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="proportional-gaps" class="slide level2">
<h2>Proportional Gaps</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a><span class="co"># Dataset</span></span>
<span id="cb15-2"><a></a>(<span class="fu">table</span>(penguins<span class="sc">$</span>species) <span class="sc">/</span> <span class="fu">nrow</span>(penguins))</span>
<span id="cb15-3"><a></a><span class="co">#&gt; </span></span>
<span id="cb15-4"><a></a><span class="co">#&gt;    Adelie Chinstrap    Gentoo </span></span>
<span id="cb15-5"><a></a><span class="co">#&gt; 0.4418605 0.1976744 0.3604651</span></span>
<span id="cb15-6"><a></a><span class="co"># Training Data</span></span>
<span id="cb15-7"><a></a>(<span class="fu">table</span>(penguins_train<span class="sc">$</span>species) <span class="sc">/</span> <span class="fu">nrow</span>(penguins_train))</span>
<span id="cb15-8"><a></a><span class="co">#&gt; </span></span>
<span id="cb15-9"><a></a><span class="co">#&gt;    Adelie Chinstrap    Gentoo </span></span>
<span id="cb15-10"><a></a><span class="co">#&gt; 0.4581818 0.1818182 0.3600000</span></span>
<span id="cb15-11"><a></a><span class="co"># Testing Data</span></span>
<span id="cb15-12"><a></a>(<span class="fu">table</span>(penguins_test<span class="sc">$</span>species) <span class="sc">/</span> <span class="fu">nrow</span>(penguins_test))</span>
<span id="cb15-13"><a></a><span class="co">#&gt; </span></span>
<span id="cb15-14"><a></a><span class="co">#&gt;    Adelie Chinstrap    Gentoo </span></span>
<span id="cb15-15"><a></a><span class="co">#&gt; 0.3768116 0.2608696 0.3623188</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="stratification-example" class="slide level2">
<h2>Stratification Example</h2>
<ul>
<li><p>A stratified random sample conducts a specified split within defined subsets of subsets, and then pools the results.</p></li>
<li><p>Only one column can be used to define a strata but grouping/mutate opperations can be used to create a new column that can be used as a strata (e.g.&nbsp;species/island)</p></li>
<li><p>In the case of the penguins data, we can stratify by species (think back to our nested/linear model appraoch)</p></li>
<li><p>This ensures that the training and testing sets have the same proportion of each species as the original data.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a><span class="co"># Set the seed</span></span>
<span id="cb16-2"><a></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb16-3"><a></a></span>
<span id="cb16-4"><a></a><span class="co"># Drop missing values and split the data</span></span>
<span id="cb16-5"><a></a>penguins <span class="ot">&lt;-</span> <span class="fu">drop_na</span>(penguins)</span>
<span id="cb16-6"><a></a>penguins_strata <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(penguins, <span class="at">strata =</span> species, <span class="at">prop =</span> .<span class="dv">8</span>)</span>
<span id="cb16-7"><a></a></span>
<span id="cb16-8"><a></a><span class="co"># Extract the training and testing sets</span></span>
<span id="cb16-9"><a></a></span>
<span id="cb16-10"><a></a>train_strata <span class="ot">&lt;-</span> <span class="fu">training</span>(penguins_strata)</span>
<span id="cb16-11"><a></a>test_strata  <span class="ot">&lt;-</span> <span class="fu">testing</span>(penguins_strata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="proportional-alignment" class="slide level2">
<h2>Proportional Alignment</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a><span class="co"># Check the proportions</span></span>
<span id="cb17-2"><a></a><span class="co"># Dataset</span></span>
<span id="cb17-3"><a></a><span class="fu">table</span>(penguins<span class="sc">$</span>species) <span class="sc">/</span> <span class="fu">nrow</span>(penguins)</span>
<span id="cb17-4"><a></a><span class="co">#&gt; </span></span>
<span id="cb17-5"><a></a><span class="co">#&gt;    Adelie Chinstrap    Gentoo </span></span>
<span id="cb17-6"><a></a><span class="co">#&gt; 0.4384384 0.2042042 0.3573574</span></span>
<span id="cb17-7"><a></a><span class="co"># Training Data</span></span>
<span id="cb17-8"><a></a><span class="fu">table</span>(train_strata<span class="sc">$</span>species) <span class="sc">/</span> <span class="fu">nrow</span>(train_strata)</span>
<span id="cb17-9"><a></a><span class="co">#&gt; </span></span>
<span id="cb17-10"><a></a><span class="co">#&gt;    Adelie Chinstrap    Gentoo </span></span>
<span id="cb17-11"><a></a><span class="co">#&gt; 0.4377358 0.2037736 0.3584906</span></span>
<span id="cb17-12"><a></a><span class="co"># Testing Data</span></span>
<span id="cb17-13"><a></a><span class="fu">table</span>(test_strata<span class="sc">$</span>species) <span class="sc">/</span> <span class="fu">nrow</span>(test_strata)</span>
<span id="cb17-14"><a></a><span class="co">#&gt; </span></span>
<span id="cb17-15"><a></a><span class="co">#&gt;    Adelie Chinstrap    Gentoo </span></span>
<span id="cb17-16"><a></a><span class="co">#&gt; 0.4411765 0.2058824 0.3529412</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modeling" class="slide level2">
<h2>Modeling</h2>
<div class="{columns}">
<div class="column" style="width:50%;">
<ul>
<li><p>Once the data is split, we can decide what type of model to invoke.</p></li>
<li><p>Often, users simply pick a well known model type or class for a type of problem (Classic Conceptual Model)</p></li>
<li><p>We will learn more about model types and uses next week!</p></li>
<li><p>For now, just know that the <strong>training</strong> data is used to fit a model.</p></li>
<li><p>If we are certain about the model, we can use the <strong>test</strong> data to evaluate the model.</p></li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/whole-game-split.jpg" style="width:45.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/whole-game-model-1.jpg" style="width:200.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="modeling-options" class="slide level2">
<h2>Modeling Options</h2>
<ul>
<li><p>But, there are many types of models, with different assumptions, behaviors, and qualities, that make some more applicable to a given dataset!</p></li>
<li><p>Most models have some type of parmeterization, that can often be <em>tuned</em>.</p></li>
<li><p>Testing combinations of model and tuning parmaters also requires some combintation of <code>training</code>/<code>testing</code> splits.</p></li>
</ul>

<img data-src="images/whole-game-model-n.jpg" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="modeling-options-1" class="slide level2">
<h2>Modeling Options</h2>
<p>What if we want to compare more models?</p>
<div class="fragment">
<p>And/or more model configurations?</p>
</div>
<div class="fragment">
<p>And we want to understand if these are important differences?</p>
</div>
<div class="fragment">
<p>How can we use the <em>training</em> data to compare and evaluate different models? 🤔</p>
</div>
<div class="fragment">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/whole-game-resamples.jpg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="resampling" class="slide level2">
<h2>Resampling</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>Testing combinations of model and tuning parmaters also requires some combintation of <code>training</code>/<code>testing</code> splits.</p></li>
<li><p>Resampling methods, such as cross-validation and bootstraping, are empirical simulation systems that help facilitate this.</p></li>
<li><p>They create a series of data sets similar to the initial <code>training</code>/<code>testing</code> split.</p></li>
<li><p>In the first level of the diagram to the right, we first split the original data into <code>training</code>/<code>testing</code> sets. Then, the training set is chosen for resampling.</p></li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center" data-caption="This schematic from [Kuhn and Johnson (2019)](https://bookdown.org/max/FES/resampling.html) illustrates data usage for resampling methods">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/resampling.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="key-resampling-methods" class="slide level2">
<h2>Key Resampling Methods</h2>
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Warning</strong></p>
</div>
<div class="callout-content">
<p>Resampling is always used with the training set.</p>
</div>
</div>
</div>
<p>Resampling is a key step in model validation and assessment. The <code>rsample</code> package provides tools to create resampling strategies such as cross-validation, bootstrapping, and validation splits.</p>
<div class="fragment">
<ol type="1">
<li><strong>K-Fold Cross-Validation</strong>: The dataset is split into multiple “folds” (e.g., 5-fold or 10-fold), where each fold is used as a validation set while the remaining data is used for training.</li>
</ol>
</div>
<div class="fragment">
<ol start="2" type="1">
<li><strong>Bootstrap Resampling</strong>: Samples are drawn <em>with replacement</em> from the training dataset to generate multiple datasets, which used to train and test the model.</li>
</ol>
</div>
<div class="fragment">
<ol start="3" type="1">
<li><strong>Monte Carlo Resampling (Repeated Train-Test Splits)</strong>: Randomly splits data multiple times.</li>
</ol>
</div>
<div class="fragment">
<ol start="4" type="1">
<li><strong>Validation Split</strong>: Creates a single training and testing partition.</li>
</ol>
</div>
</section>
<section id="cross-validation" class="slide level2">
<h2>Cross-validation</h2>

<img data-src="https://www.tmwr.org/premade/three-CV.svg" class="r-stretch"></section>
<section id="cross-validation-1" class="slide level2">
<h2>Cross-validation</h2>

<img data-src="https://www.tmwr.org/premade/three-CV-iter.svg" class="r-stretch"></section>
<section id="cross-validation-2" class="slide level2">
<h2>Cross-validation <img data-src="hexes/rsample.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="{columns}">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a>penguins_train <span class="sc">|&gt;</span> <span class="fu">glimpse</span>() </span>
<span id="cb18-2"><a></a><span class="co">#&gt; Rows: 275</span></span>
<span id="cb18-3"><a></a><span class="co">#&gt; Columns: 7</span></span>
<span id="cb18-4"><a></a><span class="co">#&gt; $ species           &lt;fct&gt; Gentoo, Adelie, Gentoo, Chinstrap, Gentoo, Chinstrap…</span></span>
<span id="cb18-5"><a></a><span class="co">#&gt; $ island            &lt;fct&gt; Biscoe, Torgersen, Biscoe, Dream, Biscoe, Dream, Dre…</span></span>
<span id="cb18-6"><a></a><span class="co">#&gt; $ bill_length_mm    &lt;dbl&gt; 46.2, 43.1, 46.2, 45.9, 46.5, 48.1, 45.2, 55.9, 38.1…</span></span>
<span id="cb18-7"><a></a><span class="co">#&gt; $ bill_depth_mm     &lt;dbl&gt; 14.9, 19.2, 14.4, 17.1, 13.5, 16.4, 17.8, 17.0, 17.0…</span></span>
<span id="cb18-8"><a></a><span class="co">#&gt; $ flipper_length_mm &lt;int&gt; 221, 197, 214, 190, 210, 199, 198, 228, 181, 195, 20…</span></span>
<span id="cb18-9"><a></a><span class="co">#&gt; $ body_mass_g       &lt;int&gt; 5300, 3500, 4650, 3575, 4550, 3325, 3950, 5600, 3175…</span></span>
<span id="cb18-10"><a></a><span class="co">#&gt; $ sex               &lt;fct&gt; male, male, NA, female, female, female, female, male…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a><span class="fu">nrow</span>(penguins_train) <span class="sc">*</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span></span>
<span id="cb19-2"><a></a><span class="co">#&gt; [1] 27.5</span></span>
<span id="cb19-3"><a></a></span>
<span id="cb19-4"><a></a><span class="fu">vfold_cv</span>(penguins_train, <span class="at">v =</span> <span class="dv">10</span>) <span class="co"># v = 10 is default</span></span>
<span id="cb19-5"><a></a><span class="co">#&gt; #  10-fold cross-validation </span></span>
<span id="cb19-6"><a></a><span class="co">#&gt; # A tibble: 10 × 2</span></span>
<span id="cb19-7"><a></a><span class="co">#&gt;    splits           id    </span></span>
<span id="cb19-8"><a></a><span class="co">#&gt;    &lt;list&gt;           &lt;chr&gt; </span></span>
<span id="cb19-9"><a></a><span class="co">#&gt;  1 &lt;split [247/28]&gt; Fold01</span></span>
<span id="cb19-10"><a></a><span class="co">#&gt;  2 &lt;split [247/28]&gt; Fold02</span></span>
<span id="cb19-11"><a></a><span class="co">#&gt;  3 &lt;split [247/28]&gt; Fold03</span></span>
<span id="cb19-12"><a></a><span class="co">#&gt;  4 &lt;split [247/28]&gt; Fold04</span></span>
<span id="cb19-13"><a></a><span class="co">#&gt;  5 &lt;split [247/28]&gt; Fold05</span></span>
<span id="cb19-14"><a></a><span class="co">#&gt;  6 &lt;split [248/27]&gt; Fold06</span></span>
<span id="cb19-15"><a></a><span class="co">#&gt;  7 &lt;split [248/27]&gt; Fold07</span></span>
<span id="cb19-16"><a></a><span class="co">#&gt;  8 &lt;split [248/27]&gt; Fold08</span></span>
<span id="cb19-17"><a></a><span class="co">#&gt;  9 &lt;split [248/27]&gt; Fold09</span></span>
<span id="cb19-18"><a></a><span class="co">#&gt; 10 &lt;split [248/27]&gt; Fold10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="https://www.tmwr.org/premade/three-CV.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="https://www.tmwr.org/premade/three-CV-iter.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="cross-validation-3" class="slide level2">
<h2>Cross-validation <img data-src="hexes/rsample.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<p>What is in this?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a>penguins_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(penguins_train)</span>
<span id="cb20-2"><a></a>penguins_folds<span class="sc">$</span>splits[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb20-3"><a></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb20-4"><a></a><span class="co">#&gt; &lt;Analysis/Assess/Total&gt;</span></span>
<span id="cb20-5"><a></a><span class="co">#&gt; &lt;247/28/275&gt;</span></span>
<span id="cb20-6"><a></a><span class="co">#&gt; </span></span>
<span id="cb20-7"><a></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb20-8"><a></a><span class="co">#&gt; &lt;Analysis/Assess/Total&gt;</span></span>
<span id="cb20-9"><a></a><span class="co">#&gt; &lt;247/28/275&gt;</span></span>
<span id="cb20-10"><a></a><span class="co">#&gt; </span></span>
<span id="cb20-11"><a></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb20-12"><a></a><span class="co">#&gt; &lt;Analysis/Assess/Total&gt;</span></span>
<span id="cb20-13"><a></a><span class="co">#&gt; &lt;247/28/275&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Here is another example of a list column enabling the storage of non-atomic types in tibble</p>
</div>
</div>
</div>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Important</strong></p>
</div>
<div class="callout-content">
<p>Set the seed when creating resamples</p>
</div>
</div>
</div>
</section>
<section>
<section id="alternate-resampling-schemes" class="title-slide slide level1 center">
<h1>Alternate resampling schemes</h1>

</section>
<section id="bootstrapping" class="slide level2">
<h2>Bootstrapping</h2>

<img data-src="https://www.tmwr.org/premade/bootstraps.svg" class="r-stretch"></section>
<section id="bootstrapping-1" class="slide level2">
<h2>Bootstrapping <img data-src="hexes/rsample.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a><span class="fu">set.seed</span>(<span class="dv">3214</span>)</span>
<span id="cb21-2"><a></a><span class="fu">bootstraps</span>(penguins_train)</span>
<span id="cb21-3"><a></a><span class="co">#&gt; # Bootstrap sampling </span></span>
<span id="cb21-4"><a></a><span class="co">#&gt; # A tibble: 25 × 2</span></span>
<span id="cb21-5"><a></a><span class="co">#&gt;    splits            id         </span></span>
<span id="cb21-6"><a></a><span class="co">#&gt;    &lt;list&gt;            &lt;chr&gt;      </span></span>
<span id="cb21-7"><a></a><span class="co">#&gt;  1 &lt;split [275/96]&gt;  Bootstrap01</span></span>
<span id="cb21-8"><a></a><span class="co">#&gt;  2 &lt;split [275/105]&gt; Bootstrap02</span></span>
<span id="cb21-9"><a></a><span class="co">#&gt;  3 &lt;split [275/108]&gt; Bootstrap03</span></span>
<span id="cb21-10"><a></a><span class="co">#&gt;  4 &lt;split [275/111]&gt; Bootstrap04</span></span>
<span id="cb21-11"><a></a><span class="co">#&gt;  5 &lt;split [275/102]&gt; Bootstrap05</span></span>
<span id="cb21-12"><a></a><span class="co">#&gt;  6 &lt;split [275/98]&gt;  Bootstrap06</span></span>
<span id="cb21-13"><a></a><span class="co">#&gt;  7 &lt;split [275/92]&gt;  Bootstrap07</span></span>
<span id="cb21-14"><a></a><span class="co">#&gt;  8 &lt;split [275/97]&gt;  Bootstrap08</span></span>
<span id="cb21-15"><a></a><span class="co">#&gt;  9 &lt;split [275/100]&gt; Bootstrap09</span></span>
<span id="cb21-16"><a></a><span class="co">#&gt; 10 &lt;split [275/99]&gt;  Bootstrap10</span></span>
<span id="cb21-17"><a></a><span class="co">#&gt; # ℹ 15 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="monte-carlo-cross-validation" class="slide level2">
<h2>Monte Carlo Cross-Validation <img data-src="hexes/rsample.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a><span class="fu">set.seed</span>(<span class="dv">322</span>)</span>
<span id="cb22-2"><a></a><span class="fu">mc_cv</span>(penguins_train, <span class="at">times =</span> <span class="dv">10</span>)</span>
<span id="cb22-3"><a></a><span class="co">#&gt; # Monte Carlo cross-validation (0.75/0.25) with 10 resamples  </span></span>
<span id="cb22-4"><a></a><span class="co">#&gt; # A tibble: 10 × 2</span></span>
<span id="cb22-5"><a></a><span class="co">#&gt;    splits           id        </span></span>
<span id="cb22-6"><a></a><span class="co">#&gt;    &lt;list&gt;           &lt;chr&gt;     </span></span>
<span id="cb22-7"><a></a><span class="co">#&gt;  1 &lt;split [206/69]&gt; Resample01</span></span>
<span id="cb22-8"><a></a><span class="co">#&gt;  2 &lt;split [206/69]&gt; Resample02</span></span>
<span id="cb22-9"><a></a><span class="co">#&gt;  3 &lt;split [206/69]&gt; Resample03</span></span>
<span id="cb22-10"><a></a><span class="co">#&gt;  4 &lt;split [206/69]&gt; Resample04</span></span>
<span id="cb22-11"><a></a><span class="co">#&gt;  5 &lt;split [206/69]&gt; Resample05</span></span>
<span id="cb22-12"><a></a><span class="co">#&gt;  6 &lt;split [206/69]&gt; Resample06</span></span>
<span id="cb22-13"><a></a><span class="co">#&gt;  7 &lt;split [206/69]&gt; Resample07</span></span>
<span id="cb22-14"><a></a><span class="co">#&gt;  8 &lt;split [206/69]&gt; Resample08</span></span>
<span id="cb22-15"><a></a><span class="co">#&gt;  9 &lt;split [206/69]&gt; Resample09</span></span>
<span id="cb22-16"><a></a><span class="co">#&gt; 10 &lt;split [206/69]&gt; Resample10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="validation-set" class="slide level2">
<h2>Validation set <img data-src="hexes/rsample.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb23-2"><a></a>penguins_val_split <span class="ot">&lt;-</span> <span class="fu">initial_validation_split</span>(penguins)</span>
<span id="cb23-3"><a></a>penguins_val_split</span>
<span id="cb23-4"><a></a><span class="co">#&gt; &lt;Training/Validation/Testing/Total&gt;</span></span>
<span id="cb23-5"><a></a><span class="co">#&gt; &lt;199/67/67/333&gt;</span></span>
<span id="cb23-6"><a></a><span class="fu">validation_set</span>(penguins_val_split)</span>
<span id="cb23-7"><a></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb23-8"><a></a><span class="co">#&gt;   splits           id        </span></span>
<span id="cb23-9"><a></a><span class="co">#&gt;   &lt;list&gt;           &lt;chr&gt;     </span></span>
<span id="cb23-10"><a></a><span class="co">#&gt; 1 &lt;split [199/67]&gt; validation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>A validation set is just another type of resample</p>
</div>
</section>
<section id="the-whole-game---status-update" class="slide level2">
<h2>The whole game - status update</h2>

<img data-src="images/whole-game-transparent-resamples.jpg" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="section-1" class="slide level2" data-background-iframe="https://rsample.tidymodels.org/reference/index.html">
<h2></h2>
<div class="footer">

</div>
</section></section>
<section>
<section id="unit-example" class="title-slide slide level1 center" data-background-image="images/oregon-forest.png" data-background-opacity=".5">
<h1>Unit Example</h1>
<p>Can we predict if a plot of land is forested? - Interested in classification models - We have a dataset of 7,107 6000-acre hexagons in Washington state. - Each hexagon has a nominal outcome, <code>forested</code>, with levels <code>"Yes"</code> and <code>"No"</code>.</p>
</section>
<section id="data-on-forests-in-washington" class="slide level2">
<h2>Data on forests in Washington</h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>The U.S. Forest Service maintains ML models to predict whether a plot of land is “forested.”</li>
<li>This classification is important for all sorts of research, legislation, and land management purposes.</li>
<li>Plots are typically remeasured every 10 years and this dataset contains the most recent measurement per plot.</li>
<li>Type <code>?forested</code> to learn more about this dataset, including references.</li>
</ul>
</div><div class="column" style="width:40%;">
<p><img data-src="images/forest_mountain.svg"></p>
</div></div>
<div class="footer">
<p>Credit: <a href="https://www.svgrepo.com/svg/251793/forest-mountain" class="uri">https://www.svgrepo.com/svg/251793/forest-mountain</a></p>
</div>
</section>
<section id="data-on-forests-in-washington-1" class="slide level2">
<h2>Data on forests in Washington</h2>
<div class="columns">
<div class="column" style="width:70%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb24-2"><a></a><span class="fu">library</span>(forested)</span>
<span id="cb24-3"><a></a><span class="fu">dim</span>(forested)</span>
<span id="cb24-4"><a></a><span class="co">#&gt; [1] 7107   19</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>One observation from each of 7,107 6000-acre hexagons in Washington state.</p></li>
<li><p>A nominal outcome, <code>forested</code>, with levels <code>"Yes"</code> and <code>"No"</code>, measured “on-the-ground.”</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a><span class="fu">table</span>(forested<span class="sc">$</span>forested)</span>
<span id="cb25-2"><a></a><span class="co">#&gt; </span></span>
<span id="cb25-3"><a></a><span class="co">#&gt;  Yes   No </span></span>
<span id="cb25-4"><a></a><span class="co">#&gt; 3894 3213</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>18 remotely-sensed and easily-accessible predictors:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a><span class="fu">names</span>(forested)</span>
<span id="cb26-2"><a></a><span class="co">#&gt;  [1] "forested"         "year"             "elevation"        "eastness"        </span></span>
<span id="cb26-3"><a></a><span class="co">#&gt;  [5] "northness"        "roughness"        "tree_no_tree"     "dew_temp"        </span></span>
<span id="cb26-4"><a></a><span class="co">#&gt;  [9] "precip_annual"    "temp_annual_mean" "temp_annual_min"  "temp_annual_max" </span></span>
<span id="cb26-5"><a></a><span class="co">#&gt; [13] "temp_january_min" "vapor_min"        "vapor_max"        "canopy_cover"    </span></span>
<span id="cb26-6"><a></a><span class="co">#&gt; [17] "lon"              "lat"              "land_type"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:30%;">
<p><img data-src="images/forest.svg" class="center"></p>
</div></div>
<div class="footer">
<p>Credit: <a href="https://www.svgrepo.com/svg/67614/forest" class="uri">https://www.svgrepo.com/svg/67614/forest</a></p>
</div>
</section>
<section id="data-splitting-and-spending" class="slide level2">
<h2>Data splitting and spending</h2>
<h3 id="the-initial-split">The initial split <img data-src="hexes/rsample.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb27-2"><a></a>forested_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(forested, <span class="at">prop =</span> .<span class="dv">8</span>, <span class="at">strata =</span> tree_no_tree)</span>
<span id="cb27-3"><a></a>forested_split</span>
<span id="cb27-4"><a></a><span class="co">#&gt; &lt;Training/Testing/Total&gt;</span></span>
<span id="cb27-5"><a></a><span class="co">#&gt; &lt;5685/1422/7107&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="accessing-the-data-1" class="slide level2">
<h2>Accessing the data <img data-src="hexes/rsample.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a>forested_train <span class="ot">&lt;-</span> <span class="fu">training</span>(forested_split)</span>
<span id="cb28-2"><a></a>forested_test  <span class="ot">&lt;-</span> <span class="fu">testing</span>(forested_split)</span>
<span id="cb28-3"><a></a></span>
<span id="cb28-4"><a></a><span class="fu">nrow</span>(forested_train)</span>
<span id="cb28-5"><a></a><span class="co">#&gt; [1] 5685</span></span>
<span id="cb28-6"><a></a><span class="fu">nrow</span>(forested_test)</span>
<span id="cb28-7"><a></a><span class="co">#&gt; [1] 1422</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="k-fold-cross-validation" class="slide level2">
<h2>K-Fold Cross-Validation <img data-src="hexes/rsample.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a><span class="co"># Load the dataset</span></span>
<span id="cb29-2"><a></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb29-3"><a></a></span>
<span id="cb29-4"><a></a><span class="co"># Create a 10-fold cross-validation object</span></span>
<span id="cb29-5"><a></a>(forested_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(forested_train, <span class="at">v =</span> <span class="dv">10</span>))</span>
<span id="cb29-6"><a></a><span class="co">#&gt; #  10-fold cross-validation </span></span>
<span id="cb29-7"><a></a><span class="co">#&gt; # A tibble: 10 × 2</span></span>
<span id="cb29-8"><a></a><span class="co">#&gt;    splits             id    </span></span>
<span id="cb29-9"><a></a><span class="co">#&gt;    &lt;list&gt;             &lt;chr&gt; </span></span>
<span id="cb29-10"><a></a><span class="co">#&gt;  1 &lt;split [5116/569]&gt; Fold01</span></span>
<span id="cb29-11"><a></a><span class="co">#&gt;  2 &lt;split [5116/569]&gt; Fold02</span></span>
<span id="cb29-12"><a></a><span class="co">#&gt;  3 &lt;split [5116/569]&gt; Fold03</span></span>
<span id="cb29-13"><a></a><span class="co">#&gt;  4 &lt;split [5116/569]&gt; Fold04</span></span>
<span id="cb29-14"><a></a><span class="co">#&gt;  5 &lt;split [5116/569]&gt; Fold05</span></span>
<span id="cb29-15"><a></a><span class="co">#&gt;  6 &lt;split [5117/568]&gt; Fold06</span></span>
<span id="cb29-16"><a></a><span class="co">#&gt;  7 &lt;split [5117/568]&gt; Fold07</span></span>
<span id="cb29-17"><a></a><span class="co">#&gt;  8 &lt;split [5117/568]&gt; Fold08</span></span>
<span id="cb29-18"><a></a><span class="co">#&gt;  9 &lt;split [5117/568]&gt; Fold09</span></span>
<span id="cb29-19"><a></a><span class="co">#&gt; 10 &lt;split [5117/568]&gt; Fold10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-do-you-fit-a-linear-model-in-r" class="slide level2">
<h2>How do you fit a linear model in R?</h2>
<ul>
<li><p><code>lm</code> for linear model &lt;– The one we have looked at!</p></li>
<li><p><code>glmnet</code> for regularized regression</p></li>
<li><p><code>keras</code> for regression using TensorFlow</p></li>
<li><p><code>stan</code> for Bayesian regression using Stan</p></li>
<li><p><code>spark</code> for large data sets using spark</p></li>
<li><p><code>brulee</code> for regression using torch (PyTourch)</p></li>
</ul>
</section>
<section id="challenge" class="slide level2">
<h2>Challenge</h2>
<ul>
<li>All of these models have different syntax and functions</li>
<li>How do you keep track of all of them?</li>
<li>How do you know which one to use?</li>
<li>How would you compare them?</li>
</ul>
<p>Comparing 3-5 of these models is a lot of work using functions for diverse packages.</p>
<div class="{columns}">
<div class="column" style="width:40%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/lm-help.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/glm-help.png" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="the-tidymodels-advantage" class="slide level2">
<h2>The tidymodels advantage</h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>In the <code>tidymodels</code> framework, all models are created using the same syntax:
<ul>
<li>This makes it easy to compare models</li>
<li>This makes it easy to switch between models</li>
<li>This makes it easy to use the same model with different engines (packages)</li>
</ul></li>
<li>The <code>parsnip</code> package provides a consistent interface to many models</li>
<li>For example, to fit a linear model you would be able to access the <code>linear_reg(</code>) function</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a>?linear_reg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/lm_engines.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="a-tidymodels-prediction-will" class="slide level2">
<h2>A tidymodels prediction will … <img data-src="hexes/tidymodels.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<ul>
<li>always be inside a <strong>tibble</strong></li>
<li>have column names and types are <strong>unsurprising</strong> and <strong>predictable</strong></li>
<li>ensure the number of rows in <code>new_data</code> and the output <strong>are the same</strong></li>
</ul>
</section>
<section id="to-specify-a-model" class="slide level2">
<h2>To specify a model <img data-src="hexes/parsnip.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="fragment">
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>Choose a <u>model</u></li>
<li>Specify an engine</li>
<li>Set the mode</li>
</ul>
</div><div class="column" style="width:40%;">
<p><br><br><br> <img data-src="images/forest_mountain.svg" class="absolute" style="height: 300px; "></p>
</div></div>
</div>
</section>
<section id="specify-a-model-type" class="slide level2">
<h2>Specify a model: Type <img data-src="hexes/parsnip.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<p>Next week we will discuss model types more thoroughly. For now, we will focus on two types:</p>
<ol type="1">
<li>Logistic Regression</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a><span class="fu">logistic_reg</span>()</span>
<span id="cb31-2"><a></a><span class="co">#&gt; Logistic Regression Model Specification (classification)</span></span>
<span id="cb31-3"><a></a><span class="co">#&gt; </span></span>
<span id="cb31-4"><a></a><span class="co">#&gt; Computational engine: glm</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a><span class="fu">decision_tree</span>()</span>
<span id="cb32-2"><a></a><span class="co">#&gt; Decision Tree Model Specification (unknown mode)</span></span>
<span id="cb32-3"><a></a><span class="co">#&gt; </span></span>
<span id="cb32-4"><a></a><span class="co">#&gt; Computational engine: rpart</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We chose these two because they are robust, simple model that fit our goal of predicting a binary condition/class (forested/not forested)</p>
</section>
<section id="specify-a-model-engine" class="slide level2">
<h2>Specify a model: engine <img data-src="hexes/parsnip.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>Choose a model</li>
<li>Specify an <u>engine</u></li>
<li>Set the mode</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a>?<span class="fu">logistic_reg</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/log_reg_help_engine.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="specify-a-model-engine-1" class="slide level2">
<h2>Specify a model: engine <img data-src="hexes/parsnip.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a></a><span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>)</span>
<span id="cb34-3"><a></a><span class="co">#&gt; Logistic Regression Model Specification (classification)</span></span>
<span id="cb34-4"><a></a><span class="co">#&gt; </span></span>
<span id="cb34-5"><a></a><span class="co">#&gt; Computational engine: glmnet</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a><span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a></a>  <span class="fu">set_engine</span>(<span class="st">"stan"</span>)</span>
<span id="cb35-3"><a></a><span class="co">#&gt; Logistic Regression Model Specification (classification)</span></span>
<span id="cb35-4"><a></a><span class="co">#&gt; </span></span>
<span id="cb35-5"><a></a><span class="co">#&gt; Computational engine: stan</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="specify-a-model-mode" class="slide level2">
<h2>Specify a model: mode <img data-src="hexes/parsnip.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>Choose a model</li>
<li>Specify an engine</li>
<li>Set the <u>mode</u></li>
</ul>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a></a>?<span class="fu">logistic_reg</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/log_reg_help_class.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="specify-a-model-mode-1" class="slide level2">
<h2>Specify a model: mode <img data-src="hexes/parsnip.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<h4 id="some-models-have-limit-classes">Some models have limit classes …</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a></a><span class="fu">logistic_reg</span>() </span>
<span id="cb37-2"><a></a><span class="co">#&gt; Logistic Regression Model Specification (classification)</span></span>
<span id="cb37-3"><a></a><span class="co">#&gt; </span></span>
<span id="cb37-4"><a></a><span class="co">#&gt; Computational engine: glm</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<h4 id="others-requires-specification">Others requires specification …</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a></a><span class="fu">decision_tree</span>()</span>
<span id="cb38-2"><a></a><span class="co">#&gt; Decision Tree Model Specification (unknown mode)</span></span>
<span id="cb38-3"><a></a><span class="co">#&gt; </span></span>
<span id="cb38-4"><a></a><span class="co">#&gt; Computational engine: rpart</span></span>
<span id="cb38-5"><a></a></span>
<span id="cb38-6"><a></a><span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-7"><a></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb38-8"><a></a><span class="co">#&gt; Decision Tree Model Specification (classification)</span></span>
<span id="cb38-9"><a></a><span class="co">#&gt; </span></span>
<span id="cb38-10"><a></a><span class="co">#&gt; Computational engine: rpart</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="r-fit-text">
<p>All available models are listed at <a href="https://www.tidymodels.org/find/parsnip/" class="uri">https://www.tidymodels.org/find/parsnip/</a></p>
</div>
</section>
<section id="section-2" class="slide level2" data-background-iframe="https://www.tidymodels.org/find/parsnip/">
<h2></h2>
<div class="footer">

</div>
</section>
<section id="to-specify-a-model-1" class="slide level2">
<h2>To specify a model <img data-src="hexes/parsnip.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>Choose a <u>model</u></li>
<li>Specify an <u>engine</u></li>
<li>Set the <u>mode</u></li>
</ul>
</div><div class="column" style="width:40%;">
<p><br><br><br> <img data-src="images/forest_mountain.svg" class="absolute" style="height: 300px; "></p>
</div></div>
</section>
<section id="logistic-regression" class="slide level2">
<h2>Logistic regression</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>Logistic regression predicts probability—instead of a straight line, it gives an S-shaped curve that estimates how likely an outcome (e.g., is forested) is based on a predictor (e.g., rainfall and temperature).</p></li>
<li><p>The dots in the plot show the actual proportion of “successes” (e.g., is forested) within different bins of the predictor variable(s) (A).</p></li>
<li><p>The vertical error bars represent uncertainty—showing a range where the true probability might fall.</p></li>
<li><p>Logistic regression helps answer “how likely” questions—e.g., “How likely is someone to pass based on their study hours?” rather than just predicting a yes/no outcome.</p></li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-5_files/figure-revealjs/plot-logistic-reg-2-1.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="decision-trees" class="slide level2">
<h2>Decision trees</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week-5_files/figure-revealjs/plot-tree-fit-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">

</div></div>
</section>
<section id="decision-trees-1" class="slide level2">
<h2>Decision trees</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week-5_files/figure-revealjs/plot-tree-fit-2-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<ul>
<li><p>Series of splits or if/then statements based on predictors</p></li>
<li><p>First the tree <em>grows</em> until some condition is met (maximum depth, no more data)</p></li>
<li><p>Then the tree is <em>pruned</em> to reduce its complexity</p></li>
</ul>
</div></div>
</section>
<section id="decision-trees-2" class="slide level2">
<h2>Decision trees</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week-5_files/figure-revealjs/plot-tree-fit-3-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-5_files/figure-revealjs/plot-tree-preds-1.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="what-algorithm-is-best-for-estimate-forested-plots" class="slide level2">
<h2>What algorithm is best for estimate forested plots?</h2>
<p>We can only really know by testing them …</p>
<div class="columns">
<div class="column" style="width:50%;">
<h4 id="logistic-regression-1">Logistic regression</h4>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-5_files/figure-revealjs/plot-logistic-reg-3-1.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<h4 id="decision-trees-3">Decision trees</h4>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-5_files/figure-revealjs/plot-tree-preds-2-1.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="fitting-your-model" class="slide level2">
<h2>Fitting your model:</h2>
<ul>
<li>OK! So you have split data, you have a model, and you have an engine and mode</li>
<li>Now you need to fit the model!</li>
<li>This is done using the <code>fit()</code> function</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a></a>dt_model <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a></a>  <span class="fu">set_engine</span>(<span class="st">'rpart'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb39-4"><a></a></span>
<span id="cb39-5"><a></a><span class="co"># Model, formula, data inputs</span></span>
<span id="cb39-6"><a></a>(output <span class="ot">&lt;-</span> <span class="fu">fit</span>(dt_model, forested <span class="sc">~</span> ., <span class="at">data =</span> forested_train) )</span>
<span id="cb39-7"><a></a><span class="co">#&gt; parsnip model object</span></span>
<span id="cb39-8"><a></a><span class="co">#&gt; </span></span>
<span id="cb39-9"><a></a><span class="co">#&gt; n= 5685 </span></span>
<span id="cb39-10"><a></a><span class="co">#&gt; </span></span>
<span id="cb39-11"><a></a><span class="co">#&gt; node), split, n, loss, yval, (yprob)</span></span>
<span id="cb39-12"><a></a><span class="co">#&gt;       * denotes terminal node</span></span>
<span id="cb39-13"><a></a><span class="co">#&gt; </span></span>
<span id="cb39-14"><a></a><span class="co">#&gt;  1) root 5685 2571 Yes (0.54775726 0.45224274)  </span></span>
<span id="cb39-15"><a></a><span class="co">#&gt;    2) land_type=Tree 3025  289 Yes (0.90446281 0.09553719) *</span></span>
<span id="cb39-16"><a></a><span class="co">#&gt;    3) land_type=Barren,Non-tree vegetation 2660  378 No (0.14210526 0.85789474)  </span></span>
<span id="cb39-17"><a></a><span class="co">#&gt;      6) temp_annual_max&lt; 13.395 351  155 Yes (0.55840456 0.44159544)  </span></span>
<span id="cb39-18"><a></a><span class="co">#&gt;       12) tree_no_tree=Tree 91    5 Yes (0.94505495 0.05494505) *</span></span>
<span id="cb39-19"><a></a><span class="co">#&gt;       13) tree_no_tree=No tree 260  110 No (0.42307692 0.57692308) *</span></span>
<span id="cb39-20"><a></a><span class="co">#&gt;      7) temp_annual_max&gt;=13.395 2309  182 No (0.07882200 0.92117800) *</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="component-extracts" class="slide level2">
<h2>Component extracts:</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>While <code>tidymodels</code> provides a standard interface to all models all base models have specific methods (remember <code>summary.lm</code>? )</p></li>
<li><p>To use these, you must extract a the underlying object.</p></li>
<li><p><code>extract_fit_engine()</code> extracts the underlying model object</p></li>
<li><p><code>extract_fit_parsnip()</code> extracts the parsnip object</p></li>
<li><p><code>extract_recipe()</code> extracts the recipe object</p></li>
<li><p><code>extract_preprocessor()</code> extracts the preprocessor object</p></li>
<li><p>… many more</p></li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a></a>ex <span class="ot">&lt;-</span> <span class="fu">extract_fit_engine</span>(output)</span>
<span id="cb40-2"><a></a><span class="fu">class</span>(ex) <span class="co"># the class of the engine used!</span></span>
<span id="cb40-3"><a></a><span class="co">#&gt; [1] "rpart"</span></span>
<span id="cb40-4"><a></a></span>
<span id="cb40-5"><a></a><span class="co"># Use rpart plot and text methods ...</span></span>
<span id="cb40-6"><a></a><span class="fu">plot</span>(ex)</span>
<span id="cb40-7"><a></a><span class="fu">text</span>(ex, <span class="at">cex =</span> <span class="fl">0.9</span>, <span class="at">use.n =</span> <span class="cn">TRUE</span>, <span class="at">xpd =</span> <span class="cn">TRUE</span>,)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-5_files/figure-revealjs/unnamed-chunk-26-1.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section></section>
<section>
<section id="a-model-workflow" class="title-slide slide level1 center">
<h1>A model workflow</h1>

</section>
<section id="workflows" class="slide level2">
<h2>Workflows? <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<p>The <code>workflows</code> package in <code>tidymodels</code> helps:</p>
<ul>
<li><p>Manage preprocessing and modeling in a structured pipeline</p></li>
<li><p>Avoid repetitive code</p></li>
<li><p>Reduce errors when integrating steps</p></li>
</ul>
<div class="fragment">
<p>Think of them as containers for:</p>
<ul>
<li><p>Preprocessing steps (e.g., feature engineering, transformations)</p></li>
<li><p>Model specification</p></li>
<li><p>Fitting approaches</p></li>
</ul>
</div>
<div class="fragment">
<p>Why Use Workflows?</p>
<p>✅ Keeps preprocessing and modeling together<br>
</p>
<p>✅ Ensures consistency in data handling &nbsp;</p>
<p>✅ Makes code easier to read and maintain&nbsp;</p>
</div>
</section>
<section id="basic-workflow-structure" class="slide level2">
<h2>Basic Workflow Structure: <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<ol type="1">
<li><p>Create a workflow object (similar to how <code>ggplot()</code> instantiates a canvas)</p></li>
<li><p>Add a formula or recipe (preprocessor)</p></li>
<li><p>Add the model</p></li>
<li><p>Fit the workflow</p></li>
</ol>
</section>
<section id="a-model-workflow-1" class="slide level2">
<h2>A model workflow <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/parsnip.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a></a>dt_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a></a>  <span class="fu">add_formula</span>(forested <span class="sc">~</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a></a>  <span class="fu">add_model</span>(dt_model) <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a></a>  <span class="fu">fit</span>(<span class="at">data =</span> forested_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="cell">
<pre><code>#&gt; ══ Workflow [trained] ══════════════════════════════════════════════════════════
#&gt; Preprocessor: Formula
#&gt; Model: decision_tree()
#&gt; 
#&gt; ── Preprocessor ────────────────────────────────────────────────────────────────
#&gt; forested ~ .
#&gt; 
#&gt; ── Model ───────────────────────────────────────────────────────────────────────
#&gt; n= 5685 
#&gt; 
#&gt; node), split, n, loss, yval, (yprob)
#&gt;       * denotes terminal node
#&gt; 
#&gt;  1) root 5685 2571 Yes (0.54775726 0.45224274)  
#&gt;    2) land_type=Tree 3025  289 Yes (0.90446281 0.09553719) *
#&gt;    3) land_type=Barren,Non-tree vegetation 2660  378 No (0.14210526 0.85789474)  
#&gt;      6) temp_annual_max&lt; 13.395 351  155 Yes (0.55840456 0.44159544)  
#&gt;       12) tree_no_tree=Tree 91    5 Yes (0.94505495 0.05494505) *
#&gt;       13) tree_no_tree=No tree 260  110 No (0.42307692 0.57692308) *
#&gt;      7) temp_annual_max&gt;=13.395 2309  182 No (0.07882200 0.92117800) *</code></pre>
</div>
</section>
<section id="predict-with-your-model" class="slide level2">
<h2>Predict with your model <img data-src="hexes/broom.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<p><em>How do you use your new model?</em></p>
<ul>
<li><code>augment()</code> will return the dataset with predictions and residuals added.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a></a>dt_preds <span class="ot">&lt;-</span> <span class="fu">augment</span>(dt_wf, <span class="at">new_data =</span> forested_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="cell">
<pre><code>#&gt; # A tibble: 1,422 × 22
#&gt;    .pred_class .pred_Yes .pred_No forested  year elevation eastness northness
#&gt;    &lt;fct&gt;           &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
#&gt;  1 Yes            0.904    0.0955 No        2005       164      -84        53
#&gt;  2 Yes            0.904    0.0955 Yes       2005       806       47       -88
#&gt;  3 No             0.423    0.577  Yes       2005      2240      -67       -74
#&gt;  4 Yes            0.904    0.0955 Yes       2005       787       66       -74
#&gt;  5 Yes            0.904    0.0955 Yes       2005      1330       99         7
#&gt;  6 Yes            0.904    0.0955 Yes       2005      1423       46        88
#&gt;  7 Yes            0.904    0.0955 Yes       2014       546      -92       -38
#&gt;  8 Yes            0.904    0.0955 Yes       2014      1612       30       -95
#&gt;  9 No             0.0788   0.921  No        2014       235        0      -100
#&gt; 10 No             0.0788   0.921  No        2014       308      -70       -70
#&gt; # ℹ 1,412 more rows
#&gt; # ℹ 14 more variables: roughness &lt;dbl&gt;, tree_no_tree &lt;fct&gt;, dew_temp &lt;dbl&gt;,
#&gt; #   precip_annual &lt;dbl&gt;, temp_annual_mean &lt;dbl&gt;, temp_annual_min &lt;dbl&gt;,
#&gt; #   temp_annual_max &lt;dbl&gt;, temp_january_min &lt;dbl&gt;, vapor_min &lt;dbl&gt;,
#&gt; #   vapor_max &lt;dbl&gt;, canopy_cover &lt;dbl&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;, land_type &lt;fct&gt;</code></pre>
</div>
</section>
<section id="evaluate-your-model" class="slide level2">
<h2>Evaluate your model <img data-src="hexes/yardstick.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<p><em>How do you evaluate the skill of your models?</em></p>
<p>We will learn more about model evaluation and tuning latter in this unit, but for now we can blindly use the <code>metrics()</code> function defaults to get a sense of how our model is doing.</p>
<ul>
<li><p>The default metrics for <em>classification</em> models are <strong>accuracy</strong> and <strong>kap</strong> (Cohen’s Kappa)</p></li>
<li><p>The default metric for <em>regression</em> models are <strong>RMSE</strong>, <strong>R^2</strong>, and <strong>MAE</strong></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a></a><span class="co"># We have a classification model</span></span>
<span id="cb45-2"><a></a><span class="fu">metrics</span>(dt_preds, <span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb45-3"><a></a><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span id="cb45-4"><a></a><span class="co">#&gt;   .metric  .estimator .estimate</span></span>
<span id="cb45-5"><a></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb45-6"><a></a><span class="co">#&gt; 1 accuracy binary         0.885</span></span>
<span id="cb45-7"><a></a><span class="co">#&gt; 2 kap      binary         0.768</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="tidymodels-advantage" class="title-slide slide level1 center">
<h1><code>tidymodels</code> advantage! <img data-src="hexes/tidymodels.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h1>
<ul>
<li>OK! while that was not too much work, it certainly wasn’t minimal.</li>
</ul>
<div class="fragment">
<ul>
<li><p>Now lets say you want to check if the logistic regression model performs better than the decision tree</p></li>
<li><p>That sounds like a lot to repeat.</p></li>
<li><p>Fortunately, the <code>tidymodels</code> framework makes this a straight forward swap!</p></li>
</ul>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a></a>log_mod <span class="ot">=</span> <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb46-4"><a></a></span>
<span id="cb46-5"><a></a>log_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb46-6"><a></a>  <span class="fu">add_formula</span>(forested <span class="sc">~</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb46-7"><a></a>  <span class="fu">add_model</span>(log_mod) <span class="sc">%&gt;%</span></span>
<span id="cb46-8"><a></a>  <span class="fu">fit</span>(<span class="at">data =</span> forested_train)</span>
<span id="cb46-9"><a></a></span>
<span id="cb46-10"><a></a>log_preds <span class="ot">&lt;-</span> <span class="fu">augment</span>(log_wf, <span class="at">new_data =</span> forested_test)</span>
<span id="cb46-11"><a></a></span>
<span id="cb46-12"><a></a><span class="fu">metrics</span>(log_preds, <span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb46-13"><a></a><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span id="cb46-14"><a></a><span class="co">#&gt;   .metric  .estimator .estimate</span></span>
<span id="cb46-15"><a></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb46-16"><a></a><span class="co">#&gt; 1 accuracy binary         0.890</span></span>
<span id="cb46-17"><a></a><span class="co">#&gt; 2 kap      binary         0.777</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="so-who-wins" class="slide level2">
<h2>So who wins?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a></a><span class="fu">metrics</span>(dt_preds, <span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb47-2"><a></a><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span id="cb47-3"><a></a><span class="co">#&gt;   .metric  .estimator .estimate</span></span>
<span id="cb47-4"><a></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb47-5"><a></a><span class="co">#&gt; 1 accuracy binary         0.885</span></span>
<span id="cb47-6"><a></a><span class="co">#&gt; 2 kap      binary         0.768</span></span>
<span id="cb47-7"><a></a><span class="fu">metrics</span>(log_preds, <span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb47-8"><a></a><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span id="cb47-9"><a></a><span class="co">#&gt;   .metric  .estimator .estimate</span></span>
<span id="cb47-10"><a></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb47-11"><a></a><span class="co">#&gt; 1 accuracy binary         0.890</span></span>
<span id="cb47-12"><a></a><span class="co">#&gt; 2 kap      binary         0.777</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Right out of the gate, there doesn’t seem to be much difference, but …</p>
</section>
<section id="dont-get-to-confident" class="slide level2">
<h2>Don’t get to confident!</h2>
<ul>
<li>We have evaluated the model on the same data we trained it on</li>
<li>This is not a good practice and can give us a false sense of confidence</li>
<li>Instead, we can use our <code>resamples</code> to better understand the skill of a model based on the iterative leave out policy:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a></a>dt_wf_rs <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a></a>  <span class="fu">add_formula</span>(forested <span class="sc">~</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a></a>  <span class="fu">add_model</span>(dt_model) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a></a>  <span class="fu">fit_resamples</span>(<span class="at">resamples =</span> forested_folds, </span>
<span id="cb48-5"><a></a>                <span class="co"># Here we just ask tidymodels to save all predictions...</span></span>
<span id="cb48-6"><a></a>                <span class="at">control   =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="cell">
<pre><code>#&gt; # A tibble: 1 × 5
#&gt;   splits             id     .metrics         .notes           .predictions      
#&gt;   &lt;list&gt;             &lt;chr&gt;  &lt;list&gt;           &lt;list&gt;           &lt;list&gt;            
#&gt; 1 &lt;split [5116/569]&gt; Fold01 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [569 × 6]&gt;</code></pre>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p><code>tidyr::unnest</code> could be used to expand any of those list columns!</p>
</div>
</div>
</div>
</section>
<section id="dont-get-to-confident-1" class="slide level2">
<h2>Don’t get to confident!</h2>
<ul>
<li>We can execute the same workflow for the logistic regression model, this time evaluating the resamples instead of the test data.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a></a>log_wf_rs <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a></a>  <span class="fu">add_formula</span>(forested <span class="sc">~</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a></a>  <span class="fu">add_model</span>(log_mod) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a></a>  <span class="fu">fit_resamples</span>(<span class="at">resamples =</span> forested_folds,</span>
<span id="cb50-5"><a></a>                <span class="at">control =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="cell">
<pre><code>#&gt; # Resampling results
#&gt; # 10-fold cross-validation 
#&gt; # A tibble: 10 × 5
#&gt;    splits             id     .metrics         .notes           .predictions
#&gt;    &lt;list&gt;             &lt;chr&gt;  &lt;list&gt;           &lt;list&gt;           &lt;list&gt;      
#&gt;  1 &lt;split [5116/569]&gt; Fold01 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt;  2 &lt;split [5116/569]&gt; Fold02 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt;  3 &lt;split [5116/569]&gt; Fold03 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt;  4 &lt;split [5116/569]&gt; Fold04 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt;  5 &lt;split [5116/569]&gt; Fold05 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt;  6 &lt;split [5117/568]&gt; Fold06 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt;  7 &lt;split [5117/568]&gt; Fold07 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt;  8 &lt;split [5117/568]&gt; Fold08 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt;  9 &lt;split [5117/568]&gt; Fold09 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt; 10 &lt;split [5117/568]&gt; Fold10 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;</code></pre>
</div>
</section>
<section id="dont-get-to-confident-2" class="slide level2">
<h2>Don’t get to confident!</h2>
<ul>
<li><p>Since we now have an “ensemble” of models (across the folds), we can collect a summary of the metrics across them.</p></li>
<li><p>The default metrics for classification ensembles are:</p>
<ul>
<li><strong>accuracy</strong>: accuracy is the proportion of correct predictions</li>
<li><strong>brier_class</strong>: the Brier score for classification is the mean squared difference between the predicted probability and the actual outcome</li>
<li><strong>roc_auc</strong>: the area under the ROC (Receiver Operating Characteristic) curve</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a></a></span>
<span id="cb52-2"><a></a><span class="fu">collect_metrics</span>(log_wf_rs)</span>
<span id="cb52-3"><a></a><span class="co">#&gt; # A tibble: 3 × 6</span></span>
<span id="cb52-4"><a></a><span class="co">#&gt;   .metric     .estimator   mean     n std_err .config             </span></span>
<span id="cb52-5"><a></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb52-6"><a></a><span class="co">#&gt; 1 accuracy    binary     0.906     10 0.00360 Preprocessor1_Model1</span></span>
<span id="cb52-7"><a></a><span class="co">#&gt; 2 brier_class binary     0.0714    10 0.00191 Preprocessor1_Model1</span></span>
<span id="cb52-8"><a></a><span class="co">#&gt; 3 roc_auc     binary     0.961     10 0.00164 Preprocessor1_Model1</span></span>
<span id="cb52-9"><a></a><span class="fu">collect_metrics</span>(dt_wf_rs)</span>
<span id="cb52-10"><a></a><span class="co">#&gt; # A tibble: 3 × 6</span></span>
<span id="cb52-11"><a></a><span class="co">#&gt;   .metric     .estimator   mean     n std_err .config             </span></span>
<span id="cb52-12"><a></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb52-13"><a></a><span class="co">#&gt; 1 accuracy    binary     0.896     10 0.00385 Preprocessor1_Model1</span></span>
<span id="cb52-14"><a></a><span class="co">#&gt; 2 brier_class binary     0.0889    10 0.00224 Preprocessor1_Model1</span></span>
<span id="cb52-15"><a></a><span class="co">#&gt; 3 roc_auc     binary     0.909     10 0.00267 Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="further-simplification-workflowsets" class="slide level2">
<h2>Further simplification: <code>workflowsets</code></h2>
<p>OK, so we have streamlined a lot of things with <code>tidymodels</code>:</p>
<ul>
<li><p>We have a specified preprocesser (e.g.&nbsp;formula or recipe)</p></li>
<li><p>We have defined a model (complete with engine and mode)</p></li>
<li><p>We have implemented workflows pairing each model with the preprocesser to either fit the model to the resamples, or, the training data.</p></li>
</ul>
<p>While a significant improvement, we can do better!</p>
<div class="{callout-note}">
<p>Does the idea of implementing a process over an list of elements ring a bell?</p>
</div>
</section>
<section id="model-mappings" class="slide level2">
<h2>Model mappings: <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<ul>
<li><p><code>workflowsets</code> is a package that builds off of <code>purrr</code> and allows you to iterate over multiple models and/or multiple resamples</p></li>
<li><p>Remember how <code>map</code>, <code>map_*</code>, <code>map2</code>, and <code>walk2</code> functions allow lists to map to lists or vectors? <code>workflow_set</code> maps a preprocessor (formula or recipe) to a set of models - each provided as a <code>list</code> object.</p></li>
<li><p>To start, we will create a <code>workflow_set</code> object (instead of a <code>workflow</code>). The first argument is a list of preprocessor objects (formulas or recipes) and the second argument is a list of model objects.</p></li>
<li><p>Both must be lists, by nature of the underlying <code>purrr</code> code.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a></a>(wf_obj <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(<span class="fu">list</span>(forested <span class="sc">~</span>.), <span class="fu">list</span>(log_mod, dt_model)))</span>
<span id="cb53-2"><a></a><span class="co">#&gt; # A workflow set/tibble: 2 × 4</span></span>
<span id="cb53-3"><a></a><span class="co">#&gt;   wflow_id              info             option    result    </span></span>
<span id="cb53-4"><a></a><span class="co">#&gt;   &lt;chr&gt;                 &lt;list&gt;           &lt;list&gt;    &lt;list&gt;    </span></span>
<span id="cb53-5"><a></a><span class="co">#&gt; 1 formula_logistic_reg  &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;</span></span>
<span id="cb53-6"><a></a><span class="co">#&gt; 2 formula_decision_tree &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="iteritive-extecution" class="slide level2">
<h2>Iteritive extecution</h2>
<ul>
<li><p>Once the <code>workflow_set</code> object is created, the <code>workflow_map</code> function can be used to map a function across the preprocessor/model combinations.</p></li>
<li><p>Here we are mapping the <code>fit_resamples</code> function across the <code>workflow_set</code> combinations using the <code>resamples</code> argument to specify the resamples we want to use (<code>forested_folds</code>).</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a></a>wf_obj <span class="ot">&lt;-</span> </span>
<span id="cb54-2"><a></a>  <span class="fu">workflow_set</span>(<span class="fu">list</span>(forested <span class="sc">~</span>.), <span class="fu">list</span>(log_mod, dt_model)) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a></a>  <span class="fu">workflow_map</span>(<span class="st">"fit_resamples"</span>, <span class="at">resamples =</span> forested_folds) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="cell">
<pre><code>#&gt; # A workflow set/tibble: 2 × 4
#&gt;   wflow_id              info             option    result   
#&gt;   &lt;chr&gt;                 &lt;list&gt;           &lt;list&gt;    &lt;list&gt;   
#&gt; 1 formula_logistic_reg  &lt;tibble [1 × 4]&gt; &lt;opts[1]&gt; &lt;rsmp[+]&gt;
#&gt; 2 formula_decision_tree &lt;tibble [1 × 4]&gt; &lt;opts[1]&gt; &lt;rsmp[+]&gt;</code></pre>
</div>
</section>
<section id="rapid-comparision" class="slide level2">
<h2>Rapid comparision</h2>
<p>With that single function, all models have been fit to the resamples and we can quickly compare the results both graphically and statistically:</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a></a><span class="co"># Quick plot function</span></span>
<span id="cb56-2"><a></a><span class="fu">autoplot</span>(wf_obj) <span class="sc">+</span> </span>
<span id="cb56-3"><a></a>  <span class="fu">theme_linedraw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-5_files/figure-revealjs/unnamed-chunk-40-1.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a></a><span class="co"># Long list of results, ranked by accuracy</span></span>
<span id="cb57-2"><a></a><span class="fu">rank_results</span>(wf_obj, </span>
<span id="cb57-3"><a></a>            <span class="at">rank_metric =</span> <span class="st">"accuracy"</span>, </span>
<span id="cb57-4"><a></a>            <span class="at">select_best =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-5"><a></a><span class="co">#&gt; # A tibble: 6 × 9</span></span>
<span id="cb57-6"><a></a><span class="co">#&gt;   wflow_id         .config .metric   mean std_err     n preprocessor model  rank</span></span>
<span id="cb57-7"><a></a><span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;        &lt;chr&gt; &lt;int&gt;</span></span>
<span id="cb57-8"><a></a><span class="co">#&gt; 1 formula_logisti… Prepro… accura… 0.906  0.00360    10 formula      logi…     1</span></span>
<span id="cb57-9"><a></a><span class="co">#&gt; 2 formula_logisti… Prepro… brier_… 0.0714 0.00191    10 formula      logi…     1</span></span>
<span id="cb57-10"><a></a><span class="co">#&gt; 3 formula_logisti… Prepro… roc_auc 0.961  0.00164    10 formula      logi…     1</span></span>
<span id="cb57-11"><a></a><span class="co">#&gt; 4 formula_decisio… Prepro… accura… 0.896  0.00385    10 formula      deci…     2</span></span>
<span id="cb57-12"><a></a><span class="co">#&gt; 5 formula_decisio… Prepro… brier_… 0.0889 0.00224    10 formula      deci…     2</span></span>
<span id="cb57-13"><a></a><span class="co">#&gt; 6 formula_decisio… Prepro… roc_auc 0.909  0.00267    10 formula      deci…     2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
<div class="fragment">
<p>Overall, the logistic regression model appears to the best model for this data set!</p>
</div>
</section>
<section id="the-whole-game---status-update-1" class="slide level2">
<h2>The whole game - status update</h2>

<img data-src="images/whole-game-transparent-select.jpg" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"><p>On Wednesday, we’ll talk more about models we can chose from…</p>
<p>Next week we will cover</p>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../csu-rams-logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://github.com/mikejohnson51/csu-ess-523c/">ESS 523c: Environmental Data Science Applications: Water Resources</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': true,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 1000,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script>
      Reveal.addEventListener( 'slidechanged', function( event ) {
        console.log("hello")
        
        slide_id = event.currentSlide.id
        link = "annotations" + ".html#" + slide_id
        
        var annotation_div = document.createElement('div')
        annotation_div.setAttribute("class", "annotation-link")
        
        var notes_link = document.createElement('a')
        notes_link.setAttribute("href", link)
        notes_link.setAttribute("target", "_blank")
        
        var iii = document.createElement('i')
        iii.setAttribute("class", "fa fa-info")
        notes_link.appendChild(iii)
        
        annotation_div.appendChild(notes_link)
        
        var tmp = event.currentTarget.getElementsByClassName("annotation-link")
        if (tmp.length === 1) {
          tmp[0].remove()
        }
        
        if (event.currentSlide.classList.contains("annotation")) {
          event.currentTarget.append(annotation_div)
        }
      } );

    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>