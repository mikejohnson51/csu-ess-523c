<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Week 5 – ESS 523c</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5b6eb65566b1f8a996f1287d789c0740.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-c63d9198b28a859559c0f0cce9729cfa.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../csu-rams-logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ESS 523c</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mikejohnson51/csu-ess-523c/"> <i class="bi bi-github" role="img" aria-label="ESS 523c">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#unit-3-modeling-machine-learning" id="toc-unit-3-modeling-machine-learning" class="nav-link active" data-scroll-target="#unit-3-modeling-machine-learning">Unit 3: Modeling (Machine Learning)</a></li>
  <li><a href="#what-is-machine-learning" id="toc-what-is-machine-learning" class="nav-link" data-scroll-target="#what-is-machine-learning">What is machine learning?</a></li>
  <li><a href="#what-is-machine-learning-2025-edition" id="toc-what-is-machine-learning-2025-edition" class="nav-link" data-scroll-target="#what-is-machine-learning-2025-edition">What is machine learning? (2025 edition)</a></li>
  <li><a href="#classic-conceptual-model" id="toc-classic-conceptual-model" class="nav-link" data-scroll-target="#classic-conceptual-model">Classic Conceptual Model</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#the-big-picture-road-map" id="toc-the-big-picture-road-map" class="nav-link" data-scroll-target="#the-big-picture-road-map">The big picture: Road map</a></li>
  <li><a href="#what-is-tidymodels" id="toc-what-is-tidymodels" class="nav-link" data-scroll-target="#what-is-tidymodels">What is <code>tidymodels</code>?</a></li>
  <li><a href="#key-tidymodels-packages" id="toc-key-tidymodels-packages" class="nav-link" data-scroll-target="#key-tidymodels-packages">Key tidymodels Packages</a></li>
  <li><a href="#typcical-workflow-in-tidymodels" id="toc-typcical-workflow-in-tidymodels" class="nav-link" data-scroll-target="#typcical-workflow-in-tidymodels">Typcical Workflow in <code>tidymodels</code></a></li>
  <li><a href="#data-normalization-tidymodels" id="toc-data-normalization-tidymodels" class="nav-link" data-scroll-target="#data-normalization-tidymodels">Data Normalization: <code>tidymodels</code></a></li>
  <li><a href="#why-normalize-data-for-ml" id="toc-why-normalize-data-for-ml" class="nav-link" data-scroll-target="#why-normalize-data-for-ml">Why Normalize Data for ML?</a></li>
  <li><a href="#common-normalization-techniques" id="toc-common-normalization-techniques" class="nav-link" data-scroll-target="#common-normalization-techniques">Common Normalization Techniques</a></li>
  <li><a href="#common-normalization-techniques-1" id="toc-common-normalization-techniques-1" class="nav-link" data-scroll-target="#common-normalization-techniques-1">Common Normalization Techniques</a></li>
  <li><a href="#common-normalization-techniques-2" id="toc-common-normalization-techniques-2" class="nav-link" data-scroll-target="#common-normalization-techniques-2">Common Normalization Techniques</a></li>
  <li><a href="#other-feature-engineering-tasks" id="toc-other-feature-engineering-tasks" class="nav-link" data-scroll-target="#other-feature-engineering-tasks">Other Feature Engineering Tasks</a></li>
  <li><a href="#implementing-normalization-in-tidymodels" id="toc-implementing-normalization-in-tidymodels" class="nav-link" data-scroll-target="#implementing-normalization-in-tidymodels">Implementing Normalization in Tidymodels</a></li>
  <li><a href="#what-will-we-do" id="toc-what-will-we-do" class="nav-link" data-scroll-target="#what-will-we-do">What will we do?</a>
  <ul class="collapse">
  <li><a href="#example-workflow" id="toc-example-workflow" class="nav-link" data-scroll-target="#example-workflow">Example Workflow</a></li>
  </ul></li>
  <li><a href="#build-a-model-with-normalized-data" id="toc-build-a-model-with-normalized-data" class="nav-link" data-scroll-target="#build-a-model-with-normalized-data">Build a model with Normalized Data</a></li>
  <li><a href="#build-a-model-with-normalized-data-1" id="toc-build-a-model-with-normalized-data-1" class="nav-link" data-scroll-target="#build-a-model-with-normalized-data-1">Build a model with Normalized Data</a></li>
  <li><a href="#build-a-model-with-normalized-data-2" id="toc-build-a-model-with-normalized-data-2" class="nav-link" data-scroll-target="#build-a-model-with-normalized-data-2">Build a model with Normalized Data</a></li>
  <li><a href="#build-a-model-with-normalized-data-3" id="toc-build-a-model-with-normalized-data-3" class="nav-link" data-scroll-target="#build-a-model-with-normalized-data-3">Build a model with Normalized Data</a></li>
  <li><a href="#data-budget" id="toc-data-budget" class="nav-link" data-scroll-target="#data-budget">Data Budget</a></li>
  <li><a href="#our-typical-process-will-like-this" id="toc-our-typical-process-will-like-this" class="nav-link" data-scroll-target="#our-typical-process-will-like-this">Our typical process will like this:</a></li>
  <li><a href="#how-we-split-data" id="toc-how-we-split-data" class="nav-link" data-scroll-target="#how-we-split-data">How we split data</a></li>
  <li><a href="#startification" id="toc-startification" class="nav-link" data-scroll-target="#startification">Startification</a></li>
  <li><a href="#initial-splits" id="toc-initial-splits" class="nav-link" data-scroll-target="#initial-splits">Initial splits <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#accessing-the-data" id="toc-accessing-the-data" class="nav-link" data-scroll-target="#accessing-the-data">Accessing the data: <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#proportional-gaps" id="toc-proportional-gaps" class="nav-link" data-scroll-target="#proportional-gaps">Proportional Gaps</a></li>
  <li><a href="#stratification-example" id="toc-stratification-example" class="nav-link" data-scroll-target="#stratification-example">Stratification Example</a></li>
  <li><a href="#proportional-alignment" id="toc-proportional-alignment" class="nav-link" data-scroll-target="#proportional-alignment">Proportional Alignment</a></li>
  <li><a href="#modeling" id="toc-modeling" class="nav-link" data-scroll-target="#modeling">Modeling</a></li>
  <li><a href="#modeling-options" id="toc-modeling-options" class="nav-link" data-scroll-target="#modeling-options">Modeling Options</a></li>
  <li><a href="#modeling-options-1" id="toc-modeling-options-1" class="nav-link" data-scroll-target="#modeling-options-1">Modeling Options</a></li>
  <li><a href="#resampling" id="toc-resampling" class="nav-link" data-scroll-target="#resampling">Resampling</a></li>
  <li><a href="#key-resampling-methods" id="toc-key-resampling-methods" class="nav-link" data-scroll-target="#key-resampling-methods">Key Resampling Methods</a></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation">Cross-validation</a></li>
  <li><a href="#cross-validation-1" id="toc-cross-validation-1" class="nav-link" data-scroll-target="#cross-validation-1">Cross-validation</a></li>
  <li><a href="#cross-validation-2" id="toc-cross-validation-2" class="nav-link" data-scroll-target="#cross-validation-2">Cross-validation <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#cross-validation-3" id="toc-cross-validation-3" class="nav-link" data-scroll-target="#cross-validation-3">Cross-validation <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#alternate-resampling-schemes" id="toc-alternate-resampling-schemes" class="nav-link" data-scroll-target="#alternate-resampling-schemes">Alternate resampling schemes</a>
  <ul class="collapse">
  <li><a href="#bootstrapping" id="toc-bootstrapping" class="nav-link" data-scroll-target="#bootstrapping">Bootstrapping</a></li>
  <li><a href="#bootstrapping-1" id="toc-bootstrapping-1" class="nav-link" data-scroll-target="#bootstrapping-1">Bootstrapping <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#monte-carlo-cross-validation" id="toc-monte-carlo-cross-validation" class="nav-link" data-scroll-target="#monte-carlo-cross-validation">Monte Carlo Cross-Validation <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#validation-set" id="toc-validation-set" class="nav-link" data-scroll-target="#validation-set">Validation set <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#the-whole-game---status-update" id="toc-the-whole-game---status-update" class="nav-link" data-scroll-target="#the-whole-game---status-update">The whole game - status update</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a></li>
  </ul></li>
  <li><a href="#unit-example" id="toc-unit-example" class="nav-link" data-scroll-target="#unit-example">Unit Example</a>
  <ul class="collapse">
  <li><a href="#data-on-forests-in-washington" id="toc-data-on-forests-in-washington" class="nav-link" data-scroll-target="#data-on-forests-in-washington">Data on forests in Washington</a></li>
  <li><a href="#data-on-forests-in-washington-1" id="toc-data-on-forests-in-washington-1" class="nav-link" data-scroll-target="#data-on-forests-in-washington-1">Data on forests in Washington</a></li>
  <li><a href="#data-splitting-and-spending" id="toc-data-splitting-and-spending" class="nav-link" data-scroll-target="#data-splitting-and-spending">Data splitting and spending</a>
  <ul class="collapse">
  <li><a href="#the-initial-split" id="toc-the-initial-split" class="nav-link" data-scroll-target="#the-initial-split">The initial split <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  </ul></li>
  <li><a href="#accessing-the-data-1" id="toc-accessing-the-data-1" class="nav-link" data-scroll-target="#accessing-the-data-1">Accessing the data <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#k-fold-cross-validation" id="toc-k-fold-cross-validation" class="nav-link" data-scroll-target="#k-fold-cross-validation">K-Fold Cross-Validation <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#how-do-you-fit-a-linear-model-in-r" id="toc-how-do-you-fit-a-linear-model-in-r" class="nav-link" data-scroll-target="#how-do-you-fit-a-linear-model-in-r">How do you fit a linear model in R?</a></li>
  <li><a href="#challenge" id="toc-challenge" class="nav-link" data-scroll-target="#challenge">Challenge</a></li>
  <li><a href="#the-tidymodels-advantage" id="toc-the-tidymodels-advantage" class="nav-link" data-scroll-target="#the-tidymodels-advantage">The tidymodels advantage</a></li>
  <li><a href="#a-tidymodels-prediction-will" id="toc-a-tidymodels-prediction-will" class="nav-link" data-scroll-target="#a-tidymodels-prediction-will">A tidymodels prediction will … <img src="hexes/tidymodels.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#to-specify-a-model" id="toc-to-specify-a-model" class="nav-link" data-scroll-target="#to-specify-a-model">To specify a model <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#specify-a-model-type" id="toc-specify-a-model-type" class="nav-link" data-scroll-target="#specify-a-model-type">Specify a model: Type <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#specify-a-model-engine" id="toc-specify-a-model-engine" class="nav-link" data-scroll-target="#specify-a-model-engine">Specify a model: engine <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#specify-a-model-engine-1" id="toc-specify-a-model-engine-1" class="nav-link" data-scroll-target="#specify-a-model-engine-1">Specify a model: engine <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#specify-a-model-mode" id="toc-specify-a-model-mode" class="nav-link" data-scroll-target="#specify-a-model-mode">Specify a model: mode <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#specify-a-model-mode-1" id="toc-specify-a-model-mode-1" class="nav-link" data-scroll-target="#specify-a-model-mode-1">Specify a model: mode <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"></a></li>
  <li><a href="#to-specify-a-model-1" id="toc-to-specify-a-model-1" class="nav-link" data-scroll-target="#to-specify-a-model-1">To specify a model <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression">Logistic regression</a></li>
  <li><a href="#decision-trees" id="toc-decision-trees" class="nav-link" data-scroll-target="#decision-trees">Decision trees</a></li>
  <li><a href="#decision-trees-1" id="toc-decision-trees-1" class="nav-link" data-scroll-target="#decision-trees-1">Decision trees</a></li>
  <li><a href="#decision-trees-2" id="toc-decision-trees-2" class="nav-link" data-scroll-target="#decision-trees-2">Decision trees</a></li>
  <li><a href="#what-algorithm-is-best-for-estimate-forested-plots" id="toc-what-algorithm-is-best-for-estimate-forested-plots" class="nav-link" data-scroll-target="#what-algorithm-is-best-for-estimate-forested-plots">What algorithm is best for estimate forested plots?</a></li>
  <li><a href="#fitting-your-model" id="toc-fitting-your-model" class="nav-link" data-scroll-target="#fitting-your-model">Fitting your model:</a></li>
  <li><a href="#component-extracts" id="toc-component-extracts" class="nav-link" data-scroll-target="#component-extracts">Component extracts:</a></li>
  </ul></li>
  <li><a href="#a-model-workflow" id="toc-a-model-workflow" class="nav-link" data-scroll-target="#a-model-workflow">A model workflow</a>
  <ul class="collapse">
  <li><a href="#workflows" id="toc-workflows" class="nav-link" data-scroll-target="#workflows">Workflows? <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#basic-workflow-structure" id="toc-basic-workflow-structure" class="nav-link" data-scroll-target="#basic-workflow-structure">Basic Workflow Structure: <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#a-model-workflow-1" id="toc-a-model-workflow-1" class="nav-link" data-scroll-target="#a-model-workflow-1">A model workflow <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></a></li>
  <li><a href="#predict-with-your-model" id="toc-predict-with-your-model" class="nav-link" data-scroll-target="#predict-with-your-model">Predict with your model <img src="hexes/broom.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#evaluate-your-model" id="toc-evaluate-your-model" class="nav-link" data-scroll-target="#evaluate-your-model">Evaluate your model <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  </ul></li>
  <li><a href="#tidymodels-advantage" id="toc-tidymodels-advantage" class="nav-link" data-scroll-target="#tidymodels-advantage"><code>tidymodels</code> advantage! <img src="hexes/tidymodels.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a>
  <ul class="collapse">
  <li><a href="#so-who-wins" id="toc-so-who-wins" class="nav-link" data-scroll-target="#so-who-wins">So who wins?</a></li>
  <li><a href="#dont-get-to-confident" id="toc-dont-get-to-confident" class="nav-link" data-scroll-target="#dont-get-to-confident">Don’t get to confident!</a></li>
  <li><a href="#dont-get-to-confident-1" id="toc-dont-get-to-confident-1" class="nav-link" data-scroll-target="#dont-get-to-confident-1">Don’t get to confident!</a></li>
  <li><a href="#dont-get-to-confident-2" id="toc-dont-get-to-confident-2" class="nav-link" data-scroll-target="#dont-get-to-confident-2">Don’t get to confident!</a></li>
  <li><a href="#further-simplification-workflowsets" id="toc-further-simplification-workflowsets" class="nav-link" data-scroll-target="#further-simplification-workflowsets">Further simplification: <code>workflowsets</code></a></li>
  <li><a href="#model-mappings" id="toc-model-mappings" class="nav-link" data-scroll-target="#model-mappings">Model mappings: <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></a></li>
  <li><a href="#iteritive-extecution" id="toc-iteritive-extecution" class="nav-link" data-scroll-target="#iteritive-extecution">Iteritive extecution</a></li>
  <li><a href="#rapid-comparision" id="toc-rapid-comparision" class="nav-link" data-scroll-target="#rapid-comparision">Rapid comparision</a></li>
  <li><a href="#the-whole-game---status-update-1" id="toc-the-whole-game---status-update-1" class="nav-link" data-scroll-target="#the-whole-game---status-update-1">The whole game - status update</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="week-5.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 5</h1>
<p class="subtitle lead">Machine Learning Part 1</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="unit-3-modeling-machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="unit-3-modeling-machine-learning">Unit 3: Modeling (Machine Learning)</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://imgs.xkcd.com/comics/machine_learning.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<div class="footer">
<p><a href="https://xkcd.com/1838/" class="uri">https://xkcd.com/1838/</a></p>
</div>
</section>
<section id="what-is-machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="what-is-machine-learning">What is machine learning?</h2>
<p><img src="images/what_is_ml.png" class="absolute img-fluid" style="z-index: -1;" data-top="0" data-left="150"></p>
<div class="footer">
<p>Illustration credit: <a href="https://vas3k.com/blog/machine_learning/" class="uri">https://vas3k.com/blog/machine_learning/</a></p>
</div>
</section>
<section id="what-is-machine-learning-2025-edition" class="level2">
<h2 class="anchored" data-anchor-id="what-is-machine-learning-2025-edition">What is machine learning? (2025 edition)</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the early 2010s, “Artificial intelligence” (AI) was largely synonymous with what we’ll refer to as “machine learning” in this workshop. In the late 2010s and early 2020s, AI usually referred to deep learning methods. Since the release of ChatGPT in late 2022, “AI” has come to also encompass large language models (LLMs) / generative models.</p>
</div>
</div>
<p><img src="images/what_is_ml_expanding.gif" class="absolute img-fluid" style="z-index: -1;" data-top="150" data-left="150"></p>
<div class="footer">
<p>Illustration credit: <a href="https://vas3k.com/blog/machine_learning/" class="uri">https://vas3k.com/blog/machine_learning/</a></p>
</div>
</section>
<section id="classic-conceptual-model" class="level2">
<h2 class="anchored" data-anchor-id="classic-conceptual-model">Classic Conceptual Model</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/ml_illustration.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<div class="footer">
<p>Illustration credit: <a href="https://vas3k.com/blog/machine_learning/" class="uri">https://vas3k.com/blog/machine_learning/</a></p>
</div>
</section>
<section id="section" class="level2" data-background-image="images/tm-org.png" data-background-size="contain">
<h2 data-background-image="images/tm-org.png" data-background-size="contain" class="anchored" data-anchor-id="section"></h2>
</section>
<section id="the-big-picture-road-map" class="level2">
<h2 class="anchored" data-anchor-id="the-big-picture-road-map">The big picture: Road map</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/whole-game-final-performance.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="what-is-tidymodels" class="level2">
<h2 class="anchored" data-anchor-id="what-is-tidymodels">What is <code>tidymodels</code>?</h2>
<ul>
<li>An R package ecosystem for modeling and machine learning</li>
<li>Built on the <code>tidyverse</code> principles (consistent syntax, modular design)</li>
<li>Provides a structured workflow for preprocessing, model fitting, and evaluation</li>
<li>Includes packages for model specification, preprocessing, resampling, tuning, and evaluation</li>
<li>Promotes best practices for reproducibility and efficiency</li>
<li>Offers a unified interface for different models and tasks</li>
</ul>
</section>
<section id="key-tidymodels-packages" class="level2">
<h2 class="anchored" data-anchor-id="key-tidymodels-packages">Key tidymodels Packages</h2>
<p>📦 <code>recipes</code>: Feature engineering and preprocessing</p>
<p>📦 <code>parsnip</code>: Unified interface for model specification</p>
<p>📦 <code>workflows</code>: Streamlined modeling pipelines</p>
<p>📦 <code>tune</code>: Hyperparameter tuning</p>
<p>📦 <code>rsample</code>: Resampling and validation</p>
<p>📦 <code>yardstick</code>: Model evaluation metrics</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">'images/tidymodels-packages.png'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/tidymodels-packages.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>tidymodels<span class="sc">::</span><span class="fu">tidymodels_packages</span>()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] "broom"        "cli"          "conflicted"   "dials"        "dplyr"       </span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [6] "ggplot2"      "hardhat"      "infer"        "modeldata"    "parsnip"     </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [11] "purrr"        "recipes"      "rlang"        "rsample"      "rstudioapi"  </span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [16] "tibble"       "tidyr"        "tune"         "workflows"    "workflowsets"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [21] "yardstick"    "tidymodels"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="typcical-workflow-in-tidymodels" class="level2">
<h2 class="anchored" data-anchor-id="typcical-workflow-in-tidymodels">Typcical Workflow in <code>tidymodels</code></h2>
<p>1️⃣ Load Package &amp; Data</p>
<p>2️⃣ Preprocess Data (<code>recipes</code>)</p>
<p>3️⃣ Define Model (<code>parsnip</code>)</p>
<p>4️⃣ Create a Workflow (<code>workflows</code>)</p>
<p>5️⃣ Train &amp; Tune (<code>tune</code>)</p>
<p>6️⃣ Evaluate Performance (<code>yardstick</code>)</p>
</section>
<section id="data-normalization-tidymodels" class="level2">
<h2 class="anchored" data-anchor-id="data-normalization-tidymodels">Data Normalization: <code>tidymodels</code></h2>
<ul>
<li><p>Data normalization is a crucial step in data preprocessing for machine learning.</p></li>
<li><p>It ensures that features contribute equally to model performance by transforming them into a common scale.</p></li>
<li><p>This is particularly important for algorithms that rely on distance metrics (e.g., k-nearest neighbors, support vector machines) or gradient-based optimization (e.g., neural networks, logistic regression).</p></li>
<li><p>In the <code>tidymodels</code> framework, data normalization is handled within preprocessing workflows using the <code>recipes</code> package, which provides a structured way to apply transformations consistently.</p></li>
</ul>
</section>
<section id="why-normalize-data-for-ml" class="level2">
<h2 class="anchored" data-anchor-id="why-normalize-data-for-ml">Why Normalize Data for ML?</h2>
<p>✅ Improves Model Convergence: Many machine learning models rely on gradient descent, which can be inefficient if features are on different scales.</p>
<p>✅ Prevents Feature Domination: Features with large magnitudes can overshadow smaller ones, leading to biased models.</p>
<p>✅ Enhances Interpretability: Standardized data improves comparisons across variables and aids in better model understanding.</p>
<p>✅ Facilitates Distance-Based Methods: Algorithms like k-nearest neighbors and principal component analysis (PCA) perform best when data is normalized.</p>
</section>
<section id="common-normalization-techniques" class="level2">
<h2 class="anchored" data-anchor-id="common-normalization-techniques">Common Normalization Techniques</h2>
<section id="min-max-scaling" class="level4">
<h4 class="anchored" data-anchor-id="min-max-scaling">1. <code>Min-Max Scaling</code></h4>
<ul>
<li><p>Transforms data into a fixed range (typically [0,1]).</p></li>
<li><p>Preserves relationships but sensitive to outliers.</p></li>
<li><p>Formula: <span class="math display">\[ x' = \frac{x - x_{min}}{x_{max} - x_{min}} \]</span></p></li>
<li><p>Implemented using <code>step_range()</code> in <code>recipes.</code></p></li>
</ul>
</section>
<section id="z-score-standardization-standard-scaling" class="level4">
<h4 class="anchored" data-anchor-id="z-score-standardization-standard-scaling">2. <code>Z-Score Standardization (Standard Scaling)</code></h4>
<ul>
<li><p>Centers data to have zero mean and unit variance.</p></li>
<li><p>More robust to outliers compared to min-max scaling.</p></li>
<li><p>Formula: <span class="math display">\[ x' = \frac{x - \mu}{\sigma} \]</span></p></li>
<li><p>Implemented using <code>step_normalize()</code> in <code>recipes</code>.</p></li>
</ul>
</section>
</section>
<section id="common-normalization-techniques-1" class="level2">
<h2 class="anchored" data-anchor-id="common-normalization-techniques-1">Common Normalization Techniques</h2>
<section id="robust-scaling" class="level4">
<h4 class="anchored" data-anchor-id="robust-scaling">3. <code>Robust Scaling</code></h4>
<ul>
<li><p>Uses median and interquartile range (IQR) for scaling.</p></li>
<li><p>Less sensitive to outliers.</p></li>
<li><p>Formula: <span class="math display">\[ x' = \frac{x - median(x)}{IQR(x)} \]</span></p></li>
<li><p>Implemented using <code>step_YeoJohnson()</code> or <code>step_BoxCox()</code> in <code>recipes.</code></p></li>
</ul>
</section>
<section id="log-transformation" class="level4">
<h4 class="anchored" data-anchor-id="log-transformation">4. <code>Log Transformation</code></h4>
<ul>
<li><p>Useful for skewed distributions to reduce the impact of extreme values.</p></li>
<li><p>Implemented using <code>step_log()</code> in <code>recipes.</code></p></li>
</ul>
</section>
</section>
<section id="common-normalization-techniques-2" class="level2">
<h2 class="anchored" data-anchor-id="common-normalization-techniques-2">Common Normalization Techniques</h2>
<section id="principal-component-analysis-pca" class="level4">
<h4 class="anchored" data-anchor-id="principal-component-analysis-pca">5. <code>Principal Component Analysis (PCA)</code></h4>
<ul>
<li><p>Projects data into a lower-dimensional space while maintaining variance.</p></li>
<li><p>Used in high-dimensional datasets.</p></li>
<li><p>Implemented using <code>step_pca()</code> in recipes.</p></li>
</ul>
</section>
</section>
<section id="other-feature-engineering-tasks" class="level2">
<h2 class="anchored" data-anchor-id="other-feature-engineering-tasks">Other Feature Engineering Tasks</h2>
<section id="handling-missing-data" class="level4">
<h4 class="anchored" data-anchor-id="handling-missing-data">Handling Missing Data</h4>
<ul>
<li><code>step_impute_mean()</code></li>
<li><code>step_impute_median()</code></li>
<li><code>step_impute_knn()</code></li>
</ul>
<p>can be used to fill missing values.</p>
</section>
<section id="encoding-categorical-variables" class="level4">
<h4 class="anchored" data-anchor-id="encoding-categorical-variables">Encoding Categorical Variables</h4>
<ul>
<li><p><code>step_dummy()</code> creates dummy variables for categorical features.</p></li>
<li><p><code>step_other()</code> groups infrequent categories into an “other” category.</p></li>
</ul>
</section>
<section id="creating-interaction-terms" class="level4">
<h4 class="anchored" data-anchor-id="creating-interaction-terms">Creating Interaction Terms</h4>
<ul>
<li><code>step_interact()</code> generates interaction terms between predictors.</li>
</ul>
</section>
<section id="feature-extraction" class="level4">
<h4 class="anchored" data-anchor-id="feature-extraction">Feature Extraction</h4>
<ul>
<li><code>step_pca()</code> or <code>step_ica()</code> can be used to extract important components.</li>
</ul>
</section>
<section id="text-feature-engineering" class="level4">
<h4 class="anchored" data-anchor-id="text-feature-engineering">Text Feature Engineering</h4>
<p><code>step_tokenize()</code>, <code>step_stopwords()</code>, and <code>step_tf()</code> for text processing.</p>
</section>
<section id="binning-numerical-data" class="level4">
<h4 class="anchored" data-anchor-id="binning-numerical-data">Binning Numerical Data</h4>
<p><code>step_bin2factor()</code> converts continuous variables into categorical bins.</p>
</section>
<section id="polynomial-and-spline-features" class="level4">
<h4 class="anchored" data-anchor-id="polynomial-and-spline-features">Polynomial and Spline Features</h4>
<p><code>step_poly()</code> and <code>step_bs()</code> for generating polynomial and spline transformations.</p>
</section>
</section>
<section id="implementing-normalization-in-tidymodels" class="level2">
<h2 class="anchored" data-anchor-id="implementing-normalization-in-tidymodels">Implementing Normalization in Tidymodels</h2>
</section>
<section id="what-will-we-do" class="level2">
<h2 class="anchored" data-anchor-id="what-will-we-do">What will we do?</h2>
<ol type="1">
<li><p>We will create a recipe to normalize the numerical predictors in the <code>penguins</code> dataset using the <code>recipes</code> package.</p></li>
<li><p>We will then prepare (<code>prep</code>) the recipe and apply it to the dataset to obtain normalized data.</p></li>
<li><p>We will then <code>bake</code> the recipe to apply the transformations to the dataset.</p></li>
<li><p>Once processed, we can implement a linear regression model using the normalized data.</p></li>
</ol>
<p>. . .</p>
<section id="example-workflow" class="level3">
<h3 class="anchored" data-anchor-id="example-workflow">Example Workflow</h3>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>(recipe_obj <span class="ot">&lt;-</span> <span class="fu">recipe</span>(flipper_length_mm <span class="sc">~</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                       bill_length_mm <span class="sc">+</span> body_mass_g <span class="sc">+</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                       sex <span class="sc">+</span> island <span class="sc">+</span> species, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> penguins) <span class="sc">|&gt;</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mean</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_factor_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()))</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare and apply transformations</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>prep_recipe     <span class="ot">&lt;-</span> <span class="fu">prep</span>(recipe_obj, <span class="at">training =</span> penguins) </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>normalized_data <span class="ot">&lt;-</span> <span class="fu">bake</span>(prep_recipe, <span class="at">new_data =</span> <span class="cn">NULL</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">species =</span> penguins<span class="sc">$</span>species) <span class="sc">|&gt;</span> </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(normalized_data)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 9</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   bill_length_mm body_mass_g flipper_length_mm sex_male island_Dream</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;            &lt;dbl&gt;       &lt;dbl&gt;             &lt;int&gt;    &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1         -0.886      -0.565               181    0.990       -0.750</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2         -0.812      -0.502               186   -1.01        -0.750</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3         -0.665      -1.19                195   -1.01        -0.750</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4         -1.33       -0.940               193   -1.01        -0.750</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5         -0.849      -0.690               190    0.990       -0.750</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6         -0.923      -0.721               181   -1.01        -0.750</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 4 more variables: island_Torgersen &lt;dbl&gt;, species_Chinstrap &lt;dbl&gt;,</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   species_Gentoo &lt;dbl&gt;, species &lt;fct&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<section id="explanation" class="level4">
<h4 class="anchored" data-anchor-id="explanation">Explanation:</h4>
<ul>
<li><p><code>recipe()</code> defines preprocessing steps for modeling.</p></li>
<li><p><code>step_impute_mean(all_numeric_predictors())</code> standardizes all numerical predictors.</p></li>
<li><p><code>step_dummy(all_factor_predictors())</code> creates dummy variables for categorical predictors.</p></li>
<li><p><code>step_normalize(all_numeric_predictors()))</code> standardizes all numerical predictors.</p></li>
<li><p><code>prep()</code> estimates parameters for transformations.</p></li>
<li><p><code>bake()</code> applies the transformations to the dataset.</p></li>
</ul>
</section>
</div>
</div>
</section>
</section>
<section id="build-a-model-with-normalized-data" class="level2">
<h2 class="anchored" data-anchor-id="build-a-model-with-normalized-data">Build a model with Normalized Data</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">model =</span> <span class="fu">lm</span>(flipper_length_mm <span class="sc">~</span> . , <span class="at">data =</span> normalized_data) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = flipper_length_mm ~ ., data = normalized_data)
#&gt; 
#&gt; Coefficients:
#&gt;       (Intercept)     bill_length_mm        body_mass_g           sex_male  
#&gt;          200.9649             2.2754             4.6414             0.7208  
#&gt;      island_Dream   island_Torgersen  species_Chinstrap     species_Gentoo  
#&gt;            0.6525             0.9800             0.5640             8.0796  
#&gt;  speciesChinstrap      speciesGentoo  
#&gt;                NA                 NA</code></pre>
</div>
</div>
</div>
</section>
<section id="build-a-model-with-normalized-data-1" class="level2">
<h2 class="anchored" data-anchor-id="build-a-model-with-normalized-data-1">Build a model with Normalized Data</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">model =</span> <span class="fu">lm</span>(flipper_length_mm <span class="sc">~</span> . , <span class="at">data =</span> normalized_data) )</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = flipper_length_mm ~ ., data = normalized_data)
#&gt; 
#&gt; Coefficients:
#&gt;       (Intercept)     bill_length_mm        body_mass_g           sex_male  
#&gt;          200.9649             2.2754             4.6414             0.7208  
#&gt;      island_Dream   island_Torgersen  species_Chinstrap     species_Gentoo  
#&gt;            0.6525             0.9800             0.5640             8.0796  
#&gt;  speciesChinstrap      speciesGentoo  
#&gt;                NA                 NA
#&gt; # A tibble: 1 × 12
#&gt;   r.squared adj.r.squared sigma statistic   p.value    df logLik   AIC   BIC
#&gt;       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     0.863         0.861  5.23      294. 2.15e-136     7 -1020. 2057. 2092.
#&gt; # ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</code></pre>
</div>
</div>
</div>
</section>
<section id="build-a-model-with-normalized-data-2" class="level2">
<h2 class="anchored" data-anchor-id="build-a-model-with-normalized-data-2">Build a model with Normalized Data</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">model =</span> <span class="fu">lm</span>(flipper_length_mm <span class="sc">~</span> . , <span class="at">data =</span> normalized_data) )</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(model)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>(pred <span class="ot">&lt;-</span> <span class="fu">augment</span>(model, normalized_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = flipper_length_mm ~ ., data = normalized_data)
#&gt; 
#&gt; Coefficients:
#&gt;       (Intercept)     bill_length_mm        body_mass_g           sex_male  
#&gt;          200.9649             2.2754             4.6414             0.7208  
#&gt;      island_Dream   island_Torgersen  species_Chinstrap     species_Gentoo  
#&gt;            0.6525             0.9800             0.5640             8.0796  
#&gt;  speciesChinstrap      speciesGentoo  
#&gt;                NA                 NA
#&gt; # A tibble: 1 × 12
#&gt;   r.squared adj.r.squared sigma statistic   p.value    df logLik   AIC   BIC
#&gt;       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     0.863         0.861  5.23      294. 2.15e-136     7 -1020. 2057. 2092.
#&gt; # ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;
#&gt; # A tibble: 333 × 15
#&gt;    bill_length_mm body_mass_g flipper_length_mm sex_male island_Dream
#&gt;             &lt;dbl&gt;       &lt;dbl&gt;             &lt;int&gt;    &lt;dbl&gt;        &lt;dbl&gt;
#&gt;  1         -0.886      -0.565               181    0.990       -0.750
#&gt;  2         -0.812      -0.502               186   -1.01        -0.750
#&gt;  3         -0.665      -1.19                195   -1.01        -0.750
#&gt;  4         -1.33       -0.940               193   -1.01        -0.750
#&gt;  5         -0.849      -0.690               190    0.990       -0.750
#&gt;  6         -0.923      -0.721               181   -1.01        -0.750
#&gt;  7         -0.867       0.592               195    0.990       -0.750
#&gt;  8         -0.518      -1.25                182   -1.01        -0.750
#&gt;  9         -0.978      -0.502               191    0.990       -0.750
#&gt; 10         -1.71        0.248               198    0.990       -0.750
#&gt; # ℹ 323 more rows
#&gt; # ℹ 10 more variables: island_Torgersen &lt;dbl&gt;, species_Chinstrap &lt;dbl&gt;,
#&gt; #   species_Gentoo &lt;dbl&gt;, species &lt;fct&gt;, .fitted &lt;dbl&gt;, .resid &lt;dbl&gt;,
#&gt; #   .hat &lt;dbl&gt;, .sigma &lt;dbl&gt;, .cooksd &lt;dbl&gt;, .std.resid &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
</section>
<section id="build-a-model-with-normalized-data-3" class="level2">
<h2 class="anchored" data-anchor-id="build-a-model-with-normalized-data-3">Build a model with Normalized Data</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">model =</span> <span class="fu">lm</span>(flipper_length_mm <span class="sc">~</span> . , <span class="at">data =</span> normalized_data) )</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(model)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>(pred <span class="ot">&lt;-</span> <span class="fu">augment</span>(model, normalized_data))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscatter</span>(pred,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="st">'flipper_length_mm'</span>, <span class="at">y =</span> <span class="st">'.fitted'</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">add =</span> <span class="st">"reg.line"</span>, <span class="at">conf.int =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">cor.coef =</span> <span class="cn">TRUE</span>, <span class="at">cor.method =</span> <span class="st">"pearson"</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"species"</span>, <span class="at">palette =</span> <span class="st">"jco"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = flipper_length_mm ~ ., data = normalized_data)
#&gt; 
#&gt; Coefficients:
#&gt;       (Intercept)     bill_length_mm        body_mass_g           sex_male  
#&gt;          200.9649             2.2754             4.6414             0.7208  
#&gt;      island_Dream   island_Torgersen  species_Chinstrap     species_Gentoo  
#&gt;            0.6525             0.9800             0.5640             8.0796  
#&gt;  speciesChinstrap      speciesGentoo  
#&gt;                NA                 NA
#&gt; # A tibble: 1 × 12
#&gt;   r.squared adj.r.squared sigma statistic   p.value    df logLik   AIC   BIC
#&gt;       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     0.863         0.861  5.23      294. 2.15e-136     7 -1020. 2057. 2092.
#&gt; # ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;
#&gt; # A tibble: 333 × 15
#&gt;    bill_length_mm body_mass_g flipper_length_mm sex_male island_Dream
#&gt;             &lt;dbl&gt;       &lt;dbl&gt;             &lt;int&gt;    &lt;dbl&gt;        &lt;dbl&gt;
#&gt;  1         -0.886      -0.565               181    0.990       -0.750
#&gt;  2         -0.812      -0.502               186   -1.01        -0.750
#&gt;  3         -0.665      -1.19                195   -1.01        -0.750
#&gt;  4         -1.33       -0.940               193   -1.01        -0.750
#&gt;  5         -0.849      -0.690               190    0.990       -0.750
#&gt;  6         -0.923      -0.721               181   -1.01        -0.750
#&gt;  7         -0.867       0.592               195    0.990       -0.750
#&gt;  8         -0.518      -1.25                182   -1.01        -0.750
#&gt;  9         -0.978      -0.502               191    0.990       -0.750
#&gt; 10         -1.71        0.248               198    0.990       -0.750
#&gt; # ℹ 323 more rows
#&gt; # ℹ 10 more variables: island_Torgersen &lt;dbl&gt;, species_Chinstrap &lt;dbl&gt;,
#&gt; #   species_Gentoo &lt;dbl&gt;, species &lt;fct&gt;, .fitted &lt;dbl&gt;, .resid &lt;dbl&gt;,
#&gt; #   .hat &lt;dbl&gt;, .sigma &lt;dbl&gt;, .cooksd &lt;dbl&gt;, .std.resid &lt;dbl&gt;</code></pre>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-5_files/figure-revealjs/example_auto_04_output-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="data-budget" class="level2">
<h2 class="anchored" data-anchor-id="data-budget">Data Budget</h2>
<ul>
<li><p>In any modeling effort, it’s crucial to evaluate the performance of a model using different validation techniques to ensure a model can generalize to unseen data.</p></li>
<li><p>But data is limited even in the age of “big data”.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/whole-game-split.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="our-typical-process-will-like-this" class="level2">
<h2 class="anchored" data-anchor-id="our-typical-process-will-like-this">Our typical process will like this:</h2>
<ol type="1">
<li>Read in raw data (<code>readr</code>, <code>dplyr::*_join</code>) (single or multi table)</li>
</ol>
<p>. . .</p>
<ol start="2" type="1">
<li>Prepare the data (EDA/mutate/summarize/clean, etc)</li>
</ol>
<ul>
<li>This is “Feature Engineering”</li>
</ul>
<p>. . .</p>
<ol start="3" type="1">
<li>Once we’ve established our features (rows), we decide how to “spend” them …</li>
</ol>
<p>. . .</p>
<p>For machine learning, we typically split data into <strong>training</strong> and <strong>test</strong> sets:</p>
<p>. . .</p>
<ul>
<li><p>The <strong>training set</strong> is used to estimate model parameters.</p></li>
<li><p>Spending too much data in <strong>training</strong> prevents us from computing a good assessment of model <strong>performance</strong>.</p></li>
</ul>
<p>. . .</p>
<ul>
<li><p>The <strong>test set</strong> is used as an independent assessment of performance.</p></li>
<li><p>Spending too much data in <strong>testing</strong> prevents us from computing good model parameter estimates.</p></li>
</ul>
</section>
<section id="how-we-split-data" class="level2">
<h2 class="anchored" data-anchor-id="how-we-split-data">How we split data</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-5_files/figure-revealjs/test-train-split-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>. . .</p>
<ul>
<li><p>Splitting can be handled in many of ways. Typically, we base it off of a “hold out” percentage (e.g.&nbsp;20%)</p></li>
<li><p>These hold out cases are extracted randomly from the data set. (remember seeds?)</p></li>
</ul>
<p>. . .</p>
<ul>
<li>The <strong>training</strong> set is usually the majority of the data and provides a sandbox for testing different modeling appraoches.</li>
</ul>
<p>. . .</p>
<ul>
<li><p>The <strong>test</strong> set is held in reserve until one or two models are chosen.</p></li>
<li><p>The <strong>test</strong> set is then used as the final arbiter to determine the efficacy of the model.</p></li>
</ul>
</section>
<section id="startification" class="level2">
<h2 class="anchored" data-anchor-id="startification">Startification</h2>
<ul>
<li><p>In many cases, there is a structure to the data that would inhibit inpartial spliiting (e.g.&nbsp;a class, a region, a species, a sex, etc)</p></li>
<li><p>Imagine you have a jar of M&amp;Ms in different colors — red, blue, and green. You want to take some candies out to taste, but you want to make sure you get a fair mix of each color, not just grabbing a bunch of red ones by accident.</p></li>
<li><p>Stratified resampling is like making sure that if your jar is 50% red, 30% blue, and 20% green, then the handful of candies you take keeps the same balance.</p></li>
<li><p>In data science, we do the same thing when we pick samples from a dataset: we make sure that different groups (like categories of people, animals, or weather types) are still fairly represented!</p></li>
</ul>
</section>
<section id="initial-splits" class="level2">
<h2 class="anchored" data-anchor-id="initial-splits">Initial splits <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<ul>
<li>In <code>tidymodels</code>, the <code>rsample</code> package provides functions for creating initial splits of data.</li>
<li>The <code>initial_split()</code> function is used to create a single split of the data.</li>
<li>The <code>prop</code> argument defines the proportion of the data to be used for training.</li>
<li>The default is 0.75, which means 75% of the data will be used for training and 25% for testing.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">101991</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>(resample_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(penguins, <span class="at">prop =</span> <span class="fl">0.8</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;Training/Testing/Total&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;275/69/344&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Sanity check</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="dv">69</span><span class="sc">/</span><span class="dv">344</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.2005814</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="accessing-the-data" class="level2">
<h2 class="anchored" data-anchor-id="accessing-the-data">Accessing the data: <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<ul>
<li>Once the data is split, we can access the training and testing data using the <code>training()</code> and <code>testing()</code> functions to extract the partitioned data from the full set:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>penguins_train <span class="ot">&lt;-</span> <span class="fu">training</span>(resample_split)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(penguins_train)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 275</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Columns: 7</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ species           &lt;fct&gt; Gentoo, Adelie, Gentoo, Chinstrap, Gentoo, Chinstrap…</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ island            &lt;fct&gt; Biscoe, Torgersen, Biscoe, Dream, Biscoe, Dream, Dre…</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ bill_length_mm    &lt;dbl&gt; 46.2, 43.1, 46.2, 45.9, 46.5, 48.1, 45.2, 55.9, 38.1…</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ bill_depth_mm     &lt;dbl&gt; 14.9, 19.2, 14.4, 17.1, 13.5, 16.4, 17.8, 17.0, 17.0…</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ flipper_length_mm &lt;int&gt; 221, 197, 214, 190, 210, 199, 198, 228, 181, 195, 20…</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ body_mass_g       &lt;int&gt; 5300, 3500, 4650, 3575, 4550, 3325, 3950, 5600, 3175…</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ sex               &lt;fct&gt; male, male, NA, female, female, female, female, male…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>penguins_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(resample_split)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(penguins_test)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 69</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Columns: 7</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ species           &lt;fct&gt; Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel…</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ island            &lt;fct&gt; Torgersen, Torgersen, Torgersen, Biscoe, Biscoe, Bis…</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ bill_length_mm    &lt;dbl&gt; NA, 39.3, 36.6, 35.9, 38.8, 37.9, 39.2, 39.6, 36.7, …</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ bill_depth_mm     &lt;dbl&gt; NA, 20.6, 17.8, 19.2, 17.2, 18.6, 21.1, 17.2, 18.8, …</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ flipper_length_mm &lt;int&gt; NA, 190, 185, 189, 180, 172, 196, 196, 187, 205, 187…</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ body_mass_g       &lt;int&gt; NA, 3650, 3700, 3800, 3800, 3150, 4150, 3550, 3800, …</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ sex               &lt;fct&gt; NA, male, female, female, male, female, male, female…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="proportional-gaps" class="level2">
<h2 class="anchored" data-anchor-id="proportional-gaps">Proportional Gaps</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>(<span class="fu">table</span>(penguins<span class="sc">$</span>species) <span class="sc">/</span> <span class="fu">nrow</span>(penguins))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Adelie Chinstrap    Gentoo </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.4418605 0.1976744 0.3604651</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Training Data</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>(<span class="fu">table</span>(penguins_train<span class="sc">$</span>species) <span class="sc">/</span> <span class="fu">nrow</span>(penguins_train))</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Adelie Chinstrap    Gentoo </span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.4581818 0.1818182 0.3600000</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing Data</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>(<span class="fu">table</span>(penguins_test<span class="sc">$</span>species) <span class="sc">/</span> <span class="fu">nrow</span>(penguins_test))</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Adelie Chinstrap    Gentoo </span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.3768116 0.2608696 0.3623188</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="stratification-example" class="level2">
<h2 class="anchored" data-anchor-id="stratification-example">Stratification Example</h2>
<ul>
<li><p>A stratified random sample conducts a specified split within defined subsets of subsets, and then pools the results.</p></li>
<li><p>Only one column can be used to define a strata but grouping/mutate opperations can be used to create a new column that can be used as a strata (e.g.&nbsp;species/island)</p></li>
<li><p>In the case of the penguins data, we can stratify by species (think back to our nested/linear model appraoch)</p></li>
<li><p>This ensures that the training and testing sets have the same proportion of each species as the original data.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the seed</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop missing values and split the data</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>penguins <span class="ot">&lt;-</span> <span class="fu">drop_na</span>(penguins)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>penguins_strata <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(penguins, <span class="at">strata =</span> species, <span class="at">prop =</span> .<span class="dv">8</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the training and testing sets</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>train_strata <span class="ot">&lt;-</span> <span class="fu">training</span>(penguins_strata)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>test_strata  <span class="ot">&lt;-</span> <span class="fu">testing</span>(penguins_strata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="proportional-alignment" class="level2">
<h2 class="anchored" data-anchor-id="proportional-alignment">Proportional Alignment</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the proportions</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(penguins<span class="sc">$</span>species) <span class="sc">/</span> <span class="fu">nrow</span>(penguins)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Adelie Chinstrap    Gentoo </span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.4384384 0.2042042 0.3573574</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Training Data</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(train_strata<span class="sc">$</span>species) <span class="sc">/</span> <span class="fu">nrow</span>(train_strata)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Adelie Chinstrap    Gentoo </span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.4377358 0.2037736 0.3584906</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing Data</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(test_strata<span class="sc">$</span>species) <span class="sc">/</span> <span class="fu">nrow</span>(test_strata)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Adelie Chinstrap    Gentoo </span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.4411765 0.2058824 0.3529412</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modeling" class="level2">
<h2 class="anchored" data-anchor-id="modeling">Modeling</h2>
<div class="{columns}">
<div class="column" style="width:50%;">
<ul>
<li><p>Once the data is split, we can decide what type of model to invoke.</p></li>
<li><p>Often, users simply pick a well known model type or class for a type of problem (Classic Conceptual Model)</p></li>
<li><p>We will learn more about model types and uses next week!</p></li>
<li><p>For now, just know that the <strong>training</strong> data is used to fit a model.</p></li>
<li><p>If we are certain about the model, we can use the <strong>test</strong> data to evaluate the model.</p></li>
</ul>
</div>
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/whole-game-split.jpg" class="img-fluid figure-img" style="width:45.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/whole-game-model-1.jpg" class="img-fluid figure-img" style="width:200.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="modeling-options" class="level2">
<h2 class="anchored" data-anchor-id="modeling-options">Modeling Options</h2>
<ul>
<li><p>But, there are many types of models, with different assumptions, behaviors, and qualities, that make some more applicable to a given dataset!</p></li>
<li><p>Most models have some type of parmeterization, that can often be <em>tuned</em>.</p></li>
<li><p>Testing combinations of model and tuning parmaters also requires some combintation of <code>training</code>/<code>testing</code> splits.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/whole-game-model-n.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="modeling-options-1" class="level2">
<h2 class="anchored" data-anchor-id="modeling-options-1">Modeling Options</h2>
<p>What if we want to compare more models?</p>
<p>. . .</p>
<p>And/or more model configurations?</p>
<p>. . .</p>
<p>And we want to understand if these are important differences?</p>
<p>. . .</p>
<p>How can we use the <em>training</em> data to compare and evaluate different models? 🤔</p>
<p>. . .</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/whole-game-resamples.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="resampling" class="level2">
<h2 class="anchored" data-anchor-id="resampling">Resampling</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>Testing combinations of model and tuning parmaters also requires some combintation of <code>training</code>/<code>testing</code> splits.</p></li>
<li><p>Resampling methods, such as cross-validation and bootstraping, are empirical simulation systems that help facilitate this.</p></li>
<li><p>They create a series of data sets similar to the initial <code>training</code>/<code>testing</code> split.</p></li>
<li><p>In the first level of the diagram to the right, we first split the original data into <code>training</code>/<code>testing</code> sets. Then, the training set is chosen for resampling.</p></li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center" data-caption="This schematic from [Kuhn and Johnson (2019)](https://bookdown.org/max/FES/resampling.html) illustrates data usage for resampling methods">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/resampling.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="key-resampling-methods" class="level2">
<h2 class="anchored" data-anchor-id="key-resampling-methods">Key Resampling Methods</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Resampling is always used with the training set.</p>
</div>
</div>
<p>Resampling is a key step in model validation and assessment. The <code>rsample</code> package provides tools to create resampling strategies such as cross-validation, bootstrapping, and validation splits.</p>
<p>. . .</p>
<ol type="1">
<li><strong>K-Fold Cross-Validation</strong>: The dataset is split into multiple “folds” (e.g., 5-fold or 10-fold), where each fold is used as a validation set while the remaining data is used for training.</li>
</ol>
<p>. . .</p>
<ol start="2" type="1">
<li><strong>Bootstrap Resampling</strong>: Samples are drawn <em>with replacement</em> from the training dataset to generate multiple datasets, which used to train and test the model.</li>
</ol>
<p>. . .</p>
<ol start="3" type="1">
<li><strong>Monte Carlo Resampling (Repeated Train-Test Splits)</strong>: Randomly splits data multiple times.</li>
</ol>
<p>. . .</p>
<ol start="4" type="1">
<li><strong>Validation Split</strong>: Creates a single training and testing partition.</li>
</ol>
</section>
<section id="cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation">Cross-validation</h2>
<p><img src="https://www.tmwr.org/premade/three-CV.svg" class="img-fluid"></p>
</section>
<section id="cross-validation-1" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation-1">Cross-validation</h2>
<p><img src="https://www.tmwr.org/premade/three-CV-iter.svg" class="img-fluid"></p>
</section>
<section id="cross-validation-2" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation-2">Cross-validation <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="{columns}">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>penguins_train <span class="sc">|&gt;</span> <span class="fu">glimpse</span>() </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 275</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Columns: 7</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ species           &lt;fct&gt; Gentoo, Adelie, Gentoo, Chinstrap, Gentoo, Chinstrap…</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ island            &lt;fct&gt; Biscoe, Torgersen, Biscoe, Dream, Biscoe, Dream, Dre…</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ bill_length_mm    &lt;dbl&gt; 46.2, 43.1, 46.2, 45.9, 46.5, 48.1, 45.2, 55.9, 38.1…</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ bill_depth_mm     &lt;dbl&gt; 14.9, 19.2, 14.4, 17.1, 13.5, 16.4, 17.8, 17.0, 17.0…</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ flipper_length_mm &lt;int&gt; 221, 197, 214, 190, 210, 199, 198, 228, 181, 195, 20…</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ body_mass_g       &lt;int&gt; 5300, 3500, 4650, 3575, 4550, 3325, 3950, 5600, 3175…</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ sex               &lt;fct&gt; male, male, NA, female, female, female, female, male…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(penguins_train) <span class="sc">*</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 27.5</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">vfold_cv</span>(penguins_train, <span class="at">v =</span> <span class="dv">10</span>) <span class="co"># v = 10 is default</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #  10-fold cross-validation </span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 2</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    splits           id    </span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;list&gt;           &lt;chr&gt; </span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 &lt;split [247/28]&gt; Fold01</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 &lt;split [247/28]&gt; Fold02</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 &lt;split [247/28]&gt; Fold03</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 &lt;split [247/28]&gt; Fold04</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 &lt;split [247/28]&gt; Fold05</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 &lt;split [248/27]&gt; Fold06</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 &lt;split [248/27]&gt; Fold07</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 &lt;split [248/27]&gt; Fold08</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 &lt;split [248/27]&gt; Fold09</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 &lt;split [248/27]&gt; Fold10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.tmwr.org/premade/three-CV.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.tmwr.org/premade/three-CV-iter.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="cross-validation-3" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation-3">Cross-validation <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<p>What is in this?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>penguins_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(penguins_train)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>penguins_folds<span class="sc">$</span>splits[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;Analysis/Assess/Total&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;247/28/275&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;Analysis/Assess/Total&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;247/28/275&gt;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;Analysis/Assess/Total&gt;</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;247/28/275&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Here is another example of a list column enabling the storage of non-atomic types in tibble</p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Set the seed when creating resamples</p>
</div>
</div>
</section>
<section id="alternate-resampling-schemes" class="level1">
<h1>Alternate resampling schemes</h1>
<section id="bootstrapping" class="level2">
<h2 class="anchored" data-anchor-id="bootstrapping">Bootstrapping</h2>
<p><img src="https://www.tmwr.org/premade/bootstraps.svg" class="img-fluid"></p>
</section>
<section id="bootstrapping-1" class="level2">
<h2 class="anchored" data-anchor-id="bootstrapping-1">Bootstrapping <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3214</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bootstraps</span>(penguins_train)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Bootstrap sampling </span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 25 × 2</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    splits            id         </span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;list&gt;            &lt;chr&gt;      </span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 &lt;split [275/96]&gt;  Bootstrap01</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 &lt;split [275/105]&gt; Bootstrap02</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 &lt;split [275/108]&gt; Bootstrap03</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 &lt;split [275/111]&gt; Bootstrap04</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 &lt;split [275/102]&gt; Bootstrap05</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 &lt;split [275/98]&gt;  Bootstrap06</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 &lt;split [275/92]&gt;  Bootstrap07</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 &lt;split [275/97]&gt;  Bootstrap08</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 &lt;split [275/100]&gt; Bootstrap09</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 &lt;split [275/99]&gt;  Bootstrap10</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 15 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="monte-carlo-cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="monte-carlo-cross-validation">Monte Carlo Cross-Validation <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">322</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mc_cv</span>(penguins_train, <span class="at">times =</span> <span class="dv">10</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Monte Carlo cross-validation (0.75/0.25) with 10 resamples  </span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 2</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    splits           id        </span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;list&gt;           &lt;chr&gt;     </span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 &lt;split [206/69]&gt; Resample01</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 &lt;split [206/69]&gt; Resample02</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 &lt;split [206/69]&gt; Resample03</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 &lt;split [206/69]&gt; Resample04</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 &lt;split [206/69]&gt; Resample05</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 &lt;split [206/69]&gt; Resample06</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 &lt;split [206/69]&gt; Resample07</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 &lt;split [206/69]&gt; Resample08</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 &lt;split [206/69]&gt; Resample09</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 &lt;split [206/69]&gt; Resample10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="validation-set" class="level2">
<h2 class="anchored" data-anchor-id="validation-set">Validation set <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>penguins_val_split <span class="ot">&lt;-</span> <span class="fu">initial_validation_split</span>(penguins)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>penguins_val_split</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;Training/Validation/Testing/Total&gt;</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;199/67/67/333&gt;</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">validation_set</span>(penguins_val_split)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   splits           id        </span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;list&gt;           &lt;chr&gt;     </span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 &lt;split [199/67]&gt; validation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>A validation set is just another type of resample</p>
</section>
<section id="the-whole-game---status-update" class="level2">
<h2 class="anchored" data-anchor-id="the-whole-game---status-update">The whole game - status update</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/whole-game-transparent-resamples.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="section-1" class="level2" data-background-iframe="https://rsample.tidymodels.org/reference/index.html">
<h2 data-background-iframe="https://rsample.tidymodels.org/reference/index.html" class="anchored" data-anchor-id="section-1"></h2>
<div class="footer">

</div>
</section>
</section>
<section id="unit-example" class="level1" data-background-image="images/oregon-forest.png" data-background-opacity=".5">
<h1 data-background-image="images/oregon-forest.png" data-background-opacity=".5">Unit Example</h1>
<p>Can we predict if a plot of land is forested? - Interested in classification models - We have a dataset of 7,107 6000-acre hexagons in Washington state. - Each hexagon has a nominal outcome, <code>forested</code>, with levels <code>"Yes"</code> and <code>"No"</code>.</p>
<section id="data-on-forests-in-washington" class="level2">
<h2 class="anchored" data-anchor-id="data-on-forests-in-washington">Data on forests in Washington</h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>The U.S. Forest Service maintains ML models to predict whether a plot of land is “forested.”</li>
<li>This classification is important for all sorts of research, legislation, and land management purposes.</li>
<li>Plots are typically remeasured every 10 years and this dataset contains the most recent measurement per plot.</li>
<li>Type <code>?forested</code> to learn more about this dataset, including references.</li>
</ul>
</div><div class="column" style="width:40%;">
<p><img src="images/forest_mountain.svg" class="img-fluid"></p>
</div>
</div>
<div class="footer">
<p>Credit: <a href="https://www.svgrepo.com/svg/251793/forest-mountain" class="uri">https://www.svgrepo.com/svg/251793/forest-mountain</a></p>
</div>
</section>
<section id="data-on-forests-in-washington-1" class="level2">
<h2 class="anchored" data-anchor-id="data-on-forests-in-washington-1">Data on forests in Washington</h2>
<div class="columns">
<div class="column" style="width:70%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forested)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(forested)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 7107   19</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>One observation from each of 7,107 6000-acre hexagons in Washington state.</p></li>
<li><p>A nominal outcome, <code>forested</code>, with levels <code>"Yes"</code> and <code>"No"</code>, measured “on-the-ground.”</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(forested<span class="sc">$</span>forested)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Yes   No </span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3894 3213</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>18 remotely-sensed and easily-accessible predictors:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(forested)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] "forested"         "year"             "elevation"        "eastness"        </span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5] "northness"        "roughness"        "tree_no_tree"     "dew_temp"        </span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9] "precip_annual"    "temp_annual_mean" "temp_annual_min"  "temp_annual_max" </span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13] "temp_january_min" "vapor_min"        "vapor_max"        "canopy_cover"    </span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [17] "lon"              "lat"              "land_type"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:30%;">
<p><img src="images/forest.svg" class="center img-fluid"></p>
</div>
</div>
<div class="footer">
<p>Credit: <a href="https://www.svgrepo.com/svg/67614/forest" class="uri">https://www.svgrepo.com/svg/67614/forest</a></p>
</div>
</section>
<section id="data-splitting-and-spending" class="level2">
<h2 class="anchored" data-anchor-id="data-splitting-and-spending">Data splitting and spending</h2>
<section id="the-initial-split" class="level3">
<h3 class="anchored" data-anchor-id="the-initial-split">The initial split <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>forested_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(forested, <span class="at">prop =</span> .<span class="dv">8</span>, <span class="at">strata =</span> tree_no_tree)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>forested_split</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;Training/Testing/Total&gt;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;5685/1422/7107&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="accessing-the-data-1" class="level2">
<h2 class="anchored" data-anchor-id="accessing-the-data-1">Accessing the data <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>forested_train <span class="ot">&lt;-</span> <span class="fu">training</span>(forested_split)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>forested_test  <span class="ot">&lt;-</span> <span class="fu">testing</span>(forested_split)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(forested_train)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5685</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(forested_test)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1422</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="k-fold-cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="k-fold-cross-validation">K-Fold Cross-Validation <img src="hexes/rsample.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the dataset</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a 10-fold cross-validation object</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>(forested_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(forested_train, <span class="at">v =</span> <span class="dv">10</span>))</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #  10-fold cross-validation </span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 2</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    splits             id    </span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;list&gt;             &lt;chr&gt; </span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 &lt;split [5116/569]&gt; Fold01</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 &lt;split [5116/569]&gt; Fold02</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 &lt;split [5116/569]&gt; Fold03</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 &lt;split [5116/569]&gt; Fold04</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 &lt;split [5116/569]&gt; Fold05</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 &lt;split [5117/568]&gt; Fold06</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 &lt;split [5117/568]&gt; Fold07</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 &lt;split [5117/568]&gt; Fold08</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 &lt;split [5117/568]&gt; Fold09</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 &lt;split [5117/568]&gt; Fold10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-do-you-fit-a-linear-model-in-r" class="level2">
<h2 class="anchored" data-anchor-id="how-do-you-fit-a-linear-model-in-r">How do you fit a linear model in R?</h2>
<ul>
<li><p><code>lm</code> for linear model &lt;– The one we have looked at!</p></li>
<li><p><code>glmnet</code> for regularized regression</p></li>
<li><p><code>keras</code> for regression using TensorFlow</p></li>
<li><p><code>stan</code> for Bayesian regression using Stan</p></li>
<li><p><code>spark</code> for large data sets using spark</p></li>
<li><p><code>brulee</code> for regression using torch (PyTourch)</p></li>
</ul>
</section>
<section id="challenge" class="level2">
<h2 class="anchored" data-anchor-id="challenge">Challenge</h2>
<ul>
<li>All of these models have different syntax and functions</li>
<li>How do you keep track of all of them?</li>
<li>How do you know which one to use?</li>
<li>How would you compare them?</li>
</ul>
<p>Comparing 3-5 of these models is a lot of work using functions for diverse packages.</p>
<div class="{columns}">
<div class="column" style="width:40%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/lm-help.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/glm-help.png" class="img-fluid figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="the-tidymodels-advantage" class="level2">
<h2 class="anchored" data-anchor-id="the-tidymodels-advantage">The tidymodels advantage</h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>In the <code>tidymodels</code> framework, all models are created using the same syntax:
<ul>
<li>This makes it easy to compare models</li>
<li>This makes it easy to switch between models</li>
<li>This makes it easy to use the same model with different engines (packages)</li>
</ul></li>
<li>The <code>parsnip</code> package provides a consistent interface to many models</li>
<li>For example, to fit a linear model you would be able to access the <code>linear_reg(</code>) function</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>?linear_reg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/lm_engines.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="a-tidymodels-prediction-will" class="level2">
<h2 class="anchored" data-anchor-id="a-tidymodels-prediction-will">A tidymodels prediction will … <img src="hexes/tidymodels.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<ul>
<li>always be inside a <strong>tibble</strong></li>
<li>have column names and types are <strong>unsurprising</strong> and <strong>predictable</strong></li>
<li>ensure the number of rows in <code>new_data</code> and the output <strong>are the same</strong></li>
</ul>
</section>
<section id="to-specify-a-model" class="level2">
<h2 class="anchored" data-anchor-id="to-specify-a-model">To specify a model <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<p>. . .</p>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>Choose a <u>model</u></li>
<li>Specify an engine</li>
<li>Set the mode</li>
</ul>
</div><div class="column" style="width:40%;">
<p><br><br><br> <img src="images/forest_mountain.svg" class="absolute" height="300"></p>
</div>
</div>
</section>
<section id="specify-a-model-type" class="level2">
<h2 class="anchored" data-anchor-id="specify-a-model-type">Specify a model: Type <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<p>Next week we will discuss model types more thoroughly. For now, we will focus on two types:</p>
<ol type="1">
<li>Logistic Regression</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logistic_reg</span>()</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Logistic Regression Model Specification (classification)</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Computational engine: glm</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">decision_tree</span>()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Decision Tree Model Specification (unknown mode)</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Computational engine: rpart</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We chose these two because they are robust, simple model that fit our goal of predicting a binary condition/class (forested/not forested)</p>
</section>
<section id="specify-a-model-engine" class="level2">
<h2 class="anchored" data-anchor-id="specify-a-model-engine">Specify a model: engine <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>Choose a model</li>
<li>Specify an <u>engine</u></li>
<li>Set the mode</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>?<span class="fu">logistic_reg</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/log_reg_help_engine.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="specify-a-model-engine-1" class="level2">
<h2 class="anchored" data-anchor-id="specify-a-model-engine-1">Specify a model: engine <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Logistic Regression Model Specification (classification)</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Computational engine: glmnet</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"stan"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Logistic Regression Model Specification (classification)</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Computational engine: stan</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="specify-a-model-mode" class="level2">
<h2 class="anchored" data-anchor-id="specify-a-model-mode">Specify a model: mode <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>Choose a model</li>
<li>Specify an engine</li>
<li>Set the <u>mode</u></li>
</ul>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>?<span class="fu">logistic_reg</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/log_reg_help_class.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="specify-a-model-mode-1" class="level2">
<h2 class="anchored" data-anchor-id="specify-a-model-mode-1">Specify a model: mode <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<section id="some-models-have-limit-classes" class="level4">
<h4 class="anchored" data-anchor-id="some-models-have-limit-classes">Some models have limit classes …</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logistic_reg</span>() </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Logistic Regression Model Specification (classification)</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Computational engine: glm</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
</section>
<section id="others-requires-specification" class="level4">
<h4 class="anchored" data-anchor-id="others-requires-specification">Others requires specification …</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">decision_tree</span>()</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Decision Tree Model Specification (unknown mode)</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Computational engine: rpart</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Decision Tree Model Specification (classification)</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Computational engine: rpart</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="r-fit-text">
<p>All available models are listed at <a href="https://www.tidymodels.org/find/parsnip/" class="uri">https://www.tidymodels.org/find/parsnip/</a></p>
</div>
</section>
</section>
<section id="section-2" class="level2" data-background-iframe="https://www.tidymodels.org/find/parsnip/">
<h2 data-background-iframe="https://www.tidymodels.org/find/parsnip/" class="anchored" data-anchor-id="section-2"></h2>
<div class="footer">

</div>
</section>
<section id="to-specify-a-model-1" class="level2">
<h2 class="anchored" data-anchor-id="to-specify-a-model-1">To specify a model <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>Choose a <u>model</u></li>
<li>Specify an <u>engine</u></li>
<li>Set the <u>mode</u></li>
</ul>
</div><div class="column" style="width:40%;">
<p><br><br><br> <img src="images/forest_mountain.svg" class="absolute" height="300"></p>
</div>
</div>
</section>
<section id="logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression">Logistic regression</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>Logistic regression predicts probability—instead of a straight line, it gives an S-shaped curve that estimates how likely an outcome (e.g., is forested) is based on a predictor (e.g., rainfall and temperature).</p></li>
<li><p>The dots in the plot show the actual proportion of “successes” (e.g., is forested) within different bins of the predictor variable(s) (A).</p></li>
<li><p>The vertical error bars represent uncertainty—showing a range where the true probability might fall.</p></li>
<li><p>Logistic regression helps answer “how likely” questions—e.g., “How likely is someone to pass based on their study hours?” rather than just predicting a yes/no outcome.</p></li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-5_files/figure-revealjs/plot-logistic-reg-2-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="decision-trees" class="level2">
<h2 class="anchored" data-anchor-id="decision-trees">Decision trees</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-5_files/figure-revealjs/plot-tree-fit-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">

</div>
</div>
</section>
<section id="decision-trees-1" class="level2">
<h2 class="anchored" data-anchor-id="decision-trees-1">Decision trees</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-5_files/figure-revealjs/plot-tree-fit-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<ul>
<li><p>Series of splits or if/then statements based on predictors</p></li>
<li><p>First the tree <em>grows</em> until some condition is met (maximum depth, no more data)</p></li>
<li><p>Then the tree is <em>pruned</em> to reduce its complexity</p></li>
</ul>
</div>
</div>
</section>
<section id="decision-trees-2" class="level2">
<h2 class="anchored" data-anchor-id="decision-trees-2">Decision trees</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-5_files/figure-revealjs/plot-tree-fit-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-5_files/figure-revealjs/plot-tree-preds-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="what-algorithm-is-best-for-estimate-forested-plots" class="level2">
<h2 class="anchored" data-anchor-id="what-algorithm-is-best-for-estimate-forested-plots">What algorithm is best for estimate forested plots?</h2>
<p>We can only really know by testing them …</p>
<div class="columns">
<div class="column" style="width:50%;">
<section id="logistic-regression-1" class="level4">
<h4 class="anchored" data-anchor-id="logistic-regression-1">Logistic regression</h4>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-5_files/figure-revealjs/plot-logistic-reg-3-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</div><div class="column" style="width:50%;">
<section id="decision-trees-3" class="level4">
<h4 class="anchored" data-anchor-id="decision-trees-3">Decision trees</h4>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-5_files/figure-revealjs/plot-tree-preds-2-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</div>
</div>
</section>
<section id="fitting-your-model" class="level2">
<h2 class="anchored" data-anchor-id="fitting-your-model">Fitting your model:</h2>
<ul>
<li>OK! So you have split data, you have a model, and you have an engine and mode</li>
<li>Now you need to fit the model!</li>
<li>This is done using the <code>fit()</code> function</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>dt_model <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">'rpart'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Model, formula, data inputs</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>(output <span class="ot">&lt;-</span> <span class="fu">fit</span>(dt_model, forested <span class="sc">~</span> ., <span class="at">data =</span> forested_train) )</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parsnip model object</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; n= 5685 </span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; node), split, n, loss, yval, (yprob)</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       * denotes terminal node</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1) root 5685 2571 Yes (0.54775726 0.45224274)  </span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    2) land_type=Tree 3025  289 Yes (0.90446281 0.09553719) *</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    3) land_type=Barren,Non-tree vegetation 2660  378 No (0.14210526 0.85789474)  </span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      6) temp_annual_max&lt; 13.395 351  155 Yes (0.55840456 0.44159544)  </span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       12) tree_no_tree=Tree 91    5 Yes (0.94505495 0.05494505) *</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       13) tree_no_tree=No tree 260  110 No (0.42307692 0.57692308) *</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      7) temp_annual_max&gt;=13.395 2309  182 No (0.07882200 0.92117800) *</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="component-extracts" class="level2">
<h2 class="anchored" data-anchor-id="component-extracts">Component extracts:</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>While <code>tidymodels</code> provides a standard interface to all models all base models have specific methods (remember <code>summary.lm</code>? )</p></li>
<li><p>To use these, you must extract a the underlying object.</p></li>
<li><p><code>extract_fit_engine()</code> extracts the underlying model object</p></li>
<li><p><code>extract_fit_parsnip()</code> extracts the parsnip object</p></li>
<li><p><code>extract_recipe()</code> extracts the recipe object</p></li>
<li><p><code>extract_preprocessor()</code> extracts the preprocessor object</p></li>
<li><p>… many more</p></li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>ex <span class="ot">&lt;-</span> <span class="fu">extract_fit_engine</span>(output)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(ex) <span class="co"># the class of the engine used!</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "rpart"</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use rpart plot and text methods ...</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ex)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(ex, <span class="at">cex =</span> <span class="fl">0.9</span>, <span class="at">use.n =</span> <span class="cn">TRUE</span>, <span class="at">xpd =</span> <span class="cn">TRUE</span>,)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-5_files/figure-revealjs/unnamed-chunk-26-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="a-model-workflow" class="level1">
<h1>A model workflow</h1>
<section id="workflows" class="level2">
<h2 class="anchored" data-anchor-id="workflows">Workflows? <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<p>The <code>workflows</code> package in <code>tidymodels</code> helps:</p>
<ul>
<li><p>Manage preprocessing and modeling in a structured pipeline</p></li>
<li><p>Avoid repetitive code</p></li>
<li><p>Reduce errors when integrating steps</p></li>
</ul>
<p>. . .</p>
<p>Think of them as containers for:</p>
<ul>
<li><p>Preprocessing steps (e.g., feature engineering, transformations)</p></li>
<li><p>Model specification</p></li>
<li><p>Fitting approaches</p></li>
</ul>
<p>. . .</p>
<p>Why Use Workflows?</p>
<p>✅ Keeps preprocessing and modeling together<br>
</p>
<p>✅ Ensures consistency in data handling &nbsp;</p>
<p>✅ Makes code easier to read and maintain&nbsp;</p>
</section>
<section id="basic-workflow-structure" class="level2">
<h2 class="anchored" data-anchor-id="basic-workflow-structure">Basic Workflow Structure: <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<ol type="1">
<li><p>Create a workflow object (similar to how <code>ggplot()</code> instantiates a canvas)</p></li>
<li><p>Add a formula or recipe (preprocessor)</p></li>
<li><p>Add the model</p></li>
<li><p>Fit the workflow</p></li>
</ol>
</section>
<section id="a-model-workflow-1" class="level2">
<h2 class="anchored" data-anchor-id="a-model-workflow-1">A model workflow <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"> <img src="hexes/parsnip.png" class="absolute" data-top="-20" data-right="64" width="64" height="74"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>dt_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_formula</span>(forested <span class="sc">~</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(dt_model) <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> forested_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="cell">
<pre><code>#&gt; ══ Workflow [trained] ══════════════════════════════════════════════════════════
#&gt; Preprocessor: Formula
#&gt; Model: decision_tree()
#&gt; 
#&gt; ── Preprocessor ────────────────────────────────────────────────────────────────
#&gt; forested ~ .
#&gt; 
#&gt; ── Model ───────────────────────────────────────────────────────────────────────
#&gt; n= 5685 
#&gt; 
#&gt; node), split, n, loss, yval, (yprob)
#&gt;       * denotes terminal node
#&gt; 
#&gt;  1) root 5685 2571 Yes (0.54775726 0.45224274)  
#&gt;    2) land_type=Tree 3025  289 Yes (0.90446281 0.09553719) *
#&gt;    3) land_type=Barren,Non-tree vegetation 2660  378 No (0.14210526 0.85789474)  
#&gt;      6) temp_annual_max&lt; 13.395 351  155 Yes (0.55840456 0.44159544)  
#&gt;       12) tree_no_tree=Tree 91    5 Yes (0.94505495 0.05494505) *
#&gt;       13) tree_no_tree=No tree 260  110 No (0.42307692 0.57692308) *
#&gt;      7) temp_annual_max&gt;=13.395 2309  182 No (0.07882200 0.92117800) *</code></pre>
</div>
</section>
<section id="predict-with-your-model" class="level2">
<h2 class="anchored" data-anchor-id="predict-with-your-model">Predict with your model <img src="hexes/broom.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<p><em>How do you use your new model?</em></p>
<ul>
<li><code>augment()</code> will return the dataset with predictions and residuals added.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>dt_preds <span class="ot">&lt;-</span> <span class="fu">augment</span>(dt_wf, <span class="at">new_data =</span> forested_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="cell">
<pre><code>#&gt; # A tibble: 1,422 × 22
#&gt;    .pred_class .pred_Yes .pred_No forested  year elevation eastness northness
#&gt;    &lt;fct&gt;           &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
#&gt;  1 Yes            0.904    0.0955 No        2005       164      -84        53
#&gt;  2 Yes            0.904    0.0955 Yes       2005       806       47       -88
#&gt;  3 No             0.423    0.577  Yes       2005      2240      -67       -74
#&gt;  4 Yes            0.904    0.0955 Yes       2005       787       66       -74
#&gt;  5 Yes            0.904    0.0955 Yes       2005      1330       99         7
#&gt;  6 Yes            0.904    0.0955 Yes       2005      1423       46        88
#&gt;  7 Yes            0.904    0.0955 Yes       2014       546      -92       -38
#&gt;  8 Yes            0.904    0.0955 Yes       2014      1612       30       -95
#&gt;  9 No             0.0788   0.921  No        2014       235        0      -100
#&gt; 10 No             0.0788   0.921  No        2014       308      -70       -70
#&gt; # ℹ 1,412 more rows
#&gt; # ℹ 14 more variables: roughness &lt;dbl&gt;, tree_no_tree &lt;fct&gt;, dew_temp &lt;dbl&gt;,
#&gt; #   precip_annual &lt;dbl&gt;, temp_annual_mean &lt;dbl&gt;, temp_annual_min &lt;dbl&gt;,
#&gt; #   temp_annual_max &lt;dbl&gt;, temp_january_min &lt;dbl&gt;, vapor_min &lt;dbl&gt;,
#&gt; #   vapor_max &lt;dbl&gt;, canopy_cover &lt;dbl&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;, land_type &lt;fct&gt;</code></pre>
</div>
</section>
<section id="evaluate-your-model" class="level2">
<h2 class="anchored" data-anchor-id="evaluate-your-model">Evaluate your model <img src="hexes/yardstick.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<p><em>How do you evaluate the skill of your models?</em></p>
<p>We will learn more about model evaluation and tuning latter in this unit, but for now we can blindly use the <code>metrics()</code> function defaults to get a sense of how our model is doing.</p>
<ul>
<li><p>The default metrics for <em>classification</em> models are <strong>accuracy</strong> and <strong>kap</strong> (Cohen’s Kappa)</p></li>
<li><p>The default metric for <em>regression</em> models are <strong>RMSE</strong>, <strong>R^2</strong>, and <strong>MAE</strong></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We have a classification model</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">metrics</span>(dt_preds, <span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric  .estimator .estimate</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 accuracy binary         0.885</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 kap      binary         0.768</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="tidymodels-advantage" class="level1">
<h1><code>tidymodels</code> advantage! <img src="hexes/tidymodels.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h1>
<ul>
<li>OK! while that was not too much work, it certainly wasn’t minimal.</li>
</ul>
<p>. . .</p>
<ul>
<li><p>Now lets say you want to check if the logistic regression model performs better than the decision tree</p></li>
<li><p>That sounds like a lot to repeat.</p></li>
<li><p>Fortunately, the <code>tidymodels</code> framework makes this a straight forward swap!</p></li>
</ul>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>log_mod <span class="ot">=</span> <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>log_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_formula</span>(forested <span class="sc">~</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(log_mod) <span class="sc">%&gt;%</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> forested_train)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>log_preds <span class="ot">&lt;-</span> <span class="fu">augment</span>(log_wf, <span class="at">new_data =</span> forested_test)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="fu">metrics</span>(log_preds, <span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric  .estimator .estimate</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 accuracy binary         0.890</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 kap      binary         0.777</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="so-who-wins" class="level2">
<h2 class="anchored" data-anchor-id="so-who-wins">So who wins?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">metrics</span>(dt_preds, <span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric  .estimator .estimate</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 accuracy binary         0.885</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 kap      binary         0.768</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">metrics</span>(log_preds, <span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric  .estimator .estimate</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 accuracy binary         0.890</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 kap      binary         0.777</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Right out of the gate, there doesn’t seem to be much difference, but …</p>
</section>
<section id="dont-get-to-confident" class="level2">
<h2 class="anchored" data-anchor-id="dont-get-to-confident">Don’t get to confident!</h2>
<ul>
<li>We have evaluated the model on the same data we trained it on</li>
<li>This is not a good practice and can give us a false sense of confidence</li>
<li>Instead, we can use our <code>resamples</code> to better understand the skill of a model based on the iterative leave out policy:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dt_wf_rs <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_formula</span>(forested <span class="sc">~</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(dt_model) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resamples =</span> forested_folds, </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Here we just ask tidymodels to save all predictions...</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">control   =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="cell">
<pre><code>#&gt; # A tibble: 1 × 5
#&gt;   splits             id     .metrics         .notes           .predictions      
#&gt;   &lt;list&gt;             &lt;chr&gt;  &lt;list&gt;           &lt;list&gt;           &lt;list&gt;            
#&gt; 1 &lt;split [5116/569]&gt; Fold01 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [569 × 6]&gt;</code></pre>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>tidyr::unnest</code> could be used to expand any of those list columns!</p>
</div>
</div>
</section>
<section id="dont-get-to-confident-1" class="level2">
<h2 class="anchored" data-anchor-id="dont-get-to-confident-1">Don’t get to confident!</h2>
<ul>
<li>We can execute the same workflow for the logistic regression model, this time evaluating the resamples instead of the test data.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>log_wf_rs <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_formula</span>(forested <span class="sc">~</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(log_mod) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resamples =</span> forested_folds,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="cell">
<pre><code>#&gt; # Resampling results
#&gt; # 10-fold cross-validation 
#&gt; # A tibble: 10 × 5
#&gt;    splits             id     .metrics         .notes           .predictions
#&gt;    &lt;list&gt;             &lt;chr&gt;  &lt;list&gt;           &lt;list&gt;           &lt;list&gt;      
#&gt;  1 &lt;split [5116/569]&gt; Fold01 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt;  2 &lt;split [5116/569]&gt; Fold02 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt;  3 &lt;split [5116/569]&gt; Fold03 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt;  4 &lt;split [5116/569]&gt; Fold04 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt;  5 &lt;split [5116/569]&gt; Fold05 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt;  6 &lt;split [5117/568]&gt; Fold06 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt;  7 &lt;split [5117/568]&gt; Fold07 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt;  8 &lt;split [5117/568]&gt; Fold08 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt;  9 &lt;split [5117/568]&gt; Fold09 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    
#&gt; 10 &lt;split [5117/568]&gt; Fold10 &lt;tibble [3 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;</code></pre>
</div>
</section>
<section id="dont-get-to-confident-2" class="level2">
<h2 class="anchored" data-anchor-id="dont-get-to-confident-2">Don’t get to confident!</h2>
<ul>
<li><p>Since we now have an “ensemble” of models (across the folds), we can collect a summary of the metrics across them.</p></li>
<li><p>The default metrics for classification ensembles are:</p>
<ul>
<li><strong>accuracy</strong>: accuracy is the proportion of correct predictions</li>
<li><strong>brier_class</strong>: the Brier score for classification is the mean squared difference between the predicted probability and the actual outcome</li>
<li><strong>roc_auc</strong>: the area under the ROC (Receiver Operating Characteristic) curve</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(log_wf_rs)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 6</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric     .estimator   mean     n std_err .config             </span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 accuracy    binary     0.906     10 0.00360 Preprocessor1_Model1</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 brier_class binary     0.0714    10 0.00191 Preprocessor1_Model1</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 roc_auc     binary     0.961     10 0.00164 Preprocessor1_Model1</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(dt_wf_rs)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 6</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric     .estimator   mean     n std_err .config             </span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 accuracy    binary     0.896     10 0.00385 Preprocessor1_Model1</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 brier_class binary     0.0889    10 0.00224 Preprocessor1_Model1</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 roc_auc     binary     0.909     10 0.00267 Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="further-simplification-workflowsets" class="level2">
<h2 class="anchored" data-anchor-id="further-simplification-workflowsets">Further simplification: <code>workflowsets</code></h2>
<p>OK, so we have streamlined a lot of things with <code>tidymodels</code>:</p>
<ul>
<li><p>We have a specified preprocesser (e.g.&nbsp;formula or recipe)</p></li>
<li><p>We have defined a model (complete with engine and mode)</p></li>
<li><p>We have implemented workflows pairing each model with the preprocesser to either fit the model to the resamples, or, the training data.</p></li>
</ul>
<p>While a significant improvement, we can do better!</p>
<div class="{callout-note}">
<p>Does the idea of implementing a process over an list of elements ring a bell?</p>
</div>
</section>
<section id="model-mappings" class="level2">
<h2 class="anchored" data-anchor-id="model-mappings">Model mappings: <img src="hexes/workflows.png" class="absolute" data-top="-20" data-right="0" width="64" height="74"></h2>
<ul>
<li><p><code>workflowsets</code> is a package that builds off of <code>purrr</code> and allows you to iterate over multiple models and/or multiple resamples</p></li>
<li><p>Remember how <code>map</code>, <code>map_*</code>, <code>map2</code>, and <code>walk2</code> functions allow lists to map to lists or vectors? <code>workflow_set</code> maps a preprocessor (formula or recipe) to a set of models - each provided as a <code>list</code> object.</p></li>
<li><p>To start, we will create a <code>workflow_set</code> object (instead of a <code>workflow</code>). The first argument is a list of preprocessor objects (formulas or recipes) and the second argument is a list of model objects.</p></li>
<li><p>Both must be lists, by nature of the underlying <code>purrr</code> code.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>(wf_obj <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(<span class="fu">list</span>(forested <span class="sc">~</span>.), <span class="fu">list</span>(log_mod, dt_model)))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A workflow set/tibble: 2 × 4</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   wflow_id              info             option    result    </span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                 &lt;list&gt;           &lt;list&gt;    &lt;list&gt;    </span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 formula_logistic_reg  &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 formula_decision_tree &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="iteritive-extecution" class="level2">
<h2 class="anchored" data-anchor-id="iteritive-extecution">Iteritive extecution</h2>
<ul>
<li><p>Once the <code>workflow_set</code> object is created, the <code>workflow_map</code> function can be used to map a function across the preprocessor/model combinations.</p></li>
<li><p>Here we are mapping the <code>fit_resamples</code> function across the <code>workflow_set</code> combinations using the <code>resamples</code> argument to specify the resamples we want to use (<code>forested_folds</code>).</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>wf_obj <span class="ot">&lt;-</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_set</span>(<span class="fu">list</span>(forested <span class="sc">~</span>.), <span class="fu">list</span>(log_mod, dt_model)) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_map</span>(<span class="st">"fit_resamples"</span>, <span class="at">resamples =</span> forested_folds) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="cell">
<pre><code>#&gt; # A workflow set/tibble: 2 × 4
#&gt;   wflow_id              info             option    result   
#&gt;   &lt;chr&gt;                 &lt;list&gt;           &lt;list&gt;    &lt;list&gt;   
#&gt; 1 formula_logistic_reg  &lt;tibble [1 × 4]&gt; &lt;opts[1]&gt; &lt;rsmp[+]&gt;
#&gt; 2 formula_decision_tree &lt;tibble [1 × 4]&gt; &lt;opts[1]&gt; &lt;rsmp[+]&gt;</code></pre>
</div>
</section>
<section id="rapid-comparision" class="level2">
<h2 class="anchored" data-anchor-id="rapid-comparision">Rapid comparision</h2>
<p>With that single function, all models have been fit to the resamples and we can quickly compare the results both graphically and statistically:</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick plot function</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(wf_obj) <span class="sc">+</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week-5_files/figure-revealjs/unnamed-chunk-40-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Long list of results, ranked by accuracy</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rank_results</span>(wf_obj, </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">rank_metric =</span> <span class="st">"accuracy"</span>, </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">select_best =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 9</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   wflow_id         .config .metric   mean std_err     n preprocessor model  rank</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;        &lt;chr&gt; &lt;int&gt;</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 formula_logisti… Prepro… accura… 0.906  0.00360    10 formula      logi…     1</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 formula_logisti… Prepro… brier_… 0.0714 0.00191    10 formula      logi…     1</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 formula_logisti… Prepro… roc_auc 0.961  0.00164    10 formula      logi…     1</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 formula_decisio… Prepro… accura… 0.896  0.00385    10 formula      deci…     2</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 formula_decisio… Prepro… brier_… 0.0889 0.00224    10 formula      deci…     2</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 formula_decisio… Prepro… roc_auc 0.909  0.00267    10 formula      deci…     2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>. . .</p>
<p>Overall, the logistic regression model appears to the best model for this data set!</p>
</section>
<section id="the-whole-game---status-update-1" class="level2">
<h2 class="anchored" data-anchor-id="the-whole-game---status-update-1">The whole game - status update</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/whole-game-transparent-select.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>On Wednesday, we’ll talk more about models we can chose from…</p>
<p>Next week we will cover</p>


</section>
</section>

</main> <!-- /main -->

<script>
  // htmlwidgets need to know to resize themselves when slides are shown/hidden.
  // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
  // slide changes (different for each slide format).
  (function () {
    // dispatch for htmlwidgets
    function fireSlideEnter() {
      const event = window.document.createEvent("Event");
      event.initEvent("slideenter", true, true);
      window.document.dispatchEvent(event);
    }

    function fireSlideChanged(previousSlide, currentSlide) {
      fireSlideEnter();

      // dispatch for shiny
      if (window.jQuery) {
        if (previousSlide) {
          window.jQuery(previousSlide).trigger("hidden");
        }
        if (currentSlide) {
          window.jQuery(currentSlide).trigger("shown");
        }
      }
    }

    // hookup for slidy
    if (window.w3c_slidy) {
      window.w3c_slidy.add_observer(function (slide_num) {
        // slide_num starts at position 1
        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
      });
    }

  })();
</script>

<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>