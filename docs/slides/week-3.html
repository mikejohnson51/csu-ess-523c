<!DOCTYPE html>
<html lang="en"><head>
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <title>ESS 523c – Week 3</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-be8ed9a3cdcbe7a498a633334f8d1033.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
</head>
<body class="quarto-light">
<script src="https://use.fontawesome.com/5235085b15.js"></script>
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#1E4D2B" class="quarto-title-block center">
  <h1 class="title">Week 3</h1>
  <p class="subtitle">Predicates, Simplification &amp; Tesselations</p>

<div class="quarto-title-authors">
</div>

</section>
<section id="last-week" class="title-slide slide level1 center">
<h1>Last week</h1>
<p>We learned about the SRS (Spatial Reference Systems)</p>
<ul>
<li><p>They can be <strong>geographic</strong> (3D, angular units)</p>
<ul>
<li><p>Ellipsoid (squished sphere model)</p></li>
<li><p>geoid (mathematical model of gravitational field)</p></li>
<li><p>datum marks the relationship between the ellipsoid and geoid</p>
<ul>
<li><p>can be local (NAD27)</p></li>
<li><p>can be global (WGS84, NAD83)</p></li>
</ul></li>
</ul></li>
<li><p>SRS can be projected (x-y axis, measurement units (m), false origin)</p>
<ul>
<li><p>All PCS are based on GCS</p></li>
<li><p>Projections seek to place the 3D earth on 2D</p></li>
<li><p>Does this by defining a plane that can be conic, cylindrical or planar</p></li>
<li><p>“unfolding to this plane” creates distortion of <strong>shape</strong>, <strong>area</strong>, <strong>distance</strong>, or <strong>direction</strong></p></li>
<li><p>The distortion is greater from point/lines of tangency or secanacy</p></li>
</ul></li>
</ul>
</section>

<section>
<section id="measures-geos-measures" class="title-slide slide level1 center">
<h1>Measures (GEOS Measures)</h1>
<ul>
<li><p>Measures are the questions we ask about the dimension of a geometry</p>
<ul>
<li><p>How long is a line or polygon perimeter (unit)</p></li>
<li><p>What is the area of a polygon (unit<sup>2</sup>)</p></li>
<li><p>How far are two object from one another (unit)</p></li>
</ul></li>
<li><p>Measures come from the GEOS library</p></li>
<li><p>Measures are in the <strong>units</strong> of the base projection</p></li>
<li><p>Measures can be Euclidean (PCS) or geodesic (GSC)</p>
<ul>
<li><p>geodesic (Great Circle) distances can be more accurate by eliminating distortion</p></li>
<li><p>but are much slower to calculate</p></li>
</ul></li>
</ul>
</section>
<section id="for-example" class="slide level2">
<h2>For example …</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a>usa <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(<span class="fu">st_union</span>(<span class="fu">aoi_get</span>(<span class="at">state =</span> <span class="st">"conus"</span>)), <span class="st">"MULTILINESTRING"</span>)</span>
<span id="cb1-2"><a></a></span>
<span id="cb1-3"><a></a><span class="fu">nrow</span>(cities)</span>
<span id="cb1-4"><a></a><span class="co">#&gt; [1] 31254</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a><span class="co"># Great Circle Distance in GCS</span></span>
<span id="cb2-2"><a></a><span class="fu">system.time</span>({x <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(usa, cities)})</span>
<span id="cb2-3"><a></a><span class="co"># user      system elapsed </span></span>
<span id="cb2-4"><a></a><span class="co"># 103.560   1.390  117.128 </span></span>
<span id="cb2-5"><a></a></span>
<span id="cb2-6"><a></a><span class="co"># Euclidean Distance on PCS</span></span>
<span id="cb2-7"><a></a><span class="fu">system.time</span>({x <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(usa, cities, <span class="at">which =</span> <span class="st">"Euclidean"</span>)})</span>
<span id="cb2-8"><a></a><span class="co"># user    system  elapsed </span></span>
<span id="cb2-9"><a></a><span class="co"># 2.422   0.019   2.494 </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="units" class="slide level2">
<h2>Units</h2>
<p>When possible measure operations report results with a units appropriate for the CRS:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a>co <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/co.shp"</span>)</span>
<span id="cb3-2"><a></a><span class="co">#&gt; Reading layer `co' from data source </span></span>
<span id="cb3-3"><a></a><span class="co">#&gt;   `/Users/mikejohnson/github/csu-ess-523c/slides/data/co.shp' </span></span>
<span id="cb3-4"><a></a><span class="co">#&gt;   using driver `ESRI Shapefile'</span></span>
<span id="cb3-5"><a></a><span class="co">#&gt; Simple feature collection with 64 features and 4 fields</span></span>
<span id="cb3-6"><a></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb3-7"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb3-8"><a></a><span class="co">#&gt; Bounding box:  xmin: -109.0602 ymin: 36.99246 xmax: -102.0415 ymax: 41.00342</span></span>
<span id="cb3-9"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb3-10"><a></a>a <span class="ot">&lt;-</span> <span class="fu">st_area</span>(co[<span class="dv">1</span>,])</span>
<span id="cb3-11"><a></a><span class="fu">attributes</span>(a) <span class="sc">|&gt;</span> <span class="fu">unlist</span>()</span>
<span id="cb3-12"><a></a><span class="co">#&gt; units.numerator1 units.numerator2            class </span></span>
<span id="cb3-13"><a></a><span class="co">#&gt;              "m"              "m"          "units"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <strong>units</strong> package can be used to convert between units:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>units<span class="sc">::</span><span class="fu">set_units</span>(a, km<span class="sc">^</span><span class="dv">2</span>) <span class="co"># result in square kilometers</span></span>
<span id="cb4-2"><a></a><span class="co">#&gt; 3062.85 [km^2]</span></span>
<span id="cb4-3"><a></a>units<span class="sc">::</span><span class="fu">set_units</span>(a, ha) <span class="co"># result in hectares</span></span>
<span id="cb4-4"><a></a><span class="co">#&gt; 306285 [ha]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and the results can be stripped of their attributes for cases where numeric values are needed (e.g.&nbsp;math operators and ggplot):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="fu">as.numeric</span>(a)</span>
<span id="cb5-2"><a></a><span class="co">#&gt; [1] 3062849758</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="topologic-diminsion" class="slide level2">
<h2>Topologic Diminsion</h2>
<p>A <strong>POINT</strong> is shape with a dimension of 0 that occupies a single location in coordinate space.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a><span class="co"># POINT defined as numeric vector</span></span>
<span id="cb6-2"><a></a>(<span class="fu">st_dimension</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))))</span>
<span id="cb6-3"><a></a><span class="co">#&gt; [1] 0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A <strong>LINESTRING</strong> is shape that has a dimension of 1 (length)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="co"># LINESTRING defined by matrix</span></span>
<span id="cb7-2"><a></a>(<span class="fu">st_dimension</span>(<span class="fu">st_linestring</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">nrow =</span> <span class="dv">2</span>))))</span>
<span id="cb7-3"><a></a><span class="co">#&gt; [1] 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A <strong>POLYGON</strong> is surface stored as a list of its exterior and interior rings. It has a dimension of 2. (area)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a><span class="co"># POLYGON defined by LIST (interior and exterior rings)</span></span>
<span id="cb8-2"><a></a>(<span class="fu">st_dimension</span>(<span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">1</span>,<span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)))))</span>
<span id="cb8-3"><a></a><span class="co">#&gt; [1] 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="predicates" class="title-slide slide level1 center">
<h1>Predicates</h1>

</section>
<section id="geometric-interiors-boundaries-and-exteriors" class="slide level2">
<h2>Geometric Interiors, Boundaries and Exteriors</h2>
<p>All geometries have interior, boundary and exterior regions.</p>
<p>The terms <code>interior</code> and <code>boundary</code> are used in the context of algebraic topology and manifold theory and <strong>not</strong> general topology</p>
<p>The OGC has define these states for the common geometry types in the simple features standard:</p>
<table class="caption-top">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Dimension</th>
<th style="text-align: left;">Geometry Type</th>
<th style="text-align: left;">Interior (I)</th>
<th style="text-align: left;">Boundary (B)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Point, MultiPoint</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">Point, Points</td>
<td style="text-align: left;">Empty</td>
</tr>
<tr class="even">
<td style="text-align: left;">LineString, Line</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">Points that are left when the boundary points are removed.</td>
<td style="text-align: left;">Two end points.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Polygon</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">Points within the rings.</td>
<td style="text-align: left;">Set of rings.</td>
</tr>
</tbody>
</table>
</section>
<section id="interior-boundary-and-exterior-points" class="slide level2">
<h2>Interior, Boundary and Exterior: POINTS</h2>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-10-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="interior-boundary-and-exterior-linestring" class="slide level2">
<h2>Interior, Boundary and Exterior: LINESTRING</h2>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-11-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="interior-boundary-and-exterior-polygon" class="slide level2">
<h2>Interior, Boundary and Exterior: POLYGON</h2>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-12-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="summary" class="slide level2">
<h2>Summary</h2>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-13-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="predicates-1" class="slide level2">
<h2>Predicates</h2>
<p>In the following, we are interested in the resulting geometry that occurs when 2 geometries are overlaid…</p>
</section>
<section id="overlap-is-a-point-0d" class="slide level2">
<h2>Overlap is a POINT: 0D</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week-3_files/figure-revealjs/unnamed-chunk-14-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week-3_files/figure-revealjs/unnamed-chunk-15-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week-3_files/figure-revealjs/unnamed-chunk-16-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="overlap-is-a-linestring-1d" class="slide level2">
<h2>Overlap is a LINESTRING: 1D</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week-3_files/figure-revealjs/unnamed-chunk-17-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week-3_files/figure-revealjs/unnamed-chunk-18-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week-3_files/figure-revealjs/unnamed-chunk-19-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="overlap-is-a-polygon-2d" class="slide level2">
<h2>Overlap is a POLYGON: 2D</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week-3_files/figure-revealjs/unnamed-chunk-20-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week-3_files/figure-revealjs/unnamed-chunk-21-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week-3_files/figure-revealjs/unnamed-chunk-22-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="no-overlap-false" class="slide level2">
<h2>No Overlap = FALSE</h2>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-23-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="dimensionally-extended-9-intersection-model" class="slide level2">
<h2>Dimensionally Extended 9-Intersection Model</h2>
<ul>
<li><p>The DE-9IM is a <strong>topological</strong> model and (standard) used to describe the spatial relations of two geometries</p></li>
<li><p>Used in geometry, point-set topology, geospatial topology</p></li>
<li><p>The <strong>DE-9IM</strong> <em>matrix</em> provides a way to classify geometry relations using the set <strong>{0,1,2,F}</strong> or <strong>{T,F}</strong></p></li>
<li><p>With a <strong>{T,F}</strong> matrix domain, there are 512 possible relations that can be grouped into binary classification schemes.</p></li>
<li><p>About 10 of these, have been given a common name such as <em>intersects</em>, <em>touches</em>, and <em>within</em>.</p></li>
<li><p>When testing two geometries against a scheme, the result is a spatial <em>predicate</em> named by the scheme.</p></li>
<li><p>Provides the primary basis for queries and assertions in GIS and spatial databases (PostGIS).</p></li>
</ul>
</section>
<section id="the-matrix-model" class="slide level2">
<h2>The Matrix Model</h2>
<p>The <strong>DE-9IM</strong> matrix is based on a 3x3 intersection matrix:</p>

<img data-src="images/12-de-9Im-matrix.png" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"><p>Where:</p>
<ul>
<li><strong>dim</strong> is the dimension of the intersection and</li>
<li>I is the interior</li>
<li>B is the boundary</li>
<li>E is the exterior</li>
</ul>
<div class="fragment">
<p>Empty sets are denoted as <strong>F</strong></p>
<p>non-empty sets are denoted with the maximum dimension of the intersection <em>{0,1,2}</em></p>
</div>
</section>
<section id="section" class="slide level2">
<h2></h2>
<p>A simpler (binary) version of this matrix can be created by mapping all non-empty intersections {0,1,2} to TRUE.</p>

<img data-src="images/12-de-9Im-matrix-simple.svg" class="r-stretch"><p>Where <code>II</code> would state: “Does the Interior of”a” overlaps with the Interior of “b” in a way that produces a point (0), line (1), or polygon (2)”</p>
<p>Where <code>IB</code> would state: “Does the Interior of”a” overlap with the Boundary of “b” in a way that produces a point (0), line (1), or polygon (2)”</p>
<p>Both matrix forms: - dimensional {0,1,2,F} - Boolean {T,F}</p>
<div class="fragment">
<p>Can be serialize as a “DE-9IM string code” representing the matrix in a single string element (standardized format for data interchange)</p>
<p>The OGC has standardized the typical spatial predicates (Contains, Crosses, Intersects, Touches, etc.) as <em>Boolean</em> functions, and the DE-9IM model as a function that returns the DE-9IM code, with domain of {0,1,2,F}</p>
</div>
</section>
<section id="illustration" class="slide level2">
<h2>Illustration</h2>

<img data-src="images/12-de-91m-figure.png" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"><p>Reading from left-to-right and top-to-bottom, the DE-9IM(a,b) string code is ‘212101212’</p>
</section>
<section id="spatial-relations-in-r" class="slide level2">
<h2>Spatial Relations in R</h2>
<ul>
<li>Geometry X is a 3 feature polygon colored in red</li>
<li>Geometry Y is a 4 feature polygon colored in blue</li>
</ul>
<div class="columns">
<div class="{.column-width=&quot;50%&quot;}">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-3_files/figure-revealjs/unnamed-chunk-26-1.png" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<div class="{.column-width=&quot;50%&quot;}">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a><span class="fu">st_relate</span>(x,y)</span>
<span id="cb9-2"><a></a><span class="co">#&gt;      [,1]        [,2]        [,3]        [,4]       </span></span>
<span id="cb9-3"><a></a><span class="co">#&gt; [1,] "212FF1FF2" "FF2FF1212" "212101212" "FF2FF1212"</span></span>
<span id="cb9-4"><a></a><span class="co">#&gt; [2,] "FF2FF1212" "212101212" "212101212" "FF2FF1212"</span></span>
<span id="cb9-5"><a></a><span class="co">#&gt; [3,] "FF2FF1212" "FF2FF1212" "212101212" "FF2FF1212"</span></span>
<span id="cb9-6"><a></a><span class="fu">st_relate</span>(x,x)</span>
<span id="cb9-7"><a></a><span class="co">#&gt;      [,1]        [,2]        [,3]       </span></span>
<span id="cb9-8"><a></a><span class="co">#&gt; [1,] "2FFF1FFF2" "FF2F01212" "FF2F11212"</span></span>
<span id="cb9-9"><a></a><span class="co">#&gt; [2,] "FF2F01212" "2FFF1FFF2" "FF2FF1212"</span></span>
<span id="cb9-10"><a></a><span class="co">#&gt; [3,] "FF2F11212" "FF2FF1212" "2FFF1FFF2"</span></span>
<span id="cb9-11"><a></a><span class="fu">st_relate</span>(y,y)</span>
<span id="cb9-12"><a></a><span class="co">#&gt;      [,1]        [,2]        [,3]        [,4]       </span></span>
<span id="cb9-13"><a></a><span class="co">#&gt; [1,] "2FFF1FFF2" "FF2FF1212" "212101212" "FF2FF1212"</span></span>
<span id="cb9-14"><a></a><span class="co">#&gt; [2,] "FF2FF1212" "2FFF1FFF2" "212101212" "FF2FF1212"</span></span>
<span id="cb9-15"><a></a><span class="co">#&gt; [3,] "212101212" "212101212" "2FFF1FFF2" "FF2FF1212"</span></span>
<span id="cb9-16"><a></a><span class="co">#&gt; [4,] "FF2FF1212" "FF2FF1212" "FF2FF1212" "2FFF1FFF2"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="named-predicates" class="slide level2 smaller">
<h2>Named Predicates</h2>
<ul>
<li><p>“named spatial predicates” have been defined for some common relations.</p></li>
<li><p>A few functions can be derived (expressed by masks) from DE-9IM include (* = wildcard):</p></li>
</ul>
<table class="caption-top">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Predicate</th>
<th style="text-align: left;">DE-9IM String Code</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Intersects</strong></td>
<td style="text-align: left;"><code>T*F**FFF*</code></td>
<td style="text-align: left;">“Two geometries intersect if they share any portion of space”</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Overlaps</strong></td>
<td style="text-align: left;"><code>T*F**FFF*</code></td>
<td style="text-align: left;">“Two geometries overlap if they share some but not all of the same space”</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Equals</strong></td>
<td style="text-align: left;"><code>T*F**FFF*</code></td>
<td style="text-align: left;">“Two geometries are topologically equal if their interiors intersect and no part of the interior or boundary of one geometry intersects the exterior of the other”</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Disjoint</strong></td>
<td style="text-align: left;"><code>FF*FF*****</code></td>
<td style="text-align: left;">“Two geometries are disjoint: they have no point in common. They form a set of disconnected geometries.”</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Touches</strong></td>
<td style="text-align: left;"><code>FT*******</code></td>
<td style="text-align: left;"><code>F**T*****</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Contains</strong></td>
<td style="text-align: left;"><code>T*****FF**</code></td>
<td style="text-align: left;">“A contains B: geometry B lies in A, and the interiors intersect”</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Covers</strong></td>
<td style="text-align: left;"><code>T*****FF*</code></td>
<td style="text-align: left;"><code>*T****FF*</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Within</strong></td>
<td style="text-align: left;"><code>*T*****FF*</code></td>
<td style="text-align: left;"><code>**T****FF*</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Covered by</strong></td>
<td style="text-align: left;"><code>*T*****FF*</code></td>
<td style="text-align: left;"><code>**T****FF*</code></td>
</tr>
</tbody>
</table>
</section>
<section id="binary-predicates" class="slide level2">
<h2>Binary Predicates</h2>
<ul>
<li><p>Collectively, predicates define the type of relationship each 2D object has with another.</p></li>
<li><p>Of the ~ 512 unique relationships offered by the DE-9IM models a selection of ~ 10 have been named.</p></li>
<li><p>These are include in PostGIS/GEOS and are made accessible via R sf</p></li>
</ul>

<img data-src="images/13-sf-binary.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="named-predicates-in-r" class="slide level2">
<h2>Named predicates in R</h2>
<ul>
<li><code>sf</code> provides a set of functions that implement the DE-9IM model and named predicates. Each of these can return either a <em>sparse</em> or <em>dense</em> matrix.</li>
</ul>
<h4 id="sparse-matrix"><em>sparse</em> matrix</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a><span class="fu">st_intersects</span>(x,y)</span>
<span id="cb10-2"><a></a><span class="co">#&gt; Sparse geometry binary predicate list of length 3, where the predicate</span></span>
<span id="cb10-3"><a></a><span class="co">#&gt; was `intersects'</span></span>
<span id="cb10-4"><a></a><span class="co">#&gt;  1: 1, 3</span></span>
<span id="cb10-5"><a></a><span class="co">#&gt;  2: 2, 3</span></span>
<span id="cb10-6"><a></a><span class="co">#&gt;  3: 3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<h4 id="dense-matrix"><em>dense</em> matrix</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a><span class="fu">st_intersects</span>(x, y, <span class="at">sparse =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-2"><a></a><span class="co">#&gt;       [,1]  [,2] [,3]  [,4]</span></span>
<span id="cb11-3"><a></a><span class="co">#&gt; [1,]  TRUE FALSE TRUE FALSE</span></span>
<span id="cb11-4"><a></a><span class="co">#&gt; [2,] FALSE  TRUE TRUE FALSE</span></span>
<span id="cb11-5"><a></a><span class="co">#&gt; [3,] FALSE FALSE TRUE FALSE</span></span>
<span id="cb11-6"><a></a></span>
<span id="cb11-7"><a></a><span class="fu">st_disjoint</span>(x, y, <span class="at">sparse =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-8"><a></a><span class="co">#&gt;       [,1]  [,2]  [,3] [,4]</span></span>
<span id="cb11-9"><a></a><span class="co">#&gt; [1,] FALSE  TRUE FALSE TRUE</span></span>
<span id="cb11-10"><a></a><span class="co">#&gt; [2,]  TRUE FALSE FALSE TRUE</span></span>
<span id="cb11-11"><a></a><span class="co">#&gt; [3,]  TRUE  TRUE FALSE TRUE</span></span>
<span id="cb11-12"><a></a></span>
<span id="cb11-13"><a></a><span class="fu">st_touches</span>(x, y, <span class="at">sparse =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-14"><a></a><span class="co">#&gt;       [,1]  [,2]  [,3]  [,4]</span></span>
<span id="cb11-15"><a></a><span class="co">#&gt; [1,] FALSE FALSE FALSE FALSE</span></span>
<span id="cb11-16"><a></a><span class="co">#&gt; [2,] FALSE FALSE FALSE FALSE</span></span>
<span id="cb11-17"><a></a><span class="co">#&gt; [3,] FALSE FALSE FALSE FALSE</span></span>
<span id="cb11-18"><a></a></span>
<span id="cb11-19"><a></a><span class="fu">st_within</span>(x, y, <span class="at">sparse =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-20"><a></a><span class="co">#&gt;       [,1]  [,2]  [,3]  [,4]</span></span>
<span id="cb11-21"><a></a><span class="co">#&gt; [1,] FALSE FALSE FALSE FALSE</span></span>
<span id="cb11-22"><a></a><span class="co">#&gt; [2,] FALSE FALSE FALSE FALSE</span></span>
<span id="cb11-23"><a></a><span class="co">#&gt; [3,] FALSE FALSE FALSE FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="st_relates-vs.-predicate-calls" class="slide level2">
<h2>st_relates vs.&nbsp;predicate calls…</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a>states <span class="ot">=</span> <span class="fu">filter</span>(<span class="fu">aoi_get</span>(<span class="at">state =</span> <span class="st">"all"</span>), state_abbr <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"WA"</span>, <span class="st">"OR"</span>, <span class="st">"MT"</span>, <span class="st">"ID"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a></a>  <span class="fu">select</span>(name)</span>
<span id="cb12-3"><a></a></span>
<span id="cb12-4"><a></a>wa <span class="ot">=</span> <span class="fu">filter</span>(states, name <span class="sc">==</span> <span class="st">"Washington"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div data-column.wdith="50%">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a><span class="fu">plot</span>(states<span class="sc">$</span>geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week-3_files/figure-revealjs/unnamed-chunk-32-1.png" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
</div><div data-column.wdith="50%">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a>(<span class="fu">mutate</span>(states, </span>
<span id="cb14-2"><a></a>        <span class="at">deim9 =</span> <span class="fu">st_relate</span>(states, wa),</span>
<span id="cb14-3"><a></a>        <span class="at">touch =</span> <span class="fu">st_touches</span>(states, wa, <span class="at">sparse =</span> F)))</span>
<span id="cb14-4"><a></a><span class="co">#&gt; Simple feature collection with 4 features and 3 fields</span></span>
<span id="cb14-5"><a></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb14-6"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb14-7"><a></a><span class="co">#&gt; Bounding box:  xmin: -124.8485 ymin: 41.98818 xmax: -104.0397 ymax: 49.00244</span></span>
<span id="cb14-8"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb14-9"><a></a><span class="co">#&gt;         name                       geometry     deim9 touch</span></span>
<span id="cb14-10"><a></a><span class="co">#&gt; 1      Idaho MULTIPOLYGON (((-111.0455 4... FF2F11212  TRUE</span></span>
<span id="cb14-11"><a></a><span class="co">#&gt; 2    Montana MULTIPOLYGON (((-109.7985 4... FF2FF1212 FALSE</span></span>
<span id="cb14-12"><a></a><span class="co">#&gt; 3     Oregon MULTIPOLYGON (((-117.22 44.... FF2F11212  TRUE</span></span>
<span id="cb14-13"><a></a><span class="co">#&gt; 4 Washington MULTIPOLYGON (((-121.5237 4... 2FFF1FFF2 FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section></section>
<section>
<section id="so" class="title-slide slide level1 center">
<h1>So…</h1>
<ul>
<li><p>binary predicates return conditional <em>{T,F}</em> relations based on predefined masks of the DE-9IM strings</p></li>
<li><p>Up to this point in class we have been using Boolean <em>{T,F}</em> masks to filter data.frames by columns:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a>fruits <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"apple"</span>, <span class="st">"orange"</span>, <span class="st">"lemon"</span>, <span class="st">"watermelon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a>fruits <span class="sc">==</span> <span class="st">"apple"</span></span>
<span id="cb16-2"><a></a><span class="co">#&gt; [1]  TRUE FALSE FALSE FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a>fruits <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"apple"</span>, <span class="st">"lemon"</span>)</span>
<span id="cb17-2"><a></a><span class="co">#&gt; [1]  TRUE FALSE  TRUE FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filtering-on-data.frames" class="slide level2">
<h2>Filtering on data.frames</h2>
<ul>
<li>We have used <code>dplyr::filter</code> to subset a data frame, retaining all rows that satisfy a <code>boolean</code> condition.</li>
</ul>
<div class="columns">
<div data-column.wdith="50%">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a><span class="fu">mutate</span>(states, <span class="at">equalsWA =</span> (name <span class="sc">==</span> <span class="st">"Washington"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb18-3"><a></a><span class="co">#&gt;         name equalsWA</span></span>
<span id="cb18-4"><a></a><span class="co">#&gt; 1      Idaho    FALSE</span></span>
<span id="cb18-5"><a></a><span class="co">#&gt; 2    Montana    FALSE</span></span>
<span id="cb18-6"><a></a><span class="co">#&gt; 3     Oregon    FALSE</span></span>
<span id="cb18-7"><a></a><span class="co">#&gt; 4 Washington     TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div data-column.wdith="50%">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a><span class="fu">filter</span>(states, name <span class="sc">==</span> <span class="st">"Washington"</span>)</span>
<span id="cb19-2"><a></a><span class="co">#&gt; Simple feature collection with 1 feature and 1 field</span></span>
<span id="cb19-3"><a></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb19-4"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb19-5"><a></a><span class="co">#&gt; Bounding box:  xmin: -124.8485 ymin: 45.54364 xmax: -116.9161 ymax: 49.00244</span></span>
<span id="cb19-6"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb19-7"><a></a><span class="co">#&gt;         name                       geometry</span></span>
<span id="cb19-8"><a></a><span class="co">#&gt; 1 Washington MULTIPOLYGON (((-121.5237 4...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="spatial-filtering" class="slide level2">
<h2>Spatial Filtering</h2>
<ul>
<li><p>We can filter spatially, use <code>st_filter</code> as the function call</p></li>
<li><p>Here the <code>boolean</code> condition is not passed (e.g.&nbsp;name == WA)</p></li>
<li><p>But instead, is defined by a spatial predicate</p></li>
<li><p>The default is <code>st_intersects</code> but can be changed with the <code>.predicate</code> argument:</p></li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a><span class="fu">mutate</span>(states, </span>
<span id="cb20-2"><a></a>       <span class="at">touch =</span> <span class="fu">st_touches</span>(states, wa, <span class="at">sparse =</span> <span class="cn">FALSE</span>)) </span>
<span id="cb20-3"><a></a><span class="co">#&gt; Simple feature collection with 4 features and 2 fields</span></span>
<span id="cb20-4"><a></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb20-5"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb20-6"><a></a><span class="co">#&gt; Bounding box:  xmin: -124.8485 ymin: 41.98818 xmax: -104.0397 ymax: 49.00244</span></span>
<span id="cb20-7"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb20-8"><a></a><span class="co">#&gt;         name                       geometry touch</span></span>
<span id="cb20-9"><a></a><span class="co">#&gt; 1      Idaho MULTIPOLYGON (((-111.0455 4...  TRUE</span></span>
<span id="cb20-10"><a></a><span class="co">#&gt; 2    Montana MULTIPOLYGON (((-109.7985 4... FALSE</span></span>
<span id="cb20-11"><a></a><span class="co">#&gt; 3     Oregon MULTIPOLYGON (((-117.22 44....  TRUE</span></span>
<span id="cb20-12"><a></a><span class="co">#&gt; 4 Washington MULTIPOLYGON (((-121.5237 4... FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a><span class="fu">st_filter</span>(states, wa, <span class="at">.predicate =</span> st_touches) </span>
<span id="cb21-2"><a></a><span class="co">#&gt; Simple feature collection with 2 features and 1 field</span></span>
<span id="cb21-3"><a></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb21-4"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb21-5"><a></a><span class="co">#&gt; Bounding box:  xmin: -124.7035 ymin: 41.98818 xmax: -111.0435 ymax: 49.00085</span></span>
<span id="cb21-6"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb21-7"><a></a><span class="co">#&gt;     name                       geometry</span></span>
<span id="cb21-8"><a></a><span class="co">#&gt; 1  Idaho MULTIPOLYGON (((-111.0455 4...</span></span>
<span id="cb21-9"><a></a><span class="co">#&gt; 2 Oregon MULTIPOLYGON (((-117.22 44....</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section id="result" class="slide level2">
<h2>Result</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a><span class="fu">ggplot</span>(states) <span class="sc">+</span> </span>
<span id="cb22-2"><a></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span> </span>
<span id="cb22-3"><a></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> wa, <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb22-4"><a></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_filter</span>(states, wa, <span class="at">.predicate =</span> st_touches), <span class="at">fill =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb22-5"><a></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="week-3_files/figure-revealjs/unnamed-chunk-41-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="distance-example-additional-parameter" class="slide level2">
<h2>Distance Example (additional parameter)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a>cities <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"../labs/data/uscities.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lng"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a></a>  <span class="fu">select</span>(city, population, state_name) <span class="sc">|&gt;</span> </span>
<span id="cb23-4"><a></a>  <span class="fu">st_transform</span>(<span class="dv">5070</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a><span class="fu">st_filter</span>(cities, </span>
<span id="cb24-2"><a></a>          <span class="fu">filter</span>(cities, city <span class="sc">==</span> <span class="st">"Fort Collins"</span>), </span>
<span id="cb24-3"><a></a>          <span class="at">.predicate =</span> st_is_within_distance, <span class="dv">10000</span>) </span>
<span id="cb24-4"><a></a><span class="co">#&gt; Simple feature collection with 2 features and 3 fields</span></span>
<span id="cb24-5"><a></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb24-6"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb24-7"><a></a><span class="co">#&gt; Bounding box:  xmin: -760147.5 ymin: 1982249 xmax: -751658.3 ymax: 1984621</span></span>
<span id="cb24-8"><a></a><span class="co">#&gt; Projected CRS: NAD83 / Conus Albers</span></span>
<span id="cb24-9"><a></a><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span id="cb24-10"><a></a><span class="co">#&gt;   city         population state_name            geometry</span></span>
<span id="cb24-11"><a></a><span class="co">#&gt; * &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;              &lt;POINT [m]&gt;</span></span>
<span id="cb24-12"><a></a><span class="co">#&gt; 1 Fort Collins     339256 Colorado   (-760147.5 1984621)</span></span>
<span id="cb24-13"><a></a><span class="co">#&gt; 2 Timnath            8007 Colorado   (-751658.3 1982249)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section id="spatial-data-science" class="title-slide slide level1 center">
<h1>Spatial Data Science</h1>
<ul>
<li><p>Filtering is a nice way to reduce the dimensions of a <strong>single</strong> dataset</p></li>
<li><p>Often “<em>… one table is not enough… </em>”</p></li>
<li><p>In these cases we want to combine - or <strong>join</strong> - data</p></li>
</ul>
</section>

<section>
<section id="spatial-joining" class="title-slide slide level1 center">
<h1>Spatial Joining</h1>
<ul>
<li>Joining two non-spatial datasets relies on a shared <em>key</em> that uniquely identifies each record in a table</li>
</ul>

<img data-src="images/07-joins.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"><ul>
<li><p>Spatially joining data relies on shared <em>geographic relations</em> rather then a shared <em>key</em></p></li>
<li><p>Like filter, these relations can be defined by a <strong>predicate</strong></p></li>
<li><p>As with tabular data, mutating joins <em>add</em> data to the target object (x) from a source object (y).</p></li>
</ul>
</section>
<section id="st_join" class="slide level2">
<h2>st_join</h2>
<ul>
<li><p>In <code>sf</code> <code>st_join</code> provides this joining capacity</p></li>
<li><p>By default, <code>st_join</code> performs a <em>left</em> join (Returns all records from x, and the matched records from y)</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/13-left-join.png" class="quarto-figure quarto-figure-center" style="width:25.0%"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>It can also do inner joins by setting <code>left = FALSE</code>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/13-inner-join.png" class="quarto-figure quarto-figure-center" style="width:25.0%"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>The default predicate for <code>st_join</code> (and <code>st_filter</code>) is <code>st_intersects</code></p></li>
<li><p>This can be changed with the join argument (see <code>?st_join</code> for details).</p></li>
</ul>
</section></section>
<section>
<section id="every-starbucks-in-the-world" class="title-slide slide level1 center">
<h1>Every Starbucks in the World</h1>
<p>What county has the most Starbucks in each state?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a>(<span class="at">starbucks =</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">'../labs/data/directory.csv'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Latitude), Country <span class="sc">==</span> <span class="st">"US"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">|&gt;</span> </span>
<span id="cb25-4"><a></a>  <span class="fu">st_transform</span>(<span class="dv">5070</span>))</span>
<span id="cb25-5"><a></a><span class="co">#&gt; Simple feature collection with 13608 features and 11 fields</span></span>
<span id="cb25-6"><a></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb25-7"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb25-8"><a></a><span class="co">#&gt; Bounding box:  xmin: -6223543 ymin: 278590.9 xmax: 2122577 ymax: 5307178</span></span>
<span id="cb25-9"><a></a><span class="co">#&gt; Projected CRS: NAD83 / Conus Albers</span></span>
<span id="cb25-10"><a></a><span class="co">#&gt; # A tibble: 13,608 × 12</span></span>
<span id="cb25-11"><a></a><span class="co">#&gt;    Brand     `Store Number` `Store Name` `Ownership Type` `Street Address` City </span></span>
<span id="cb25-12"><a></a><span class="co">#&gt;  * &lt;chr&gt;     &lt;chr&gt;          &lt;chr&gt;        &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;</span></span>
<span id="cb25-13"><a></a><span class="co">#&gt;  1 Starbucks 3513-125945    Safeway-Anc… Licensed         5600 Debarr Rd … Anch…</span></span>
<span id="cb25-14"><a></a><span class="co">#&gt;  2 Starbucks 74352-84449    Safeway-Anc… Licensed         1725 Abbott Rd   Anch…</span></span>
<span id="cb25-15"><a></a><span class="co">#&gt;  3 Starbucks 12449-152385   Safeway - A… Licensed         1501 Huffman Rd  Anch…</span></span>
<span id="cb25-16"><a></a><span class="co">#&gt;  4 Starbucks 24936-233524   100th &amp; C S… Company Owned    320 W. 100th Av… Anch…</span></span>
<span id="cb25-17"><a></a><span class="co">#&gt;  5 Starbucks 8973-85630     Old Seward … Company Owned    1005 E Dimond B… Anch…</span></span>
<span id="cb25-18"><a></a><span class="co">#&gt;  6 Starbucks 72788-84447    Fred Meyer … Licensed         1000 E Northern… Anch…</span></span>
<span id="cb25-19"><a></a><span class="co">#&gt;  7 Starbucks 79549-106150   Safeway - A… Licensed         3101 PENLAND PK… Anch…</span></span>
<span id="cb25-20"><a></a><span class="co">#&gt;  8 Starbucks 75988-107245   ANC Main Te… Licensed         HMSHost, 500 We… Anch…</span></span>
<span id="cb25-21"><a></a><span class="co">#&gt;  9 Starbucks 11426-99254    Tudor Rd an… Company Owned    110 W. Tudor Rd… Anch…</span></span>
<span id="cb25-22"><a></a><span class="co">#&gt; 10 Starbucks 20349-108249   Fred Meyer-… Licensed         7701 Debarr Road Anch…</span></span>
<span id="cb25-23"><a></a><span class="co">#&gt; # ℹ 13,598 more rows</span></span>
<span id="cb25-24"><a></a><span class="co">#&gt; # ℹ 6 more variables: `State/Province` &lt;chr&gt;, Country &lt;chr&gt;, Postcode &lt;chr&gt;,</span></span>
<span id="cb25-25"><a></a><span class="co">#&gt; #   `Phone Number` &lt;chr&gt;, Timezone &lt;chr&gt;, geometry &lt;POINT [m]&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a>counties <span class="ot">=</span> <span class="fu">aoi_get</span>(<span class="at">state =</span> <span class="st">"conus"</span>, <span class="at">county =</span> <span class="st">"all"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a></a>  <span class="fu">st_transform</span>(<span class="dv">5070</span>) <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a></a>  <span class="fu">select</span>(name, state_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-1" class="slide level2">
<h2></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a>topSB <span class="ot">&lt;-</span> <span class="fu">st_join</span>(counties, starbucks) <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a></a>  <span class="fu">group_by</span>(name, state_name) <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb27-4"><a></a>  <span class="fu">group_by</span>(state_name) <span class="sc">|&gt;</span> </span>
<span id="cb27-5"><a></a>  <span class="fu">slice_max</span>(n, <span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb27-6"><a></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-50-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="section-2" class="slide level2">
<h2></h2>
<ul>
<li>Neither <em>joining</em> nor <em>filtering</em> spatially alter the underlying geometry of the features</li>
<li>In cases where we seek to alter a geometry based on another, we need clipping methods</li>
</ul>
</section>
<section id="clipping" class="slide level2">
<h2>Clipping</h2>
<ul>
<li><p>Clipping is a form of subsetting that involves changing the geometry of at least some features.</p></li>
<li><p>Clipping can only apply to features more complex than points: (lines, polygons and their ‘multi’ equivalents).</p></li>
</ul>

<img data-src="images/13-clipping.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="spatial-subsetting" class="slide level2">
<h2>Spatial Subsetting</h2>
<ul>
<li>By default the data.frame subsetting methods we’ve seen (e.g <code>[,]</code>) implements <code>st_intersection</code></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a>wa <span class="ot">=</span> <span class="fu">st_transform</span>(wa, <span class="dv">5070</span>)</span>
<span id="cb28-2"><a></a>wa_starbucks <span class="ot">=</span> starbucks[wa,] <span class="co">#&lt;&lt;</span></span>
<span id="cb28-3"><a></a></span>
<span id="cb28-4"><a></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">data =</span> wa) <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">data =</span> wa_starbucks) <span class="sc">+</span> <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="week-3_files/figure-revealjs/unnamed-chunk-52-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section></section>
<section id="simplification" class="title-slide slide level1 center">
<h1>Simplification</h1>

</section>

<section>
<section id="computational-complexity" class="title-slide slide level1 center">
<h1>Computational Complexity</h1>
<ul>
<li><p>In all the cases we have looked at, the number of <code>POINT</code> (e.g geometries, nodes, or vertices) define the complexity of the predicate or the clip</p></li>
<li><p>Computational needs increase with the number of POINTS / NODES / VERTICES</p></li>
<li><p><strong>Simplification</strong> is a process for generalization vector objects (lines and polygons)</p></li>
<li><p>Another reason for simplifying objects is to reduce the amount of memory, disk space and network bandwidth they consume</p></li>
<li><p>Other times the level of detail captured in a geometry is either not needed, or, even counter productive the the scale/purpose of an analysis</p></li>
<li><p>If you are cropping features to a national border, how much detail do you need? The more points in your border, the long the clip operation will take….</p></li>
</ul>
</section>
<section id="section-3" class="slide level2">
<h2></h2>
<p>In cases where we want to reduce the complexity in a geometry we can use simplification algorithms</p>
<p>The most common algorithms are Ramer–Douglas–Peucker and Visvalingam-Whyatt.</p>
</section>
<section id="ramerdouglaspeucker" class="slide level2">
<h2>Ramer–Douglas–Peucker</h2>
<ul>
<li><p>Mark the <code>first</code> and <code>last</code> points as kept</p></li>
<li><p>Find the point, <code>p</code> that is the farthest from the first-last line segment. If there are no points between first and last we are done (the base case)</p></li>
<li><p>If <code>p</code> is closer than <code>tolerance</code> units to the line segment then everything between first and last can be discarded</p></li>
<li><p>Otherwise, mark p as kept and repeat steps 1-4 using the points between first and p and between p and last (the call to recursion)</p></li>
</ul>

<img data-src="images/13-douglas-peucker-animated.gif" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="st_simplify" class="slide level2">
<h2>st_simplify</h2>

<img data-src="images/13-postgis-st-simplify.png" class="quarto-figure quarto-figure-center r-stretch" style="width:90.0%"></section>
<section id="st_simplify-1" class="slide level2">
<h2>st_simplify</h2>
<ul>
<li><p><code>sf</code> provides <code>st_simplify</code>, which uses the GEOS implementation of the Douglas-Peucker algorithm to reduce the vertex count.</p></li>
<li><p><code>st_simplify</code> uses the <code>dTolerance</code> to control the level of generalization in map units (see Douglas and Peucker 1973 for details).</p></li>
</ul>

<img data-src="images/13-r-st-simplify.png" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"></section>
<section id="section-4" class="slide level2">
<h2></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a>usa <span class="ot">=</span> <span class="fu">aoi_get</span>(<span class="at">state =</span> <span class="st">"conus"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a></a>  <span class="fu">st_union</span>() <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a></a>  <span class="fu">st_transform</span>(<span class="dv">5070</span>)</span>
<span id="cb29-4"><a></a></span>
<span id="cb29-5"><a></a>usa1000   <span class="ot">=</span> <span class="fu">st_simplify</span>(usa, <span class="at">dTolerance =</span> <span class="dv">10000</span>)</span>
<span id="cb29-6"><a></a>usa10000  <span class="ot">=</span> <span class="fu">st_simplify</span>(usa, <span class="at">dTolerance =</span> <span class="dv">100000</span>)</span>
<span id="cb29-7"><a></a>usa100000 <span class="ot">=</span> <span class="fu">st_simplify</span>(usa, <span class="at">dTolerance =</span> <span class="dv">1000000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-57-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="section-5" class="slide level2">
<h2></h2>
<ul>
<li><p>A limitation with Douglas-Peucker (therefore st_simplify) is that it simplifies objects on a per-geometry basis.</p></li>
<li><p>This means the ‘topology’ is lost, resulting in overlapping and disconnected geometries.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a>states <span class="ot">=</span> <span class="fu">st_transform</span>(states, <span class="dv">5070</span>)</span>
<span id="cb30-2"><a></a>simp_states   <span class="ot">=</span> <span class="fu">st_simplify</span>(states, <span class="at">dTolerance =</span> <span class="dv">20000</span>)</span>
<span id="cb30-3"><a></a><span class="fu">plot</span>(simp_states<span class="sc">$</span>geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="week-3_files/figure-revealjs/unnamed-chunk-58-1.png" style="width:100.0%" class="r-stretch"></section>
<section id="visvalingam" class="slide level2">
<h2>Visvalingam</h2>
<ul>
<li>The Visvalingam algorithm overcomes some limitations of the Douglas-Peucker algorithm (Visvalingam and Whyatt 1993).</li>
<li>it progressively removes points with the least-perceptible change.</li>
<li>Simplification often allows the elimination of 95% or more points while retaining sufficient detail for visualization and often analysis</li>
</ul>

<img data-src="images/13-ms-simplify.png" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"></section>
<section id="rmapshaper" class="slide level2">
<h2>rmapshaper</h2>
<p>In R, the <code>rmapshaper</code> package implements the Visvalingam algorithm in the <code>ms_simplify</code> function.</p>
<ul>
<li>The <code>ms_simplify</code> function is a wrapper around the <code>mapshaper</code> JavaScript library (created by lead viz experts at the NYT)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a><span class="fu">library</span>(rmapshaper)</span>
<span id="cb31-2"><a></a></span>
<span id="cb31-3"><a></a>usa10 <span class="ot">=</span> <span class="fu">ms_simplify</span>(usa, <span class="at">keep =</span> .<span class="dv">1</span>)</span>
<span id="cb31-4"><a></a>usa5  <span class="ot">=</span> <span class="fu">ms_simplify</span>(usa, <span class="at">keep =</span> .<span class="dv">05</span>)</span>
<span id="cb31-5"><a></a>usa1  <span class="ot">=</span> <span class="fu">ms_simplify</span>(usa, <span class="at">keep =</span> .<span class="dv">01</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-61-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="section-6" class="slide level2">
<h2></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a>states <span class="ot">=</span> <span class="fu">st_transform</span>(states, <span class="dv">5070</span>)</span>
<span id="cb32-2"><a></a>simp_states   <span class="ot">=</span> <span class="fu">ms_simplify</span>(states, <span class="at">keep =</span> .<span class="dv">05</span>)</span>
<span id="cb32-3"><a></a><span class="fu">plot</span>(simp_states<span class="sc">$</span>geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="week-3_files/figure-revealjs/unnamed-chunk-62-1.png" style="width:100.0%" class="r-stretch"></section>
<section id="section-7" class="slide level2">
<h2></h2>
<p>In all cases, the number of points in a geometry can be calculated with <code>mapview::npts()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a>states <span class="ot">=</span> <span class="fu">st_transform</span>(states, <span class="dv">5070</span>)</span>
<span id="cb33-2"><a></a>simp_states_st   <span class="ot">=</span> <span class="fu">st_simplify</span>(states, <span class="at">dTolerance =</span> <span class="dv">20000</span>)</span>
<span id="cb33-3"><a></a>simp_states_ms   <span class="ot">=</span> <span class="fu">ms_simplify</span>(states, <span class="at">keep =</span> .<span class="dv">05</span>)</span>
<span id="cb33-4"><a></a></span>
<span id="cb33-5"><a></a>mapview<span class="sc">::</span><span class="fu">npts</span>(states)</span>
<span id="cb33-6"><a></a><span class="co">#&gt; [1] 5930</span></span>
<span id="cb33-7"><a></a>mapview<span class="sc">::</span><span class="fu">npts</span>(simp_states_st)</span>
<span id="cb33-8"><a></a><span class="co">#&gt; [1] 53</span></span>
<span id="cb33-9"><a></a>mapview<span class="sc">::</span><span class="fu">npts</span>(simp_states_ms)</span>
<span id="cb33-10"><a></a><span class="co">#&gt; [1] 292</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="tesselation" class="title-slide slide level1 center">
<h1>Tesselation</h1>
<ul>
<li><p>So far we have spent the last few days looking at simple feature objects</p></li>
<li><p>Where a feature as a geometry define by a set of structured POINT(s)</p></li>
<li><p>These points have precision and define location ({X Y CRS})</p></li>
<li><p>The geometry defines a bounds: either 0D, 1D or 2D</p></li>
<li><p>Each object is therefore bounded to those geometries implying a level of exactness.</p></li>
</ul>
</section>
<section id="core-concepts-of-spatial-data-kuhn-2012" class="slide level2">
<h2>Core Concepts of Spatial Data: (<a href="https://www.tandfonline.com/doi/full/10.1080/13658816.2012.722637">Kuhn 2012</a>)</h2>

<img data-src="images/15-cc.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="core-concepts-of-spatial-data-kuhn-2012-1" class="slide level2">
<h2>Core Concepts of Spatial Data: (<a href="https://www.tandfonline.com/doi/full/10.1080/13658816.2012.722637">Kuhn 2012</a>)</h2>
<ul>
<li><p><strong>One Base Concept</strong>: Location</p></li>
<li><p><strong>Four Content Concepts</strong>: Field, Object, Network, Event</p></li>
<li><p><strong>Two Quality Concepts</strong>: Granularity, Accuracy</p></li>
</ul>
</section>
<section id="core-concepts-of-spatial-data-kuhn-2012-2" class="slide level2">
<h2>Core Concepts of Spatial Data: (<a href="https://www.tandfonline.com/doi/full/10.1080/13658816.2012.722637">Kuhn 2012</a>)</h2>
<ul>
<li><p><strong>One Base Concept</strong>: Location (<em>coordinates</em>)</p></li>
<li><p><strong>Four Content Concepts</strong>: Field (<em>raster</em>), Object (<em>simple feature</em>), <del>Network</del>, <del>Event</del></p></li>
<li><p><strong>Two Quality Concepts</strong>: Granularity (<em>simplification</em>), Accuracy (<em>taken for granted</em>)</p></li>
</ul>
</section>
<section id="object-view" class="slide level2">
<h2>Object View</h2>
<ul>
<li><p>Objects describe <em>individuals</em> that have an identity (id) as well as spatial, temporal, and thematic properties.</p></li>
<li><p>Answers questions about <em>properties</em> and <em>relations</em> of objects.</p></li>
<li><p>Results from fixing theme, controlling time, and measuring space.</p></li>
<li><p>Features, such as surfaces, depend on objects (but are also objects)</p></li>
</ul>
</section>
<section id="object-view-1" class="slide level2">
<h2>Object View</h2>
<ul>
<li><p>Object implies boundedness</p>
<ul>
<li>boundaries may not be known or even knowable, but have limits.</li>
</ul></li>
<li><p>Crude examples of such limits are the minimal bounding boxes used for indexing and querying objects in databases.</p></li>
<li><p>Many objects (particularly natural ones) do not have crisp boundaries (watersheds)</p></li>
<li><p>Differences between spatial information from multiple sources are often caused by more or less arbitrary delineations through context-dependent boundaries.</p></li>
<li><p>Many questions about objects and features can be answered without boundaries, using simple point representations (centroids) with thematic <em>attributes</em>.</p></li>
</ul>
</section>
<section id="field-view" class="slide level2">
<h2>Field View</h2>
<ul>
<li><p>Fields describe phenomena that have a scalar or vector attribute everywhere in a space of interest</p>
<ul>
<li>for example, air temperatures, rainfall, elevation, land cover</li>
</ul></li>
<li><p>Field information answers the question <strong>what is here?</strong>, where here can be anywhere in the space considered.</p></li>
<li><p>Field-based spatial information can also represent attributes that are computed rather than measured, such as probabilities or densities.</p></li>
</ul>

<img data-src="images/15-prob-snow-christmas.jpg" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"><p>Together, fields and objects are the two fundamental ways of structuring spatial information.</p>
</section>
<section id="objects-can-provide-coverage" class="slide level2">
<h2>Objects can provide coverage:</h2>
<ul>
<li><p>Both objects and fields can cover space continuously - the primary difference is that objects prescribe bounds.</p>
<ul>
<li><p>Counties are one form of object that covers the USA seamlessly</p></li>
<li><p>State objects are another …</p></li>
</ul></li>
</ul>
</section></section>
<section>
<section id="object-coverages" class="title-slide slide level1 center">
<h1>Object Coverages</h1>

</section>
<section id="landsat-path-row" class="slide level2">
<h2>LANDSAT Path Row</h2>
<ul>
<li>Serves tiles based on a path/row index</li>
</ul>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-66-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="modis-sinisoial-grid" class="slide level2">
<h2>MODIS Sinisoial Grid</h2>
<ul>
<li>Serves tiles based on a path/row index</li>
</ul>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-67-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="uber-hex-addressing" class="slide level2">
<h2><a href="https://eng.uber.com/h3/">Uber Hex Addressing</a></h2>
<ul>
<li>Breaks the world into Hexagons…<br>
</li>
</ul>
<p><br></p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/15-uber-h3.jpeg" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/15-uber-h3-zoom.jpeg" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="what3word" class="slide level2">
<h2><a href="https://what3words.com/switched.mandates.apple">what3word</a></h2>
<ul>
<li>Breaks the world into 3m grids encoded with unique 3 word strings</li>
</ul>

<img data-src="images/15-what3words.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="map-tiles-slippy-maps-pyramids" class="slide level2">
<h2><a href="https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames">Map Tiles / slippy maps / Pyramids</a></h2>
<ul>
<li>Use XYZ where Z is a zoom level …</li>
</ul>

<img data-src="images/15-pyramid.jpg" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="our-data-for-today" class="slide level2">
<h2>Our Data for today …</h2>
<h4 id="southern-counties">Southern Counties</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a></a>south_counties <span class="ot">=</span> <span class="fu">aoi_get</span>(<span class="at">state =</span> <span class="st">"south"</span>, <span class="at">county =</span> <span class="st">"all"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-2"><a></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(cities))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<h4 id="unioned-to-states-using-dplyr">Unioned to States using <code>dplyr</code></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a>south_states <span class="ot">=</span> south_counties <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a></a>  <span class="fu">group_by</span>(state_name) <span class="sc">|&gt;</span> </span>
<span id="cb35-3"><a></a>  <span class="fu">summarise</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<h4 id="south-county-centroids">South County Centroids</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a></a>south_cent <span class="ot">=</span> <span class="fu">st_centroid</span>(south_counties)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-75-1.png" style="width:100.0%" class="r-stretch"></section>
<section id="southern-coverage-county" class="slide level2">
<h2>Southern Coverage: County</h2>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-76-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="regular-tiles" class="slide level2">
<h2>Regular Tiles</h2>
<ul>
<li><p>One way to tile a surface is into regions of equal area</p></li>
<li><p>Tiles can be either <em>square</em> (rectilinear) or <em>hexagonal</em></p></li>
<li><p><code>st_make_grid</code> generates a square or hexagonal grid covering the geometry of an <code>sf</code> or <code>sfc</code> object</p></li>
<li><p>The return object of <code>st_make_grid</code> is a new <code>sfc</code> object</p></li>
<li><p>Grids can be specified by <em>cellsize</em> or number of grid cells (<em>n</em>) in the X and Y direction</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a></a><span class="co"># Create a grid over the south with 70 rows and 50 columns</span></span>
<span id="cb37-2"><a></a>sq_grid <span class="ot">=</span> <span class="fu">st_make_grid</span>(south_counties, <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">70</span>, <span class="dv">50</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a></a>  <span class="fu">st_as_sf</span>() <span class="sc">|&gt;</span> </span>
<span id="cb37-4"><a></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="southern-coverage-square" class="slide level2">
<h2>Southern Coverage: Square</h2>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-78-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="hexagonal-grid" class="slide level2">
<h2>Hexagonal Grid</h2>
<ul>
<li><p>Hexagonal tessellations (honey combs) offer an alternative to square grids</p></li>
<li><p>They are created in the same way but by setting <code>square = FALSE</code></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a></a>hex_grid <span class="ot">=</span> <span class="fu">st_make_grid</span>(south_counties, <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">70</span>, <span class="dv">50</span>), <span class="at">square =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a></a>  <span class="fu">st_as_sf</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-3"><a></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="southern-coverage-hexagon" class="slide level2">
<h2>Southern Coverage: Hexagon</h2>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-80-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="advantages-square-grids" class="slide level2">
<h2>Advantages Square Grids</h2>
<ul>
<li><p>Simple definition and data storage</p>
<ul>
<li>Only need the origin (lower left), cell size (XY) and grid dimensions</li>
</ul></li>
<li><p>Easy to aggregate and dissaggregate (resample)</p></li>
<li><p>Analogous to raster data</p></li>
<li><p>Relationship between cells is given</p></li>
<li><p>Combining layers is easy with traditional matrix algebra</p></li>
</ul>
</section>
<section id="advantages-square-grids-1" class="slide level2">
<h2>Advantages Square Grids</h2>
<ul>
<li>Reduced Edge Effects
<ul>
<li>Lower perimeter to area ratio</li>
<li>minimizes the amount line length needed to create a lattice of cells with a given area</li>
</ul></li>
<li>All neighbors are identical
<ul>
<li>No rook vs queen neighbors</li>
</ul></li>
<li>Better fit to curve surfaces (e.g.&nbsp;the earth)</li>
</ul>
</section>
<section id="section-8" class="slide level2">
<h2></h2>

<img data-src="images/15-hex-vs-others.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="triangulations" class="slide level2">
<h2>Triangulations</h2>
<ul>
<li><p>An alternative to creating equal area tiles is to create triangulations from known <strong>anchor points</strong></p></li>
<li><p>Triangulation requires a set of input points and seeks to partition the interior into a partition of triangles.</p></li>
<li><p>In GIS contexts you’ll hear:</p>
<ul>
<li>Thiessen Polygon</li>
<li>Voronoi Regions</li>
<li>Delunay Triangulation</li>
<li>TIN (Triangular irregular networks)</li>
<li>etc,..</li>
</ul></li>
</ul>
</section>
<section id="voronoi-polygons" class="slide level2">
<h2>Voronoi Polygons</h2>
<ul>
<li><p>Voronoi/Thiessen polygon boundaries define the area closest to each anchor point relative to all others</p></li>
<li><p>They are defined by the <em>perpendicular</em> bisectors of the lines between all points.</p></li>
</ul>

<img data-src="images/15-voronoi-animation.gif" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="voronoi-polygons-1" class="slide level2">
<h2>Voronoi Polygons</h2>

<img data-src="images/15-Voronoi_growth_euclidean.gif" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="voronoi-polygons-2" class="slide level2">
<h2>Voronoi Polygons</h2>
<ul>
<li>Usefull for tasks such as:
<ul>
<li>nearest neighbor search,</li>
<li>facility location (optimization),</li>
<li>largest empty areas,</li>
<li>path planning…</li>
</ul></li>
<li>Also useful for simple interpolation of values such as rain gauges,</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/15-gage-rainfall.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/15-triangle-rainfall.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="often-used-in-numerical-models-and-simulations" class="slide level2">
<h2>Often used in numerical models and simulations</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/15-ocean-eddy.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/15-jetstream.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="st_voronoi" class="slide level2">
<h2><code>st_voronoi</code></h2>
<ul>
<li><p>st_voronoi creates voronoi tesselation in <code>sf</code></p></li>
<li><p>It works over a <code>MULTIPOINT</code> collection</p></li>
<li><p>Should always be simplified after creation (st_cast())</p></li>
<li><p>If to be treated as an object for analysis, should be id’d</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a></a>south_cent_u <span class="ot">=</span> <span class="fu">st_union</span>(south_cent)</span>
<span id="cb39-2"><a></a></span>
<span id="cb39-3"><a></a>v_grid <span class="ot">=</span> <span class="fu">st_voronoi</span>(south_cent_u) <span class="sc">|&gt;</span> </span>
<span id="cb39-4"><a></a>  <span class="fu">st_cast</span>() <span class="sc">|&gt;</span> </span>
<span id="cb39-5"><a></a>  <span class="fu">st_as_sf</span>() <span class="sc">|&gt;</span> </span>
<span id="cb39-6"><a></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="southern-coverage-voronoi" class="slide level2">
<h2>Southern Coverage: Voronoi</h2>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-89-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="southern-coverage-voronoi-1" class="slide level2">
<h2>Southern Coverage: Voronoi</h2>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-91-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="delaunay-triangulation" class="slide level2">
<h2>Delaunay triangulation</h2>
<ul>
<li>A Delaunay triangulation for a given set of points (P) in a plane, is a triangulation DT(P), where no point is inside the circumcircle of any triangle in DT(P).</li>
</ul>

<img data-src="images/15-Delaunay_triangles.gif" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="delaunay-triangulation-1" class="slide level2">
<h2>Delaunay triangulation</h2>
<ul>
<li><p>The Delaunay triangulation of a discrete POINT set corresponds to the dual graph of the Voronoi diagram.</p></li>
<li><p>The circumcenters (center of circles) of Delaunay triangles are the vertices of the Voronoi diagram.</p></li>
</ul>

<img data-src="images/15-vor-delun.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="used-in-landscape-evaluation-and-terrian-modeling" class="slide level2">
<h2>Used in landscape evaluation and terrian modeling</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/15-flood-plain-mapping.jpg" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/15-tin-terrain.jpg" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="st_triangulate" class="slide level2">
<h2><code>st_triangulate</code></h2>
<ul>
<li><p><code>st_triangulate</code> creates Delaunay triangulation in <code>sf</code></p></li>
<li><p>It works over a <code>MULTIPOINT</code> collection</p></li>
<li><p>Should always be simplified after creation (<code>st_cast()</code>)</p></li>
<li><p>If to be treated as an object for analysis, should be id’d</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a></a>t_grid <span class="ot">=</span> <span class="fu">st_triangulate</span>(south_cent_u) <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a></a>  <span class="fu">st_cast</span>() <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a></a>  <span class="fu">st_as_sf</span>() <span class="sc">|&gt;</span> </span>
<span id="cb40-4"><a></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="southern-coverage-triangles" class="slide level2">
<h2>Southern Coverage: Triangles</h2>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-97-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="southern-coverage-triangles-1" class="slide level2">
<h2>Southern Coverage: Triangles</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a></a>t_grid <span class="ot">=</span> <span class="fu">st_intersection</span>(t_grid, <span class="fu">st_union</span>(south_states))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="week-3_files/figure-revealjs/unnamed-chunk-99-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="difference-in-object-coverages" class="slide level2">
<h2>Difference in object coverages:</h2>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped caption-top" data-quarto-postprocess="true" style="font-size: 48px; margin-left: auto; margin-right: auto;">
<caption>Tesselation Characteristics</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Type</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Elements</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean Area (km2)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Standard Deviation Area (km2)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Coverage Area</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">triangulation</td>
<td style="text-align: right;">2,828</td>
<td style="text-align: right;">832</td>
<td style="text-align: right;">557</td>
<td style="text-align: right;">2,352,288</td>
</tr>
<tr class="even">
<td style="text-align: left;">voroni</td>
<td style="text-align: right;">1,421</td>
<td style="text-align: right;">1,688</td>
<td style="text-align: right;">1,046</td>
<td style="text-align: right;">2,398,383</td>
</tr>
<tr class="odd">
<td style="text-align: left;">counties</td>
<td style="text-align: right;">1,421</td>
<td style="text-align: right;">1,688</td>
<td style="text-align: right;">1,216</td>
<td style="text-align: right;">2,398,383</td>
</tr>
<tr class="even">
<td style="text-align: left;">grid</td>
<td style="text-align: right;">3,500</td>
<td style="text-align: right;">1,470</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5,144,369</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hexagon</td>
<td style="text-align: right;">3,789</td>
<td style="text-align: right;">1,425</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5,398,416</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="modifiable-areal-unit-problem-maup" class="slide level2">
<h2>Modifiable areal unit problem (MAUP)</h2>
<ul>
<li><p>The modifiable areal unit problem (MAUP) is a source of statistical bias that can significantly impact the results of statistical hypothesis tests.</p></li>
<li><p>MAUP affects results when point-based measures are aggregated into districts.</p></li>
<li><p>The resulting summary values (e.g., totals or proportions) are influenced by both the shape and scale of the aggregation unit.</p></li>
</ul>

<img data-src="images/15-maup.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section></section>
<section id="real-world-example" class="title-slide slide level1 center">
<h1>Real World Example</h1>
<ul>
<li><p>The power of GIS is the ability to integrate different layers and types of information</p></li>
<li><p>The scale of information can impact the analysis as can the grouping and zoning schemes chosen</p></li>
<li><p>The Modifiable Areal Unit Problem (MAUP) is an important issue for those who conduct spatial analysis using units of analysis at aggregations higher than incident level.</p></li>
<li><p>The MAUP occurs when the aggregate units of analysis are arbitrarily produced or not directly related to the underlying phenomena. A classic example of this problem is Gerrymandering.</p></li>
<li><p>Gerrymandering involves shaping and re-shaping voting districts based on the political affiliations of the resident citizenry.</p></li>
</ul>
</section>

<section>
<section id="examples" class="title-slide slide level1 center">
<h1><a href="https://thefulcrum.us/worst-gerrymandering-districts-example">Examples</a></h1>

<img data-src="images/15-gm-maup.png" class="quarto-figure quarto-figure-center r-stretch" style="width:90.0%"></section>
<section id="wrap-up" class="slide level2">
<h2>Wrap up</h2>
<p>Today we covered the following topics: - Spatial predicates and binary predicates - Spatial filtering and joining - Spatial simplification - Spatial tessellations / Coverages - Modifiable areal unit problem (MAUP)</p>
<p>Combined with your understanding of</p>
<ul>
<li>Geometry and topology</li>
<li>Coordinate Reference Systems</li>
<li>Their integration with R</li>
</ul>
<p>We are well suited to move on to raster data (gridded coverage model!) next week</p>
<p>Congrats!!</p>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../csu-rams-logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://github.com/mikejohnson51/csu-ess-523c/">ESS 523c: Environmental Data Science Applications: Water Resources</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 1000,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script>
      Reveal.addEventListener( 'slidechanged', function( event ) {
        console.log("hello")
        
        slide_id = event.currentSlide.id
        link = "annotations" + ".html#" + slide_id
        
        var annotation_div = document.createElement('div')
        annotation_div.setAttribute("class", "annotation-link")
        
        var notes_link = document.createElement('a')
        notes_link.setAttribute("href", link)
        notes_link.setAttribute("target", "_blank")
        
        var iii = document.createElement('i')
        iii.setAttribute("class", "fa fa-info")
        notes_link.appendChild(iii)
        
        annotation_div.appendChild(notes_link)
        
        var tmp = event.currentTarget.getElementsByClassName("annotation-link")
        if (tmp.length === 1) {
          tmp[0].remove()
        }
        
        if (event.currentSlide.classList.contains("annotation")) {
          event.currentTarget.append(annotation_div)
        }
      } );

    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>