<!DOCTYPE html>
<html lang="en"><head>
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <title>ESS 523c – Week 2-2</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-be8ed9a3cdcbe7a498a633334f8d1033.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
<script src="https://use.fontawesome.com/5235085b15.js"></script>
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#1E4D2B" class="quarto-title-block center">
  <h1 class="title">Week 2-2</h1>
  <p class="subtitle">Projections, Measures</p>

<div class="quarto-title-authors">
</div>

</section>
<section id="picking-up-again" class="slide level2">
<h2>Picking up again …</h2>
<p>Yesterday, we discussed the <em>simple feature</em> standard</p>
<ol type="1">
<li>Geometries (type, dimension, and structure)</li>
</ol>
<pre><code>- Empty, Valid, Simple</code></pre>
<ol start="2" type="1">
<li><p>Encoding (WKT &amp; WKB)</p></li>
<li><p>A set of operations</p></li>
</ol>
<p>And the implementation of the <strong>simple features</strong> standard in R</p>
<ul>
<li><p><em>sfg</em>: a <em>single</em> feature geometry</p></li>
<li><p><em>sfc</em>: a <em>set</em> of geometries (<code>sfg</code>) stored as a list</p></li>
<li><p><em>sf</em>: a <code>sfc</code> list joined with a <code>data.frame</code> (attributes)</p></li>
</ul>
<p>This R implementation is ideal/special because it achieves the simple feature abstract goal of:</p>
<blockquote>
<p>“<em>A simple feature is defined by the OpenGIS Abstract specification to have both <strong>spatial</strong> and <strong>non-spatial</strong> attributes…</em>” - <a href="http://www.opengeospatial.org/standards/sfa">standard</a>.</p>
</blockquote>
<p>The shapefile/GIS traditional GIS view does not do this and seperates geometry (shp), from projection (prj), from data (dbf) and relates them through an shx file</p>
</section>
<section id="integration-with-tidyverse" class="slide level2">
<h2>Integration with <code>tidyverse</code></h2>
<ul>
<li><p>We saw how the <code>dplyr</code> verbs still work on an <code>sf</code> object since <code>sf</code> extends the data.frame class</p></li>
<li><p>How <code>geom_sf</code> support mapping (“spatial plotting”) in <code>ggplot</code></p></li>
<li><p>How to read spatial data into R via GDAL drivers:</p>
<ul>
<li>spatial files (<code>read_sf</code>)</li>
<li>flat files via <code>st_as_sf</code></li>
</ul></li>
<li><p>Integration with a few <code>GEOS</code> geometry operations like:</p>
<ul>
<li>st_combine()</li>
<li>st_union()</li>
</ul></li>
</ul>
</section>
<section id="yesterday" class="slide level2">
<h2>Yesterday …</h2>
<div class="{columns}">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a>conus <span class="ot">&lt;-</span>  USAboundaries<span class="sc">::</span><span class="fu">us_states</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a></a>  <span class="fu">filter</span>(<span class="sc">!</span>state_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puerto Rico"</span>, </span>
<span id="cb2-3"><a></a>                            <span class="st">"Alaska"</span>, </span>
<span id="cb2-4"><a></a>                            <span class="st">"Hawaii"</span>))</span>
<span id="cb2-5"><a></a></span>
<span id="cb2-6"><a></a><span class="fu">length</span>(<span class="fu">st_geometry</span>(conus))</span>
<span id="cb2-7"><a></a><span class="co">#&gt; [1] 49</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week2-2_files/figure-revealjs/unnamed-chunk-3-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="feature-resoloved-and-combined" class="slide level2">
<h2>1 feature: resoloved and combined:</h2>
<div class="{columns}">
<div class="column" style="width:50%;">
<ul>
<li>st_cast / st_union work on <code>sfg</code>, <code>sfc</code>, and <code>sf</code> objects:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a>us_c_ml <span class="ot">=</span> <span class="fu">st_combine</span>(conus) <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>)</span>
<span id="cb3-3"><a></a>   </span>
<span id="cb3-4"><a></a>us_u_ml <span class="ot">=</span> <span class="fu">st_union</span>(conus) <span class="sc">|&gt;</span></span>
<span id="cb3-5"><a></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week2-2_files/figure-revealjs/unnamed-chunk-5-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="so-what" class="slide level2">
<h2>So what?</h2>
<p>Lets imagine we want to know the distance from Denver to the nearest state border:</p>
<p>To do this, we need to:<br>
</p>
<p>1: define Denver as a geometry in a CRS<br>
2: determine the correct geometry types / representation<br>
3: calculate the distance between (1) and (2)<br>
</p>
</section>
<section id="make-denver-in-the-crs-of-our-states" class="slide level2">
<h2>1. Make “Denver” in the CRS of our states</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>denver <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fl">39.7392</span>, <span class="at">x =</span> <span class="sc">-</span><span class="fl">104.9903</span>, <span class="at">name =</span> <span class="st">"Denver"</span>)</span>
<span id="cb4-2"><a></a>(<span class="at">denver_sf =</span> <span class="fu">st_as_sf</span>(denver, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb4-3"><a></a><span class="co">#&gt; Simple feature collection with 1 feature and 1 field</span></span>
<span id="cb4-4"><a></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb4-5"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb4-6"><a></a><span class="co">#&gt; Bounding box:  xmin: -104.9903 ymin: 39.7392 xmax: -104.9903 ymax: 39.7392</span></span>
<span id="cb4-7"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb4-8"><a></a><span class="co">#&gt;     name                  geometry</span></span>
<span id="cb4-9"><a></a><span class="co">#&gt; 1 Denver POINT (-104.9903 39.7392)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="determine-the-3-closest-states" class="slide level2">
<h2>2. Determine the 3 closest states:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a>conus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 12 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    statefp  statens    affgeoid geoid stusps       name lsad        aland
#&gt; 1       06 01779778 0400000US06    06     CA California   00 403671196038
#&gt; 2       55 01779806 0400000US55    55     WI  Wisconsin   00 140292246684
#&gt; 3       16 01779783 0400000US16    16     ID      Idaho   00 214049923496
#&gt; 4       27 00662849 0400000US27    27     MN  Minnesota   00 206232157570
#&gt; 5       19 01779785 0400000US19    19     IA       Iowa   00 144659688848
#&gt; 6       29 01779791 0400000US29    29     MO   Missouri   00 178052563675
#&gt; 7       24 01714934 0400000US24    24     MD   Maryland   00  25151895765
#&gt; 8       41 01155107 0400000US41    41     OR     Oregon   00 248628426864
#&gt; 9       26 01779789 0400000US26    26     MI   Michigan   00 146614604273
#&gt; 10      30 00767982 0400000US30    30     MT    Montana   00 376973673895
#&gt;          awater state_name state_abbr jurisdiction_type
#&gt; 1   20294133830 California         CA             state
#&gt; 2   29343721650  Wisconsin         WI             state
#&gt; 3    2391577745      Idaho         ID             state
#&gt; 4   18949864226  Minnesota         MN             state
#&gt; 5    1085996889       Iowa         IA             state
#&gt; 6    2487215790   Missouri         MO             state
#&gt; 7    6979171386   Maryland         MD             state
#&gt; 8    6170953359     Oregon         OR             state
#&gt; 9  103872203398   Michigan         MI             state
#&gt; 10   3866689601    Montana         MT             state
#&gt;                          geometry
#&gt; 1  MULTIPOLYGON (((-118.594 33...
#&gt; 2  MULTIPOLYGON (((-86.93428 4...
#&gt; 3  MULTIPOLYGON (((-117.243 44...
#&gt; 4  MULTIPOLYGON (((-97.22904 4...
#&gt; 5  MULTIPOLYGON (((-96.62187 4...
#&gt; 6  MULTIPOLYGON (((-95.76564 4...
#&gt; 7  MULTIPOLYGON (((-76.04621 3...
#&gt; 8  MULTIPOLYGON (((-124.5524 4...
#&gt; 9  MULTIPOLYGON (((-84.61622 4...
#&gt; 10 MULTIPOLYGON (((-116.0492 4...</code></pre>
</div>
</div></div>
</section>
<section id="determine-the-3-closest-states-1" class="slide level2">
<h2>2. Determine the 3 closest states:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a>conus <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a></a>  <span class="fu">select</span>(state_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 1 field
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    state_name                       geometry
#&gt; 1  California MULTIPOLYGON (((-118.594 33...
#&gt; 2   Wisconsin MULTIPOLYGON (((-86.93428 4...
#&gt; 3       Idaho MULTIPOLYGON (((-117.243 44...
#&gt; 4   Minnesota MULTIPOLYGON (((-97.22904 4...
#&gt; 5        Iowa MULTIPOLYGON (((-96.62187 4...
#&gt; 6    Missouri MULTIPOLYGON (((-95.76564 4...
#&gt; 7    Maryland MULTIPOLYGON (((-76.04621 3...
#&gt; 8      Oregon MULTIPOLYGON (((-124.5524 4...
#&gt; 9    Michigan MULTIPOLYGON (((-84.61622 4...
#&gt; 10    Montana MULTIPOLYGON (((-116.0492 4...</code></pre>
</div>
</div></div>
</section>
<section id="determine-the-3-closest-states-2" class="slide level2">
<h2>2. Determine the 3 closest states:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>conus <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a></a>  <span class="fu">select</span>(state_name) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">st_distance</span>(., denver_sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 2 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    state_name                       geometry          dist
#&gt; 1  California MULTIPOLYGON (((-118.594 33... 1000950.5 [m]
#&gt; 2   Wisconsin MULTIPOLYGON (((-86.93428 4... 1146522.6 [m]
#&gt; 3       Idaho MULTIPOLYGON (((-117.243 44...  567809.5 [m]
#&gt; 4   Minnesota MULTIPOLYGON (((-97.22904 4...  823100.9 [m]
#&gt; 5        Iowa MULTIPOLYGON (((-96.62187 4...  773889.8 [m]
#&gt; 6    Missouri MULTIPOLYGON (((-95.76564 4...  789142.1 [m]
#&gt; 7    Maryland MULTIPOLYGON (((-76.04621 3... 2174383.4 [m]
#&gt; 8      Oregon MULTIPOLYGON (((-124.5524 4... 1041819.1 [m]
#&gt; 9    Michigan MULTIPOLYGON (((-84.61622 4... 1401455.7 [m]
#&gt; 10    Montana MULTIPOLYGON (((-116.0492 4...  585011.2 [m]</code></pre>
</div>
</div></div>
</section>
<section id="determine-the-3-closest-states-3" class="slide level2">
<h2>2. Determine the 3 closest states:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>conus <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a></a>  <span class="fu">select</span>(state_name) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">st_distance</span>(., denver_sf)) <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a></a>  <span class="fu">slice_min</span>(dist, <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 3 features and 2 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -111.0569 ymin: 36.99243 xmax: -95.30829 ymax: 45.0059
#&gt; Geodetic CRS:  WGS 84
#&gt;   state_name         dist                       geometry
#&gt; 1   Colorado      0.0 [m] MULTIPOLYGON (((-109.06 38....
#&gt; 2    Wyoming 139988.4 [m] MULTIPOLYGON (((-111.0569 4...
#&gt; 3   Nebraska 161243.2 [m] MULTIPOLYGON (((-104.0531 4...</code></pre>
</div>
</div></div>
</section>
<section id="determine-the-3-closest-states-4" class="slide level2">
<h2>2. Determine the 3 closest states:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a>conus <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a></a>  <span class="fu">select</span>(state_name) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">st_distance</span>(., denver_sf)) <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a></a>  <span class="fu">slice_min</span>(dist, <span class="at">n =</span> <span class="dv">3</span>) <span class="ot">-&gt;</span></span>
<span id="cb13-5"><a></a>  near3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">

</div></div>
<div class="cell">
<pre><code>#&gt; Simple feature collection with 3 features and 2 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -111.0569 ymin: 36.99243 xmax: -95.30829 ymax: 45.0059
#&gt; Geodetic CRS:  WGS 84
#&gt;   state_name         dist                       geometry
#&gt; 1   Colorado      0.0 [m] MULTIPOLYGON (((-109.06 38....
#&gt; 2    Wyoming 139988.4 [m] MULTIPOLYGON (((-111.0569 4...
#&gt; 3   Nebraska 161243.2 [m] MULTIPOLYGON (((-104.0531 4...</code></pre>
</div>
<ul>
<li>That’s close, but the distance to Colorado is 0, that’s not a state border.</li>
</ul>
</section>
<section id="geometry-selection" class="slide level2">
<h2>Geometry Selection</h2>
<ul>
<li><code>Polygon</code> (therefore MULTIPOLGYGONS) describe areas!</li>
<li>The distance to a <code>point</code> <strong>in</strong> a <code>polygon</code> to that polygon is 0.</li>
</ul>
</section>
<section id="to-determine-distance-to-border-we-need-a-linear-representation" class="slide level2">
<h2>To determine distance to border we need a linear representation:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a>conus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 12 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    statefp  statens    affgeoid geoid stusps       name lsad        aland
#&gt; 1       06 01779778 0400000US06    06     CA California   00 403671196038
#&gt; 2       55 01779806 0400000US55    55     WI  Wisconsin   00 140292246684
#&gt; 3       16 01779783 0400000US16    16     ID      Idaho   00 214049923496
#&gt; 4       27 00662849 0400000US27    27     MN  Minnesota   00 206232157570
#&gt; 5       19 01779785 0400000US19    19     IA       Iowa   00 144659688848
#&gt; 6       29 01779791 0400000US29    29     MO   Missouri   00 178052563675
#&gt; 7       24 01714934 0400000US24    24     MD   Maryland   00  25151895765
#&gt; 8       41 01155107 0400000US41    41     OR     Oregon   00 248628426864
#&gt; 9       26 01779789 0400000US26    26     MI   Michigan   00 146614604273
#&gt; 10      30 00767982 0400000US30    30     MT    Montana   00 376973673895
#&gt;          awater state_name state_abbr jurisdiction_type
#&gt; 1   20294133830 California         CA             state
#&gt; 2   29343721650  Wisconsin         WI             state
#&gt; 3    2391577745      Idaho         ID             state
#&gt; 4   18949864226  Minnesota         MN             state
#&gt; 5    1085996889       Iowa         IA             state
#&gt; 6    2487215790   Missouri         MO             state
#&gt; 7    6979171386   Maryland         MD             state
#&gt; 8    6170953359     Oregon         OR             state
#&gt; 9  103872203398   Michigan         MI             state
#&gt; 10   3866689601    Montana         MT             state
#&gt;                          geometry
#&gt; 1  MULTIPOLYGON (((-118.594 33...
#&gt; 2  MULTIPOLYGON (((-86.93428 4...
#&gt; 3  MULTIPOLYGON (((-117.243 44...
#&gt; 4  MULTIPOLYGON (((-97.22904 4...
#&gt; 5  MULTIPOLYGON (((-96.62187 4...
#&gt; 6  MULTIPOLYGON (((-95.76564 4...
#&gt; 7  MULTIPOLYGON (((-76.04621 3...
#&gt; 8  MULTIPOLYGON (((-124.5524 4...
#&gt; 9  MULTIPOLYGON (((-84.61622 4...
#&gt; 10 MULTIPOLYGON (((-116.0492 4...</code></pre>
</div>
</div></div>
</section>
<section id="to-determine-distance-to-border-we-need-a-linear-representation-1" class="slide level2">
<h2>To determine distance to border we need a linear representation:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a>conus <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a></a>  <span class="fu">select</span>(state_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 1 field
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    state_name                       geometry
#&gt; 1  California MULTIPOLYGON (((-118.594 33...
#&gt; 2   Wisconsin MULTIPOLYGON (((-86.93428 4...
#&gt; 3       Idaho MULTIPOLYGON (((-117.243 44...
#&gt; 4   Minnesota MULTIPOLYGON (((-97.22904 4...
#&gt; 5        Iowa MULTIPOLYGON (((-96.62187 4...
#&gt; 6    Missouri MULTIPOLYGON (((-95.76564 4...
#&gt; 7    Maryland MULTIPOLYGON (((-76.04621 3...
#&gt; 8      Oregon MULTIPOLYGON (((-124.5524 4...
#&gt; 9    Michigan MULTIPOLYGON (((-84.61622 4...
#&gt; 10    Montana MULTIPOLYGON (((-116.0492 4...</code></pre>
</div>
</div></div>
</section>
<section id="to-determine-distance-to-border-we-need-a-linear-representation-2" class="slide level2">
<h2>To determine distance to border we need a linear representation:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a>conus <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a></a>  <span class="fu">select</span>(state_name) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 1 field
#&gt; Geometry type: MULTILINESTRING
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    state_name                       geometry
#&gt; 1  California MULTILINESTRING ((-118.594 ...
#&gt; 2   Wisconsin MULTILINESTRING ((-86.93428...
#&gt; 3       Idaho MULTILINESTRING ((-117.243 ...
#&gt; 4   Minnesota MULTILINESTRING ((-97.22904...
#&gt; 5        Iowa MULTILINESTRING ((-96.62187...
#&gt; 6    Missouri MULTILINESTRING ((-95.76564...
#&gt; 7    Maryland MULTILINESTRING ((-76.04621...
#&gt; 8      Oregon MULTILINESTRING ((-124.5524...
#&gt; 9    Michigan MULTILINESTRING ((-84.61622...
#&gt; 10    Montana MULTILINESTRING ((-116.0492...</code></pre>
</div>
</div></div>
</section>
<section id="to-determine-distance-to-border-we-need-a-linear-representation-3" class="slide level2">
<h2>To determine distance to border we need a linear representation:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a>conus <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a></a>  <span class="fu">select</span>(state_name) <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">st_distance</span>(., denver_sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 49 features and 2 fields
#&gt; Geometry type: MULTILINESTRING
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;    state_name                       geometry          dist
#&gt; 1  California MULTILINESTRING ((-118.594 ... 1000950.5 [m]
#&gt; 2   Wisconsin MULTILINESTRING ((-86.93428... 1146522.6 [m]
#&gt; 3       Idaho MULTILINESTRING ((-117.243 ...  567809.5 [m]
#&gt; 4   Minnesota MULTILINESTRING ((-97.22904...  823100.9 [m]
#&gt; 5        Iowa MULTILINESTRING ((-96.62187...  773889.8 [m]
#&gt; 6    Missouri MULTILINESTRING ((-95.76564...  789142.1 [m]
#&gt; 7    Maryland MULTILINESTRING ((-76.04621... 2174383.4 [m]
#&gt; 8      Oregon MULTILINESTRING ((-124.5524... 1041819.1 [m]
#&gt; 9    Michigan MULTILINESTRING ((-84.61622... 1401455.7 [m]
#&gt; 10    Montana MULTILINESTRING ((-116.0492...  585011.2 [m]</code></pre>
</div>
</div></div>
</section>
<section id="to-determine-distance-to-border-we-need-a-linear-representation-4" class="slide level2">
<h2>To determine distance to border we need a linear representation:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a>conus <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a></a>  <span class="fu">select</span>(state_name) <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">st_distance</span>(., denver_sf)) <span class="sc">|&gt;</span></span>
<span id="cb23-5"><a></a>  <span class="fu">slice_min</span>(dist, <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt; Simple feature collection with 3 features and 2 fields
#&gt; Geometry type: MULTILINESTRING
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -111.0569 ymin: 36.99243 xmax: -95.30829 ymax: 45.0059
#&gt; Geodetic CRS:  WGS 84
#&gt;   state_name         dist                       geometry
#&gt; 1   Colorado 139988.4 [m] MULTILINESTRING ((-109.06 3...
#&gt; 2    Wyoming 139988.4 [m] MULTILINESTRING ((-111.0569...
#&gt; 3   Nebraska 161243.2 [m] MULTILINESTRING ((-104.0531...</code></pre>
</div>
</div></div>
</section>
<section id="to-determine-distance-to-border-we-need-a-linear-representation-5" class="slide level2">
<h2>To determine distance to border we need a linear representation:</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a>conus <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a></a>  <span class="fu">select</span>(state_name) <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">st_distance</span>(., denver_sf)) <span class="sc">|&gt;</span></span>
<span id="cb25-5"><a></a>  <span class="fu">slice_min</span>(dist, <span class="at">n =</span> <span class="dv">3</span>) <span class="ot">-&gt;</span></span>
<span id="cb25-6"><a></a>  near3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">

</div></div>
<div class="cell">
<pre><code>#&gt; Simple feature collection with 3 features and 2 fields
#&gt; Geometry type: MULTILINESTRING
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -111.0569 ymin: 36.99243 xmax: -95.30829 ymax: 45.0059
#&gt; Geodetic CRS:  WGS 84
#&gt;   state_name         dist                       geometry
#&gt; 1   Colorado 139988.4 [m] MULTILINESTRING ((-109.06 3...
#&gt; 2    Wyoming 139988.4 [m] MULTILINESTRING ((-111.0569...
#&gt; 3   Nebraska 161243.2 [m] MULTILINESTRING ((-104.0531...</code></pre>
</div>
<ul>
<li><p>Good. However, we were only interested in the distance to the closest border not to ALL boarders. Therefore we calculated 48 (49 - 1) more distances then needed!</p></li>
<li><p>While this is not to complex for 1 &lt;-&gt; 49 features imagine we had 28,000+ (like) your lab!</p></li>
<li><p>That would result in 1,344,000 more calculations then needed …</p></li>
</ul>
</section>
<section id="revisting-the-idea-of-the-feature-level" class="slide level2">
<h2>Revisting the idea of the feature level:</h2>
<p>A “feature” can “be part of the whole” or the whole</p>
<ul>
<li><p>A island (POLYGON), or a set of islands acting as 1 unit (MULTIPOLYGON)</p></li>
<li><p>A city (POINT), or a set of cities meeting a condition (MULTIPOINT)</p></li>
<li><p>A road (LINESTRING), or a route (MULTILINESTRING)</p></li>
<li><p>Since we want the distance to the nearest border, <em>regardless</em> of the state. Our <strong>feature</strong> is the <em>set of borders with preserved boundaries</em>.</p></li>
<li><p>In other words, a 1 feature <code>MULTILINESTRING</code></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a><span class="fu">st_distance</span>(denver_sf, <span class="fu">st_cast</span>(<span class="fu">st_combine</span>(conus), <span class="st">"MULTILINESTRING"</span>))</span>
<span id="cb27-2"><a></a><span class="co">#&gt; Units: [m]</span></span>
<span id="cb27-3"><a></a><span class="co">#&gt;          [,1]</span></span>
<span id="cb27-4"><a></a><span class="co">#&gt; [1,] 139988.4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The same principle would apply if the question was “<em>distance to national border</em>”</p>
</section>
<section id="the-stickness-of-sfc-column" class="slide level2">
<h2>The stickness of <code>sfc</code> column</h2>
<ul>
<li>A simple features object (sf) is the connection of a <code>sfc</code> list-column and <code>data.frame</code> of attributes</li>
</ul>

<img data-src="images/11-sticky-geom.png" class="quarto-figure quarto-figure-center r-stretch" width="529"><ul>
<li>This binding is unique compared to other column bindings built with things like
<ul>
<li><code>dplyr::bind_cols()</code></li>
<li><code>cbind()</code></li>
<li><code>do.call(cbind, list())</code></li>
</ul></li>
</ul>
</section>
<section id="the-stickness-of-sfc-column-1" class="slide level2">
<h2>The stickness of <code>sfc</code> column</h2>
<ul>
<li>Geometry columns are “sticky” meaning they persist through data manipulation:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a>USAboundaries<span class="sc">::</span><span class="fu">us_states</span>() <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a></a>  <span class="fu">select</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb28-4"><a></a><span class="co">#&gt; Simple feature collection with 2 features and 1 field</span></span>
<span id="cb28-5"><a></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb28-6"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb28-7"><a></a><span class="co">#&gt; Bounding box:  xmin: -124.4096 ymin: 32.53416 xmax: -86.80587 ymax: 47.05468</span></span>
<span id="cb28-8"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb28-9"><a></a><span class="co">#&gt;         name                       geometry</span></span>
<span id="cb28-10"><a></a><span class="co">#&gt; 1 California MULTIPOLYGON (((-118.594 33...</span></span>
<span id="cb28-11"><a></a><span class="co">#&gt; 2  Wisconsin MULTIPOLYGON (((-86.93428 4...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dropping the geometry column requires dropping the geometry via <code>sf</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a>USAboundaries<span class="sc">::</span><span class="fu">us_states</span>() <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb29-3"><a></a>  <span class="fu">select</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb29-4"><a></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb29-5"><a></a><span class="co">#&gt;         name</span></span>
<span id="cb29-6"><a></a><span class="co">#&gt; 1 California</span></span>
<span id="cb29-7"><a></a><span class="co">#&gt; 2  Wisconsin</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or cohersing the <code>sf</code> object to a <code>data.frame</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a>USAboundaries<span class="sc">::</span><span class="fu">us_states</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb30-3"><a></a>  <span class="fu">select</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb30-4"><a></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb30-5"><a></a><span class="co">#&gt;         name</span></span>
<span id="cb30-6"><a></a><span class="co">#&gt; 1 California</span></span>
<span id="cb30-7"><a></a><span class="co">#&gt; 2  Wisconsin</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="coordinate-systems" class="slide level2">
<h2>Coordinate Systems</h2>
<ul>
<li>What makes a feature geometry <em>spatial</em> is the reference system…</li>
</ul>

<img data-src="images/09-sf-model.png" class="quarto-figure quarto-figure-center r-stretch" width="350"></section>
<section id="coordinate-systems-1" class="slide level2">
<h2>Coordinate Systems</h2>
<ul>
<li><p>Coordinate Reference Systems (CRS) defines how spatial features relate to the surface of the Earth.</p></li>
<li><p>CRSs are either geographic or projected…</p></li>
<li><p>CRSs are measurement units for coordinates:</p></li>
</ul>
</section>
<section id="sf-tools" class="slide level2">
<h2><code>sf</code> tools</h2>
<p>In <code>sf</code> we have <em>three</em> tools for exploring, define, and changing CRS systems:</p>
<ul>
<li><p><em>st_crs</em> : Retrieve coordinate reference system from sf or sfc object</p></li>
<li><p><em>st_set_crs</em> : Set or replace coordinate reference system from object</p></li>
<li><p><em>st_transform</em> : Transform or convert coordinates of simple feature</p></li>
<li><p>Again, “st” (like PostGIS) denotes it is an operation that can work on a ” <em>s</em> patial <em>t</em> ype ”</p></li>
</ul>
</section>
<section id="geographic-coordinate-systms-gcs" class="slide level2">
<h2>Geographic Coordinate Systms (GCS)</h2>
<p>A GCS identifies locations on the <em>curved</em> surface of the earth.</p>
<p>Locations are measured in <strong>angular</strong> units from the center of the earth relative to the plane defined by the equator and the plane defined by the prime meridian.</p>
<p>The vertical angle describes the <em>latitude</em> and the horizontal angle the <em>longitude</em></p>
<p>In most coordinate systems, the North-South and East-West directions are encoded as +/-.</p>
<p>North and East are positive (<code>+</code>) and South and West are negative (<code>-</code>) sign.</p>
<p>A GCS is defined by 3 components:</p>
<ul>
<li><p>an <strong>ellipsoid</strong></p></li>
<li><p>a <strong>geoid</strong></p></li>
<li><p>a <strong>datum</strong></p></li>
</ul>
</section>
<section id="sphere-and-ellipsoid" class="slide level2">
<h2>Sphere and Ellipsoid</h2>
<ul>
<li><p>Assuming that the earth is a perfect sphere simplifies calculations and works for small-scale maps (maps that show a <em>large</em> area of the earth).</p></li>
<li><p>But … the earth is not a sphere do to its rotation inducing a centripetal force along the equator.</p></li>
<li><p>This results in an equatorial axis that is roughly 21 km longer than the polar axis.</p></li>
<li><p>To account for this, the earth is modeled as an ellipsoid (slighty squished sphere) defined by two radii:</p>
<ul>
<li>the <strong>semi-major</strong> axis (along the equatorial radius)</li>
<li>the <strong>semi-minor</strong> axis (along the polar radius)</li>
</ul></li>
</ul>

<img data-src="images/11-semi-axis.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="section" class="slide level2">
<h2></h2>
<ul>
<li><p>Thanks to satellite and computational capabilities our estimates of these radii are be quite precise</p>
<ul>
<li><p>The semi-major axis is 6,378,137 m</p></li>
<li><p>The semi-minor axis is 6,356,752 m</p></li>
</ul></li>
<li><p>Differences in distance along the surfaces of an ellipsoid vs.&nbsp;a perfect sphere are small but measurable (the difference can be as high as 20 km)</p></li>
</ul>
<div class="{columns}">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/11-sphere.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/11-ellipsoid.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="geoid" class="slide level2">
<h2>Geoid</h2>
<ul>
<li><p>The <em>ellipsoid</em> gives us the earths form as a perfectly smooth object</p></li>
<li><p>But … the earth is not perfectly smooth</p></li>
<li><p>Deviations from the perfect sphere are measurable and can influence measurements.</p></li>
<li><p>A <em>geoid</em> is a mathematical model fore representing these deviations</p>
<ul>
<li><p>We are <em>not</em> talking about mountains and ocean trenches but the earth’s gravitational potential which is tied to the flow of the earth’s hot and fluid core.</p></li>
<li><p>Therefore the geoid is constantly changing, albeit a large temporal scale.</p></li>
</ul></li>
<li><p>The measurement and representation of the earth’s shape is at the heart of <code>geodesy</code></p></li>
</ul>

<img data-src="images/11-nasa-geoids.jpg" width="175" class="r-stretch quarto-figure-center"><p class="caption">NASA’s geoid models</p></section>
<section id="datum" class="slide level2">
<h2>Datum</h2>
<ul>
<li><p>So how are we to reconcile our need to work with a (simple) mathematical model of the earth’s shape with the undulating nature of the geoid?</p></li>
<li><p>We align the geoid with the ellipsoid to map the the earths departures from the smooth assumption</p></li>
<li><p>The alignment can be <strong>local</strong> where the ellipsoid surface is closely fit to the geoid at a particular location on the earth’s surface</p></li>
</ul>
<p>or</p>
<ul>
<li><p><strong>geocentric</strong> where the ellipsoid is aligned with the center of the earth.</p></li>
<li><p>The alignment of the smooth ellipsoid to the geoid model defines a <strong>datum</strong>.</p></li>
</ul>
</section>
<section id="local-datums" class="slide level2">
<h2>Local Datums</h2>
<ul>
<li><p>There are many local datums to choose from</p></li>
<li><p>The choice of datum is largely driven by the location</p></li>
<li><p>When working in the USA, a the North American Datum of 1927 (or NAD27 for short) is standard</p>
<ul>
<li>NAD27 is not well suited for other parts of the world.</li>
</ul></li>
</ul>
<p>Examples of common local datums are shown in the following table:</p>
</section>
<section id="section-1" class="slide level2">
<h2></h2>
<table class="caption-top">
<colgroup>
<col style="width: 40%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Local datum</th>
<th>Acronym</th>
<th>Best for</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>North American Datum of 1927</td>
<td>NAD27</td>
<td>Continental US</td>
<td>This is an old datum but still prevalent</td>
</tr>
<tr class="even">
<td>European Datum of 1950</td>
<td>ED50</td>
<td>Western Europe</td>
<td>Developed after World War II and still quite popular</td>
</tr>
<tr class="odd">
<td>World Geodetic System 1972</td>
<td>WGS72</td>
<td>Global</td>
<td>Developed by the Department of Defense.</td>
</tr>
</tbody>
</table>
</section>
<section id="geocentric-datum" class="slide level2">
<h2>Geocentric Datum</h2>
<ul>
<li><p>Many modern datums use a geocentric alignment</p>
<ul>
<li><p>World Geodetic Survey for 1984 (WGS84)</p></li>
<li><p>North American Datums of 1983 (NAD83)</p></li>
</ul></li>
<li><p>Most popular geocentric datums use the WGS84 <em>ellipsoid</em> or the GRS80 <em>ellipsoid</em> which share nearly identical semi-major and semi-minor axes</p></li>
</ul>
</section>
<section id="section-2" class="slide level2">
<h2></h2>
<table class="caption-top">
<colgroup>
<col style="width: 37%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Geocentric datum</th>
<th>Acronym</th>
<th>Best for</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>North American Datum of 1983</td>
<td>NAD83</td>
<td>Continental US</td>
<td>This is one of the most popular modern datums for the contiguous US.</td>
</tr>
<tr class="even">
<td>European Terrestrial Reference System 1989</td>
<td>ETRS89</td>
<td>Western Europe</td>
<td>This is the most popular modern datum for much of Europe.</td>
</tr>
<tr class="odd">
<td>World Geodetic System 1984</td>
<td>WGS84</td>
<td>Global</td>
<td>Developed by the Department of Defense.</td>
</tr>
</tbody>
</table>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>NAD 27 is based on Clarke Ellipsoid of 1866 which is calculated by manual surveying. NAD83 is based on the Geodetic Reference System (GRS) of 1980.</p>
</div>
</div>
</div>
</section>
<section id="building-a-gcs" class="slide level2">
<h2>Building a GCS</h2>
<ul>
<li><p>So, a GCS is defined by the ellipsoid model and its alignment to the geoid defining the datum.</p></li>
<li><p>Smooth Sphere - Mathmatical Geoid (in angular units)</p></li>
</ul>
</section>
<section id="projected-coordinate-systems" class="slide level2">
<h2>Projected Coordinate Systems</h2>
<ul>
<li><p>The surface of the earth is curved but maps (and to data GIS) is flat.</p></li>
<li><p>A projected coordinate system (PCS) is a reference system for identifying locations and measuring features on a flat (2D) surfaces. I</p></li>
<li><p>Projected coordinate systems have an origin, an <em>x</em> axis, a <em>y</em> axis, and a linear unit of measure.</p></li>
<li><p>Going from a GCS to a PCS requires mathematical transformations.</p></li>
<li><p>There are three main groups of projection types:</p>
<ul>
<li>conic</li>
<li>cylindrical</li>
<li>planar</li>
</ul></li>
</ul>
</section>
<section id="projection-types" class="slide level2">
<h2>Projection Types:</h2>

<img data-src="images/11-projected-crs.png" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"><ul>
<li><p>In all cases, distortion is <em>minimized</em> at the line/point of <strong>tangency</strong> (denoted by black line/point)</p></li>
<li><p>Distortions are <em>minimized</em> along the tangency lines and increase with the distance from those lines.</p></li>
</ul>
</section>
<section id="plannar" class="slide level2">
<h2>Plannar</h2>
<ul>
<li><p>A planar projection projects data onto a flat surface touching the globe at a <em>point</em> or along 1 line of <em>tangency.</em></p></li>
<li><p>Typically used to map polar regions.</p></li>
</ul>

<img data-src="images/11-projected-crs.png" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"></section>
<section id="cylindrical" class="slide level2">
<h2>Cylindrical</h2>
<ul>
<li><p>A cylindrical projection maps the surface onto a cylinder.</p></li>
<li><p>This projection could also be created by touching the Earth’s surface along 1 or 2 lines of <em>tangency</em></p></li>
<li><p>Most often when mapping the entire world.</p></li>
</ul>

<img data-src="images/11-projected-crs.png" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"></section>
<section id="conic" class="slide level2">
<h2>Conic</h2>
<p>In a conic projection, the Earth’s surface is projected onto a cone along 1 or 2 lines of <em>tangency</em></p>
<p>Therefore, it is the best suited for maps of mid-latitude areas.</p>

<img data-src="images/11-projected-crs.png" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"></section>
<section id="spatial-properties" class="slide level2">
<h2>Spatial Properties</h2>
<ul>
<li><p>All projections <em>distort</em> real-world geographic features.</p></li>
<li><p>Think about trying to unpeel an orange while preserving the skin</p></li>
</ul>
<p>The four spatial properties that are subject to distortion are: <strong>shape</strong>, <strong>area</strong>, <strong>distance</strong> and <strong>direction</strong></p>
<ul>
<li><p>A map that preserves shape is called <code>conformal</code>;</p></li>
<li><p>one that preserves area is called <code>equal-area</code>;</p></li>
<li><p>one that preserves distance is called <code>equidistant</code></p></li>
<li><p>one that preserves direction is called <code>azimuthal</code></p></li>
<li><p>Each map projection can preserve only one or two of the four spatial properties.</p></li>
<li><p>Often, projections are named after the spatial properties they preserve.</p></li>
<li><p>When working with small-scale (large area) maps and when multiple spatial properties are needed, it is best to break the analyses across projections to minimize errors associated with spatial distortion.</p></li>
</ul>
</section>
<section id="setting-crsspcss" class="slide level2">
<h2>Setting CRSs/PCSs</h2>
<ul>
<li>We saw that <code>sfc</code> objects have two attributes to store a CRS: <code>epsg</code> and <code>proj4string</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a><span class="fu">st_geometry</span>(conus)</span>
<span id="cb31-2"><a></a><span class="co">#&gt; Geometry set for 49 features </span></span>
<span id="cb31-3"><a></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb31-4"><a></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb31-5"><a></a><span class="co">#&gt; Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436</span></span>
<span id="cb31-6"><a></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb31-7"><a></a><span class="co">#&gt; First 5 geometries:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>This implies that all geometries in a geometry list-column (sfc) must have the same CRS.</p></li>
<li><p><code>proj4string</code> is a generic, string-based description of a CRS, understood by <a href="https://proj4.org/">PROJ</a></p></li>
<li><p>It defines projection types and parameter values for particular projections,</p></li>
<li><p>As a result it can cover an infinite amount of different projections.</p></li>
<li><p><code>epsg</code> is the <em>integer ID</em> for a known CRS that can be resolved into a <code>proj4string</code>.</p>
<ul>
<li>This is somewhat equivalent to the idea that a 6-digit FIP code can be resolved to a state/county pair</li>
</ul></li>
<li><p>Some <code>proj4string</code> values can resolved back into their corresponding <code>epsg</code> ID, but this does not always work.</p></li>
<li><p>The importance of having <code>epsg</code> values stored with data besides <code>proj4string</code> values is that the <code>epsg</code> refers to particular, well-known CRS, whose parameters may change (improve) over time</p></li>
<li><p>fixing only the <code>proj4string</code> may remove the possibility to benefit from such improvements, and limit some of the provenance of datasets (but may help reproducibility)</p></li>
</ul>
</section>
<section id="proj4-coordinate-syntax" class="slide level2">
<h2><code>PROJ4</code> coordinate syntax</h2>
<p>The <code>PROJ4</code> syntax contains a list of parameters, each prefixed with the <code>+</code> character.</p>
<p>A list of some <code>PROJ4</code> parameters follows and the full list can be found <a href="https://proj.org/usage/projections.html">here</a>:</p>
<table class="caption-top">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>+a</td>
<td>Semi-major radius of the ellipsoid axis</td>
</tr>
<tr class="even">
<td>+b</td>
<td>Semi-minor radius of the ellipsoid axis</td>
</tr>
<tr class="odd">
<td>+datum</td>
<td>Datum name</td>
</tr>
<tr class="even">
<td>+ellps</td>
<td>Ellipsoid name</td>
</tr>
<tr class="odd">
<td>+lat_0</td>
<td>Latitude of origin</td>
</tr>
<tr class="even">
<td>+lat_1</td>
<td>Latitude of first standard parallel</td>
</tr>
<tr class="odd">
<td>+lat_2</td>
<td>Latitude of second standard parallel</td>
</tr>
<tr class="even">
<td>+lat_ts</td>
<td>Latitude of true scale</td>
</tr>
<tr class="odd">
<td>+lon_0</td>
<td>Central meridian</td>
</tr>
<tr class="even">
<td>+over</td>
<td>Allow longitude output outside -180 to 180 range, disables wrapping</td>
</tr>
<tr class="odd">
<td>+proj</td>
<td>Projection name</td>
</tr>
<tr class="even">
<td>+south</td>
<td>Denotes southern hemisphere UTM zone</td>
</tr>
<tr class="odd">
<td>+units</td>
<td>meters, US survey feet, etc.</td>
</tr>
<tr class="even">
<td>+x_0</td>
<td>False easting</td>
</tr>
<tr class="odd">
<td>+y_0</td>
<td>False northing</td>
</tr>
<tr class="even">
<td>+zone</td>
<td>UTM zone</td>
</tr>
</tbody>
</table>
</section>
<section id="section-3" class="slide level2">
<h2></h2>
<p><strong>WGS84</strong><br>
<em>EPSG</em>: 4326<br>
<em>PROJ4</em>: <code>+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs</code><br>
- projection name: longlat<br>
- Latitude of origin: WGS84<br>
- Longitude of origin: WGS84<br>
</p>
<p><strong>WGS84</strong><br>
<em>EPSG</em>: 5070<br>
<code>"+proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs"</code><br>
- projection name: <code>aea</code> (Albers Equal Area)<br>
- Latitude of origin: 23<br>
- Longitude of origin: -96<br>
- Latitude of first standard parallel: 29.5<br>
- Latitude of second standard parallel: 45.5<br>
- False Easting: 0<br>
- False Northing: 0<br>
- Datum: NAD83<br>
- Units: m<br>
</p>
</section>
<section id="transform-and-retrive" class="slide level2">
<h2>Transform and retrive</h2>
<div class="{columns}">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a><span class="fu">st_crs</span>(conus)<span class="sc">$</span>epsg</span>
<span id="cb32-2"><a></a><span class="co">#&gt; [1] 4326</span></span>
<span id="cb32-3"><a></a><span class="fu">st_crs</span>(conus)<span class="sc">$</span>proj4string</span>
<span id="cb32-4"><a></a><span class="co">#&gt; [1] "+proj=longlat +datum=WGS84 +no_defs"</span></span>
<span id="cb32-5"><a></a><span class="fu">st_crs</span>(conus)<span class="sc">$</span>datum</span>
<span id="cb32-6"><a></a><span class="co">#&gt; [1] "WGS84"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a>conus5070 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(conus, <span class="dv">5070</span>)</span>
<span id="cb33-2"><a></a></span>
<span id="cb33-3"><a></a><span class="fu">st_crs</span>(conus5070)<span class="sc">$</span>epsg</span>
<span id="cb33-4"><a></a><span class="co">#&gt; [1] 5070</span></span>
<span id="cb33-5"><a></a><span class="fu">st_crs</span>(conus5070)<span class="sc">$</span>proj4string</span>
<span id="cb33-6"><a></a><span class="co">#&gt; [1] "+proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs"</span></span>
<span id="cb33-7"><a></a><span class="fu">st_crs</span>(conus5070)<span class="sc">$</span>datum</span>
<span id="cb33-8"><a></a><span class="co">#&gt; [1] "NAD83"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>

<img data-src="week2-2_files/figure-revealjs/unnamed-chunk-26-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:90.0%"></section>
<section id="revisit-denver" class="slide level2">
<h2>Revisit Denver</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a></a><span class="bu">echo</span> <span class="at">-104.9903</span> 39.7392 <span class="kw">|</span> <span class="ex">proj</span> +proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs</span>
<span id="cb34-2"><a></a><span class="co">#&gt; -723281.88   6827.29</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>red = false origin : blue = Denver</li>
</ul>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img data-src="week2-2_files/figure-revealjs/unnamed-chunk-28-1.png"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img data-src="week2-2_files/figure-revealjs/unnamed-chunk-28-2.png"></p>
</div>
</div>
</div>
</section>
<section id="geodesic-geometries" class="slide level2">
<h2>Geodesic geometries</h2>
<ul>
<li><p>PCSs introduce errors in their geometric measurements because the distance between two points on an ellipsoid is difficult to replicate on a projected coordinate system unless these points are close to one another.</p></li>
<li><p>In most cases, such errors other sources of error in the feature representation outweigh measurement errors made in a PCS making them tolorable.</p></li>
</ul>
<p>However, if the domain of analysis is large (i.e.&nbsp;the North American continent), then the measurement errors associated with a projected coordinate system may no longer be acceptable.</p>
<p>A way to circumvent projected coordinate system limitations is to adopt a <em>geodesic</em> solution.</p>
</section>
<section id="geodesic-measurments" class="slide level2">
<h2>Geodesic Measurments</h2>
<ul>
<li><p>A <strong>geodesic distance</strong> is the shortest distance between two points on an ellipsoid</p></li>
<li><p>A <strong>geodesic area</strong> measurement is one that is measured on an ellipsoid.</p></li>
<li><p>Such measurements are <em>independent</em> of the underlying projected coordinate system.</p></li>
<li><p>Why does this matter?</p></li>
<li><p>Compare the distances measured between Santa Barbara and Amsterdam. The blue line represents the shortest distance between the two points on a <em>planar</em> coordinate system. The red line as measured on a <em>ellipsoid</em>.</p></li>
</ul>

<img data-src="week2-2_files/figure-revealjs/unnamed-chunk-29-1.png" width="2304" class="r-stretch"></section>
<section id="section-4" class="slide level2">
<h2></h2>
<ul>
<li><p>the geodesic distance looks weird given its curved appearance on the projected map.</p></li>
<li><p>this curvature is a byproduct of the current reference system’s increasing distance distortion as one moves towards the pole!</p></li>
<li><p>We can display the geodesic and planar distance on a 3D globe (or a projection that mimics the view of the 3D earth).</p></li>
</ul>

<img data-src="week2-2_files/figure-revealjs/unnamed-chunk-30-1.png" class="quarto-figure quarto-figure-center r-stretch" width="864"></section>
<section id="section-5" class="slide level2">
<h2></h2>
<ul>
<li><p>So if a geodesic measurement is more precise than a planar measurement, why not perform all spatial operations using geodesic geometry?</p></li>
<li><p>The downside is in its computational requirements.</p></li>
<li><p>It’s far more efficient to compute area/distance on a plane than it is on a spheroid.</p></li>
<li><p>This is because geodesic calculations have no simple algebraic solutions and involve approximations that may require iteration! (think optimization or nonlinear solutions)</p></li>
<li><p>So this may be a computationally taxing approach if processing 1,000(s) or 1,000,000(s) of line segments.</p></li>
</ul>
</section>
<section id="gedesic-area-and-length-measurements" class="slide level2">
<h2>Gedesic Area and Length Measurements</h2>
<ul>
<li><p>Not all algorthimns are equal (in terms of speed or accuracy)</p></li>
<li><p>Some more efficient algorithms that minimize computation time may reduce precision in the process.</p></li>
<li><p>Some of ArcMap’s functions offer the option to compute geodesic distances and areas however ArcMap does not clearly indicate <em>how</em> its geodesic calculations are implemented (<a href="https://mgimond.github.io/Spatial/coordinate-systems.html#geodesic-geometries">cite</a></p></li>
<li><p>R is well documented, and is efficient!</p></li>
</ul>
</section>
<section id="distances" class="slide level2">
<h2>Distances</h2>
<p><code>?st_distance</code></p>

<img data-src="images/11-sf-geos-measures.png" class="quarto-figure quarto-figure-center r-stretch" style="width:75.0%"></section>
<section id="native-sf-binds-to-libwgeom" class="slide level2">
<h2>native <code>sf</code> binds to <code>libwgeom</code></h2>
<div class="{columns}">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/11-lwgeom.png" class="quarto-figure quarto-figure-center" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/09-sf-depends.png" class="quarto-figure quarto-figure-center" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="distance-example" class="slide level2">
<h2>Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb35-2"><a></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb35-3"><a></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB</code></pre>
</div>
</div></div>
</section>
<section id="distance-example-1" class="slide level2">
<h2>Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb37-2"><a></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb37-3"><a></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb37-4"><a></a></span>
<span id="cb37-5"><a></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)</code></pre>
</div>
</div></div>
</section>
<section id="distance-example-2" class="slide level2">
<h2>Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb39-2"><a></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb39-3"><a></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb39-4"><a></a></span>
<span id="cb39-5"><a></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb39-6"><a></a></span>
<span id="cb39-7"><a></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)</code></pre>
</div>
</div></div>
</section>
<section id="distance-example-3" class="slide level2">
<h2>Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb41-2"><a></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb41-3"><a></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb41-4"><a></a></span>
<span id="cb41-5"><a></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb41-6"><a></a></span>
<span id="cb41-7"><a></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span>
<span id="cb41-8"><a></a></span>
<span id="cb41-9"><a></a><span class="co"># Greeat Circle Distance</span></span>
<span id="cb41-10"><a></a><span class="fu">st_distance</span>(pts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)
#&gt; Units: [m]
#&gt;         [,1]    [,2]
#&gt; [1,]       0 4050406
#&gt; [2,] 4050406       0</code></pre>
</div>
</div></div>
</section>
<section id="distance-example-4" class="slide level2">
<h2>Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb43-2"><a></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb43-3"><a></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb43-4"><a></a></span>
<span id="cb43-5"><a></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb43-6"><a></a></span>
<span id="cb43-7"><a></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span>
<span id="cb43-8"><a></a></span>
<span id="cb43-9"><a></a><span class="co"># Greeat Circle Distance</span></span>
<span id="cb43-10"><a></a><span class="fu">st_distance</span>(pts)</span>
<span id="cb43-11"><a></a></span>
<span id="cb43-12"><a></a><span class="co"># Euclidean Distance</span></span>
<span id="cb43-13"><a></a><span class="fu">st_distance</span>(pts, <span class="at">which =</span> <span class="st">"Euclidean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)
#&gt; Units: [m]
#&gt;         [,1]    [,2]
#&gt; [1,]       0 4050406
#&gt; [2,] 4050406       0
#&gt; Units: [°]
#&gt;          1        2
#&gt; 1  0.00000 46.12338
#&gt; 2 46.12338  0.00000</code></pre>
</div>
</div></div>
</section>
<section id="distance-example-5" class="slide level2">
<h2>Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb45-2"><a></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb45-3"><a></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb45-4"><a></a></span>
<span id="cb45-5"><a></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb45-6"><a></a></span>
<span id="cb45-7"><a></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span>
<span id="cb45-8"><a></a></span>
<span id="cb45-9"><a></a><span class="co"># Greeat Circle Distance</span></span>
<span id="cb45-10"><a></a><span class="fu">st_distance</span>(pts)</span>
<span id="cb45-11"><a></a></span>
<span id="cb45-12"><a></a><span class="co"># Euclidean Distance</span></span>
<span id="cb45-13"><a></a><span class="fu">st_distance</span>(pts, <span class="at">which =</span> <span class="st">"Euclidean"</span>)</span>
<span id="cb45-14"><a></a></span>
<span id="cb45-15"><a></a><span class="co"># Equal Area PCS</span></span>
<span id="cb45-16"><a></a><span class="fu">st_distance</span>(<span class="fu">st_transform</span>(pts, <span class="dv">5070</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)
#&gt; Units: [m]
#&gt;         [,1]    [,2]
#&gt; [1,]       0 4050406
#&gt; [2,] 4050406       0
#&gt; Units: [°]
#&gt;          1        2
#&gt; 1  0.00000 46.12338
#&gt; 2 46.12338  0.00000
#&gt; Units: [m]
#&gt;         1       2
#&gt; 1       0 4017987
#&gt; 2 4017987       0</code></pre>
</div>
</div></div>
</section>
<section id="distance-example-6" class="slide level2">
<h2>Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb47-2"><a></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb47-3"><a></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb47-4"><a></a></span>
<span id="cb47-5"><a></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb47-6"><a></a></span>
<span id="cb47-7"><a></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span>
<span id="cb47-8"><a></a></span>
<span id="cb47-9"><a></a><span class="co"># Greeat Circle Distance</span></span>
<span id="cb47-10"><a></a><span class="fu">st_distance</span>(pts)</span>
<span id="cb47-11"><a></a></span>
<span id="cb47-12"><a></a><span class="co"># Euclidean Distance</span></span>
<span id="cb47-13"><a></a><span class="fu">st_distance</span>(pts, <span class="at">which =</span> <span class="st">"Euclidean"</span>)</span>
<span id="cb47-14"><a></a></span>
<span id="cb47-15"><a></a><span class="co"># Equal Area PCS</span></span>
<span id="cb47-16"><a></a><span class="fu">st_distance</span>(<span class="fu">st_transform</span>(pts, <span class="dv">5070</span>))</span>
<span id="cb47-17"><a></a></span>
<span id="cb47-18"><a></a><span class="co"># Equal Distance</span></span>
<span id="cb47-19"><a></a><span class="fu">st_distance</span>(<span class="fu">st_transform</span>(pts, eqds))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)
#&gt; Units: [m]
#&gt;         [,1]    [,2]
#&gt; [1,]       0 4050406
#&gt; [2,] 4050406       0
#&gt; Units: [°]
#&gt;          1        2
#&gt; 1  0.00000 46.12338
#&gt; 2 46.12338  0.00000
#&gt; Units: [m]
#&gt;         1       2
#&gt; 1       0 4017987
#&gt; 2 4017987       0
#&gt; Units: [m]
#&gt;         1       2
#&gt; 1       0 3823549
#&gt; 2 3823549       0</code></pre>
</div>
</div></div>
</section>
<section id="distance-example-7" class="slide level2">
<h2>Distance Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a></a>(<span class="at">pts =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="fl">40.7128</span>, <span class="fl">34.4208</span>),</span>
<span id="cb49-2"><a></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.0060</span>, <span class="sc">-</span><span class="fl">119.6982</span> ),</span>
<span id="cb49-3"><a></a>                  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>,<span class="st">"SB"</span>)))</span>
<span id="cb49-4"><a></a></span>
<span id="cb49-5"><a></a>(<span class="at">pts =</span> <span class="fu">st_as_sf</span>(pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb49-6"><a></a></span>
<span id="cb49-7"><a></a>eqds <span class="ot">=</span> <span class="st">'+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'</span></span>
<span id="cb49-8"><a></a></span>
<span id="cb49-9"><a></a><span class="co"># Greeat Circle Distance</span></span>
<span id="cb49-10"><a></a><span class="fu">st_distance</span>(pts)</span>
<span id="cb49-11"><a></a></span>
<span id="cb49-12"><a></a><span class="co"># Euclidean Distance</span></span>
<span id="cb49-13"><a></a><span class="fu">st_distance</span>(pts, <span class="at">which =</span> <span class="st">"Euclidean"</span>)</span>
<span id="cb49-14"><a></a></span>
<span id="cb49-15"><a></a><span class="co"># Equal Area PCS</span></span>
<span id="cb49-16"><a></a><span class="fu">st_distance</span>(<span class="fu">st_transform</span>(pts, <span class="dv">5070</span>))</span>
<span id="cb49-17"><a></a></span>
<span id="cb49-18"><a></a><span class="co"># Equal Distance</span></span>
<span id="cb49-19"><a></a><span class="fu">st_distance</span>(<span class="fu">st_transform</span>(pts, eqds))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<pre><code>#&gt;         y         x name
#&gt; 1 40.7128  -74.0060  NYC
#&gt; 2 34.4208 -119.6982   SB
#&gt; Simple feature collection with 2 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -119.6982 ymin: 34.4208 xmax: -74.006 ymax: 40.7128
#&gt; Geodetic CRS:  WGS 84
#&gt;   name                  geometry
#&gt; 1  NYC   POINT (-74.006 40.7128)
#&gt; 2   SB POINT (-119.6982 34.4208)
#&gt; Units: [m]
#&gt;         [,1]    [,2]
#&gt; [1,]       0 4050406
#&gt; [2,] 4050406       0
#&gt; Units: [°]
#&gt;          1        2
#&gt; 1  0.00000 46.12338
#&gt; 2 46.12338  0.00000
#&gt; Units: [m]
#&gt;         1       2
#&gt; 1       0 4017987
#&gt; 2 4017987       0
#&gt; Units: [m]
#&gt;         1       2
#&gt; 1       0 3823549
#&gt; 2 3823549       0</code></pre>
</div>
</div></div>
</section>
<section id="area-example-conus" class="slide level2">
<h2>Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">

</div></div>
</section>
<section id="area-example-conus-1" class="slide level2">
<h2>Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb52-2"><a></a></span>
<span id="cb52-3"><a></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"WGS84"</span>, <span class="st">"AEA"</span>, <span class="st">"EPDS"</span>),</span>
<span id="cb52-4"><a></a>           <span class="at">area =</span> <span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">st_area</span>(conus)),</span>
<span id="cb52-5"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, <span class="dv">5070</span>))),</span>
<span id="cb52-6"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, eqds)))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">

</div></div>
</section>
<section id="area-example-conus-2" class="slide level2">
<h2>Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb53-2"><a></a></span>
<span id="cb53-3"><a></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"WGS84"</span>, <span class="st">"AEA"</span>, <span class="st">"EPDS"</span>),</span>
<span id="cb53-4"><a></a>           <span class="at">area =</span> <span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">st_area</span>(conus)),</span>
<span id="cb53-5"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, <span class="dv">5070</span>))),</span>
<span id="cb53-6"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, eqds)))))</span>
<span id="cb53-7"><a></a></span>
<span id="cb53-8"><a></a><span class="fu">ggplot</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week2-2_files/figure-revealjs/conus_auto_03_output-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="area-example-conus-3" class="slide level2">
<h2>Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb54-2"><a></a></span>
<span id="cb54-3"><a></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"WGS84"</span>, <span class="st">"AEA"</span>, <span class="st">"EPDS"</span>),</span>
<span id="cb54-4"><a></a>           <span class="at">area =</span> <span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">st_area</span>(conus)),</span>
<span id="cb54-5"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, <span class="dv">5070</span>))),</span>
<span id="cb54-6"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, eqds)))))</span>
<span id="cb54-7"><a></a></span>
<span id="cb54-8"><a></a><span class="fu">ggplot</span>(df) <span class="sc">+</span></span>
<span id="cb54-9"><a></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> <span class="fu">as.numeric</span>(area) ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week2-2_files/figure-revealjs/conus_auto_04_output-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="area-example-conus-4" class="slide level2">
<h2>Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb55-2"><a></a></span>
<span id="cb55-3"><a></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"WGS84"</span>, <span class="st">"AEA"</span>, <span class="st">"EPDS"</span>),</span>
<span id="cb55-4"><a></a>           <span class="at">area =</span> <span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">st_area</span>(conus)),</span>
<span id="cb55-5"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, <span class="dv">5070</span>))),</span>
<span id="cb55-6"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, eqds)))))</span>
<span id="cb55-7"><a></a></span>
<span id="cb55-8"><a></a><span class="fu">ggplot</span>(df) <span class="sc">+</span></span>
<span id="cb55-9"><a></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> <span class="fu">as.numeric</span>(area) )) <span class="sc">+</span></span>
<span id="cb55-10"><a></a>  <span class="fu">theme_linedraw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week2-2_files/figure-revealjs/conus_auto_05_output-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="area-example-conus-5" class="slide level2">
<h2>Area Example: CONUS</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a></a>us_u_mp <span class="ot">=</span> <span class="fu">st_cast</span>(us_u_ml, <span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb56-2"><a></a></span>
<span id="cb56-3"><a></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"WGS84"</span>, <span class="st">"AEA"</span>, <span class="st">"EPDS"</span>),</span>
<span id="cb56-4"><a></a>           <span class="at">area =</span> <span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">st_area</span>(conus)),</span>
<span id="cb56-5"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, <span class="dv">5070</span>))),</span>
<span id="cb56-6"><a></a>            <span class="fu">sum</span>(<span class="fu">st_area</span>(<span class="fu">st_transform</span>(conus, eqds)))))</span>
<span id="cb56-7"><a></a></span>
<span id="cb56-8"><a></a><span class="fu">ggplot</span>(df) <span class="sc">+</span></span>
<span id="cb56-9"><a></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> <span class="fu">as.numeric</span>(area) )) <span class="sc">+</span></span>
<span id="cb56-10"><a></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb56-11"><a></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"SRS"</span>, <span class="at">y =</span> <span class="st">"m2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="week2-2_files/figure-revealjs/conus_auto_06_output-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="units-in-sf" class="slide level2">
<h2>Units in <code>sf</code></h2>
<ul>
<li><p>The CRS in <code>sf</code> encodes the units of measurement relating to spatial features</p></li>
<li><p>Where possible geometric operations such as <code>st_distance()</code>, <code>st_length()</code> and <code>st_area()</code> report results with a units attribute appropriate for the CRS:</p></li>
<li><p>This can be both handy and very confusing for those new to it. Consider the following:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a></a>(<span class="at">l =</span> <span class="fu">sum</span>(<span class="fu">st_length</span>(conus)))</span>
<span id="cb57-2"><a></a><span class="co">#&gt; 94980149 [m]</span></span>
<span id="cb57-3"><a></a>(<span class="at">a =</span> <span class="fu">sum</span>(<span class="fu">st_area</span>(conus)))</span>
<span id="cb57-4"><a></a><span class="co">#&gt; 7.83761e+12 [m^2]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-6" class="slide level2">
<h2></h2>
<p>We can set units if we do manipulations as well using the units package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a></a>units<span class="sc">::</span><span class="fu">set_units</span>(l, <span class="st">"km"</span>)</span>
<span id="cb58-2"><a></a><span class="co">#&gt; 94980.15 [km]</span></span>
<span id="cb58-3"><a></a>units<span class="sc">::</span><span class="fu">set_units</span>(l, <span class="st">"mile"</span>)</span>
<span id="cb58-4"><a></a><span class="co">#&gt; 59017.93 [mile]</span></span>
<span id="cb58-5"><a></a></span>
<span id="cb58-6"><a></a>units<span class="sc">::</span><span class="fu">set_units</span>(a, <span class="st">"ha"</span>)</span>
<span id="cb58-7"><a></a><span class="co">#&gt; 783760974 [ha]</span></span>
<span id="cb58-8"><a></a>units<span class="sc">::</span><span class="fu">set_units</span>(a, <span class="st">"km2"</span>)</span>
<span id="cb58-9"><a></a><span class="co">#&gt; 7837610 [km^2]</span></span>
<span id="cb58-10"><a></a>units<span class="sc">::</span><span class="fu">set_units</span>(a, <span class="st">"in2"</span>)</span>
<span id="cb58-11"><a></a><span class="co">#&gt; 1.214832e+16 [in^2]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="units-are-a-class" class="slide level2">
<h2>Units are a class</h2>
<ul>
<li>units are an S3 data object with attribute information and “rules of engagement”</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a></a><span class="fu">class</span>(<span class="fu">st_length</span>(conus)) </span>
<span id="cb59-2"><a></a><span class="co">#&gt; [1] "units"</span></span>
<span id="cb59-3"><a></a><span class="fu">attributes</span>(<span class="fu">st_length</span>(conus)) <span class="sc">|&gt;</span> <span class="fu">unlist</span>()</span>
<span id="cb59-4"><a></a><span class="co">#&gt; units.numerator           class </span></span>
<span id="cb59-5"><a></a><span class="co">#&gt;             "m"         "units"</span></span>
<span id="cb59-6"><a></a></span>
<span id="cb59-7"><a></a><span class="fu">st_length</span>(conus) <span class="sc">+</span> <span class="dv">100</span></span>
<span id="cb59-8"><a></a><span class="co">#&gt; Error in Ops.units(st_length(conus), 100): both operands of the expression should be "units" objects</span></span>
<span id="cb59-9"><a></a></span>
<span id="cb59-10"><a></a>conus <span class="sc">|&gt;</span> </span>
<span id="cb59-11"><a></a>  <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fu">st_area</span>(.)) <span class="sc">|&gt;</span> </span>
<span id="cb59-12"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> area)) <span class="sc">+</span> </span>
<span id="cb59-13"><a></a>  <span class="fu">geom_col</span>()</span>
<span id="cb59-14"><a></a><span class="co">#&gt; Error in `stopifnot()`:</span></span>
<span id="cb59-15"><a></a><span class="co">#&gt; ℹ In argument: `area = st_area(.)`.</span></span>
<span id="cb59-16"><a></a><span class="co">#&gt; Caused by error:</span></span>
<span id="cb59-17"><a></a><span class="co">#&gt; ! object '.' not found</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="unit-values-can-be-stripped-of-their-attributes-if-need-be" class="slide level2">
<h2>Unit values can be stripped of their attributes if need be:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a></a><span class="co"># Via drop_units</span></span>
<span id="cb60-2"><a></a>(units<span class="sc">::</span><span class="fu">drop_units</span>(<span class="fu">sum</span>(<span class="fu">st_length</span>(conus))))</span>
<span id="cb60-3"><a></a><span class="co">#&gt; [1] 94980149</span></span>
<span id="cb60-4"><a></a></span>
<span id="cb60-5"><a></a><span class="co"># Via casting</span></span>
<span id="cb60-6"><a></a>(<span class="fu">as.numeric</span>(<span class="fu">sum</span>(<span class="fu">st_length</span>(conus))))</span>
<span id="cb60-7"><a></a><span class="co">#&gt; [1] 94980149</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../csu-rams-logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://github.com/mikejohnson51/csu-ess-523c/">ESS 523c: Environmental Data Science Applications: Water Resources</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': true,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,

        height: 720,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script>
      Reveal.addEventListener( 'slidechanged', function( event ) {
        console.log("hello")
        
        slide_id = event.currentSlide.id
        link = "annotations" + ".html#" + slide_id
        
        var annotation_div = document.createElement('div')
        annotation_div.setAttribute("class", "annotation-link")
        
        var notes_link = document.createElement('a')
        notes_link.setAttribute("href", link)
        notes_link.setAttribute("target", "_blank")
        
        var iii = document.createElement('i')
        iii.setAttribute("class", "fa fa-info")
        notes_link.appendChild(iii)
        
        annotation_div.appendChild(notes_link)
        
        var tmp = event.currentTarget.getElementsByClassName("annotation-link")
        if (tmp.length === 1) {
          tmp[0].remove()
        }
        
        if (event.currentSlide.classList.contains("annotation")) {
          event.currentTarget.append(annotation_div)
        }
      } );

    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>